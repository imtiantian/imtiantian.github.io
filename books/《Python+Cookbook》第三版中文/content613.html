<div id="pf265" class="pf w0 h0" data-page-no="265"><div class="pc pc265 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg265.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 wsd91">17.20<span class="_ _e"> </span>15.20 <span class="ff1 ws165">处理 </span><span class="ls23d">C</span><span class="ff1">语言中的可迭代对象</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">17.20.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y114 ff1 fs3 fc0 sc0 ls2d ws15fb">你想写 <span class="ff4 ls252">C</span><span class="ls13 wse5">扩展代码处理来自任何可迭代对象如列表<span class="_ _1"></span>、元组<span class="_ _1"></span>、文件或生成器中的元</span></div><div class="t m0 x5 h9 y115 ff1 fs3 fc0 sc0 ls0">素。</div><div class="t m0 x5 he y116 ff2 fs2 fc4 sc0 ls0 wsadf">17.20.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 yf10 ff1 fs3 fc0 sc0 ls0 ws38">下面是一个 <span class="ff4 ls8">C</span>扩展函数例子，演示了怎样处理可迭代对象中的元素：</div><div class="t m0 x5 hf y3ab2 ff8 fs5 fc0 sc0 ls0 ws4">static PyObject *py_consume_iterable(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y3ab3 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *obj;</div><div class="t m0 x19 hf y3ab4 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *iter;</div><div class="t m0 x19 hf y3ab5 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *item;</div><div class="t m0 x19 hf y3ab6 ff8 fs5 fc0 sc0 ls0 ws4">if (!PyArg_ParseTuple(args, &quot;O&quot;, &amp;obj)) {</div><div class="t m0 x15 hf y30b9 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y30ba ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3ab7 ff8 fs5 fc0 sc0 ls0 ws4">if ((iter = PyObject_GetIter(obj)) == NULL) {</div><div class="t m0 x15 hf y660 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y3ab8 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3ab9 ff8 fs5 fc0 sc0 ls0 ws4">while ((item = PyIter_Next(iter)) != NULL) {</div><div class="t m0 x15 hf y3aba ff8 fs5 fc0 sc0 ls0 ws4">/* Use item */</div><div class="t m0 x15 hf y3abb ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x15 hf y3abc ff8 fs5 fc0 sc0 ls0">Py_DECREF(item);</div><div class="t m0 x19 hf y3abd ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3abe ff8 fs5 fc0 sc0 ls0">Py_DECREF(iter);</div><div class="t m0 x19 hf y3abf ff8 fs5 fc0 sc0 ls0 ws4">return Py_BuildValue(&quot;&quot;);</div><div class="t m0 x5 hf y3ac0 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 he y3ac1 ff2 fs2 fc4 sc0 ls0 wsadf">17.20.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y3ac2 ff1 fs3 fc0 sc0 ls0 ws15fc">本<span class="_ _0"></span>节<span class="_ _0"></span>中<span class="_ _0"></span>的<span class="_ _0"></span>代<span class="_ _0"></span>码<span class="_ _0"></span>和 <span class="ff4 ws15fd">Python </span><span class="ws15fe">中<span class="_ _6"></span>对<span class="_ _0"></span>应<span class="_ _0"></span>代<span class="_ _0"></span>码<span class="_ _0"></span>类<span class="_ _0"></span>似。 <span class="ff6 ws3a9">PyObject GetIter()<span class="_ _b"> </span></span><span class="ls16d wsa5b">的调用和调用<span class="_ _d"></span></span></span></div><div class="t m0 x5 h9 y3ac3 ff6 fs3 fc0 sc0 ls0 ws15ff">iter() <span class="ff1 ws1600">一样<span class="_ _6"></span>可获<span class="_ _6"></span>得一<span class="_ _6"></span>个迭<span class="_ _6"></span>代<span class="_ _6"></span>器。 </span>PyIter Next() <span class="ff1 ws1601">函数<span class="_ _6"></span>调用 </span><span class="ws4dd">next <span class="ff1 wsa0">方<span class="_ _6"></span>法<span class="_ _6"></span>返回<span class="_ _6"></span>下一<span class="_ _6"></span>个元<span class="_ _6"></span>素</span></span></div><div class="t m0 x5 h7 y3ac4 ff1 fs3 fc0 sc0 ls1c">或<span class="ff4 ls0 wsa5">NULL(</span><span class="ls0 wsa0">如果没有元素了<span class="ff4 wsa5">)</span><span class="ws1602">。要注意正确的内存管理—<span class="_ _19"></span>— <span class="ff6 wscd1">Py<span class="_ _7"> </span>DECREF() </span>需要同时在产生</span></span></div><div class="t m0 x5 h9 y218a ff1 fs3 fc0 sc0 ls0">的元素和迭代器对象本身上同时被调用，以避免出现内存泄露。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">17.20.<span class="_ _36"> </span>15.20 <span class="ff1 ws16b">处理 </span><span class="ls246">C</span><span class="ff1 ws15bc">语言中的可迭代对象 </span>604</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
