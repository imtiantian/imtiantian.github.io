<div id="pf1bc" class="pf w0 h0" data-page-no="1bc"><div class="pc pc1bc w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1bc.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y765 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Return True if receiving is allowed<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y766 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">False</span></div><div class="t m0 x15 hf y768 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">handle_receive<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y769 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Perform the receive operation<span class="ff9">&apos;</span></span></div><div class="t m0 x16 h10 y76a ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x15 hf y76c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wants_to_send<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y842 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Return True if sending is requested<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y1d75 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">False</span></div><div class="t m0 x15 hf y1d77 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">handle_send<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1d78 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">Send outgoing data<span class="ff9">&apos;</span></span></div><div class="t m0 x16 h10 y1d79 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y2ce5 ff1 fs3 fc0 sc0 ls0">这个类的实例作为插件被放入类似下面这样的事件循环中：</div><div class="t m0 x5 h10 y2ce6 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">select</span></div><div class="t m0 x5 hf y2ce7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">event_loop<span class="fc0">(handlers):</span></span></div><div class="t m0 x15 hf y2ce8 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2ce9 ff8 fs5 fc0 sc0 ls0 ws2a3">wants_recv <span class="fc6 ls32">=</span><span class="ws159">[h <span class="ff7 fca ws139">for </span><span class="ls33">h</span><span class="ff7 fca ws157">in </span><span class="ws16d">handlers <span class="ff7 fca ws157">if </span><span class="ws13a">h<span class="fc6 ls34">.</span>wants_to_receive()]</span></span></span></div><div class="t m0 x16 hf y2cea ff8 fs5 fc0 sc0 ls0 ws2a3">wants_send <span class="fc6 ls32">=</span><span class="ws159">[h <span class="ff7 fca ws139">for </span><span class="ls33">h</span><span class="ff7 fca ws157">in </span><span class="ws16d">handlers <span class="ff7 fca ws157">if </span><span class="ws13a">h<span class="fc6 ls34">.</span>wants_to_send()]</span></span></span></div><div class="t m0 x16 hf y2ceb ff8 fs5 fc0 sc0 ls0 ws13b">can_recv, can_send, _ <span class="fc6 ls32">=</span><span class="ws13a">select<span class="fc6">.</span><span class="ws4">select(wants_recv, wants_send, [])</span></span></div><div class="t m0 x16 hf y2cec ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">h</span><span class="ws157">in <span class="ff8 fc0">can_recv:</span></span></div><div class="t m0 x17 hf y2ced ff8 fs5 fc0 sc0 ls0 ws13a">h<span class="fc6 ls34">.</span>handle_receive()</div><div class="t m0 x16 hf y2cee ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">h</span><span class="ws157">in <span class="ff8 fc0">can_send:</span></span></div><div class="t m0 x17 hf y2cef ff8 fs5 fc0 sc0 ls0 ws13a">h<span class="fc6 ls34">.</span>handle_send()</div><div class="t m0 x0 h9 ybc5 ff1 fs3 fc0 sc0 ls10 ws1030">事件循环的关键部分是 <span class="ff6 ls0 ws5eb">select() `` <span class="ffc fs7 ls1f6 ws1031">调用，<span class="_ _1"></span>它会不断轮询文件描述符从而激活它。在<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y2cf0 ffc fs7 fc0 sc0 ls0 ws1032">调用 <span class="ff6 fs3 ws1033">``select() <span class="ff1 wsa0">之前，时间循环会询问所有的处理器来决定哪一个想接受或发生。然</span></span></div><div class="t m0 x5 h9 y2cf1 ff1 fs3 fc0 sc0 ls51 ws256">后它将结果列表提供给 <span class="ff6 ls0 ws1034">select() </span><span class="ws988">。然后 <span class="ff6 ls0 ws1034">select() </span><span class="ws1c8">返回准备接受或发送的对象组成的</span></span></div><div class="t m0 x5 h9 y2cf2 ff1 fs3 fc0 sc0 ls0 ws14">列表。然后相应的 <span class="ff6 ws1d1">handle<span class="_ _7"> </span>receive() </span><span class="ls5">或</span><span class="ff6 ws25d">handle<span class="_ _16"> </span>send() </span>方法被触发。</div><div class="t m0 x0 h9 y2cf3 ff1 fs3 fc0 sc0 ls0 wsa0">编<span class="_ _6"></span>写应<span class="_ _6"></span>用<span class="_ _6"></span>程<span class="_ _6"></span>序的<span class="_ _6"></span>时<span class="_ _6"></span>候，<span class="_ _6"></span><span class="ff6 ws1035">EventHandler </span>的<span class="_ _6"></span>实例<span class="_ _6"></span>会<span class="_ _6"></span>被<span class="_ _6"></span>创<span class="_ _6"></span>建。例<span class="_ _6"></span>如，<span class="_ _6"></span>下<span class="_ _6"></span>面<span class="_ _6"></span>是两<span class="_ _6"></span>个<span class="_ _6"></span>简<span class="_ _6"></span>单<span class="_ _6"></span>的</div><div class="t m0 x5 h7 y2cf4 ff1 fs3 fc0 sc0 ls0 ws14">基于 <span class="ff4 ws8a">UDP </span>网络服务的处理器例子：</div><div class="t m0 x5 h10 yda7 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">socket</span></div><div class="t m0 x5 h10 yda8 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf yda9 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UDPServer<span class="ff8 fc0">(EventHandler):</span></span></div><div class="t m0 x15 hf ydaa ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, address):</span></span></span></div><div class="t m0 x16 hf ydab ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">sock </span><span class="ls33">=</span><span class="fc0">socket</span><span class="ls34">.</span><span class="fc0">socket(socket</span><span class="ls34">.</span><span class="fc0 ws13b">AF_INET, socket</span>.<span class="fc0">SOCK_DGRAM)</span></span></div><div class="t m0 x16 hf ydac ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">sock</span><span class="ls34">.</span><span class="fc0">bind(address)</span></span></div><div class="t m0 x15 hf y7c6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">fileno<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y7c7 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">sock<span class="fc6 ls34">.</span>fileno()</span></span></div><div class="t m0 x15 hf ydad ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wants_to_receive<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y20f7 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">True</span></div><div class="t m0 x5 hf ydaf ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UDPTimeServer<span class="ff8 fc0">(UDPServer):</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">13.12.<span class="_ _36"> </span>11.12 <span class="ff1 ws36c">理解事件驱动的 </span><span class="ws102f">IO 435</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
