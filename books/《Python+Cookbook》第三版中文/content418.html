<div id="pf1a2" class="pf w0 h0" data-page-no="1a2"><div class="pc pc1a2 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a2.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h9 y2a ff1 fs3 fc0 sc0 ls0 ws14">使用 <span class="ff6 ws17d">str() </span>转换它。例如：</div><div class="t m0 x5 hf y2a84 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">ipaddress<span class="fc6 ls34">.</span>ip_address(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">127.0.0.1<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2a85 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws146">socket <span class="fca">import <span class="ff8 fc0 ws13b">socket, AF_INET, SOCK_STREAM</span></span></span></span></div><div class="t m0 x5 hf y2a86 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13b">socket(AF_INET, SOCK_STREAM)</span></span></div><div class="t m0 x5 hf y2a87 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0 ws208">connect((a, </span><span class="fc7">8080<span class="fc0">))</span></span></span></span></div><div class="t m0 x5 hf y2a88 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y2a89 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y2a8a ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws13b">: Can<span class="ff9 ls34">&apos;</span>t convert <span class="ff9 ls34">&apos;</span><span class="ws13a">IPv4Address<span class="ff9 ls32">&apos;</span><span class="ws4">object to str implicitly</span></span></span></div><div class="t m0 x5 hf y2a8b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">connect((<span class="fca">str</span><span class="ws13c">(a), </span><span class="fc7">8080</span>))</span></span></span></div><div class="t m0 x5 hf y2a8c ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y2a8d ff1 fs3 fc0 sc0 ls0 wsc">更多相关内容，请参考 <span class="ff4 fc3 ws9c">An In<span class="_ _1"></span>tro<span class="_ _6"></span>duction to the ipaddress Mo<span class="_ _6"></span>dule</span></div><div class="t m0 x5 hd y2a8e ff2 fs4 fc4 sc0 ls0 ws211">13.5<span class="_ _e"> </span>11.5 <span class="ff1 ws357">创建一个简单的 </span><span class="wseff">REST <span class="ff1">接口</span></span></div><div class="t m0 x5 he y2a8f ff2 fs2 fc4 sc0 ls0 ws212">13.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y2a90 ff1 fs3 fc0 sc0 ls40 wsf00">你想使用一个简单的 <span class="ff4 ls0 wsf01">REST </span><span class="ws180">接口通过网络远程控制或访问你的应用程序，但是你<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y2a91 ff1 fs3 fc0 sc0 ls0 ws38">又不想自己去安装一个完整的 <span class="ff4 wsf02">w<span class="_ _1"></span>eb <span class="ff1">框架。</span></span></div><div class="t m0 x5 he y2a92 ff2 fs2 fc4 sc0 ls0 ws212">13.5.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y2a93 ff1 fs3 fc0 sc0 ls0 wsf03">构<span class="_ _12"></span>建<span class="_ _0"></span>一<span class="_ _12"></span>个 <span class="ff4 wsf04">REST </span><span class="ls1df wsf05">风格的接口最简单的方法是创建一个基于 </span><span class="ff4 wsf06">WSGI </span><span class="wsa0">标<span class="_ _12"></span>准<span class="_ _0"></span>（<span class="ff4">PEP</span></span></div><div class="t m0 x5 h7 y2a94 ff4 fs3 fc0 sc0 ls0 wsa5">3333<span class="ff1">）的很小的库，下面是一个例子：</span></div><div class="t m0 x5 h11 y2a95 ffa fs5 fcd sc0 ls0 ws4"># resty.py</div><div class="t m0 x5 h10 y2a96 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">cgi</span></div><div class="t m0 x5 hf y2a97 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">notfound_404<span class="fc0 ws13b">(environ, start_response):</span></span></div><div class="t m0 x15 hf y2a98 ff8 fs5 fc0 sc0 ls0 ws13a">start_response(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">404 Not Found<span class="ff9 ls34">&apos;</span><span class="fc0">, [ (</span><span class="ff9 ls34">&apos;</span><span class="ws13a">Content-type<span class="ff9 ls34">&apos;</span></span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">text/plain<span class="ff9 ls34">&apos;</span></span><span class="ws13b">) ])</span></div><div class="t m0 x15 hf y2a99 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">[b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Not Found<span class="ff9 ws13b">&apos;</span></span>]</span></div><div class="t m0 x5 hf y2a9a ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">PathDispatcher<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2a9b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y2a9c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">pathmap </span><span class="ls33">=</span><span class="fc0 ws13b">{ }</span></span></div><div class="t m0 x15 hf y2a9d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__call__<span class="fc0">(<span class="fca">self</span><span class="ws4">, environ, start_response):</span></span></span></div><div class="t m0 x16 hf y2a9e ff8 fs5 fc0 sc0 ls0 ws161">path <span class="fc6 ls33">=</span><span class="ws13a">environ[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">PATH_INFO<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x16 hf y2a9f ff8 fs5 fc0 sc0 ls0 ws145">params <span class="fc6 ls32">=</span><span class="ws13a">cgi<span class="fc6">.</span>FieldStorage(environ[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">wsgi.input<span class="ff9 ws13b">&apos;</span></span>],</span></div><div class="t m0 x1e hf y23 ff8 fs5 fc0 sc0 ls0 ws13a">environ<span class="fc6 ls34">=</span>environ)</div><div class="t m0 x16 hf y137f ff8 fs5 fc0 sc0 ls0 ws145">method <span class="fc6 ls32">=</span><span class="ws13a">environ[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">REQUEST_METHOD<span class="ff9 ls34">&apos;</span></span><span class="ls34">]</span><span class="fc6">.</span>lower()</span></div><div class="t m0 x16 hf y1380 ff8 fs5 fc0 sc0 ls0 ws13a">environ[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">params<span class="ff9 ws13b">&apos;</span></span><span class="ls33">]<span class="fc6 ls32">=</span></span><span class="ws4">{ key: params<span class="fc6 ls34">.</span><span class="ws147">getvalue(key) <span class="ff7 fca ws139">for </span><span class="ws158">key <span class="ff7 fca ws157">in </span><span class="ws13b">params }</span></span></span></span></div><div class="t m0 x16 hf y573 ff8 fs5 fc0 sc0 ls0 ws155">handler <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span><span class="fc0">pathmap<span class="fc6 ls34">.</span><span class="ws13b">get((method,path), notfound_404)</span></span></span></div><div class="t m0 x16 hf y574 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13b">handler(environ, start_response)</span></div><div class="t m0 x15 hf y576 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">register<span class="fc0">(<span class="fca">self</span><span class="ws4">, method, path, function):</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.5.<span class="_ _5"> </span>11.5 <span class="ff1 ws36c">创建一个简单的 </span><span class="wsf07">REST <span class="ff1 wsf08">接口 </span>409</span></div><a class="l" href="https://docs.python.org/3/howto/ipaddress.html"><div class="d m1" style="border-style:none;position:absolute;left:323.061000px;bottom:898.539000px;width:211.475000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
