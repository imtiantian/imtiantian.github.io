<div id="pff3" class="pf w0 h0" data-page-no="f3"><div class="pc pcf3 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgf3.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y181 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws248">datetime </span><span class="ws146">import <span class="ff8 fc0">date</span></span></span></div><div class="t m0 x5 hf y182 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">d<span class="fc6 ls33">=</span><span class="ls0 ws13a">date(<span class="fc7">2012</span><span class="ls33">,</span><span class="fc7">12</span><span class="ls33">,</span><span class="fc7">21</span>)</span></span></div><div class="t m0 x5 hf y183 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">format(d)</span></div><div class="t m0 x5 hf y184 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">2012-12-21<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y185 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">format(d,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws23d">%A, %B </span><span class="ffa fcf">%d</span><span class="fc9 ls34 ws9dd">, %Y<span class="ff9 ls0 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y186 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Friday, December 21, 2012<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y187 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">The end is {:<span class="ffa fcf ws159">%d </span><span class="ws23d">%b %Y}. Goodbye</span></span>&apos;<span class="ff8 fc6">.<span class="fc0 ls0">format(d)</span></span></span></div><div class="t m0 x5 hf y188 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">The end is 21 Dec 2012. Goodbye<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y98e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1a4a ff1 fs3 fc0 sc0 ls0 ws38">对于内置类型的格式化有一些标准的约定。可以参考 <span class="ff4 fc3 ws9de">string <span class="ff1 wsc">模块文档 </span></span>说明。</div><div class="t m0 x5 hd y1a4b ff2 fs4 fc4 sc0 ls0 ws9c6">10.3<span class="_ _e"> </span>8.3 <span class="ff1">让对象支持上下文管理协议</span></div><div class="t m0 x5 he y1097 ff2 fs2 fc4 sc0 ls0 ws212">10.3.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y1a4c ff1 fs3 fc0 sc0 ls0 ws14">你想让你的对象支持上下文管理协议 <span class="ff4 ws9df">(with </span><span class="wsa0">语句<span class="ff4 ls1b">)</span>。</span></div><div class="t m0 x5 he y1a4d ff2 fs2 fc4 sc0 ls0 ws212">10.3.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1a4e ff1 fs3 fc0 sc0 ls30 ws9e0">为了让一个对象兼容 <span class="ff6 ls0 ws24a">with <span class="ff1 ws9e1">语句，<span class="_ _6"></span>你<span class="_ _6"></span>需要<span class="_ _6"></span>实<span class="_ _6"></span>现 </span><span class="ws9e2">enter<span class="_ _e"> </span>() </span></span><span class="ls160">和<span class="ff6 ls0 ws9e2">exit<span class="_ _e"> </span>() <span class="ff1 wsa0">方法。<span class="_ _6"></span>例</span></span></span></div><div class="t m0 x5 h9 y1a4f ff1 fs3 fc0 sc0 ls0">如，考虑如下的一个类，它能为我们创建一个网络连接：</div><div class="t m0 x5 hf y1a50 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">socket <span class="fca">import <span class="ff8 fc0 ws13b">socket, AF_INET, SOCK_STREAM</span></span></span></div><div class="t m0 x5 hf y1a51 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">LazyConnection<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1a52 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, address, family</span><span class="fc6">=</span><span class="ws16d">AF_INET, </span><span class="fca">type<span class="fc6 ls34">=</span></span>SOCK_STREAM):</span></span></div><div class="t m0 x16 hf y1a53 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">address </span><span class="ls33">=</span><span class="fc0">address</span></span></div><div class="t m0 x16 hf y1a54 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">family </span><span class="ls32">=</span><span class="fc0">family</span></span></div><div class="t m0 x16 hf y700 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">type </span><span class="ls33">=</span></span>type</div><div class="t m0 x16 hf y1a55 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">sock </span><span class="ls33">=</span></span>None</div><div class="t m0 x15 hf y1a56 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__enter__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1a57 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws161">sock </span></span>is not <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1a58 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Already connected</span>&apos;</span><span class="fc0">)</span></span></div><div class="t m0 x16 hf y1a59 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">sock </span><span class="ls33">=</span><span class="fc0">socket(</span></span>self<span class="fc6">.<span class="fc0 ws155">family, </span></span>self<span class="fc6 ls34">.</span><span class="fc0">type)</span></div><div class="t m0 x16 hf y1a5a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">sock</span><span class="ls34">.</span><span class="fc0">connect(</span></span>self<span class="fc6 ls34">.</span><span class="fc0">address)</span></div><div class="t m0 x16 hf y1a5b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">sock</span></span></div><div class="t m0 x15 hf y1a5c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__exit__<span class="fc0">(<span class="fca">self</span><span class="ws4">, exc_ty, exc_val, tb):</span></span></span></div><div class="t m0 x16 hf y1a5d ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">sock</span><span class="ls34">.</span><span class="fc0">close()</span></span></div><div class="t m0 x16 hf y1a5e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">sock </span><span class="ls33">=</span></span>None</div><div class="t m0 x0 h9 y1a5f ff1 fs3 fc0 sc0 ls3a ws153">这个类的关键特点在于它表示了一个网络连接，但是初始化的时候并不会做任何事</div><div class="t m0 x5 h7 y1a60 ff1 fs3 fc0 sc0 ls8d">情<span class="ff4 ls1b">(</span><span class="ls0 wsa0">比如它并没有建立一个连接<span class="ff4 wsa5">)</span><span class="ws9e3">。连接的建立和关闭是使用 <span class="ff6 ws9e4">with </span></span>语句自动完成的，例</span></div><div class="t m0 x5 h9 y1a61 ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">10.3.<span class="_ _5"> </span>8.3 <span class="ff1 ws23b">让对象支持上下文管理协议 </span>234</div><a class="l" href="https://docs.python.org/3/library/string.html"><div class="d m1" style="border-style:none;position:absolute;left:556.188000px;bottom:925.495500px;width:81.056000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
