<div id="pf1c4" class="pf w0 h0" data-page-no="1c4"><div class="pc pc1c4 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1c4.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls16 ws1059">当你创建好一个线程对象后<span class="_ _c"></span>，该对象并不会立即执行<span class="_ _c"></span>，除非你调用它的 <span class="ff6 ls0">start()</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0 ws105a">方法<span class="_ _6"></span>（当你<span class="_ _6"></span>调<span class="_ _6"></span>用 <span class="ff6 ws3dd">start() </span><span class="ls12 wse4">方法时，它会<span class="_ _1"></span>调用你传递进来的函数，并把你传递进来的参<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y2c ff1 fs3 fc0 sc0 ls12 wse4">数传递给该函数）<span class="_ _2e"></span>。<span class="ff4 ls0 wsd26">Python </span>中的线程会在一个单独的系统级线程中执行（比如说一个<span class="_ _1"></span></div><div class="t m0 x5 h7 y2d ff4 fs3 fc0 sc0 ls0 ws105b">POSIX <span class="ff1 ws495">线程或者一个 </span><span class="ws105c">Windo<span class="_ _1"></span>ws <span class="ff1 wsa0">线程）<span class="_ _f"></span>，这些线程将由操作系统来全权管理。线程一旦</span></span></div><div class="t m0 x5 h9 y2e ff1 fs3 fc0 sc0 ls0 wsa0">启<span class="_ _6"></span>动，将<span class="_ _6"></span>独<span class="_ _6"></span>立<span class="_ _6"></span>执<span class="_ _6"></span>行<span class="_ _6"></span>直到<span class="_ _6"></span>目<span class="_ _6"></span>标<span class="_ _6"></span>函<span class="_ _6"></span>数<span class="_ _6"></span>返回。<span class="_ _6"></span>你<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>查<span class="_ _6"></span>询<span class="_ _6"></span>一个<span class="_ _6"></span>线<span class="_ _6"></span>程<span class="_ _6"></span>对<span class="_ _6"></span>象<span class="_ _6"></span>的状<span class="_ _6"></span>态，<span class="_ _6"></span>看<span class="_ _6"></span>它<span class="_ _6"></span>是<span class="_ _6"></span>否还</div><div class="t m0 x5 h9 y2f ff1 fs3 fc0 sc0 ls0">在执行：</div><div class="t m0 x5 hf y2d87 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ls34">t<span class="fc6">.</span><span class="ls0">is_alive():</span></span></div><div class="t m0 x15 hf y2d88 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Still running<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y2d89 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y2d8a ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Completed<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h9 y2d8b ff1 fs3 fc0 sc0 ls0">你也可以将一个线程加入到当前线程，并等待它终止：</div><div class="t m0 x5 hf y2d8c ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">join()</span></span></div><div class="t m0 x0 h7 y2d8d ff4 fs3 fc0 sc0 ls0 ws3cb">Python <span class="ff1 ls30 ws138">解释器在所有线程都终止后才继续执行代码剩余的部分。对于需要长时间<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2d8e ff1 fs3 fc0 sc0 ls0">运行的线程或者需要一直运行的后台任务，你应当考虑使用后台线程。例如：</div><div class="t m0 x5 hf y2b01 ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">Thread(target<span class="fc6 ls34">=</span><span class="ws4">countdown, args<span class="fc6 ls34">=</span></span>(<span class="fc7">10</span><span class="ws13b">,), daemon<span class="fc6 ls34">=</span></span><span class="fca">True</span>)</span></div><div class="t m0 x5 hf y2d8f ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x0 h9 y2d90 ff1 fs3 fc0 sc0 ls0 wsa0">后台线程无法等待，不<span class="_ _6"></span>过，这些线程会在主线程终<span class="_ _6"></span>止时自动销毁。除了如上<span class="_ _6"></span>所示的</div><div class="t m0 x5 h9 y2d91 ff1 fs3 fc0 sc0 ls1e ws111">两个操作<span class="_ _1"></span>，并没有太多可以对线程做的事情<span class="_ _1"></span>。你无法结束一个线程，无法给它发<span class="_ _1"></span>送信</div><div class="t m0 x5 h9 y2d92 ff1 fs3 fc0 sc0 ls1e ws111">号<span class="_ _1"></span>，无法调整它的调度，也无法执行其他高级操作<span class="_ _c"></span>。如果需要这些<span class="_ _6"></span>特性<span class="_ _1"></span>，你需要自己</div><div class="t m0 x5 h9 y2d93 ff1 fs3 fc0 sc0 ls1e ws111">添加<span class="_ _1"></span>。比如说，如果你需要终止线程<span class="_ _c"></span>，那么这个线程必须通过编程在某个特定点轮询<span class="_ _1"></span></div><div class="t m0 x5 h9 y2d94 ff1 fs3 fc0 sc0 ls0">来退出。你可以像下边这样把线程放入一个类中：</div><div class="t m0 x5 hf y1c4c ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">CountdownTask<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2d95 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y2d96 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">_running </span><span class="ls32">=</span></span>True</div><div class="t m0 x15 hf y22b2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">terminate<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y2d97 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">_running </span><span class="ls32">=</span></span>False</div><div class="t m0 x15 hf y2d98 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, n):</span></span></span></div><div class="t m0 x16 hf y2d99 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws1f5">_running </span></span><span class="ws139">and <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x17 hf y71f ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls0 ws13b">, n)</span></span></div><div class="t m0 x17 hf y2d9a ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x17 hf y2d9b ff8 fs5 fc0 sc0 ls0 ws13a">time<span class="fc6">.</span>sleep(<span class="fc7">5</span>)</div><div class="t m0 x15 hf y1d6a ff8 fs5 fc0 sc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0">CountdownTask()</span></div><div class="t m0 x15 hf y1d6b ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">Thread(target<span class="fc6 ls34">=<span class="fc0">c</span><span class="ls0">.</span></span><span class="ws4">run, args<span class="fc6 ls34">=</span></span>(<span class="fc7">10</span>,))</span></div><div class="t m0 x15 hf y1d6c ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x15 hf y1a3 ff8 fs5 fc0 sc0 ls34">c<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws208">terminate() <span class="ffa fcd ws4"># Signal termination</span></span></div><div class="t m0 x15 hf y1a4 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws105d">join() <span class="ffa fcd ws4"># Wait for actual termination (if needed)</span></span></div><div class="t m0 x0 h7 y2d9c ff1 fs3 fc0 sc0 ls40 ws105e">如果线程执行一些像 <span class="ff4 ls0 ws39b">I/O </span><span class="ws180">这样的阻塞操作，那么通过轮询来终止线程将使得线程<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y2d9d ff1 fs3 fc0 sc0 ls17 ws105f">之间的协调变得非常棘手。比如<span class="_ _1"></span>，如果一个线程一直阻塞在一个 <span class="ff4 ls0 ws1060">I/<span class="_ _6"></span>O </span><span class="wsf6">操作上，它就永<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y2d9e ff1 fs3 fc0 sc0 ls1e ws111">远无法返回<span class="_ _1"></span>，也就无法检查自己是否已经被结束了<span class="_ _1"></span>。要正确处理这些问题，你需<span class="_ _1"></span>要利</div><div class="t m0 x5 h9 y2d9f ff1 fs3 fc0 sc0 ls0">用超时循环来小心操作线程。例子如下：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">14.1.<span class="_ _36"> </span>12.1 <span class="ff1 ws600">启动与停止线程 </span>443</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
