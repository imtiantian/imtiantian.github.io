<div id="pf115" class="pf w0 h0" data-page-no="115"><div class="pc pc115 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg115.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0">A()</span></span></div><div class="t m0 x5 hf y1ac ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1ad ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws13b">: Can<span class="ff9 ls34">&apos;</span><span class="ws4">t instantiate abstract class A with abstract methods __iter__</span></span></div><div class="t m0 x5 hf y1af ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 ye8c ff1 fs3 fc0 sc0 ls0 ws911">你只要实现 <span class="ff6 ws308">iter<span class="_ _e"> </span>() </span><span class="ws14">方法就不会报错了 <span class="ff4 ls1b">(</span><span class="wsc">参考 <span class="ff4 ws171">4.2 </span><span class="ls4">和</span><span class="ff4 ws171">4.7 </span><span class="wsa0">小节<span class="ff4 wsa5">)</span>。</span></span></span></div><div class="t m0 x0 h9 y4b0 ff1 fs3 fc0 sc0 ls0">你可以先试着去实例化一个对象，在错误提示中可以找到需要实现哪些方法：</div><div class="t m0 x5 h10 y1dad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">collections</span></span></div><div class="t m0 x5 hf y1dae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">collections<span class="fc6 ls34">.</span>Sequence()</span></div><div class="t m0 x5 hf y11f2 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1daf ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y1db0 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws13b">: Can<span class="ff9 ls34">&apos;</span><span class="ws4">t instantiate abstract class Sequence with abstract methods \</span></span></div><div class="t m0 x5 hf y1db1 ff8 fs5 fc8 sc0 ls0 ws4">__getitem__, __len__</div><div class="t m0 x5 hf y1db2 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1db3 ff1 fs3 fc0 sc0 ls22 wsb10">下面是一个简单的示例<span class="_ _1"></span>，继承自上面 <span class="ff4 ls0 wsb11">Sequence </span><span class="ws119">抽象类，并且实现元素按照顺序存<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y1db4 ff1 fs3 fc0 sc0 ls0">储：</div><div class="t m0 x5 hf y1db5 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SortedItems<span class="ff8 fc0 ws13a">(collections<span class="fc6 ls34">.</span>Sequence):</span></span></div><div class="t m0 x15 hf y1db6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, initial<span class="fc6 ls34">=</span></span><span class="fca">None</span>):</span></span></div><div class="t m0 x16 hf y1db7 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_items </span><span class="ls32">=</span></span>sorted<span class="fc0 ws51e">(initial) </span><span class="ff7 ws157">if </span><span class="fc0 ws155">initial </span><span class="ff7 ws157">is not </span><span class="ws161">None <span class="ff7 ws15a">else </span><span class="fc0">[]</span></span></div><div class="t m0 x15 h11 y1db8 ffa fs5 fcd sc0 ls0 ws4"># Required sequence methods</div><div class="t m0 x15 hf y1db9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, index):</span></span></span></div><div class="t m0 x16 hf y282 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_items[index]</span></span></div><div class="t m0 x15 hf y284 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__len__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1dba ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">len<span class="fc0 ls34">(</span>self<span class="fc6">.<span class="fc0">_items)</span></span></span></div><div class="t m0 x15 h11 y1dbb ffa fs5 fcd sc0 ls0 ws4"># Method for adding an item in the right location</div><div class="t m0 x15 hf y1dbc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, item):</span></span></span></div><div class="t m0 x16 hf y1dbd ff8 fs5 fc0 sc0 ls0 ws13a">bisect<span class="fc6 ls34">.</span>insort(<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws13b">_items, item)</span></div><div class="t m0 x5 hf y1dbe ff8 fs5 fc0 sc0 ls0 ws15f">items <span class="fc6 ls33">=</span><span class="ws13a">SortedItems([<span class="fc7 ls34">5</span><span class="ls32">,<span class="fc7 ls34">1</span><span class="ls33">,</span></span><span class="fc7">3</span>])</span></div><div class="t m0 x5 hf y1dbf ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="fca">list</span>(items))</span></div><div class="t m0 x5 hf y1dc0 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(items[<span class="fc7">0</span><span class="ws4">], items[<span class="fc6 ls34">-</span></span><span class="fc7">1</span>])</span></div><div class="t m0 x5 hf y1dc1 ff8 fs5 fc0 sc0 ls0 ws13a">items<span class="fc6">.</span>add(<span class="fc7 ls34">2</span>)</div><div class="t m0 x5 hf y1dc2 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="fca">list</span>(items))</span></div><div class="t m0 x0 h7 y1dc3 ff1 fs3 fc0 sc0 ls0 wsa0">可以看到，<span class="_ _6"></span><span class="ff4 wsb12">SortedItems </span><span class="ls51 ws1c8">跟普通的序列没什么两样，支持所有常用操作，包括索引、<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y761 ff1 fs3 fc0 sc0 ls0">迭代、包含判断，甚至是切片操作。</div><div class="t m0 x0 h9 y1dc4 ff1 fs3 fc0 sc0 lse ws653">这里面使用到了 <span class="ff6 ls0 ws20b">bisect </span><span class="wsd8">模块，它是一个在排序列表中插入元素的高效方式<span class="_ _1"></span>。可以</span></div><div class="t m0 x5 h9 y1dc5 ff1 fs3 fc0 sc0 ls0">保证元素插入后还保持顺序。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.14.<span class="_ _5"> </span>8.14 <span class="ff1 wsb0f">实现自定义容器 </span>268</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
