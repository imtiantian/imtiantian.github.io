<div id="pf1fe" class="pf w0 h0" data-page-no="1fe"><div class="pc pc1fe w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1fe.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff4 fs3 fc0 sc0 ls0 wsfa">Since ignoring ﬁlename patterns is common, a utility function ignore patterns() has</div><div class="t m0 x5 h7 y2b ff4 fs3 fc0 sc0 ls0 ws9c">already b<span class="_ _6"></span>een pro<span class="_ _1"></span>vided to do it.<span class="_ _b"> </span>F<span class="_ _8"></span>or example:</div><div class="t m0 x0 h7 y8dd ff4 fs3 fc0 sc0 ls0 wsd0">sh<span class="_ _1"></span>util.cop<span class="_ _1"></span>ytree(src, dst, ignore=shutil.ignore patterns(‘<span class="ff14 ls84">˜</span><span class="ff13 ws121b">’,’</span><span class="wsa5">.pyc’))</span></div><div class="t m0 x5 he y31f7 ff2 fs2 fc4 sc0 ls0 ws212">15.7.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y13bf ff1 fs3 fc0 sc0 ls0 ws121c">使<span class="_ _12"></span>用 <span class="ff6 wsbcc">shutil </span><span class="wsa0">复<span class="_ _12"></span>制<span class="_ _12"></span>文<span class="_ _24"></span>件<span class="_ _12"></span>和<span class="_ _12"></span>目<span class="_ _12"></span>录<span class="_ _12"></span>也<span class="_ _24"></span>忒<span class="_ _12"></span>简<span class="_ _12"></span>单<span class="_ _12"></span>了<span class="_ _24"></span>点<span class="_ _12"></span>吧。<span class="_ _12"></span>不<span class="_ _12"></span>过，<span class="_ _24"></span>对<span class="_ _12"></span>于<span class="_ _12"></span>文<span class="_ _12"></span>件<span class="_ _24"></span>元<span class="_ _12"></span>数<span class="_ _12"></span>据<span class="_ _12"></span>信<span class="_ _24"></span>息，</span></div><div class="t m0 x5 h9 y31f8 ff6 fs3 fc0 sc0 ls0 ws121d">copy2() <span class="ff1 ls145 ws8b8">这样的函数只能尽自己最大能力来保留它<span class="_ _d"></span>。访问时间<span class="_ _c"></span>、创建时间和权限这<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y31f9 ff1 fs3 fc0 sc0 lsf wsdb">些基本信息会被保留<span class="_ _c"></span>，但是对于所有者、<span class="ff4 ls0 wsa5">A<span class="_ _c"></span>CLs<span class="ff1 lsf ws121e">、资源 </span><span class="ws121f">fork <span class="ff1 lsf wsdb">和其他更深层次的文件元<span class="_ _1"></span></span></span></span></div><div class="t m0 x5 h9 y31fa ff1 fs3 fc0 sc0 ls139 ws859">信息就说不准了<span class="_ _d"></span>，这个还得依赖于底层操作系统类型和用户所拥有的访问权限<span class="_ _c"></span>。你<span class="_ _c"></span></div><div class="t m0 x5 h9 y31fb ff1 fs3 fc0 sc0 ls19d ws1220">通常不会去使用 <span class="ff6 ls0 ws1221">shutil.copytree() <span class="ff1 wsa0">函<span class="_ _0"></span>数<span class="_ _0"></span>来<span class="_ _12"></span>执<span class="_ _0"></span>行<span class="_ _0"></span>系<span class="_ _0"></span>统<span class="_ _0"></span>备<span class="_ _12"></span>份。<span class="_ _0"></span>当<span class="_ _0"></span>处<span class="_ _0"></span>理<span class="_ _12"></span>文<span class="_ _0"></span>件<span class="_ _0"></span>名<span class="_ _0"></span>的<span class="_ _0"></span>时<span class="_ _12"></span>候，</span></span></div><div class="t m0 x5 h7 y1428 ff1 fs3 fc0 sc0 ls0 ws1222">最<span class="_ _0"></span>好<span class="_ _6"></span>使<span class="_ _0"></span>用 <span class="ff6 ws1223">os.path </span><span class="lse8 ws1224">中的函数来确保最大的可移植性（<span class="_ _c"></span>特别是同时要适用于 <span class="ff4 ls0 ws1225">Unix <span class="ff1">和</span></span></span></div><div class="t m0 x5 h7 y31fc ff4 fs3 fc0 sc0 ls0 wsa5">Windo<span class="_ _1"></span>ws<span class="ff1 wsa0">）<span class="_ _f"></span>。例如：</span></div><div class="t m0 x5 hf y31fd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws1f5">filename <span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">/Users/guido/programs/spam.py<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h10 y31fe ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">os.path</span></span></div><div class="t m0 x5 hf y31dc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>basename(filename)</span></div><div class="t m0 x5 hf y31ff ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">spam.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3200 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>dirname(filename)</span></div><div class="t m0 x5 hf y3201 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/Users/guido/programs<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3202 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>split(filename)</span></div><div class="t m0 x5 hf y3203 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">/Users/guido/programs<span class="ff9 ws13b">&apos;</span><span class="ls33">,</span></span><span class="ff9">&apos;</span><span class="ls0 ws13a">spam.py<span class="ff9 ws13b">&apos;</span>)</span></div><div class="t m0 x5 hf y3204 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>join(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">/new/dir<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, os</span><span class="fc6">.</span>path<span class="fc6 ls34">.</span>basename(filename))</span></div><div class="t m0 x5 hf y3205 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/new/dir/spam.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3206 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>expanduser(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">~/guido/programs/spam.py<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3207 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/Users/guido/programs/spam.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3208 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3209 ff1 fs3 fc0 sc0 ls0 ws1226">使用 <span class="ff6 ws141">copytree() </span><span class="wsa0">复制<span class="_ _6"></span>文件夹<span class="_ _6"></span>的一<span class="_ _6"></span>个棘手<span class="_ _6"></span>的问题<span class="_ _6"></span>是对于<span class="_ _6"></span>错误的<span class="_ _6"></span>处理。例<span class="_ _6"></span>如，在<span class="_ _6"></span>复制</span></div><div class="t m0 x5 h9 y320a ff1 fs3 fc0 sc0 ls1e ws111">过程中<span class="_ _1"></span>，函数可能会碰到损坏的符号链接<span class="_ _1"></span>，因为权限无法访问文件的问题等等<span class="_ _1"></span>。为了</div><div class="t m0 x5 h9 y320b ff1 fs3 fc0 sc0 ls13 wse5">解决这个问题<span class="_ _1"></span>，所有碰到的问题会被收集到一个列表中并打包为一个单独的异常，到<span class="_ _c"></span></div><div class="t m0 x5 h9 y320c ff1 fs3 fc0 sc0 ls0">了最后再抛出。下面是一个例子：</div><div class="t m0 x5 hf y320d ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y1658 ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copytree(src, dst)</span></div><div class="t m0 x5 hf y1659 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws458">Error </span></span><span class="ws157">as <span class="ff8 fc0">e:</span></span></div><div class="t m0 x15 hf y165a ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">src, dst, msg </span><span class="ws157">in <span class="ff8 fc0 ls34">e<span class="fc6">.</span><span class="ls0 ws13a">args[</span><span class="fc7">0</span><span class="ls0">]:</span></span></span></div><div class="t m0 x2b h11 y320e ffa fs5 fcd sc0 ls0 ws4"># src is source name</div><div class="t m0 x2b h11 y151b ffa fs5 fcd sc0 ls0 ws4"># dst is destination name</div><div class="t m0 x2b h11 y165c ffa fs5 fcd sc0 ls0 ws4"># msg is error message from exception</div><div class="t m0 x2b hf y165d ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws4">(dst, src, msg)</span></div><div class="t m0 x0 h9 y320f ff1 fs3 fc0 sc0 ls0 wsfd0">如果你提供关键字参数 <span class="ff6 ws317">ignore<span class="_ _7"> </span>dangling<span class="_ _16"> </span>symlinks=True </span><span class="ws14">，这时候 <span class="ff6 ws17c">copytree() </span>会</span></div><div class="t m0 x5 h9 y3210 ff1 fs3 fc0 sc0 ls0">忽略掉无效符号链接。</div><div class="t m0 x0 h9 y3211 ff1 fs3 fc0 sc0 ls13 wse5">本节演示的这些函数都是最常见的<span class="_ _1"></span>。不过，<span class="ff6 ls0 ws1227">shutil </span>还有更<span class="_ _1"></span>多的和复制数据相关的</div><div class="t m0 x5 h7 y3212 ff1 fs3 fc0 sc0 ls0 ws38">操作。它的文档很值得一看，参考 <span class="ff4 fc3 ws9c">Python do<span class="_ _6"></span>cumen<span class="_ _1"></span>tation</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.7.<span class="_ _36"> </span>13.7 <span class="ff1 ws512">复制或者移动文件和目录 </span>501</div><a class="l" href="https://docs.python.org/3/library/shutil.html"><div class="d m1" style="border-style:none;position:absolute;left:382.837500px;bottom:167.302500px;width:117.567000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
