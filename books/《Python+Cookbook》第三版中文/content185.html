<div id="pfb9" class="pf w0 h0" data-page-no="b9"><div class="pc pcb9 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgb9.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(</span>repr<span class="fc0 ws158">(o) <span class="fc6 ls33">+</span><span class="fc9 ws4">&quot; is not JSON serializable&quot;</span>)</span></span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: &lt;__main__.Point object at 0x1006f2650&gt; is not JSON serializable</span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2f1 ff1 fs3 fc0 sc0 ls0 wsa0">如果你想序列化对象<span class="_ _6"></span>实例，你可以提供一个函数，<span class="_ _6"></span>它的输入是一个实例，返<span class="_ _6"></span>回一个</div><div class="t m0 x5 h9 y2f2 ff1 fs3 fc0 sc0 ls0">可序列化的字典。例如：</div><div class="t m0 x5 hf y70e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">serialize_instance<span class="fc0">(obj):</span></span></div><div class="t m0 x15 hf y70f ff8 fs5 fc0 sc0 ls32">d<span class="fc6 ls33">=</span>{<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">__classname__</span><span class="ls33">&apos;</span></span>:<span class="fca ls0 ws13a">type<span class="fc0">(obj)<span class="fc6 ls34">.</span><span class="ws13b">__name__ }</span></span></span></div><div class="t m0 x15 hf y710 ff8 fs5 fc0 sc0 ls34">d<span class="fc6 ls0 ws13a">.<span class="fc0">update(<span class="fca">vars</span>(obj))</span></span></div><div class="t m0 x15 hf y5db ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">d</span></div><div class="t m0 x0 h9 y1427 ff1 fs3 fc0 sc0 ls0">如果你想反过来获取这个实例，可以这样做：</div><div class="t m0 x5 h11 y1428 ffa fs5 fcd sc0 ls0 ws4"># Dictionary mapping names to known classes</div><div class="t m0 x5 hf y1429 ff8 fs5 fc0 sc0 ls0 ws155">classes <span class="fc6 ls32">=</span>{</div><div class="t m0 x15 hf y142a ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">Point</span><span class="ls33">&apos;<span class="ff8 fc0 ls0 ws13b">: Point</span></span></div><div class="t m0 x5 hf y142b ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y142c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">unserialize_object<span class="fc0">(d):</span></span></div><div class="t m0 x15 hf y142d ff8 fs5 fc0 sc0 ls0 ws155">clsname <span class="fc6 ls32">=</span><span class="ls34">d<span class="fc6">.</span></span><span class="ws13a">pop(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">__classname__<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fca">None</span>)</span></div><div class="t m0 x15 hf y142e ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">clsname:</span></div><div class="t m0 x16 hf y142f ff8 fs5 fc0 sc0 ls0 ws158">cls <span class="fc6 ls32">=</span>classes[clsname]</div><div class="t m0 x16 hf y1430 ff8 fs5 fc0 sc0 ls0 ws158">obj <span class="fc6 ls32">=</span><span class="ws13a">cls<span class="fc6 ls34">.</span><span class="ws3c7">__new__(cls) <span class="ffa fcd ws4"># Make instance without calling __init__</span></span></span></div><div class="t m0 x16 hf y1431 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">key, value </span><span class="ws157">in <span class="ff8 fc0 ls34">d<span class="fc6 ls0 ws13a">.<span class="fc0">items():</span></span></span></span></div><div class="t m0 x17 hf y1432 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ws13b">(obj, key, value)</span></div><div class="t m0 x16 hf y1433 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">obj</span></div><div class="t m0 x15 hf y1434 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf y1435 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">d</span></div><div class="t m0 x0 h9 y1436 ff1 fs3 fc0 sc0 ls0">下面是如何使用这些函数的例子：</div><div class="t m0 x5 hf y1437 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">Point(<span class="fc7 ls34">2<span class="fc0">,</span><span class="ls0">3</span></span>)</span></span></div><div class="t m0 x5 hf y1438 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">json<span class="fc6">.</span><span class="ws4">dumps(p, default<span class="fc6 ls34">=</span>serialize_instance)</span></span></span></div><div class="t m0 x5 hf y1439 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">s</span></div><div class="t m0 x5 hf y143a ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">{&quot;__classname__&quot;: &quot;Point&quot;, &quot;y&quot;: 3, &quot;x&quot;: 2}<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y143b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">json<span class="fc6">.</span><span class="ws4">loads(s, object_hook<span class="fc6 ls34">=</span>unserialize_object)</span></span></span></div><div class="t m0 x5 hf y143c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf y143d ff8 fs5 fc8 sc0 ls0 ws4">&lt;__main__.Point object at 0x1017577d0&gt;</div><div class="t m0 x5 hf y19f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">x</span></span></span></div><div class="t m0 x5 hf y143e ff8 fs5 fc8 sc0 ls0">2</div><div class="t m0 x5 hf y143f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">y</span></span></span></div><div class="t m0 x5 hf y1440 ff8 fs5 fc8 sc0 ls0">3</div><div class="t m0 x5 hf y1441 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1442 ff6 fs3 fc0 sc0 ls0 ws7cf">json <span class="ff1 ls35 ws7d0">模块还有很多其他选项来控制更低级别的数字、特殊值如 </span><span class="ff4 ws7d1">NaN <span class="ff1 wsa0">等的解析。可</span></span></div><div class="t m0 x5 h9 y1443 ff1 fs3 fc0 sc0 ls0">以参考官方文档获取更多细节。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.2.<span class="_ _5"> </span>6.2 <span class="ff1 ws16b">读写 </span><span class="ws791">JSON <span class="ff1 ws792">数据 </span>176</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
