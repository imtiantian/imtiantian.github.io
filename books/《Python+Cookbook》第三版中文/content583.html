<div id="pf247" class="pf w0 h0" data-page-no="247"><div class="pc pc247 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg247.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h10 yb1e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">array</span></span></div><div class="t m0 x5 hf yb1f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">array<span class="fc6 ls34">.</span>array(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">d<span class="ff9">&apos;</span></span></span>,[<span class="fc7 ls34">1<span class="fc0">,</span><span class="ls0">2</span><span class="fc0">,</span>3</span>])</span></span></div><div class="t m0 x5 hf yb20 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>avg(a)</span></div><div class="t m0 x5 hf yb21 ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf yb22 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y37f9 ff2 fs2 fc4 sc0 ls0 ws212">17.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y37fa ff4 fs3 fc0 sc0 ls0 ws1466">Swig <span class="ff1 ls47">是</span><span class="ws49f">Python <span class="ff1 ls10 wsdf">历史中构建扩展模块的最古老的工具之一<span class="_ _1"></span>。<span class="ff4 ls0 ws1466">Swig </span>能自动化很多包</span></span></div><div class="t m0 x5 h9 y5b7 ff1 fs3 fc0 sc0 ls0">装生成器的处理。</div><div class="t m0 x0 h7 y37fb ff1 fs3 fc0 sc0 ls0 wsc">所有 <span class="ff4 ws5d5">Swig </span>接口都以类似下面这样的为开头：</div><div class="t m0 x5 hf y37fc ff8 fs5 fc0 sc0 ls0 ws4">%module sample</div><div class="t m0 x5 hf y37fd ff8 fs5 fc0 sc0 ls0">%{</div><div class="t m0 x5 hf y37fe ff8 fs5 fc0 sc0 ls0 ws4">#include &quot;sample.h&quot;</div><div class="t m0 x5 hf y37ff ff8 fs5 fc0 sc0 ls0">%}</div><div class="t m0 x0 h7 y3800 ff1 fs3 fc0 sc0 ls2d ws1474">这个仅仅只是声明了扩展模块的名称并指定了 <span class="ff4 ls252">C</span><span class="ws132">头文件<span class="_ _1"></span>，为了能让编译通过必须</span></div><div class="t m0 x5 h7 y3801 ff1 fs3 fc0 sc0 ls1f ws1475">要包含这些头文件（位于 <span class="ff4 ls27b">%<span class="ff15 ls27c">{</span></span><span class="ls2a">和<span class="ff4 ls27b">%<span class="ff15 ls27c">}</span></span></span><span class="ws113">的代码）<span class="_ _f"></span>，将它们之间复制粘贴到输出代码中，这</span></div><div class="t m0 x5 h9 y3802 ff1 fs3 fc0 sc0 ls0">也是你要放置所有包含文件和其他编译需要的定义的地方。</div><div class="t m0 x0 h7 y3803 ff4 fs3 fc0 sc0 ls0 ws1476">Swig <span class="ff1 ws1477">接口<span class="_ _6"></span>的底下<span class="_ _6"></span>部分<span class="_ _6"></span>是一<span class="_ _6"></span>个 </span><span class="ls265">C</span><span class="ff1 wsa0">声明列<span class="_ _6"></span>表，你<span class="_ _6"></span>需要<span class="_ _6"></span>在扩展<span class="_ _6"></span>中包<span class="_ _6"></span>含它。<span class="_ _6"></span>这通常<span class="_ _6"></span>从头<span class="_ _6"></span>文</span></div><div class="t m0 x5 h9 y34a5 ff1 fs3 fc0 sc0 ls0">件中被复制。在我们的例子中，我们仅仅像下面这样直接粘贴在头文件中：</div><div class="t m0 x5 hf y3804 ff8 fs5 fc0 sc0 ls0 ws4">%module sample</div><div class="t m0 x5 hf y3805 ff8 fs5 fc0 sc0 ls0">%{</div><div class="t m0 x5 hf y3806 ff8 fs5 fc0 sc0 ls0 ws4">#include &quot;sample.h&quot;</div><div class="t m0 x5 hf y3807 ff8 fs5 fc0 sc0 ls0">%}</div><div class="t m0 x5 hf y3808 ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x5 hf y3809 ff8 fs5 fc0 sc0 ls0 ws4">extern int gcd(int, int);</div><div class="t m0 x5 hf y380a ff8 fs5 fc0 sc0 ls0 ws4">extern int in_mandel(double x0, double y0, int n);</div><div class="t m0 x5 hf y380b ff8 fs5 fc0 sc0 ls0 ws4">extern int divide(int a, int b, int *remainder);</div><div class="t m0 x5 hf y380c ff8 fs5 fc0 sc0 ls0 ws4">extern double avg(double *a, int n);</div><div class="t m0 x5 hf y380d ff8 fs5 fc0 sc0 ls0 ws4">typedef struct Point {</div><div class="t m0 x15 hf y380e ff8 fs5 fc0 sc0 ls0 ws13b">double x,y;</div><div class="t m0 x5 hf y380f ff8 fs5 fc0 sc0 ls0 ws4">} Point;</div><div class="t m0 x5 hf y3810 ff8 fs5 fc0 sc0 ls0 ws4">extern double distance(Point *p1, Point *p2);</div><div class="t m0 x0 h7 y3811 ff1 fs3 fc0 sc0 ls68 ws1478">有一点需要强调的是这些声明会告诉 <span class="ff4 ls0 ws1479">Swig </span><span class="ws978">你想要在 <span class="ff4 ls0 ws991">Python </span><span class="ws23f">模块中包含哪些东西。</span></span></div><div class="t m0 x5 h9 y3812 ff1 fs3 fc0 sc0 ls13 wse5">通常你需要编辑这个声明列表或相应的修改下它<span class="_ _1"></span>。例如，如果你不想某些声明被包含<span class="_ _c"></span></div><div class="t m0 x5 h9 y3813 ff1 fs3 fc0 sc0 ls0">进来，你要将它从声明列表中移除掉。</div><div class="t m0 x0 h7 y3814 ff1 fs3 fc0 sc0 ls0 ws869">使用 <span class="ff4 ws147a">Swig </span><span class="ls6b ws147b">最复杂的地方是它能给 <span class="ff4 ls240">C</span><span class="ws28f">代码提供大量的自定义操作。这个主题太大，<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y3815 ff1 fs3 fc0 sc0 ls0">这里无法展开，但是我们在本节还剩展示了一些自定义的东西。</div><div class="t m0 x0 h9 y3816 ff1 fs3 fc0 sc0 ls14 ws147c">第一个自定义是 <span class="ff6 ls0 ws307">%extend </span><span class="ws174">指令允许方法被附加到已存在的结构体和类定义上<span class="_ _1"></span>。我</span></div><div class="t m0 x5 h7 y3817 ff1 fs3 fc0 sc0 ls40 ws4c5">例子中<span class="_ _1"></span>，这个被用来添加一个 <span class="ff4 ls0 ws147d">P<span class="_ _1"></span>oint <span class="ff1 ls40 ws180">结<span class="_ _1"></span>构体的构造器方法。它可以让你像下面这样使<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y3818 ff1 fs3 fc0 sc0 ls0">用这个结构体：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.9.<span class="_ _36"> </span>15.9 <span class="ff1 ls81">用</span><span class="ws146a">WSIG <span class="ff1 ws16b">包装 </span><span class="ls246">C</span><span class="ff1 ws146b">代码 </span>574</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
