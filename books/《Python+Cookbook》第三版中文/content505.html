<div id="pf1f9" class="pf w0 h0" data-page-no="1f9"><div class="pc pc1f9 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1f9.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">15.3.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y11a8 ff6 fs3 fc0 sc0 ls0 ws293">argparse <span class="ff1 ls2d ws132">模块是标准库中最大的模块之一，拥有大量的配置选项<span class="_ _c"></span>。本节只是演示</span></div><div class="t m0 x5 h9 y19a8 ff1 fs3 fc0 sc0 ls0">了其中最基础的一些特性，帮助你入门。</div><div class="t m0 x0 h9 y2110 ff1 fs3 fc0 sc0 ls216 ws11ec">为了解析命令行选项<span class="_ _1f"></span>，你首先要创建一个 <span class="ff6 ls0 ws11ed">ArgumentParser <span class="ff1 ws11ee">实 例， 并 使 用</span></span></div><div class="t m0 x5 h9 y3199 ff6 fs3 fc0 sc0 ls0 ws11ef">add argument() <span class="ff1 ls30 ws11f0">方法声明你想要支持的选项。在每个 </span><span class="ws11f1">add-argument() <span class="ff1 wsa0">调<span class="_ _6"></span>用中，<span class="_ _6"></span></span>dest</span></div><div class="t m0 x5 h9 y319a ff1 fs3 fc0 sc0 ls42 ws11f2">参数指定解析结果被指派给属性的名字。 <span class="ff6 ls0 ws474">metavar </span><span class="ws186">参数被用来生成帮助<span class="_ _1"></span>信息。<span class="ff6 ls0">action</span></span></div><div class="t m0 x5 h7 y319b ff1 fs3 fc0 sc0 ls0 wsde">参数指定跟属性对应的处理逻辑，通常的值为 <span class="ff6 ws11f3">store <span class="ff4 ls217">,</span></span>被用来存储某个值或讲多个参数</div><div class="t m0 x5 h9 y319c ff1 fs3 fc0 sc0 ls13 wse5">值收集到一个列表中<span class="_ _1"></span>。下面的参数收集所有剩余的命令行参数到一个列表中。在本例<span class="_ _c"></span></div><div class="t m0 x5 h9 y319d ff1 fs3 fc0 sc0 ls0">中它被用来构造一个文件名列表：</div><div class="t m0 x5 hf y30e8 ff8 fs5 fc0 sc0 ls0 ws13a">parser<span class="fc6 ls34">.</span>add_argument(dest<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">filenames<span class="ff9 ls34">&apos;</span></span>,metavar<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">filename<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, nargs<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">*<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x0 h9 y319e ff1 fs3 fc0 sc0 ls0 ws14">下面的参数根据参数是否存在来设置一个 <span class="ff6 ws472">Boolean </span>标志：</div><div class="t m0 x5 hf y319f ff8 fs5 fc0 sc0 ls0 ws13a">parser<span class="fc6 ls34">.</span>add_argument(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">-v<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, dest<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span></span><span class="fc9">verbose<span class="ff9 ls34">&apos;</span></span><span class="ws4">, action<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span></span><span class="fc9">store_true<span class="ff9 ws13b">&apos;</span></span>,</div><div class="t m0 x29 hf y31a0 ff8 fs5 fc0 sc0 ls0 ws13a">help<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13b">verbose mode<span class="ff9">&apos;</span></span>)</div><div class="t m0 x0 h9 y31a1 ff1 fs3 fc0 sc0 ls0">下面的参数接受一个单独值并将其存储为一个字符串：</div><div class="t m0 x5 hf y31a2 ff8 fs5 fc0 sc0 ls0 ws13a">parser<span class="fc6 ls34">.</span>add_argument(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">-o<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, dest<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span></span><span class="fc9">outfile<span class="ff9 ls34">&apos;</span></span><span class="ws4">, action<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span></span><span class="fc9">store<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x29 hf y31a3 ff8 fs5 fc0 sc0 ls0 ws13a">help<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13b">output file<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x0 h9 y19ea ff1 fs3 fc0 sc0 ls27 ws11f4">下面的参数说明允许某个参数重复出现多次<span class="_ _8"></span>，并将它们追加到一个列表中去<span class="_ _8"></span>。<span class="_ _d"></span></div><div class="t m0 x5 h9 y31a4 ff6 fs3 fc0 sc0 ls0 ws1f3">required <span class="ff1 wsa0">标志表示该参数至少要有一个。</span><span class="ws308">-p <span class="ff1 ls4">和</span><span class="ws17d">--pat <span class="ff1">表示两个参数名形式都可使用。</span></span></span></div><div class="t m0 x5 hf y31a5 ff8 fs5 fc0 sc0 ls0 ws13a">parser<span class="fc6 ls34">.</span>add_argument(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">-p<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">--pat<span class="ff9 ls34">&apos;</span></span>,metavar<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">pattern<span class="ff9 ls34">&apos;</span></span><span class="ws4">, required<span class="fc6 ls34">=</span></span><span class="fca">True</span>,</div><div class="t m0 x29 hf y31a6 ff8 fs5 fc0 sc0 ls0 ws13a">dest<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">patterns<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, action<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">append<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x29 hf y31a7 ff8 fs5 fc0 sc0 ls0 ws13a">help<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws4">text pattern to search for<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x0 h9 y31a8 ff1 fs3 fc0 sc0 ls0 wsa0">最后，下面的参数说明<span class="_ _6"></span>接受一个值，但是会将其和<span class="_ _6"></span>可能的选择值做比较，以<span class="_ _6"></span>检测其</div><div class="t m0 x5 h9 y31a9 ff1 fs3 fc0 sc0 ls0">合法性：</div><div class="t m0 x5 hf y2945 ff8 fs5 fc0 sc0 ls0 ws13a">parser<span class="fc6 ls34">.</span>add_argument(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">--speed<span class="ff9 ls34">&apos;</span></span><span class="ws4">, dest<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">speed<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, action<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">store<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x29 hf y31aa ff8 fs5 fc0 sc0 ls0 ws13a">choices<span class="fc6">=</span><span class="ls34">{<span class="ff9 fc9">&apos;</span></span><span class="fc9">slow<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">fast<span class="ff9 ls34">&apos;</span></span><span class="ws13b">}, default<span class="fc6 ls34">=</span><span class="ff9 fc9">&apos;</span></span><span class="fc9">slow<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x29 hf y31ab ff8 fs5 fc0 sc0 ls0 ws13a">help<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13b">search speed<span class="ff9">&apos;</span></span>)</div><div class="t m0 x0 h9 y10df ff1 fs3 fc0 sc0 ls0 ws11f5">一旦参数选项被指定，<span class="_ _c"></span>你就可以执行 <span class="ff6 ws11f6">parser.parse() </span>方法了。<span class="_ _c"></span>它会处理 <span class="ff6">sys.argv</span></div><div class="t m0 x5 h7 y31ac ff1 fs3 fc0 sc0 ls18 ws11f7">的值并返回一个结果实例。每个参数值会被设置成该实例中 <span class="ff4 ls0 ws11f8">‘‘add argumen<span class="_ _1"></span>t()‘‘ <span class="ff1 wsa0">方法<span class="_ _6"></span>的</span></span></div><div class="t m0 x5 h7 y31ad ff4 fs3 fc0 sc0 ls0 ws11f9">‘‘dest‘‘ <span class="ff1">参数指定的属性值。</span></div><div class="t m0 x0 h9 y31ae ff1 fs3 fc0 sc0 ls3d ws11fa">还很多种其他方法解析命令行选项。例如，你可能会手动的处理 <span class="ff6 ls0 ws2c3">sys.argv <span class="ff1 wsa0">或者使</span></span></div><div class="t m0 x5 h9 y31af ff1 fs3 fc0 sc0 ls1d5">用<span class="ff6 ls0 wscc1">getopt </span><span class="ls63 ws21f">模块<span class="_ _c"></span>。但是，如果你采用本节的方式<span class="_ _c"></span>，将会减少很多冗余代码<span class="_ _1"></span>，底层细节<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y31b0 ff6 fs3 fc0 sc0 ls0 ws11fb">argparse <span class="ff1 ls1d ws11fc">模块已经帮你处理了<span class="_ _c"></span>。你可能还会碰到使用 <span class="ff6 ls0 ws11fb">optparse </span><span class="ws1c3">库解析选项的代码。<span class="_ _d"></span></span></span></div><div class="t m0 x5 h9 y31b1 ff1 fs3 fc0 sc0 ls0 ws11fd">尽管 <span class="ff6 ws11fe">optparse </span><span class="ls218">和</span><span class="ff6 ws11fe">argparse </span><span class="wsa0">很像，<span class="_ _c"></span>但是后者更先进，<span class="_ _1"></span>因此在新的程序中你应该使用它。</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.3.<span class="_ _36"> </span>13.3 <span class="ff1 ws600">解析命令行选项 </span>496</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
