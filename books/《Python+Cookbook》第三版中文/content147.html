<div id="pf93" class="pf w0 h0" data-page-no="93"><div class="pc pc93 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg93.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y181 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Newline translation disabled</span></div><div class="t m0 x5 hf y182 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">g<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">hello.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, newline</span></span></span><span class="ls34">=<span class="ff9 fc9">&apos;&apos;</span></span></span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y183 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">g<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y184 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">hello world!\r\n<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y185 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1015 ff1 fs3 fc0 sc0 ls3a ws153">最后一个问题就是文本文件中可能出现的编码错误。但你读取或者写入一个文本文</div><div class="t m0 x5 h9 y1016 ff1 fs3 fc0 sc0 ls0">件时，你可能会遇到一个编码或者解码错误。比如：</div><div class="t m0 x5 hf y1017 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sample.txt<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, encoding</span></span></span><span class="ls34">=</span></span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">ascii</span><span class="ls34">&apos;</span><span class="ff8 fc0">)</span></span></div><div class="t m0 x5 hf y1018 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y1019 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y101a ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y101b ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;/usr/local/lib/python3.3/encodings/ascii.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">26</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>decode</span></div><div class="t m0 x16 hf y101c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">codecs<span class="fc6 ls34">.</span>ascii_decode(<span class="fca">input</span><span class="ls33">,</span><span class="fca">self<span class="fc6 ls34">.</span></span>errors)[<span class="fc7 ls34">0</span>]</span></div><div class="t m0 x5 hf y101d ff8 fs5 fc2 sc0 ls0 ws13a">UnicodeDecodeError<span class="fc0 ls33">:<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0">ascii<span class="ff9 ls32">&apos;</span><span class="ws4">codec can<span class="ff9 ls34">&apos;</span>t decode byte 0xc3 in position</span></span></span></div><div class="t m0 x5 hf y101e ff8 fs5 fc8 sc0 ls0 ws4">12: ordinal not in range(128)</div><div class="t m0 x5 hf y62 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y101f ff1 fs3 fc0 sc0 ls3a ws153">如果出现这个错误，通常表示你读取文本时指定的编码不正确。你最好仔细阅读说</div><div class="t m0 x5 h7 y1020 ff1 fs3 fc0 sc0 ls0 ws64c">明并<span class="_ _6"></span>确认你<span class="_ _6"></span>的文件<span class="_ _6"></span>编码<span class="_ _6"></span>是正确<span class="_ _6"></span>的 <span class="ff4 ls1b">(</span><span class="ws64d">比如<span class="_ _6"></span>使用 <span class="ff4 ws64e">UTF-8 </span><span class="ws64f">而不<span class="_ _6"></span>是 <span class="ff4 ws650">Latin-1 </span><span class="wsa0">编码<span class="_ _6"></span>或其他<span class="ff4 wsa5">)</span>。<span class="_ _6"></span>如果</span></span></span></div><div class="t m0 x5 h9 y1021 ff1 fs3 fc0 sc0 ls2c ws651">编码错误还是存在的话，你可以给 <span class="ff6 ls0 ws617">open() </span><span class="ws652">函数传递一个可选的 <span class="ff6 ls0 ws617">errors </span><span class="ws12f">参数来处理这</span></span></div><div class="t m0 x5 h9 yd9d ff1 fs3 fc0 sc0 ls0">些错误。下面是一些处理常见错误的方法：</div><div class="t m0 x5 h11 y1022 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Replace bad chars with Unicode U+fffd replacement char</span></div><div class="t m0 x5 hf y1023 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sample.txt<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, encoding</span></span></span><span class="ls34">=</span></span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">ascii</span><span class="ls34">&apos;</span><span class="ff8 fc0">, errors<span class="fc6 ls34">=</span></span><span class="ls34">&apos;</span><span class="ff8 ws13a">replace</span><span class="ls34">&apos;</span><span class="ff8 fc0">)</span></span></div><div class="t m0 x5 hf y1024 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y1025 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">Spicy Jalape?o!<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 y1026 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Ignore bad chars entirely</span></div><div class="t m0 x5 hf y1027 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">g<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sample.txt<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, encoding</span></span></span><span class="ls34">=</span></span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">ascii</span><span class="ls34">&apos;</span><span class="ff8 fc0">, errors<span class="fc6 ls34">=</span></span><span class="ls34">&apos;</span><span class="ff8 ws13a">ignore</span><span class="ls34">&apos;</span><span class="ff8 fc0">)</span></span></div><div class="t m0 x5 hf y1028 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">g<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y1029 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">Spicy Jalapeo!<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y102a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y102b ff1 fs3 fc0 sc0 lse ws653">如果你经常使用 <span class="ff6 ls0 ws20b">errors </span><span class="wsd8">参数来处理编码错误，可能会让你的生活变得很糟糕<span class="_ _1"></span>。对</span></div><div class="t m0 x5 h9 y102c ff1 fs3 fc0 sc0 ls13 wse5">于文本处理的首要原则是确保你总是使用的是正确编码<span class="_ _1"></span>。当模棱两可的时候，就使用<span class="_ _c"></span></div><div class="t m0 x5 h7 y205 ff1 fs3 fc0 sc0 ls0 ws38">默认的设置 <span class="ff4 ls1b">(</span><span class="ws14">通常都是 <span class="ff4 wsa5">UTF-8)</span>。</span></div><div class="t m0 x5 hd y102d ff2 fs4 fc4 sc0 ls0 ws134">7.2<span class="_ _e"> </span>5.2 <span class="ff1">打印输出至文件中</span></div><div class="t m0 x5 he y102e ff2 fs2 fc4 sc0 ls0 ws135">7.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y102f ff1 fs3 fc0 sc0 ls0 ws38">你想将 <span class="ff6 ws472">print() </span>函数的输出重定向到一个文件中去。</div><div class="t m0 x5 he y1030 ff2 fs2 fc4 sc0 ls0 ws135">7.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1031 ff1 fs3 fc0 sc0 ls4">在<span class="ff6 ls0 ws472">print() </span><span class="ls0 ws63">函数中指定 <span class="ff6 ws17a">file </span>关键字参数，像下面这样：</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.2.<span class="_ _5"> </span>5.2 <span class="ff1 ws654">打印输出至文件中 </span>138</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
