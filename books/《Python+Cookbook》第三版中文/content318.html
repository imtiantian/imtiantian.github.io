<div id="pf13e" class="pf w0 h0" data-page-no="13e"><div class="pc pc13e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg13e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc12 sc0 ls0 ws156">@logged<span class="ff8 fc0 ws13a">(logging<span class="fc6 ls34">.</span><span class="ws16e">CRITICAL, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">example<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1ac ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">():</span></span></div><div class="t m0 x15 hf y1ad ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Spam!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h9 y1d52 ff1 fs3 fc0 sc0 ls0">下面是交互环境下的使用例子：</div><div class="t m0 x5 h10 y2170 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">logging</span></span></div><div class="t m0 x5 hf y2171 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">logging<span class="fc6 ls34">.</span>basicConfig(level<span class="fc6 ls34">=</span>logging<span class="fc6 ls34">.</span>DEBUG)</span></div><div class="t m0 x5 hf y2172 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y2173 ff8 fs5 fc8 sc0 ls0">DEBUG:__main__:add</div><div class="t m0 x5 hf y2174 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 h11 y2175 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Change the log message</span></div><div class="t m0 x5 hf y2176 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add<span class="fc6 ls34">.</span>set_message(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Add called</span>&apos;</span>)</span></div><div class="t m0 x5 hf y2177 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y2178 ff8 fs5 fc8 sc0 ls0 ws4">DEBUG:__main__:Add called</div><div class="t m0 x5 hf y2179 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 h11 y217a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Change the log level</span></div><div class="t m0 x5 hf y217b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add<span class="fc6 ls34">.</span>set_level(logging<span class="fc6 ls34">.</span>WARNING)</span></div><div class="t m0 x5 hf y217c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y217d ff8 fs5 fc8 sc0 ls0 ws4">WARNING:__main__:Add called</div><div class="t m0 x5 hf y2d8 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y2d9 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y217e ff2 fs2 fc4 sc0 ls0 ws212">11.5.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y217f ff1 fs3 fc0 sc0 ls48 wsbc2">这一小节的关键点在于访问函数 <span class="ff4 ls0 wsa5">(</span><span class="ls18e">如<span class="ff6 ls0 ws5e3">set message() </span>和<span class="ff6 ls0 ws196">set level() <span class="ff4 wsa5">)</span></span></span><span class="ws242">，它们被作</span></div><div class="t m0 x5 h9 y2180 ff1 fs3 fc0 sc0 ls0 ws63">为属性赋给包装器。每个访问函数允许使用 <span class="ff6 ws1f3">nonlocal </span>来修改函数内部的变量。</div><div class="t m0 x0 h7 y2181 ff1 fs3 fc0 sc0 lse ws321">还有一个令人吃惊的地方是访问函数会在多层装饰器间传播 <span class="ff4 ls1b">(</span><span class="wsd8">如果你的装饰器都使</span></div><div class="t m0 x5 h7 y2182 ff1 fs3 fc0 sc0 ls0 wsbc3">用<span class="_ _6"></span>了 <span class="ff6 wsbc4">@functools.wraps </span><span class="wsa0">注解<span class="ff4 ls1b">)</span><span class="ls2d wsbc5">。例如，假设你引入另外一个装饰器<span class="_ _1"></span>，比如 <span class="ff4 ls0 wsbc6">9.2 </span><span class="ws132">小节中</span></span></span></div><div class="t m0 x5 h9 y2183 ff1 fs3 fc0 sc0 ls4">的<span class="ff6 ls0 ws1d1">@timethis <span class="ff1">，像下面这样：</span></span></div><div class="t m0 x5 h10 y2184 ff7 fs5 fc12 sc0 ls0">@timethis</div><div class="t m0 x5 hf y100c ff7 fs5 fc12 sc0 ls0 ws156">@logged<span class="ff8 fc0 ws13a">(logging<span class="fc6 ls34">.</span>DEBUG)</span></div><div class="t m0 x5 hf y2185 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></div><div class="t m0 x15 hf y2186 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></div><div class="t m0 x16 hf y2187 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x0 h9 y2188 ff1 fs3 fc0 sc0 ls0">你会发现访问函数依旧有效：</div><div class="t m0 x5 hf y2189 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">10000000</span>)</span></div><div class="t m0 x5 hf y218a ff8 fs5 fc8 sc0 ls0">DEBUG:__main__:countdown</div><div class="t m0 x5 hf y1f38 ff8 fs5 fc8 sc0 ls0 ws4">countdown 0.8198461532592773</div><div class="t m0 x5 hf y218b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>set_level(logging<span class="fc6">.</span>WARNING)</span></div><div class="t m0 x5 hf y218c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>set_message(<span class="fc9 ws4">&quot;Counting down to zero&quot;</span>)</span></div><div class="t m0 x5 hf y218d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">10000000</span>)</span></div><div class="t m0 x5 hf y218e ff8 fs5 fc8 sc0 ls0 ws4">WARNING:__main__:Counting down to zero</div><div class="t m0 x5 hf y218f ff8 fs5 fc8 sc0 ls0 ws4">countdown 0.8225970268249512</div><div class="t m0 x5 hf y2190 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2191 ff1 fs3 fc0 sc0 ls0">你还会发现即使装饰器像下面这样以相反的方向排放，效果也是一样的：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.5.<span class="_ _5"> </span>9.5 <span class="ff1 ws9db">可自定义属性的装饰器 </span>309</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
