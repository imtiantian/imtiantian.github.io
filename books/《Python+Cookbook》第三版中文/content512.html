<div id="pf200" class="pf w0 h0" data-page-no="200"><div class="pc pc200 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg200.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">15.9.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y236 ff1 fs3 fc0 sc0 ls0 ws773">查找文件，<span class="_ _c"></span>可使用 <span class="ff6 ws122f">os.walk() </span><span class="wsa0">函数，传一个顶级目录名给它。<span class="_ _c"></span>下面是一个例子，<span class="_ _c"></span>查</span></div><div class="t m0 x5 h9 y237 ff1 fs3 fc0 sc0 ls0">找特定的文件名并答应所有符合条件的文件全路径：</div><div class="t m0 x5 h11 y374 ffa fs5 fcd sc0 ls0 ws4">#!/usr/bin/env python3.3</div><div class="t m0 x5 h10 y375 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">os</span></div><div class="t m0 x5 hf y377 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">findfile<span class="fc0 ws13b">(start, name):</span></span></div><div class="t m0 x15 hf y378 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">relpath, dirs, files </span><span class="ws157">in <span class="ff8 fc0 ws13a">os<span class="fc6">.</span>walk(start):</span></span></div><div class="t m0 x16 hf y379 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">name </span>in <span class="ff8 fc0">files:</span></div><div class="t m0 x17 hf yaff ff8 fs5 fc0 sc0 ls0 ws16e">full_path <span class="fc6 ls32">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6">.</span><span class="ws4">join(start, relpath, name)</span></span></div><div class="t m0 x17 hf y3229 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(os<span class="fc6">.</span>path<span class="fc6 ls34">.</span>normpath(os<span class="fc6 ls34">.</span>path<span class="fc6">.</span>abspath(full_path)))</span></div><div class="t m0 x5 hf y322a ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y2226 ff8 fs5 fc0 sc0 ls0 ws13a">findfile(sys<span class="fc6">.</span>argv[<span class="fc7 ls34">1</span><span class="ws13b">], sys<span class="fc6 ls34">.</span></span>argv[<span class="fc7 ls34">2</span>])</div><div class="t m0 x0 h7 y322b ff1 fs3 fc0 sc0 ls30 ws1230">保存脚本为文件 <span class="ff4 ls0 wsa5">ﬁndﬁle.p<span class="_ _1"></span>y<span class="ff1 ls30 ws138">，然后在命令行中执行它。指定初始查找目录以及名字<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y322c ff1 fs3 fc0 sc0 ls0">作为位置参数，如下：</div><div class="t m0 x5 he y322d ff2 fs2 fc4 sc0 ls0 ws212">15.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y322e ff6 fs3 fc0 sc0 ls0 ws1231">os.walk() <span class="ff1 ls82 ws2f9">方法为我们遍历目录树，每次进入一个目录，它会返回一个三元组，包</span></div><div class="t m0 x5 h9 y322f ff1 fs3 fc0 sc0 ls13 wse5">含相对于查找目录的相对路径<span class="_ _1"></span>，一个该目录下的目录名列表，以及那个目录下面的文<span class="_ _c"></span></div><div class="t m0 x5 h9 y30d1 ff1 fs3 fc0 sc0 ls0">件名列表。</div><div class="t m0 x0 h9 y3230 ff1 fs3 fc0 sc0 ls0 wsa0">对<span class="_ _12"></span>于<span class="_ _12"></span>每<span class="_ _24"></span>个<span class="_ _12"></span>元<span class="_ _12"></span>组，<span class="_ _24"></span>只<span class="_ _12"></span>需<span class="_ _12"></span>检<span class="_ _12"></span>测<span class="_ _24"></span>一<span class="_ _12"></span>下<span class="_ _12"></span>目<span class="_ _24"></span>标<span class="_ _12"></span>文<span class="_ _12"></span>件<span class="_ _24"></span>名<span class="_ _12"></span>是<span class="_ _12"></span>否<span class="_ _12"></span>在<span class="_ _24"></span>文<span class="_ _12"></span>件<span class="_ _12"></span>列<span class="_ _24"></span>表<span class="_ _12"></span>中。<span class="_ _12"></span>如<span class="_ _24"></span>果<span class="_ _12"></span>是<span class="_ _12"></span>就<span class="_ _12"></span>使<span class="_ _24"></span>用</div><div class="t m0 x5 h9 y3231 ff6 fs3 fc0 sc0 ls0 ws1232">os.path.join() <span class="ff1 ls139 ws1233">合并路径<span class="_ _d"></span>。<span class="_ _6"></span>为了避免奇怪的路径名比如 <span class="ff6 ls0 ws1234">././<span class="_ _6"></span>foo//<span class="_ _0"></span>bar <span class="ff1 wsa0">，<span class="_ _0"></span>使<span class="_ _6"></span>用<span class="_ _0"></span>了<span class="_ _0"></span>另</span></span></span></div><div class="t m0 x5 h7 y3232 ff1 fs3 fc0 sc0 ls0 ws1235">外<span class="_ _6"></span>两<span class="_ _6"></span>个<span class="_ _6"></span>函<span class="_ _6"></span>数<span class="_ _6"></span>来<span class="_ _6"></span>修<span class="_ _6"></span>正<span class="_ _6"></span>结<span class="_ _6"></span>果。<span class="_ _6"></span>第<span class="_ _6"></span>一个<span class="_ _6"></span>是 <span class="ff6 ws167">os.path.abspath() <span class="ff4 ls21d">,</span></span><span class="wsa0">它<span class="_ _6"></span>接<span class="_ _6"></span>受<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _6"></span>路<span class="_ _6"></span>径，<span class="_ _6"></span>可<span class="_ _6"></span>能<span class="_ _6"></span>是<span class="_ _6"></span>相</span></div><div class="t m0 x5 h9 y3233 ff1 fs3 fc0 sc0 ls0 ws1236">对路径，<span class="_ _1"></span>最后返回绝对路径。<span class="_ _1"></span>第二个是 <span class="ff6 ws1237">os.path.normpath() </span><span class="wsa0">，<span class="_ _1"></span>用来返回正常路径，<span class="_ _1"></span>可</span></div><div class="t m0 x5 h9 y2e2 ff1 fs3 fc0 sc0 ls0">以解决双斜杆、对目录的多重引用的问题等。</div><div class="t m0 x0 h7 y3234 ff1 fs3 fc0 sc0 ls49 wsde4">尽管这个脚本相对于 <span class="ff4 ls0 ws1238">UNIX </span><span class="ws1a6">平台上面的很多查找公交来讲要简单很多<span class="_ _1"></span>，它还有跨<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y3235 ff1 fs3 fc0 sc0 ls1e ws111">平台的优势<span class="_ _1"></span>。并且，还能很轻松的加入其他的功能<span class="_ _c"></span>。我们再演示一<span class="_ _6"></span>个例子<span class="_ _1"></span>，下面的函</div><div class="t m0 x5 h9 y1774 ff1 fs3 fc0 sc0 ls0">数打印所有最近被修改过的文件：</div><div class="t m0 x5 h11 y7e2 ffa fs5 fcd sc0 ls0 ws4">#!/usr/bin/env python3.3</div><div class="t m0 x5 h10 y7e4 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">os</span></div><div class="t m0 x5 h10 y7e5 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y3236 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">modified_within<span class="fc0 ws13b">(top, seconds):</span></span></div><div class="t m0 x15 hf y3237 ff8 fs5 fc0 sc0 ls0 ws158">now <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>time()</span></div><div class="t m0 x15 hf y3238 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">path, dirs, files </span><span class="ws157">in <span class="ff8 fc0 ws13a">os<span class="fc6">.</span>walk(top):</span></span></div><div class="t m0 x16 hf y3239 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 fc0">files:</span></span></div><div class="t m0 x17 hf y323a ff8 fs5 fc0 sc0 ls0 ws1f5">fullpath <span class="fc6 ls33">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span><span class="ws13b">join(path, name)</span></span></div><div class="t m0 x17 hf y7eb ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>exists(fullpath):</span></div><div class="t m0 x18 hf y829 ff8 fs5 fc0 sc0 ls0 ws15f">mtime <span class="fc6 ls32">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6">.</span>getmtime(fullpath)</span></div><div class="t m0 x18 hf y82a ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws15f">mtime <span class="fc6 ls33">&gt;</span><span class="ws161">(now <span class="fc6 ls33">-</span>seconds):</span></span></div><div class="t m0 x29 hf y82b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(fullpath)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.9.<span class="_ _36"> </span>13.9 <span class="ff1 ws544">通过文件名查找文件 </span>503</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
