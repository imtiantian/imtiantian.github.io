<div id="pf1b2" class="pf w0 h0" data-page-no="1b2"><div class="pc pc1b2 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1b2.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ls33">,<span class="fc6 ls34">*</span></span>args,</span></span></div><div class="t m0 x3d hf y1ac ff8 fs5 fc0 sc0 ls0 ws13a">keyfile<span class="fc6">=<span class="fca">None</span></span><span class="ws4">, certfile<span class="fc6 ls34">=</span></span><span class="fca">None</span><span class="ws4">, ca_certs<span class="fc6 ls34">=</span></span><span class="fca">None</span>,</div><div class="t m0 x3d hf y1ad ff8 fs5 fc0 sc0 ls0 ws13a">cert_reqs<span class="fc6 ls34">=</span>ssl<span class="fc6 ls34">.</span>NONE,</div><div class="t m0 x3d hf y1ae ff8 fs5 fc6 sc0 ls34">**<span class="fc0 ls0">kwargs):</span></div><div class="t m0 x15 hf y1af ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws1f5">_keyfile <span class="fc6 ls33">=</span>keyfile</span></div><div class="t m0 x15 hf y1b0 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws16e">_certfile <span class="fc6 ls32">=</span>certfile</span></div><div class="t m0 x15 hf y355 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws16e">_ca_certs <span class="fc6 ls32">=</span>ca_certs</span></div><div class="t m0 x15 hf y410 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws2a3">_cert_reqs <span class="fc6 ls32">=</span>cert_reqs</span></div><div class="t m0 x15 hf y411 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__init__(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x5 hf y8c6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get_request<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x15 hf ybed ff8 fs5 fc0 sc0 ls0 ws13b">client, addr <span class="fc6 ls33">=</span><span class="fca ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>get_request()</span></span></div><div class="t m0 x15 hf ybee ff8 fs5 fc0 sc0 ls0 ws2a3">client_ssl <span class="fc6 ls32">=</span><span class="ws13a">ssl<span class="fc6">.</span>wrap_socket(client,</span></div><div class="t m0 x3e hf ybef ff8 fs5 fc0 sc0 ls0 ws155">keyfile <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>_keyfile,</div><div class="t m0 x3e hf ybf0 ff8 fs5 fc0 sc0 ls0 ws16d">certfile <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>_certfile,</div><div class="t m0 x3e hf yd7d ff8 fs5 fc0 sc0 ls0 ws16d">ca_certs <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>_ca_certs,</div><div class="t m0 x3e hf ybf1 ff8 fs5 fc0 sc0 ls0 ws16e">cert_reqs <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6">.</span></span>_cert_reqs,</div><div class="t m0 x3e hf ybf2 ff8 fs5 fc0 sc0 ls0 ws208">server_side <span class="fc6 ls32">=</span><span class="fca ws13a">True</span>)</div><div class="t m0 x15 hf ybf3 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws4">client_ssl, addr</span></div><div class="t m0 x0 h7 y21f7 ff1 fs3 fc0 sc0 ls0 wsfd0">为了使用这个 <span class="ff4 wsfd1">mixin </span><span class="wsa0">类，你可以将它跟其他服务器类混合。例如，下面是定义一个</span></div><div class="t m0 x5 h7 y2b46 ff1 fs3 fc0 sc0 ls0 ws14">基于 <span class="ff4 wsfce">SSL </span><span class="ls4">的</span><span class="ff4 wsb43">XML-RPC </span>服务器例子：</div><div class="t m0 x5 h11 y2c2f ffa fs5 fcd sc0 ls0 ws4"># XML-RPC server with SSL</div><div class="t m0 x5 hf y2c30 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wsb44">xmlrpc.server </span><span class="ws146">import <span class="ff8 fc0">SimpleXMLRPCServer</span></span></div><div class="t m0 x5 hf y2c31 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SSLSimpleXMLRPCServer<span class="ff8 fc0 ws13b">(SSLMixin, SimpleXMLRPCServer):</span></span></div><div class="t m0 x15 h10 y2c32 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y2c33 ff8 fs5 fc0 sc0 ls0 ws13a">Here<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">s the XML-RPC server from Recipe 11.6 modified only slightly to use SSL:</span></div><div class="t m0 x5 h10 y2c34 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">ssl</span></div><div class="t m0 x5 hf y2c35 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wsb44">xmlrpc.server </span><span class="ws146">import <span class="ff8 fc0">SimpleXMLRPCServer</span></span></div><div class="t m0 x5 hf y2c36 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">sslmixin </span><span class="ws146">import <span class="ff8 fc0">SSLMixin</span></span></div><div class="t m0 x5 hf y2c37 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SSLSimpleXMLRPCServer<span class="ff8 fc0 ws13b">(SSLMixin, SimpleXMLRPCServer):</span></span></div><div class="t m0 x15 h10 y2c38 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y29a5 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">KeyValueServer<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2c39 ff8 fs5 fc0 sc0 ls0 ws147">_rpc_methods_ <span class="fc6 ls33">=</span><span class="ws13a">[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">get<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">set<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">delete<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">exists<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">keys<span class="ff9 ws13b">&apos;</span></span>]</span></div><div class="t m0 x15 hf y29a6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y29a7 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_data </span><span class="ls32">=</span><span class="fc0">{}</span></span></div><div class="t m0 x16 hf y29a8 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_serv </span><span class="ls32">=</span><span class="fc0">SSLSimpleXMLRPCServer(</span><span class="ls34">*</span><span class="fc0 ws4">args, allow_none</span>=</span>True<span class="fc0 ls33">,</span><span class="fc6">**<span class="fc0">kwargs)</span></span></div><div class="t m0 x16 hf y1e2f ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_rpc_methods_:</span></span></span></div><div class="t m0 x17 hf y29a9 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_serv</span><span class="ls34">.</span><span class="fc0">register_function(</span></span>getattr<span class="fc0 ls34">(</span>self<span class="fc0 ws13b">, name))</span></div><div class="t m0 x15 hf y2c3a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name):</span></span></span></div><div class="t m0 x16 hf y2c3b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_data[name]</span></span></div><div class="t m0 x15 hf y2c3c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">set<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name, value):</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">13.10.<span class="_ _36"> </span>11.10 <span class="ff1 ws16b">在网络服务中加入 </span><span class="wsfc8">SSL 425</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
