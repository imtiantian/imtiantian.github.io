<div id="pf1a3" class="pf w0 h0" data-page-no="1a3"><div class="pc pc1a3 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a3.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">pathmap[method</span>.<span class="fc0 ws4">lower(), path] </span><span class="ls33">=</span><span class="fc0">function</span></span></div><div class="t m0 x16 hf y1ac ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">function</span></div><div class="t m0 x0 h9 y205b ff1 fs3 fc0 sc0 ls0">为了使用这个调度器，你只需要编写不同的处理器，就像下面这样：</div><div class="t m0 x5 h10 y2aa0 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y2aa1 ff8 fs5 fc0 sc0 ls0 ws208">_hello_resp <span class="fc6 ls32">=</span><span class="ff9 fc9 ws13b">&apos;&apos;&apos;<span class="ff7">\</span></span></div><div class="t m0 x5 hf y2aa2 ff8 fs5 fc9 sc0 ls0">&lt;html&gt;</div><div class="t m0 x19 hf y2aa3 ff8 fs5 fc9 sc0 ls0">&lt;head&gt;</div><div class="t m0 x31 hf y2aa4 ff8 fs5 fc9 sc0 ls0 ws13b">&lt;title&gt;Hello {name}&lt;/title&gt;</div><div class="t m0 x3c hf y2aa5 ff8 fs5 fc9 sc0 ls0">&lt;/head&gt;</div><div class="t m0 x3c hf y2aa6 ff8 fs5 fc9 sc0 ls0">&lt;body&gt;</div><div class="t m0 x31 hf y2aa7 ff8 fs5 fc9 sc0 ls0 ws13b">&lt;h1&gt;Hello {name}!&lt;/h1&gt;</div><div class="t m0 x3c hf y39b ff8 fs5 fc9 sc0 ls0">&lt;/body&gt;</div><div class="t m0 x5 hf y39c ff8 fs5 fc9 sc0 ls0 ws13a">&lt;/html&gt;<span class="ff9">&apos;&apos;&apos;</span></div><div class="t m0 x5 hf y39e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">hello_world<span class="fc0 ws13b">(environ, start_response):</span></span></div><div class="t m0 x15 hf y39f ff8 fs5 fc0 sc0 ls0 ws13a">start_response(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">200 OK<span class="ff9 ls34">&apos;</span><span class="fc0">, [ (</span><span class="ff9 ls34">&apos;</span><span class="ws13a">Content-type</span><span class="ff9">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">text/html<span class="ff9 ls34">&apos;</span></span>)])</div><div class="t m0 x15 hf y2aa8 ff8 fs5 fc0 sc0 ls0 ws145">params <span class="fc6 ls32">=</span><span class="ws13a">environ[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">params<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x15 hf y2aa9 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">_hello_resp<span class="fc6 ls34">.</span>format(name<span class="fc6">=</span>params<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">name<span class="ff9 ls34">&apos;</span></span>))</span></div><div class="t m0 x15 hf y2aaa ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0 ws13a">resp<span class="fc6 ls34">.</span>encode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y2aab ff8 fs5 fc0 sc0 ls0 ws151">_localtime_resp <span class="fc6 ls32">=</span><span class="ff9 fc9 ws13b">&apos;&apos;&apos;<span class="ff7">\</span></span></div><div class="t m0 x5 hf y2aac ff8 fs5 fc9 sc0 ls0 ws4">&lt;?xml version=&quot;1.0&quot;?&gt;</div><div class="t m0 x5 hf y2aad ff8 fs5 fc9 sc0 ls0">&lt;time&gt;</div><div class="t m0 x19 hf y1856 ff8 fs5 fc9 sc0 ls0">&lt;year&gt;{t.tm_year}&lt;/year&gt;</div><div class="t m0 x19 hf y2aae ff8 fs5 fc9 sc0 ls0">&lt;month&gt;{t.tm_mon}&lt;/month&gt;</div><div class="t m0 x19 hf y2aaf ff8 fs5 fc9 sc0 ls0">&lt;day&gt;{t.tm_mday}&lt;/day&gt;</div><div class="t m0 x19 hf y2ab0 ff8 fs5 fc9 sc0 ls0">&lt;hour&gt;{t.tm_hour}&lt;/hour&gt;</div><div class="t m0 x19 hf y2ab1 ff8 fs5 fc9 sc0 ls0">&lt;minute&gt;{t.tm_min}&lt;/minute&gt;</div><div class="t m0 x19 hf y2ab2 ff8 fs5 fc9 sc0 ls0">&lt;second&gt;{t.tm_sec}&lt;/second&gt;</div><div class="t m0 x5 hf yfa1 ff8 fs5 fc9 sc0 ls0 ws13a">&lt;/time&gt;<span class="ff9">&apos;&apos;&apos;</span></div><div class="t m0 x5 hf y2ab3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">localtime<span class="fc0 ws4">(environ, start_response):</span></span></div><div class="t m0 x15 hf y2ab4 ff8 fs5 fc0 sc0 ls0 ws13a">start_response(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">200 OK<span class="ff9 ls34">&apos;</span><span class="fc0">, [ (</span><span class="ff9 ls34">&apos;</span><span class="ws13a">Content-type</span><span class="ff9">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">application/xml<span class="ff9 ws13b">&apos;</span></span><span class="ws4">) ])</span></div><div class="t m0 x15 hf y2ab5 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">_localtime_resp<span class="fc6 ls34">.</span>format(t<span class="fc6 ls34">=</span>time<span class="fc6 ls34">.</span>localtime())</span></div><div class="t m0 x15 hf y2ab6 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0 ws13a">resp<span class="fc6 ls34">.</span>encode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y2ab7 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y2ab8 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws16a">resty </span><span class="ws146">import <span class="ff8 fc0">PathDispatcher</span></span></div><div class="t m0 x15 hf y2ab9 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws7d9">wsgiref.simple_server </span><span class="ws146">import <span class="ff8 fc0">make_server</span></span></div><div class="t m0 x15 h11 y2aba ffa fs5 fcd sc0 ls0 ws4"># Create the dispatcher and register functions</div><div class="t m0 x15 hf y2abb ff8 fs5 fc0 sc0 ls0 ws2a3">dispatcher <span class="fc6 ls32">=</span>PathDispatcher()</div><div class="t m0 x15 hf y2abc ff8 fs5 fc0 sc0 ls0 ws13a">dispatcher<span class="fc6 ls34">.</span>register(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">GET<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">/hello<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, hello_world)</span></div><div class="t m0 x15 hf y2abd ff8 fs5 fc0 sc0 ls0 ws13a">dispatcher<span class="fc6 ls34">.</span>register(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">GET<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">/localtime<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, localtime)</span></div><div class="t m0 x15 h11 y2abe ffa fs5 fcd sc0 ls0 ws4"># Launch a basic server</div><div class="t m0 x15 hf y2abf ff8 fs5 fc0 sc0 ls0 ws15f">httpd <span class="fc6 ls33">=</span><span class="ws13a">make_server(<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls32">,</span><span class="fc7">8080</span><span class="ws4">, dispatcher)</span></span></div><div class="t m0 x15 hf y2ac0 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Serving on port 8080...<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.5.<span class="_ _5"> </span>11.5 <span class="ff1 ws36c">创建一个简单的 </span><span class="wsf07">REST <span class="ff1 wsf08">接口 </span>410</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
