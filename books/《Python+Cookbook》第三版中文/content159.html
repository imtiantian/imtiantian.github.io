<div id="pf9f" class="pf w0 h0" data-page-no="9f"><div class="pc pc9f w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg9f.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x07\x00\x00\x00<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">m[<span class="fc7 ls34">0<span class="fc0">:</span>4</span><span class="ls32">]<span class="fc6">=</span><span class="ls34">b<span class="ff9 fc9">&apos;</span></span></span></span><span class="fc9 ws156">\x07\x01\x00\x00<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1ad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">v[<span class="fc7 ls34">0</span>]</span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc8 sc0 ls0">263</div><div class="t m0 x5 hf y1af ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 ye8c ff1 fs3 fc0 sc0 ls3a ws153">需要强调的一点是，内存映射一个文件并不会导致整个文件被读取到内存中。也就</div><div class="t m0 x5 h9 y7cb ff1 fs3 fc0 sc0 ls1e ws111">是说<span class="_ _1"></span>，文件并没有被复制到内存缓存或数组中<span class="_ _1"></span>。相反，操作系统仅仅为文件内容<span class="_ _1"></span>保留</div><div class="t m0 x5 h9 y7cc ff1 fs3 fc0 sc0 ls13 wse5">了一段虚拟内存<span class="_ _1"></span>。当你访问文件的不同区域时，这些区域的内容才根据需要被读取并<span class="_ _c"></span></div><div class="t m0 x5 h9 y1165 ff1 fs3 fc0 sc0 ls13 wse5">映射到内存区域中<span class="_ _1"></span>。而那些从没被访问到的部分还是留在磁盘上。所有这些过程是透<span class="_ _c"></span></div><div class="t m0 x5 h9 y7ce ff1 fs3 fc0 sc0 ls0">明的，在幕后完成！</div><div class="t m0 x0 h7 y7cf ff1 fs3 fc0 sc0 ls0 ws6ab">如果<span class="_ _6"></span>多<span class="_ _6"></span>个 <span class="ff4 ws117">Python </span><span class="ls22 ws24b">解释器内存映射同一个文件，得到的 </span><span class="ff6 ws217">mmap </span><span class="ls22 ws119">对象能够被用来在解<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y1166 ff1 fs3 fc0 sc0 ls1e ws111">释器直接交换数据<span class="_ _1"></span>。也就是说，所有<span class="_ _1"></span>解释器都能同时读写数据，并且其中一个解<span class="_ _1"></span>释器</div><div class="t m0 x5 h9 y1167 ff1 fs3 fc0 sc0 ls0 wsa0">所<span class="_ _6"></span>做的<span class="_ _6"></span>修<span class="_ _6"></span>改<span class="_ _6"></span>会<span class="_ _6"></span>自<span class="_ _6"></span>动呈<span class="_ _6"></span>现<span class="_ _6"></span>在<span class="_ _6"></span>其<span class="_ _6"></span>他<span class="_ _6"></span>解释<span class="_ _6"></span>器<span class="_ _6"></span>中。<span class="_ _6"></span>很<span class="_ _6"></span>明<span class="_ _6"></span>显，<span class="_ _6"></span>这里<span class="_ _6"></span>需<span class="_ _6"></span>要<span class="_ _6"></span>考<span class="_ _6"></span>虑<span class="_ _6"></span>同步<span class="_ _6"></span>的<span class="_ _6"></span>问<span class="_ _6"></span>题。<span class="_ _6"></span>但<span class="_ _6"></span>是这</div><div class="t m0 x5 h9 y1168 ff1 fs3 fc0 sc0 ls0">种方法有时候可以用来在管道或套接字间传递数据。</div><div class="t m0 x0 h7 y1169 ff1 fs3 fc0 sc0 ls0 ws6ac">这<span class="_ _6"></span>一<span class="_ _6"></span>小<span class="_ _6"></span>节<span class="_ _6"></span>中<span class="_ _6"></span>函<span class="_ _6"></span>数<span class="_ _6"></span>尽<span class="_ _6"></span>量<span class="_ _6"></span>写得<span class="_ _6"></span>很<span class="_ _6"></span>通<span class="_ _6"></span>用，<span class="_ _6"></span>同<span class="_ _6"></span>时<span class="_ _6"></span>适<span class="_ _6"></span>用<span class="_ _6"></span>于 <span class="ff4 ws6ad">Unix </span><span class="ls114">和</span><span class="ff4 ws6ae">Windows </span><span class="wsa0">平台。<span class="_ _6"></span>要<span class="_ _6"></span>注<span class="_ _6"></span>意<span class="_ _6"></span>的</span></div><div class="t m0 x5 h9 y116a ff1 fs3 fc0 sc0 ls0 ws63">是使用 <span class="ff6 ws25d">mmap() </span><span class="wsa0">函数时会在底层有一些平台的差异性。另外，还有一些选项可以用来创</span></div><div class="t m0 x5 h7 y116b ff1 fs3 fc0 sc0 ls30 ws31f">建匿名的内存映射区域。如果你对这个感兴趣<span class="_ _c"></span>，确保你仔细研读了 <span class="ff4 ls0 ws6af">Python </span><span class="ws59c">文档中 <span class="fc3 ls0">这</span></span></div><div class="t m0 x5 h9 y116c ff1 fs3 fc3 sc0 ls0 ws38">方面的内容 <span class="fc0">。</span></div><div class="t m0 x5 hd y116d ff2 fs4 fc4 sc0 ls0 ws211">7.11<span class="_ _e"> </span>5.11 <span class="ff1">文件路径名的操作</span></div><div class="t m0 x5 he y116e ff2 fs2 fc4 sc0 ls0 ws212">7.11.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y116f ff1 fs3 fc0 sc0 ls0">你需要使用路径名来获取文件名，目录名，绝对路径等等。</div><div class="t m0 x5 he y1170 ff2 fs2 fc4 sc0 ls0 ws212">7.11.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1171 ff1 fs3 fc0 sc0 ls0 ws371">使<span class="_ _6"></span>用 <span class="ff6 ws307">os.path </span><span class="ls14 ws174">模块中的函数来操作路径名<span class="_ _1"></span>。下面是一个交互式例子来演示一些关</span></div><div class="t m0 x5 h9 y1172 ff1 fs3 fc0 sc0 ls0">键的特性：</div><div class="t m0 x5 h10 y1173 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">os</span></span></div><div class="t m0 x5 hf y1174 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">path <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">/Users/beazley/Data/data.csv<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h11 y1175 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Get the last component of the path</span></div><div class="t m0 x5 hf y1176 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>basename(path)</span></div><div class="t m0 x5 hf y1177 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">data.csv<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 y3ef ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Get the directory name</span></div><div class="t m0 x5 hf y1178 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>dirname(path)</span></div><div class="t m0 x5 hf y1179 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/Users/beazley/Data<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 y117a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Join path components together</span></div><div class="t m0 x5 hf y117b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>join(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">tmp<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">data<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, os</span><span class="fc6">.</span>path<span class="fc6 ls34">.</span>basename(path))</span></div><div class="t m0 x5 hf y117c ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">tmp/data/data.csv<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.11.<span class="_ _5"> </span>5.11 <span class="ff1 ws533">文件路径名的操作 </span>150</div><a class="l" href="http://docs.python.org/3/library/mmap.html"><div class="d m1" style="border-style:none;position:absolute;left:766.980000px;bottom:746.298000px;width:11.956000px;height:14.016000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://docs.python.org/3/library/mmap.html"><div class="d m1" style="border-style:none;position:absolute;left:108.000000px;bottom:724.629000px;width:59.776000px;height:14.016000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
