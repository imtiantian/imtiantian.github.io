<div id="pfad" class="pf w0 h0" data-page-no="ad"><div class="pc pcad w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgad.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls3a ws50c">所有和临时文件相关的函数都允许你通过使用关键字参数 <span class="ff6 ls0 ws728">prefix </span><span class="ls123">、<span class="ff6 ls0 ws728">suffix </span><span class="ls10e">和<span class="ff6 ls0">dir</span></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">来自定义目录以及命名规则。比如：</div><div class="t m0 x5 hf y48d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">NamedTemporaryFile(prefix<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">mytemp<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, suffix<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fca">dir<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">/tmp<span class="ff9 ls34">&apos;</span></span></span>)</span></span></div><div class="t m0 x5 hf y48e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y48f ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/tmp/mytemp8ee899.txt<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y490 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y491 ff1 fs3 fc0 sc0 ls3d ws729">最后还有一点，尽可能以最安全的方式使用 <span class="ff6 ls0 ws2c3">tempfile </span><span class="ws164">模块来创建临时文件。包括<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y492 ff1 fs3 fc0 sc0 ls2d ws132">仅给当前用户授权访问以及在文件创建过程中采取措施避免竞态条件。要注意的是不<span class="_ _1"></span></div><div class="t m0 x5 h9 y493 ff1 fs3 fc0 sc0 ls0 ws14">同的平台可能会不一样。因此你最好阅读 <span class="fc3">官方文档 </span>来了解更多的细节。</div><div class="t m0 x5 hd y12dd ff2 fs4 fc4 sc0 ls0 ws211">7.20<span class="_ _e"> </span>5.20 <span class="ff1">与串行端口的数据通信</span></div><div class="t m0 x5 he y12de ff2 fs2 fc4 sc0 ls0 ws212">7.20.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y12df ff1 fs3 fc0 sc0 lse ws72a">你想通过串行端口读写数据，典型场景就是和一些硬件设备打交道 <span class="ff4 ls0 wsa5">(</span><span class="wsd8">比如一个机器</span></div><div class="t m0 x5 h7 y12e0 ff1 fs3 fc0 sc0 ls0 wsa0">人或传感器<span class="ff4 wsa5">)</span>。</div><div class="t m0 x5 he y12e1 ff2 fs2 fc4 sc0 ls0 ws212">7.20.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y12e2 ff1 fs3 fc0 sc0 ls1f ws72b">尽管你可以通过使用 <span class="ff4 ls0 ws72c">Python <span class="ff1 ws48f">内置的 </span><span class="ws72d">I/O </span></span><span class="ws113">模块来完成这个任务，但对于串行通信最</span></div><div class="t m0 x5 h7 y12e3 ff1 fs3 fc0 sc0 ls30 ws72e">好的选择是使用 <span class="ff4 fc3 ls0 ws72f">p<span class="_ _1"></span>ySerial <span class="ff1 ls6e">包<span class="fc0 ls30 ws1d7">。这个包的使用非常简单，先安装 </span></span><span class="fc0 wsa5">p<span class="_ _c"></span>ySerial<span class="ff1 ls30 ws138">，使用类似下</span></span></span></div><div class="t m0 x5 h9 ydf6 ff1 fs3 fc0 sc0 ls0">面这样的代码就能很容易的打开一个串行端口：</div><div class="t m0 x5 h10 y12e4 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">serial</span></div><div class="t m0 x5 hf y12e5 ff8 fs5 fc0 sc0 ls0 ws158">ser <span class="fc6 ls32">=</span><span class="ws13a">serial<span class="fc6">.</span>Serial(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">/dev/tty.usbmodem641<span class="ff9 ls34">&apos;</span></span><span class="ls32">,</span><span class="ffa fcd ws4"># Device name varies</span></span></div><div class="t m0 x29 hf y12e6 ff8 fs5 fc0 sc0 ls0 ws13a">baudrate<span class="fc6 ls34">=</span><span class="fc7">9600</span>,</div><div class="t m0 x29 hf y12e7 ff8 fs5 fc0 sc0 ls0 ws13a">bytesize<span class="fc6 ls34">=<span class="fc7">8</span></span>,</div><div class="t m0 x29 hf y12e8 ff8 fs5 fc0 sc0 ls0 ws13a">parity<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">N<span class="ff9">&apos;</span></span></span>,</div><div class="t m0 x29 hf y12e9 ff8 fs5 fc0 sc0 ls0 ws13a">stopbits<span class="fc6 ls34">=<span class="fc7">1</span></span>)</div><div class="t m0 x0 h7 y12ea ff1 fs3 fc0 sc0 ls6b ws730">设备名对于不同的设备和操作系统是不一样的。比如<span class="_ _1"></span>，在 <span class="ff4 ls0 ws731">Windo<span class="_ _1"></span>ws <span class="ff1 wsa0">系统<span class="_ _6"></span>上，<span class="_ _6"></span>你可</span></span></div><div class="t m0 x5 h7 y12eb ff1 fs3 fc0 sc0 ls16 ws732">以使用 <span class="ff4 ls0 ws733">0, 1 </span><span class="wsf3">等表示的一个设备来打开通<span class="_ _6"></span>信端口<span class="_ _c"></span><span class="ff4 ls0 ws734">”COM0” <span class="ff1 lsb">和</span><span class="wsa5">”COM1”<span class="ff1 wsa0">。<span class="_ _0"></span>一<span class="_ _6"></span>旦<span class="_ _6"></span>端<span class="_ _0"></span>口<span class="_ _6"></span>打<span class="_ _6"></span>开，</span></span></span></span></div><div class="t m0 x5 h9 y12ec ff1 fs3 fc0 sc0 ls0 ws14">那就可以使用 <span class="ff6 ws303">read()</span><span class="lsb">，</span><span class="ff6 ws2d1">readline() </span><span class="ls4">和</span><span class="ff6 ws23a">write() </span>函数读写数据了。例如：</div><div class="t m0 x5 hf y12ed ff8 fs5 fc0 sc0 ls0 ws13a">ser<span class="fc6 ls34">.</span>write(b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">G1 X50 Y50<span class="ff7 ws156">\r\n<span class="ff9 ls34">&apos;</span></span></span>)</div><div class="t m0 x5 hf y12ee ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">ser<span class="fc6 ls34">.</span>readline()</span></div><div class="t m0 x0 h9 yc9c ff1 fs3 fc0 sc0 ls0">大多数情况下，简单的串口通信从此变得十分简单。</div><div class="t m0 x5 he y12ef ff2 fs2 fc4 sc0 ls0 ws212">7.20.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y12f0 ff1 fs3 fc0 sc0 ls56 ws1fa">尽管表面上看起来很简单<span class="_ _c"></span>，其实串口通信有时候也是挺麻烦的<span class="_ _1"></span>。推荐你使用第三<span class="_ _1"></span></div><div class="t m0 x5 h7 y12f1 ff1 fs3 fc0 sc0 ls2c ws735">方包如 <span class="ff6 ls0 ws736">pySerial </span><span class="ws737">的一个原因是它提供了对高级特性的支持 <span class="ff4 ls0 wsa5">(<span class="ff1 wsa0">比如<span class="_ _6"></span>超时，控制<span class="_ _6"></span>流，缓冲</span></span></span></div><div class="t m0 x5 h7 y12f2 ff1 fs3 fc0 sc0 ls0 wsa0">区<span class="_ _6"></span>刷<span class="_ _6"></span>新，<span class="_ _0"></span>握<span class="_ _6"></span>手<span class="_ _6"></span>协<span class="_ _0"></span>议等<span class="_ _0"></span>等<span class="ff4 ls1b">)</span><span class="ws738">。<span class="_ _6"></span>举<span class="_ _6"></span>个<span class="_ _0"></span>例<span class="_ _6"></span>子，<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _0"></span>你<span class="_ _6"></span>想<span class="_ _6"></span>启<span class="_ _6"></span>用 <span class="ff6 ws739">RTS-<span class="_ _0"></span>CTS </span></span>握<span class="_ _6"></span>手<span class="_ _6"></span>协<span class="_ _6"></span>议，<span class="_ _0"></span>你<span class="_ _6"></span>只<span class="_ _6"></span>需<span class="_ _6"></span>要<span class="_ _0"></span>给</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.20.<span class="_ _5"> </span>5.20 <span class="ff1 ws509">与串行端口的数据通信 </span>164</div><a class="l" href="https://docs.python.org/3/library/tempfile.html"><div class="d m1" style="border-style:none;position:absolute;left:436.635000px;bottom:935.488500px;width:47.821000px;height:14.016000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://pyserial.sourceforge.net/"><div class="d m1" style="border-style:none;position:absolute;left:241.999500px;bottom:605.728500px;width:57.219000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
