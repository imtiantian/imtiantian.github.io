<div id="pf1e2" class="pf w0 h0" data-page-no="1e2"><div class="pc pc1e2 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1e2.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">send(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">World</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x5 he y2777 ff2 fs2 fc4 sc0 ls0 wsadf">14.10.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y300b ff4 fs3 fc0 sc0 ls0 ws1173">actor <span class="ff1 ls68 ws1174">模式的魅力就在于它的简单性。实际上，这里仅仅只有一个核心操作 </span><span class="ff6">send()</span></div><div class="t m0 x5 h7 y300c ff4 fs3 fc0 sc0 ls20e">.<span class="ff1 ls0 ws1175">甚<span class="_ _6"></span>至，<span class="_ _6"></span>对<span class="_ _0"></span>于在<span class="_ _0"></span>基<span class="_ _6"></span>于 </span><span class="ls0 ws1176">actor </span><span class="ff1 ls56 ws1fa">系统中的“<span class="_ _c"></span>消息”的泛化概念可以已多种方式被扩展<span class="_ _d"></span>。<span class="_ _6"></span>例<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y300d ff1 fs3 fc0 sc0 ls0 ws14">如，你可以以元组形式传递标签消息，让 <span class="ff4 wsb61">actor </span>执行不同的操作，如下：</div><div class="t m0 x5 hf y300e ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">TaggedActor<span class="ff8 fc0">(Actor):</span></span></div><div class="t m0 x15 hf y300f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y3010 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x3d hf y3011 ff8 fs5 fc0 sc0 ls0 ws13c">tag, <span class="fc6 ls34">*</span><span class="ws155">payload <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>recv()</span></div><div class="t m0 x3d hf y3012 ff8 fs5 fca sc0 ls0 ws13a">getattr<span class="fc0">(</span>self<span class="fc0 ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">do_<span class="ff9 ls34">&apos;</span><span class="fc6">+<span class="fc0">tag)(</span><span class="ls34">*</span><span class="fc0">payload)</span></span></span></div><div class="t m0 x15 h11 y3013 ffa fs5 fcd sc0 ls0 ws4"># Methods correponding to different message tags</div><div class="t m0 x15 hf y3014 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">do_A<span class="fc0">(<span class="fca">self</span><span class="ws4">, x):</span></span></span></div><div class="t m0 x16 hf y3015 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Running A</span>&apos;</span><span class="ls0 ws4">, x)</span></span></div><div class="t m0 x15 hf y3016 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">do_B<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></div><div class="t m0 x16 hf y3017 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Running B</span>&apos;</span><span class="ls0 ws4">, x, y)</span></span></div><div class="t m0 x5 h11 y3018 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y3019 ff8 fs5 fc0 sc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0">TaggedActor()</span></div><div class="t m0 x5 hf y301a ff8 fs5 fc0 sc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x5 hf y301b ff8 fs5 fc0 sc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">send((</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">A</span>&apos;</span><span class="ls32">,</span><span class="fc7">1</span><span class="ls0 ws1177">)) <span class="ffa fcd ws13b"># Invokes do_A(1)</span></span></div><div class="t m0 x5 hf y301c ff8 fs5 fc0 sc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">send((</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">B</span>&apos;</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls33">,<span class="fc7 ls0 ws13a">3</span><span class="ls0 ws1178">)) <span class="ffa fcd ws13b"># Invokes do_B(2,3)</span></span></span></div><div class="t m0 x0 h7 y1375 ff1 fs3 fc0 sc0 ls2c ws1179">作为另外一个例子，下面的 <span class="ff4 ls0 ws117a">actor </span><span class="ws12f">允许在一个工作者中运行任意的函数<span class="_ _1"></span>，并且通过</span></div><div class="t m0 x5 h7 y301d ff1 fs3 fc0 sc0 ls0 ws38">一个特殊的 <span class="ff4 ws117b">Result </span>对象返回结果：</div><div class="t m0 x5 hf y1bf ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">threading </span><span class="ws146">import <span class="ff8 fc0">Event</span></span></div><div class="t m0 x5 hf y9e8 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Result<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y9e9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y28a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">_evt </span><span class="ls33">=</span><span class="fc0">Event()</span></span></div><div class="t m0 x16 hf y9ea ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">_result </span><span class="ls33">=</span></span>None</div><div class="t m0 x15 hf y1c5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">set_result<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, value):</span></span></span></div><div class="t m0 x16 hf y1c6 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">_result </span><span class="ls33">=</span><span class="fc0">value</span></span></div><div class="t m0 x16 hf y301e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_evt</span><span class="ls34">.</span><span class="fc0">set()</span></span></div><div class="t m0 x15 hf y301f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">result<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y3020 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_evt</span><span class="ls34">.</span><span class="fc0">wait()</span></span></div><div class="t m0 x16 hf y3021 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_result</span></span></div><div class="t m0 x5 hf y3022 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Worker<span class="ff8 fc0">(Actor):</span></span></div><div class="t m0 x15 hf y3023 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">submit<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, func, </span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></span></div><div class="t m0 x16 hf y3024 ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0">Result()</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">14.10.<span class="_ _36"> </span>12.10 <span class="ff1 ws16b">定义一个 </span><span class="ws115f">Acto<span class="_ _c"></span>r <span class="ff1 ws1160">任务 </span>473</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
