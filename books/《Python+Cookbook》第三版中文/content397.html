<div id="pf18d" class="pf w0 h0" data-page-no="18d"><div class="pc pc18d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg18d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1ac ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc2 sc0 ls0 ws13a">ImportError<span class="fc0 ws4">: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">xml.superfast<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 yffa ff1 fs3 fc0 sc0 ls49 wsdd5">你之前安装过一个捕获未知模块的查找器<span class="_ _c"></span>，这个是 <span class="ff6 ls0 ws2f6">UrlMetaFinder <span class="ff1 wsa0">类<span class="_ _6"></span>的<span class="_ _6"></span>关<span class="_ _6"></span>键。<span class="_ _6"></span>一</span></span></div><div class="t m0 x5 h9 y288b ff1 fs3 fc0 sc0 ls9a">个<span class="ff6 ls0 wsdd6">UrlMetaFinder </span><span class="ls0 wsdd7">实<span class="_ _6"></span>例<span class="_ _6"></span>被<span class="_ _6"></span>添<span class="_ _6"></span>加<span class="_ _6"></span>到 <span class="ff6 ws3a9">sys.meta path<span class="_ _18"> </span></span><span class="wsa0">的末<span class="_ _6"></span>尾，<span class="_ _0"></span>作为<span class="_ _0"></span>最后<span class="_ _6"></span>一<span class="_ _0"></span>个查<span class="_ _6"></span>找<span class="_ _0"></span>器方<span class="_ _6"></span>案。</span></span></div><div class="t m0 x5 h9 y288c ff1 fs3 fc0 sc0 lsd3 ws4b2">如果被请求的模块名不能定位<span class="_ _c"></span>，就会被这个查找器<span class="_ _6"></span>处理掉<span class="_ _c"></span>。处理包的时候需要注意<span class="_ _1"></span>，<span class="_ _c"></span></div><div class="t m0 x5 h7 y288d ff1 fs3 fc0 sc0 lscc">在<span class="ff4 ls0 wsdd8">path </span><span class="ls19 wsdd9">参数中指定的值需要被检查，看它是否以查找器中注册的 </span><span class="ff4 ls0 wsdda">URL </span><span class="ls0 wsa0">开头。<span class="_ _6"></span>如果不</span></div><div class="t m0 x5 h9 y288e ff1 fs3 fc0 sc0 ls0">是，该子模块必须归属于其他查找器并被忽略掉。</div><div class="t m0 x0 h9 y288f ff1 fs3 fc0 sc0 ls2b wsddb">对于包的其他处理可在 <span class="ff6 ls0 ws835">UrlPackageLoader </span><span class="ws12e">类中被找到。这个类不会导入包名，而</span></div><div class="t m0 x5 h9 y2890 ff1 fs3 fc0 sc0 ls0 wsddc">是去<span class="_ _6"></span>加载<span class="_ _6"></span>对应<span class="_ _6"></span>的 <span class="ff6 ws7f6">init<span class="_ _e"> </span>.py </span><span class="wsddd">文件。<span class="_ _6"></span>它<span class="_ _6"></span>也会<span class="_ _6"></span>设置<span class="_ _6"></span>模块<span class="_ _6"></span>的 <span class="ff6 wsdde">path </span><span class="wsa0">属性，<span class="_ _6"></span>这一<span class="_ _6"></span>步很<span class="_ _6"></span>重<span class="_ _6"></span>要，</span></span></div><div class="t m0 x5 h9 y2891 ff1 fs3 fc0 sc0 ls22 wsddf">因为在加载包的子模块时这个值会被传给后面的 <span class="ff6 ls0 ws245">find module() </span><span class="ws119">调用。基于路径的导<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2892 ff1 fs3 fc0 sc0 ls3d ws164">入钩子是这些思想的一个扩展，但是采用了另外的方法<span class="_ _1"></span>。我们都知道，<span class="ff6 ls0 ws214">sys.path <span class="ff1 wsa0">是一</span></span></div><div class="t m0 x5 h7 y2893 ff1 fs3 fc0 sc0 ls4">个<span class="ff4 ls0 ws5c">Python <span class="ff1">查找模块的目录列表，例如：</span></span></div><div class="t m0 x5 hf y2894 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws146">pprint <span class="fca">import <span class="ff8 fc0">pprint</span></span></span></span></div><div class="t m0 x5 h10 y2895 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sys</span></span></div><div class="t m0 x5 hf y2896 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pprint(sys<span class="fc6 ls34">.</span>path)</span></div><div class="t m0 x5 hf y2897 ff8 fs5 fc8 sc0 ls34">[<span class="ff9 ls0 ws13b">&apos;&apos;<span class="ff8">,</span></span></div><div class="t m0 x5 hf y2898 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python33.zip</span>&apos;<span class="ff8 ls0">,</span></div><div class="t m0 x5 hf y2899 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3</span>&apos;<span class="ff8 ls0">,</span></div><div class="t m0 x5 hf y289a ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/plat-darwin</span>&apos;<span class="ff8 ls0">,</span></div><div class="t m0 x5 hf y4fc ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/lib-dynload</span>&apos;<span class="ff8 ls0">,</span></div><div class="t m0 x5 hf y4fd ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/...3.3/site-packages</span>&apos;<span class="ff8 ls0">]</span></div><div class="t m0 x5 hf y4fe ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y20d2 ff1 fs3 fc0 sc0 ls1c6">在<span class="ff6 ls0 ws214">sys.path </span><span class="ls3d ws164">中的每一个实体都会被额外的绑定到一个查找器对象上。你可以通过<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y289b ff1 fs3 fc0 sc0 ls0 ws14">查看 <span class="ff6 ws3a9">sys.path importer cache<span class="_ _a"> </span></span>去看下这些查找器：</div><div class="t m0 x5 hf y127 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pprint(sys<span class="fc6 ls34">.</span>path_importer_cache)</span></div><div class="t m0 x5 hf y128 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span>.<span class="ff9">&apos;</span><span class="ls0 ws13b">: FileFinder(</span><span class="ff9">&apos;</span>.<span class="ff9">&apos;</span><span class="ls0">),</span></div><div class="t m0 x5 hf y289c ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3</span>&apos;<span class="ff8 ls0 ws13b">: FileFinder(</span>&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3</span><span class="ls0 ws13b">&apos;<span class="ff8">),</span></span></div><div class="t m0 x5 hf y289d ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/</span>&apos;<span class="ff8 ls0 ws13b">: FileFinder(</span>&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/</span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y289e ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/collections</span>&apos;<span class="ff8 ls0 ws13b">: FileFinder(</span>&apos;<span class="ff8 ls0 ws13a">...python3.3/collections</span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y289f ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/encodings</span>&apos;<span class="ff8 ls0 ws4">: FileFinder(</span><span class="ls0 ws13b">&apos;<span class="ff8 ws13a">...python3.3/encodings</span></span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y28a0 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/lib-dynload</span>&apos;<span class="ff8 ls0 ws13b">: FileFinder(</span>&apos;<span class="ff8 ls0 ws13a">...python3.3/lib-dynload</span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y28a1 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/plat-darwin</span>&apos;<span class="ff8 ls0 ws13b">: FileFinder(</span>&apos;<span class="ff8 ls0 ws13a">...python3.3/plat-darwin</span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y28a2 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python3.3/site-packages</span>&apos;<span class="ff8 ls0 ws4">: FileFinder(</span><span class="ls0 ws13b">&apos;<span class="ff8 ws13a">...python3.3/site-packages</span></span>&apos;<span class="ff8 ls0">),</span></div><div class="t m0 x5 hf y28a3 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local/lib/python33.zip</span>&apos;<span class="ff8 ls0 ws4">: None}</span></div><div class="t m0 x5 hf y28a4 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y28a5 ff6 fs3 fc0 sc0 ls0 ws5ed">sys.path importer cache <span class="ff1 lsfe">比</span><span class="ws293">sys.path <span class="ff1 ls2d ws132">会更大点，因为它会为所有被加载代码的<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y28a6 ff1 fs3 fc0 sc0 ls0 ws63">目录记录它们的查找器。这包括包的子目录，这些通常在 <span class="ff6 ws1f3">sys.path </span>中是不存在的。</div><div class="t m0 x0 h7 y28a7 ff1 fs3 fc0 sc0 ls0 ws34a">要执行 <span class="ff6 wsde0">import<span class="_ _26"> </span>fib </span><span class="wsde1">，<span class="_ _1"></span>会顺序检查 <span class="ff6 wsde2">sys.path </span><span class="wsa0">中的目录。对于每个目录，<span class="_ _1"></span>名称“<span class="ff4 wsa5">ﬁb</span>”</span></span></div><div class="t m0 x5 h9 y28a8 ff1 fs3 fc0 sc0 ls13 wsa53">会被传给相应的 <span class="ff6 ls0 ws3a9">sys.path importer cache </span><span class="wse5">中的查找器。这个可以让你创建自己的查<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y28a9 ff1 fs3 fc0 sc0 ls0">找器并在缓存中放入一个实体。试试这个：</div><div class="t m0 x5 hf y28aa ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws16a">class <span class="fcc ws156">Finder<span class="ff8 fc0">:</span></span></span></div><div class="t m0 x5 hf y28ab ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca">def <span class="ff8 fcb ws13a">find_loader<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name):</span></span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>388</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
