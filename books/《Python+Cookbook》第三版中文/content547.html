<div id="pf223" class="pf w0 h0" data-page-no="223"><div class="pc pc223 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg223.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff8 fs5 fc0 sc0 ls0 ws15f">start <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6">.</span>perf_counter()</span></div><div class="t m0 x16 hf y1ac ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x16 hf y1ad ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>perf_counter()</span></div><div class="t m0 x16 hf y1ae ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">{}.{} : {}</span>&apos;</span><span class="fc6">.</span><span class="ls0 ws13a">format(func<span class="fc6">.</span><span class="ws4">__module__, func</span></span><span class="fc6">.</span><span class="ls0 ws13b">__name__, end <span class="fc6 ls32">-</span>start))</span></span></div><div class="t m0 x16 hf y1af ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">r</span></div><div class="t m0 x15 hf y1b0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x0 h9 y1f87 ff1 fs3 fc0 sc0 ls56 ws1fa">要使用这个装饰器<span class="_ _c"></span>，只需要将其放置在你要进行性能测试的函数定义前即可<span class="_ _1"></span>，比<span class="_ _1"></span></div><div class="t m0 x5 h9 y3517 ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 h10 y13c1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fc12">@timethis</span></div><div class="t m0 x5 hf y2e55 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></span></div><div class="t m0 x5 hf y3518 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x5 hf y2e56 ff7 fs5 fc5 sc0 ls0 ws8e2">... <span class="ff8 fc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x5 h10 y2e57 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y2e58 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">10000000</span>)</span></div><div class="t m0 x5 hf y2e59 ff8 fs5 fc8 sc0 ls0 ws4">__main__.countdown : 0.803001880645752</div><div class="t m0 x5 hf y3519 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y351a ff1 fs3 fc0 sc0 ls0">要测试某个代码块运行时间，你可以定义一个上下文管理器，例如：</div><div class="t m0 x5 hf y351b ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wscaf">contextlib </span><span class="ws146">import <span class="ff8 fc0">contextmanager</span></span></div><div class="t m0 x5 h10 y351c ff7 fs5 fc12 sc0 ls0">@contextmanager</div><div class="t m0 x5 hf y351d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">timeblock<span class="fc0">(label):</span></span></div><div class="t m0 x15 hf y351e ff8 fs5 fc0 sc0 ls0 ws15f">start <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6">.</span>perf_counter()</span></div><div class="t m0 x15 hf y351f ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x16 h10 y3520 ff7 fs5 fca sc0 ls0">yield</div><div class="t m0 x15 hf y3521 ff7 fs5 fca sc0 ls0 ws156">finally<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf y3522 ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>perf_counter()</span></div><div class="t m0 x16 hf y3523 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">{} : {}</span>&apos;</span><span class="fc6 ls0 ws13a">.<span class="fc0 ws4">format(label, end </span><span class="ls32">-</span><span class="fc0">start))</span></span></span></div><div class="t m0 x0 h9 y3524 ff1 fs3 fc0 sc0 ls0">下面是使用这个上下文管理器的例子：</div><div class="t m0 x5 hf y3525 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 fc0 ws13a">timeblock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">counting<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x5 hf y3526 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">10000000</span></span></span></div><div class="t m0 x5 hf y3527 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x5 hf y1225 ff7 fs5 fc5 sc0 ls0 ws8e2">... <span class="ff8 fc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x5 h10 y3528 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y3529 ff8 fs5 fc8 sc0 ls0 ws4">counting : 1.5551159381866455</div><div class="t m0 x5 hf y352a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y352b ff1 fs3 fc0 sc0 ls0 ws14">对于测试很小的代码片段运行性能，使用 <span class="ff6 ws3ce">timeit </span>模块会很方便，例如：</div><div class="t m0 x5 hf y352c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws146">timeit <span class="fca">import <span class="ff8 fc0">timeit</span></span></span></span></div><div class="t m0 x5 hf y352d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">math.sqrt(2)<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">import math</span><span class="ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y352e ff8 fs5 fc8 sc0 ls0">0.1432319980012835</div><div class="t m0 x5 hf y352f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sqrt(2)<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">from math import sqrt<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3530 ff8 fs5 fc8 sc0 ls0">0.10836604500218527</div><div class="t m0 x5 hf y3531 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y3532 ff6 fs3 fc0 sc0 ls0 ws1306">timeit <span class="ff1 ls6b ws12bd">会执行第一个参数中语句 </span><span class="ff4 ws1307">100 <span class="ff1 ls6b ws28f">万次并计算运行时间。第二个参数是运行测<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y3533 ff1 fs3 fc0 sc0 ls36 ws1308">试之前配置环境<span class="_ _c"></span>。如果你想改变循环执行次数，可以像下面这样设置 <span class="ff6 ls0 ws619">number <span class="ff1 wsa0">参数<span class="_ _0"></span>的</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.13.<span class="_ _36"> </span>14.13 <span class="ff1 wsd98">给你的程序做性能测试 </span>538</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
