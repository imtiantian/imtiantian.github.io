<div id="pf13a" class="pf w0 h0" data-page-no="13a"><div class="pc pc13a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg13a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">11.3.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y675 ff1 fs3 fc0 sc0 ls0 wsbaf">假<span class="_ _12"></span>设<span class="_ _24"></span>装<span class="_ _24"></span>饰<span class="_ _12"></span>器<span class="_ _24"></span>是<span class="_ _24"></span>通<span class="_ _24"></span>过 <span class="ff6 wsbb0">@wraps <span class="ff4 wsa5">(</span></span><span class="wsbb1">参<span class="_ _12"></span>考 <span class="ff4 wsbb2">9.2 </span><span class="wsa0">小<span class="_ _24"></span>节<span class="ff4 ls18d">)</span>来<span class="_ _24"></span>实<span class="_ _12"></span>现<span class="_ _24"></span>的，<span class="_ _24"></span>那<span class="_ _24"></span>么<span class="_ _12"></span>你<span class="_ _24"></span>可<span class="_ _24"></span>以<span class="_ _12"></span>通<span class="_ _24"></span>过<span class="_ _24"></span>访<span class="_ _12"></span>问</span></span></div><div class="t m0 x32 h9 y676 ff6 fs3 fc0 sc0 ls0 wsbae">wrapped <span class="ff1">属性来访问原始函数：</span></div><div class="t m0 x5 h10 y2110 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fc12">@somedecorator</span></div><div class="t m0 x5 hf y2111 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></span></div><div class="t m0 x5 hf y2112 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></span></div><div class="t m0 x5 h10 y2113 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y2114 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws1f5">orig_add <span class="fc6 ls33">=</span><span class="ws13a">add<span class="fc6 ls34">.</span>__wrapped__</span></span></div><div class="t m0 x5 hf y2115 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">orig_add(<span class="fc7 ls34">3</span><span class="ls33">,</span><span class="fc7">4</span>)</span></div><div class="t m0 x5 hf y2116 ff8 fs5 fc8 sc0 ls0">7</div><div class="t m0 x5 hf y2117 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y2118 ff2 fs2 fc4 sc0 ls0 ws212">11.3.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2119 ff1 fs3 fc0 sc0 ls3a ws153">直接访问未包装的原始函数在调试、内省和其他函数操作时是很有用的。但是我们</div><div class="t m0 x5 h9 y211a ff1 fs3 fc0 sc0 ls3d wsbb3">这里的方案仅仅适用于在包装器中正确使用了 <span class="ff6 ls0 wsbb4">@wraps </span><span class="wsbb5">或者直接设置了 <span class="ff6 ls0 wsbb6">wrapped <span class="ff1">属</span></span></span></div><div class="t m0 x5 h9 y211b ff1 fs3 fc0 sc0 ls0">性的情况。</div><div class="t m0 x0 h9 y136e ff1 fs3 fc0 sc0 ls42 wsbb7">如果有多个包装器，那么访问 <span class="ff6 ls0 wsbb8">wrapped </span><span class="ws186">属性的行为是不可预知的<span class="_ _1"></span>，应该避免这</span></div><div class="t m0 x5 h7 y211c ff1 fs3 fc0 sc0 ls0 ws14">样做。在 <span class="ff4 wsbb9">Python3.3 </span>中，它会略过所有的包装层，比如，假如你有如下的代码：</div><div class="t m0 x5 hf y211d ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 hf y211e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorator1<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y211f ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y2120 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y2121 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Decorator 1</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x16 hf y2122 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x15 hf y2123 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x5 hf y2124 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorator2<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y2125 ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y2126 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y2127 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Decorator 2</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x16 hf y2128 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x15 hf y1084 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x5 h10 y2129 ff7 fs5 fc12 sc0 ls0">@decorator1</div><div class="t m0 x5 h10 y212a ff7 fs5 fc12 sc0 ls0">@decorator2</div><div class="t m0 x5 hf y212b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></div><div class="t m0 x15 hf y212c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></div><div class="t m0 x0 h7 y1f51 ff1 fs3 fc0 sc0 ls0 ws38">下面我们在 <span class="ff4 wsbb9">Python3.3 </span>下测试：</div><div class="t m0 x5 hf y212d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y212e ff8 fs5 fc8 sc0 ls0 ws4">Decorator 1</div><div class="t m0 x5 hf y212f ff8 fs5 fc8 sc0 ls0 ws4">Decorator 2</div><div class="t m0 x5 hf y2130 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.3.<span class="_ _5"> </span>9.3 <span class="ff1 ws3ba">解除一个装饰器 </span>305</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
