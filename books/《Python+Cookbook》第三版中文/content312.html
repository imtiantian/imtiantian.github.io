<div id="pf138" class="pf w0 h0" data-page-no="138"><div class="pc pc138 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg138.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls113 wsb9d">需要强调的是装饰器并不会修改原始函数的参数签名以及返回值<span class="_ _d"></span>。使用 <span class="ff6 ls0">*args</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls100">和<span class="ff6 ls0 wsb9e">**kwargs </span><span class="ls6c ws29d">目的就是确保任何参数都能适用<span class="_ _1"></span>。而返回结果值基本都是调用原始函数<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y2c ff6 fs3 fc0 sc0 ls0 ws270">func(*args,<span class="_ _11"> </span>**kwargs) <span class="ff1 ws14">的返回结果，其中 <span class="ff4 wsb9f">func </span>就是原始函数。</span></div><div class="t m0 x0 h9 y99 ff1 fs3 fc0 sc0 ls10 wsdf">刚开始学习装饰器的时候<span class="_ _1"></span>，会使用一些简单的例子来说明，比如上面演示的这个<span class="_ _c"></span>。</div><div class="t m0 x5 h9 y9a ff1 fs3 fc0 sc0 ls0 wsba0">不过实际场景使用时，还是有一些细节问题要注意的。<span class="_ _c"></span>比如上面使用 <span class="ff6 wsba1">@wraps(func) </span>注</div><div class="t m0 x5 h7 y9b ff1 fs3 fc0 sc0 ls0 wsba2">解是<span class="_ _6"></span>很<span class="_ _6"></span>重<span class="_ _6"></span>要的，<span class="_ _6"></span>它<span class="_ _6"></span>能<span class="_ _6"></span>保留<span class="_ _6"></span>原<span class="_ _6"></span>始函<span class="_ _6"></span>数<span class="_ _6"></span>的<span class="_ _6"></span>元数<span class="_ _6"></span>据 <span class="ff4 wsa5">(</span><span class="wsa0">下<span class="_ _6"></span>一小<span class="_ _6"></span>节<span class="_ _6"></span>会<span class="_ _6"></span>讲到<span class="ff4 wsa5">)</span>，<span class="_ _6"></span>新<span class="_ _6"></span>手<span class="_ _6"></span>经常<span class="_ _6"></span>会<span class="_ _6"></span>忽略<span class="_ _6"></span>这<span class="_ _6"></span>个</span></div><div class="t m0 x5 h9 y9c ff1 fs3 fc0 sc0 ls13 wse5">细节<span class="_ _1"></span>。接下来的几个小节我们会更加深入的讲解装饰器函数的细节问题，如果你想构<span class="_ _c"></span></div><div class="t m0 x5 h9 y9d ff1 fs3 fc0 sc0 ls0">造你自己的装饰器函数，需要认真看一下。</div><div class="t m0 x5 hd y11c3 ff2 fs4 fc4 sc0 ls0 ws9c6">11.2<span class="_ _e"> </span>9.2 <span class="ff1">创建装饰器时保留函数元信息</span></div><div class="t m0 x5 he y20e2 ff2 fs2 fc4 sc0 ls0 ws212">11.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y20e3 ff1 fs3 fc0 sc0 ls3a ws153">你写了一个装饰器作用在某个函数上，但是这个函数的重要的元信息比如名字、文</div><div class="t m0 x5 h9 y20e4 ff1 fs3 fc0 sc0 ls0">档字符串、注解和参数签名都丢失了。</div><div class="t m0 x5 he y20e5 ff2 fs2 fc4 sc0 ls0 ws212">11.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y20e6 ff1 fs3 fc0 sc0 ls3a wsba3">任何时候你定义装饰器的时候，都应该使用 <span class="ff6 ls0 wsba4">functools <span class="ff1 wsba5">库中的 </span><span class="wsba6">@wraps <span class="ff1 wsa0">装饰器来注</span></span></span></div><div class="t m0 x5 h9 yfe7 ff1 fs3 fc0 sc0 ls0">解底层包装函数。例如：</div><div class="t m0 x5 h10 y20e7 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y20e8 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 hf y20e9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">timethis<span class="fc0">(func):</span></span></div><div class="t m0 x15 h15 y20ea ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y20eb ffa fs5 fc9 sc0 ls0 ws4">Decorator that reports the execution time.</div><div class="t m0 x15 h15 y20ec ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y20ed ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y20ee ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y20ef ff8 fs5 fc0 sc0 ls0 ws15f">start <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6">.</span>time()</span></div><div class="t m0 x16 hf y20f0 ff8 fs5 fc0 sc0 ls0 ws145">result <span class="fc6 ls32">=</span><span class="ws13a">func(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x16 hf y20f1 ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>time()</span></div><div class="t m0 x16 hf y20f2 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(func<span class="fc6 ls34">.</span><span class="ws13b">__name__, end<span class="fc6 ls34">-</span>start)</span></span></div><div class="t m0 x16 hf y20f3 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">result</span></div><div class="t m0 x15 hf y20f4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x0 h9 y20f5 ff1 fs3 fc0 sc0 ls0">下面我们使用这个被包装后的函数并检查它的元信息：</div><div class="t m0 x5 h10 ydac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fc12">@timethis</span></div><div class="t m0 x5 hf y20f6 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n:<span class="fca">int</span>):</span></span></span></div><div class="t m0 x5 h10 y7c6 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffb fc9">&apos;&apos;&apos;</span></div><div class="t m0 x5 h11 y7c7 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffa fc9 ws13b">Counts down</span></div><div class="t m0 x5 h10 y7c8 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffb fc9">&apos;&apos;&apos;</span></div><div class="t m0 x5 hf ydad ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x5 hf y20f7 ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x5 h10 ydae ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf ydaf ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">100000</span>)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.2.<span class="_ _5"> </span>9.2 <span class="ff1 ws21e">创建装饰器时保留函数元信息 </span>303</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
