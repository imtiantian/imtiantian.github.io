<div id="pf107" class="pf w0 h0" data-page-no="107"><div class="pc pc107 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg107.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">10.10<span class="_ _e"> </span>8.10 <span class="ff1">使用延迟计算属性</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">10.10.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y658 ff1 fs3 fc0 sc0 ls35 ws77e">你想将一个只读属性定义成一个 <span class="ff4 ls0 wsa5">prop<span class="_ _6"></span>ert<span class="_ _c"></span>y<span class="ff1 ls35 ws144">，并且只在访问的时候才会计算结果。但</span></span></div><div class="t m0 x5 h9 y659 ff1 fs3 fc0 sc0 ls0">是一旦被访问后，你希望结果值被缓存起来，不用每次都去计算。</div><div class="t m0 x5 he y18fe ff2 fs2 fc4 sc0 ls0 wsadf">10.10.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y6f0 ff1 fs3 fc0 sc0 ls0">定义一个延迟属性的一种高效方法是通过使用一个描述器类，如下所示：</div><div class="t m0 x5 hf y1c78 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">lazyproperty<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c79 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, func):</span></span></span></div><div class="t m0 x16 hf y1c7a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">func </span><span class="ls33">=</span><span class="fc0">func</span></span></div><div class="t m0 x15 hf y1c7b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__get__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, cls):</span></span></span></div><div class="t m0 x16 hf y1c7c ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">instance </span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1c7d ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">self</span></div><div class="t m0 x16 hf y1c7e ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1c7f ff8 fs5 fc0 sc0 ls0 ws15f">value <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>func(instance)</div><div class="t m0 x17 hf y1c80 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ws2a3">(instance, </span>self<span class="fc6">.<span class="fc0">func</span><span class="ls34">.</span><span class="fc0 ws4">__name__, value)</span></span></div><div class="t m0 x17 hf y1c81 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">value</span></div><div class="t m0 x0 h9 y1c82 ff1 fs3 fc0 sc0 ls0">你需要像下面这样在一个类中使用它：</div><div class="t m0 x5 h10 y1c83 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">math</span></div><div class="t m0 x5 hf y1c84 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Circle<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c85 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, radius):</span></span></span></div><div class="t m0 x16 hf y1c86 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">radius </span><span class="ls32">=</span><span class="fc0">radius</span></span></div><div class="t m0 x15 h10 y1c87 ff7 fs5 fc12 sc0 ls0">@lazyproperty</div><div class="t m0 x15 hf y1c88 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">area<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1c89 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Computing area</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x16 hf y1c8a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">math<span class="fc6 ls34">.</span><span class="ws159">pi <span class="fc6 ls32">*</span></span><span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws145">radius <span class="fc6 ws23d">** <span class="fc7">2</span></span></span></span></div><div class="t m0 x15 h10 y1c8b ff7 fs5 fc12 sc0 ls0">@lazyproperty</div><div class="t m0 x15 hf y1c8c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">perimeter<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y208 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Computing perimeter<span class="ff9">&apos;</span><span class="fc0">)</span></span></span></span></div><div class="t m0 x16 hf y4ca ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc7 ls32">2<span class="fc6 ls33">*<span class="fc0 ls0 ws13a">math<span class="fc6">.</span><span class="ws15c">pi </span></span><span class="ls32">*</span></span></span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">radius</span></span></div><div class="t m0 x0 h9 y1c8d ff1 fs3 fc0 sc0 ls0">下面在一个交互环境中演示它的使用：</div><div class="t m0 x5 hf y1c8e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">Circle(<span class="fc7">4.0</span>)</span></span></div><div class="t m0 x5 hf y1c8f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">radius</span></span></span></div><div class="t m0 x5 hf y1c90 ff8 fs5 fc8 sc0 ls0">4.0</div><div class="t m0 x5 hf y1c91 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y12dc ff8 fs5 fc8 sc0 ls0 ws4">Computing area</div><div class="t m0 x5 hf y40f ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.10.<span class="_ _5"> </span>8.10 <span class="ff1 wsae1">使用延迟计算属性 </span>254</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
