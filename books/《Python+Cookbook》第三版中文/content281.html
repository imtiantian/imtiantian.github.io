<div id="pf119" class="pf w0 h0" data-page-no="119"><div class="pc pc119 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg119.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getattr__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name):</span></span></span></div><div class="t m0 x16 hf y1ac ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">getattr:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, name)</span></span></span></span></div><div class="t m0 x16 hf y1ad ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">getattr<span class="fc0 ls34">(</span>self<span class="fc6">.<span class="fc0 ws4">_obj, name)</span></span></span></div><div class="t m0 x15 h11 y1af ffa fs5 fcd sc0 ls0 ws4"># Delegate attribute assignment</div><div class="t m0 x15 hf y1b0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setattr__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name, value):</span></span></span></div><div class="t m0 x16 hf y355 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">name<span class="fc6 ls34">.</span>startswith(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">_<span class="ff9">&apos;</span></span></span>):</span></div><div class="t m0 x17 hf y410 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__setattr__(name, value)</span></span></div><div class="t m0 x16 hf y411 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf yba ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">setattr:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, name, value)</span></span></span></span></div><div class="t m0 x17 hf y8c6 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ls34">(</span>self<span class="fc6 ls34">.</span><span class="fc0 ws4">_obj, name, value)</span></div><div class="t m0 x15 h11 ybee ffa fs5 fcd sc0 ls0 ws4"># Delegate attribute deletion</div><div class="t m0 x15 hf ybef ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__delattr__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name):</span></span></span></div><div class="t m0 x16 hf ybf0 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">name<span class="fc6 ls34">.</span>startswith(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">_<span class="ff9">&apos;</span></span></span>):</span></div><div class="t m0 x17 hf yd7d ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__delattr__(name)</span></div><div class="t m0 x16 hf ybf1 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf ybf2 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">delattr:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, name)</span></span></span></span></div><div class="t m0 x17 hf ybf3 ff8 fs5 fca sc0 ls0 ws13a">delattr<span class="fc0 ls34">(</span>self<span class="fc6 ls34">.</span><span class="fc0 ws4">_obj, name)</span></div><div class="t m0 x0 h9 y1e00 ff1 fs3 fc0 sc0 ls0">使用这个代理类时，你只需要用它来包装下其他类即可：</div><div class="t m0 x5 hf y1e01 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1e02 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, x):</span></span></span></div><div class="t m0 x16 hf y1e03 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></div><div class="t m0 x15 hf y1e04 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, y):</span></span></span></div><div class="t m0 x16 hf y1e05 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Spam.bar:</span>&apos;</span><span class="ls33">,</span></span><span class="ff8 ws13a">self<span class="fc6">.<span class="fc0 ws4">x, y)</span></span></span></div><div class="t m0 x5 h11 y1e06 ffa fs5 fcd sc0 ls0 ws4"># Create an instance</div><div class="t m0 x5 hf y1e07 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Spam(<span class="fc7">2</span>)</span></div><div class="t m0 x5 h11 y1e08 ffa fs5 fcd sc0 ls0 ws4"># Create a proxy around it</div><div class="t m0 x5 hf y1e09 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0">Proxy(s)</span></div><div class="t m0 x5 h11 y1e0a ffa fs5 fcd sc0 ls0 ws4"># Access the proxy</div><div class="t m0 x5 hf y1e0b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(p<span class="fc6 ls34">.</span><span class="wsb1e">x) <span class="ffa fcd ws13b"># Outputs 2</span></span></span></div><div class="t m0 x5 hf y1e0c ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">bar(</span></span><span class="fc7">3</span><span class="lscf">)<span class="ffa fcd ls0 ws4"># Outputs &quot;Spam.bar: 2 3&quot;</span></span></div><div class="t m0 x5 hf y1e0d ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.</span><span class="ls33">x<span class="fc6 ls32">=<span class="fc7 ls0 wsb1e">37 <span class="ffa fcd ws4"># Changes s.x to 37</span></span></span></span></div><div class="t m0 x0 h7 y1e0e ff1 fs3 fc0 sc0 lse wsb1f">通过自定义属性访问方法，你可以用不同方式自定义代理类行为 <span class="ff4 ls0 wsa5">(</span><span class="wsd8">比如加入日志功</span></div><div class="t m0 x5 h7 y1e0f ff1 fs3 fc0 sc0 ls0 wsa0">能、只读访问等<span class="ff4 wsa5">)</span>。</div><div class="t m0 x5 he y1e10 ff2 fs2 fc4 sc0 ls0 wsadf">10.15.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1e11 ff1 fs3 fc0 sc0 ls0">代理类有时候可以作为继承的替代方案。例如，一个简单的继承如下：</div><div class="t m0 x5 hf y1e12 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y1e13 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">(<span class="fca">self</span><span class="ws4">, x):</span></span></span></div><div class="t m0 x16 hf y1e14 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">A.spam</span>&apos;</span><span class="ls0 ws13b">, x)</span></span></div><div class="t m0 x15 hf y1e15 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">foo<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1e16 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">A.foo<span class="ff9 ws13b">&apos;</span><span class="fc0">)</span></span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.15.<span class="_ _5"> </span>8.15 <span class="ff1 wsb0f">属性的代理访问 </span>272</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
