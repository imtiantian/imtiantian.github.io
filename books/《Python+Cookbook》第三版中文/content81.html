<div id="pf51" class="pf w0 h0" data-page-no="51"><div class="pc pc51 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg51.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1e8 ff8 fs5 fc0 sc0 ls0 ws2a3">master_pat <span class="fc6 ls32">=</span><span class="ws13a">re<span class="fc6 ls34">.</span>compile(<span class="ff9 fc9 ls34">&apos;<span class="ffd ls0 ws13b">|</span>&apos;<span class="ff8 fc6">.</span></span><span class="ws4">join([NUM, PLUS, MINUS, TIMES,</span></span></div><div class="t m0 x1e hf y1e9 ff8 fs5 fc0 sc0 ls0 ws4">DIVIDE, LPAREN, RPAREN, WS]))</div><div class="t m0 x5 h11 y1ea ffa fs5 fcd sc0 ls0 ws4"># Tokenizer</div><div class="t m0 x5 hf y903 ff8 fs5 fc0 sc0 ls0 ws15f">Token <span class="fc6 ls33">=</span><span class="ws13a">collections<span class="fc6 ls34">.</span>namedtuple(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Token<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, [<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">type<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">value<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x5 hf y904 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">generate_tokens<span class="fc0">(text):</span></span></div><div class="t m0 x15 hf y905 ff8 fs5 fc0 sc0 ls0 ws155">scanner <span class="fc6 ls32">=</span><span class="ws13a">master_pat<span class="fc6 ls34">.</span>scanner(text)</span></div><div class="t m0 x15 hf y906 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">m</span><span class="ws157">in <span class="ff8 ws13a">iter<span class="fc0">(scanner<span class="fc6 ls34">.</span><span class="ws145">match, </span></span>None<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y907 ff8 fs5 fc0 sc0 ls0 ws158">tok <span class="fc6 ls32">=</span><span class="ws13a">Token(m<span class="fc6 ls34">.</span><span class="ws4">lastgroup, m</span><span class="fc6">.</span>group())</span></div><div class="t m0 x16 hf y908 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">tok<span class="fc6 ls34">.</span><span class="ws13c">type <span class="fc6 ws159">!= <span class="ff9 fc9 ws13b">&apos;</span></span></span><span class="fc9">WS<span class="ff9 ls34">&apos;</span></span>:</span></div><div class="t m0 x17 hf y909 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0">tok</span></div><div class="t m0 x5 h11 y90a ffa fs5 fcd sc0 ls0 ws4"># Parser</div><div class="t m0 x5 hf y61 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ExpressionEvaluator<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h15 y90b ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y90c ffa fs5 fc9 sc0 ls0 ws4">Implementation of a recursive descent parser. Each method</div><div class="t m0 x15 h11 y90d ffa fs5 fc9 sc0 ls0 ws4">implements a single grammar rule. Use the ._accept() method</div><div class="t m0 x15 h11 y90e ffa fs5 fc9 sc0 ls0 ws4">to test and accept the current lookahead token. Use the ._expect()</div><div class="t m0 x15 h11 y90f ffa fs5 fc9 sc0 ls0 ws4">method to exactly match and discard the next token on on the input</div><div class="t m0 x15 h11 y910 ffa fs5 fc9 sc0 ls0 ws4">(or raise a SyntaxError if it doesn<span class="ffb ls34">&apos;</span>t match).</div><div class="t m0 x15 h15 y911 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y912 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">parse<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, text):</span></span></span></div><div class="t m0 x16 hf y913 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">tokens </span><span class="ls32">=</span><span class="fc0">generate_tokens(text)</span></span></div><div class="t m0 x16 hf y914 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws158">tok </span><span class="ls33">=</span></span><span class="ws43e">None <span class="ffa fcd ws4"># Last symbol consumed</span></span></div><div class="t m0 x16 hf y915 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">nexttok </span><span class="ls33">=</span></span><span class="ws43e">None <span class="ffa fcd ws4"># Next symbol tokenized</span></span></div><div class="t m0 x16 hf y916 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws43f">_advance() <span class="ffa fcd ws4"># Load first lookahead token</span></span></span></div><div class="t m0 x16 hf y917 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">expr()</span></span></div><div class="t m0 x15 hf y918 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">_advance<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y919 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Advance one token ahead<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y91a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">tok, </span></span>self<span class="fc6 ls34">.</span><span class="fc0 ws155">nexttok <span class="fc6 ls32">=</span></span>self<span class="fc6 ls34">.</span><span class="fc0 ws1f5">nexttok, </span>next<span class="fc0 ls34">(</span>self<span class="fc6">.<span class="fc0 ws155">tokens, </span></span>None<span class="fc0">)</span></div><div class="t m0 x15 hf y91b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">_accept<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, toktype):</span></span></span></div><div class="t m0 x16 hf y91c ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Test and consume the next token if it matches toktype<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y91d ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws1f4">nexttok </span></span><span class="ws139">and <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">nexttok<span class="fc6 ls34">.</span><span class="ws161">type <span class="fc6 ws15c">== </span>toktype:</span></span></span></span></div><div class="t m0 x17 hf y91e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_advance()</span></span></div><div class="t m0 x17 hf y91f ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">True</span></div><div class="t m0 x16 hf y920 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y921 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">False</span></div><div class="t m0 x15 hf y922 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">_expect<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, toktype):</span></span></span></div><div class="t m0 x16 hf y923 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Consume next token if it matches toktype or raise SyntaxError<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y924 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_accept(toktype):</span></span></div><div class="t m0 x17 hf y925 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">SyntaxError<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws1f5">Expected <span class="ff9 ls33">&apos;</span><span class="fc6 ls32">+</span><span class="fc0">toktype)</span></span></span></div><div class="t m0 x15 h11 y926 ffa fs5 fcd sc0 ls0 ws4"># Grammar rules follow</div><div class="t m0 x15 hf y927 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">expr<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.19.<span class="_ _5"> </span>2.19 <span class="ff1 ws42c">实现一个简单的递归下降分析器 </span>72</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
