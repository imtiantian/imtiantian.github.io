<div id="pf1fc" class="pf w0 h0" data-page-no="1fc"><div class="pc pc1fc w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1fc.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 wsa0">默<span class="_ _6"></span>认<span class="_ _6"></span>情<span class="_ _6"></span>况<span class="_ _6"></span>下，<span class="_ _6"></span><span class="ff6 ws149">check output() </span><span class="ls14 ws174">仅仅返回输入到标准输出的值。如果你需要同时收<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0 ws38">集标准输出和错误输出，使用 <span class="ff6 ws25d">stderr </span>参数：</div><div class="t m0 x5 hf y48d ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>check_output([<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">cmd<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">arg1<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">arg2<span class="ff9 ls34">&apos;</span></span>],</span></div><div class="t m0 x37 hf y48e ff8 fs5 fc0 sc0 ls0 ws13a">stderr<span class="fc6">=</span>subprocess<span class="fc6">.</span>STDOUT)</div><div class="t m0 x0 h9 y31d2 ff1 fs3 fc0 sc0 ls0 ws14">如果你需要用一个超时机制来执行命令，使用 <span class="ff6 ws472">timeout </span>参数：</div><div class="t m0 x5 hf y31d3 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y31d4 ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>check_output([<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">cmd<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">arg1<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">arg2<span class="ff9 ls34">&apos;</span></span><span class="ws13b">], timeout<span class="fc6 ls34">=</span></span><span class="fc7">5</span>)</span></div><div class="t m0 x5 hf y31d5 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0 ws13a">subprocess<span class="fc6 ls34">.</span><span class="ws169">TimeoutExpired </span></span><span class="ws157">as <span class="ff8 fc0">e:</span></span></div><div class="t m0 x15 hf y31d6 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h7 y31d7 ff1 fs3 fc0 sc0 ls22 ws1208">通常来讲，命令的执行不需要使用到底层 <span class="ff4 ls0 ws1209">shell <span class="ff1 ws120a">环境<span class="_ _6"></span>（比如 </span><span class="wsa5">sh</span></span><span class="ls219">、<span class="ff4 ls0 wsa5">bash<span class="ff1 wsa0">）<span class="_ _f"></span>。<span class="_ _6"></span>一个<span class="_ _6"></span>字<span class="_ _6"></span>符</span></span></span></div><div class="t m0 x5 h9 y31d8 ff1 fs3 fc0 sc0 ls15b ws120b">串列表会被传递给一个低级系统命令<span class="_ _c"></span>，比如 <span class="ff6 ls0 ws120c">os.execve() </span><span class="ws9ae">。如果你想让命令被一个<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y31d9 ff4 fs3 fc0 sc0 ls0 ws120d">shell <span class="ff1 ls51 ws120e">执行，传递一个字符串参数，并设置参数 </span><span class="ff6 ws11c0">shell=True </span><span class="ls21a">.</span><span class="ff1 ws120f">有时候你想<span class="_ _6"></span>要 </span><span class="ws4ce">Python <span class="ff1">去</span></span></div><div class="t m0 x5 h7 y31da ff1 fs3 fc0 sc0 ls2b ws1210">执行一个复杂的 <span class="ff4 ls0 ws1211">shell </span><span class="ws12e">命令的时候这个就很有用了，比如管道流、<span class="ff4 ls0 ws1212">I/O <span class="ff1 wsa0">重定向和<span class="_ _6"></span>其他特</span></span></span></div><div class="t m0 x5 h9 y31db ff1 fs3 fc0 sc0 ls0">性。例如：</div><div class="t m0 x5 hf y31dc ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>check_output(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">grep python <span class="ffd ls215">|</span><span class="ws4">wc &gt; out<span class="ff9 ls34">&apos;</span></span><span class="fc0">, shell<span class="fc6 ls34">=</span></span></span><span class="fca">True</span>)</span></div><div class="t m0 x0 h7 y9fc ff1 fs3 fc0 sc0 lsa8 ws1213">需要注意的是在 <span class="ff4 ls0 ws1214">shell <span class="ff1 wsa0">中执<span class="_ _6"></span>行<span class="_ _6"></span>命令<span class="_ _6"></span>会存<span class="_ _6"></span>在一<span class="_ _6"></span>定<span class="_ _6"></span>的安<span class="_ _6"></span>全风<span class="_ _6"></span>险，特<span class="_ _6"></span>别<span class="_ _6"></span>是当<span class="_ _6"></span>参数<span class="_ _6"></span>来自<span class="_ _6"></span>于<span class="_ _6"></span>用</span></span></div><div class="t m0 x5 h9 y31dd ff1 fs3 fc0 sc0 ls0 ws14">户输入时。这时候可以使用 <span class="ff6 ws317">shlex.quote() </span>函数来讲参数正确的用双引用引起来。</div><div class="t m0 x5 he y31de ff2 fs2 fc4 sc0 ls0 ws212">15.6.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y31df ff1 fs3 fc0 sc0 ls0 ws1215">使<span class="_ _6"></span>用 <span class="ff6 ws149">check output()<span class="_ _7"> </span></span><span class="wsa0">函<span class="_ _0"></span>数是<span class="_ _0"></span>执行<span class="_ _0"></span>外<span class="_ _6"></span>部<span class="_ _6"></span>命<span class="_ _6"></span>令<span class="_ _6"></span>并<span class="_ _6"></span>获<span class="_ _0"></span>取其<span class="_ _0"></span>返回<span class="_ _0"></span>值<span class="_ _6"></span>的<span class="_ _6"></span>最<span class="_ _6"></span>简<span class="_ _6"></span>单<span class="_ _6"></span>方<span class="_ _0"></span>式。但<span class="_ _0"></span>是，</span></div><div class="t m0 x5 h9 y30d3 ff1 fs3 fc0 sc0 ls16 wsf3">如果你需要对子进程做更复杂的交互<span class="_ _c"></span>，比如给它发送输入<span class="_ _1"></span>，你得采用另外一种方法<span class="_ _1"></span>。<span class="_ _c"></span></div><div class="t m0 x5 h9 y31e0 ff1 fs3 fc0 sc0 ls0 ws14">这时候可直接使用 <span class="ff6 ws2fb">subprocess.Popen </span>类。例如：</div><div class="t m0 x5 h10 ye25 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">subprocess</span></div><div class="t m0 x5 h11 ye27 ffa fs5 fcd sc0 ls0 ws4"># Some text to send</div><div class="t m0 x5 hf ye28 ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ls34">b</span><span class="ff9 fc9">&apos;&apos;&apos;</span></div><div class="t m0 x5 hf ye29 ff8 fs5 fc9 sc0 ls0 ws4">hello world</div><div class="t m0 x5 hf ye2a ff8 fs5 fc9 sc0 ls0 ws4">this is a test</div><div class="t m0 x5 hf ye2b ff8 fs5 fc9 sc0 ls0">goodbye</div><div class="t m0 x5 h15 ye2c ff9 fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x5 h11 y31e1 ffa fs5 fcd sc0 ls0 ws4"># Launch a command with pipes</div><div class="t m0 x5 hf y31e2 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">subprocess<span class="fc6 ls34">.</span>Popen([<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">wc<span class="ff9 ls34">&apos;</span></span>],</span></div><div class="t m0 x48 hf ye2f ff8 fs5 fc0 sc0 ls0 ws145">stdout <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>PIPE,</span></div><div class="t m0 x48 hf ye30 ff8 fs5 fc0 sc0 ls0 ws458">stdin <span class="fc6 ls32">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>PIPE)</span></div><div class="t m0 x5 h11 ye32 ffa fs5 fcd sc0 ls0 ws4"># Send the data and get the output</div><div class="t m0 x5 hf ye33 ff8 fs5 fc0 sc0 ls0 ws4">stdout, stderr <span class="fc6 ls32">=</span><span class="ls34">p<span class="fc6">.</span></span>communicate(text)</div><div class="t m0 x5 h11 ye35 ffa fs5 fcd sc0 ls0 ws4"># To interpret as text, decode</div><div class="t m0 x5 hf ye36 ff8 fs5 fc0 sc0 ls0 ws158">out <span class="fc6 ls32">=</span><span class="ws13a">stdout<span class="fc6">.</span>decode(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf ye37 ff8 fs5 fc0 sc0 ls0 ws158">err <span class="fc6 ls32">=</span><span class="ws13a">stderr<span class="fc6">.</span>decode(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.6.<span class="_ _36"> </span>13.6 <span class="ff1 ws6e7">执行外部命令并获取它的输出 </span>499</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
