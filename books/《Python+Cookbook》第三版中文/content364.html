<div id="pf16c" class="pf w0 h0" data-page-no="16c"><div class="pc pc16c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg16c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0">然后，再在一个函数中执行同样的代码：</div><div class="t m0 x5 hf y212 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y213 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=<span class="fc7 ls0">13</span></span></span></div><div class="t m0 x5 hf y214 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls5e ws209">b=a+1<span class="_ _15"></span><span class="ff9 ls0 ws13b">&apos;<span class="ff8 fc0">)</span></span></span></span></span></span></div><div class="t m0 x5 hf y215 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(b)</span></span></div><div class="t m0 x5 h10 y216 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y217 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test()</span></div><div class="t m0 x5 hf y218 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y16b0 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y16b1 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">4</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span>test</span></div><div class="t m0 x5 hf y16b2 ff8 fs5 fc2 sc0 ls0 ws13a">NameError<span class="fc0 ws13b">: global name <span class="ff9">&apos;</span><span class="ls34">b<span class="ff9 ls33">&apos;</span></span>is not defined</span></div><div class="t m0 x5 hf y16b3 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y25cf ff1 fs3 fc0 sc0 ls0 wscbe">可<span class="_ _6"></span>以<span class="_ _6"></span>看<span class="_ _6"></span>出，<span class="_ _0"></span>最后<span class="_ _0"></span>抛<span class="_ _6"></span>出<span class="_ _6"></span>了<span class="_ _6"></span>一<span class="_ _6"></span>个 <span class="ff4 wscbf">NameError </span><span class="wscc0">异<span class="_ _6"></span>常，<span class="_ _0"></span>就跟<span class="_ _0"></span>在 <span class="ff6 wscc1">exec() </span><span class="ls63 ws21f">语句从没执行过一<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y25d0 ff1 fs3 fc0 sc0 ls0 ws14">样。要是你想在后面的计算中使用到 <span class="ff6 ws25d">exec() </span>执行结果的话就会有问题了。</div><div class="t m0 x0 h9 y25d1 ff1 fs3 fc0 sc0 ls30 wscc2">为了修正这样的错误，你需要在调用 <span class="ff6 ls0 ws8aa">exec() </span><span class="wscc3">之前使用 <span class="ff6 ls0 ws2a1">locals() </span><span class="ws138">函数来得到一个<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y25d2 ff1 fs3 fc0 sc0 ls0">局部变量字典。之后你就能从局部字典中获取修改过后的变量值了。例如：</div><div class="t m0 x5 hf y25d3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y25d4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=<span class="fc7 ls0">13</span></span></span></div><div class="t m0 x5 hf y25d5 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws158">loc <span class="fc6 ls32">=</span><span class="fca ws13a">locals</span>()</span></div><div class="t m0 x5 hf y25d6 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls5e ws209">b=a+1<span class="_ _15"></span><span class="ff9 ls0 ws13b">&apos;<span class="ff8 fc0">)</span></span></span></span></span></span></div><div class="t m0 x5 hf y25d7 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">loc[<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">b<span class="ff9">&apos;</span></span></span>]</span></span></div><div class="t m0 x5 hf y25d8 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(b)</span></span></div><div class="t m0 x5 h10 y25d9 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y25da ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test()</span></div><div class="t m0 x5 hf y1a50 ff8 fs5 fc8 sc0 ls0">14</div><div class="t m0 x5 hf y25db ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y25dc ff2 fs2 fc4 sc0 ls0 wsadf">11.23.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y25dd ff1 fs3 fc0 sc0 ls0 ws260">实际上对于 <span class="ff6 wscc4">exec() </span><span class="wscc5">的正确使用是比较难的。大多数情况下当你要考虑使用 <span class="ff6">exec()</span></span></div><div class="t m0 x5 h9 y25de ff1 fs3 fc0 sc0 ls0 wsa0">的时候，还有另外更好的解决方案（比如装饰器、闭包、元类等等）<span class="_ _f"></span>。</div><div class="t m0 x0 h9 y25df ff1 fs3 fc0 sc0 lse wscc6">然而，如果你仍然要使用 <span class="ff6 ls0 ws20b">exec() </span><span class="wsd8">，本节列出了一些如何正确使用它的方法<span class="_ _1"></span>。默认</span></div><div class="t m0 x5 h9 y25e0 ff1 fs3 fc0 sc0 ls0 wsa0">情况<span class="_ _6"></span>下，<span class="ff6 ws6aa">exec() </span><span class="lse wsd8">会在调用者局部和全局范围内执行代码。然而<span class="_ _1"></span>，在函数里面，传递给</span></div><div class="t m0 x5 h9 y17cc ff6 fs3 fc0 sc0 ls0 ws8aa">exec() <span class="ff1 ls30 wscc7">的局部范围是拷贝实际局部变量组成的一个字典<span class="_ _1"></span>。因此，如果 <span class="ff6 ls0 ws8aa">exec() <span class="ff1 wsa0">如果<span class="_ _6"></span>执</span></span></span></div><div class="t m0 x5 h9 y25e1 ff1 fs3 fc0 sc0 ls13 wse5">行了修改操作<span class="_ _1"></span>，这种修改后的结果对实际局部变量值是没有影响的。下面是另外一个<span class="_ _c"></span></div><div class="t m0 x5 h9 y66c ff1 fs3 fc0 sc0 ls0">演示它的例子：</div><div class="t m0 x5 hf y25e2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test1<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y25e3 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></span></div><div class="t m0 x5 hf y25e4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">x += 1<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y25e5 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(x)</span></span></div><div class="t m0 x5 h10 y25e6 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y25e7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test1()</span></div><div class="t m0 x5 hf y25e8 ff8 fs5 fc8 sc0 ls0">0</div><div class="t m0 x5 hf y1aac ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.23.<span class="_ _5"> </span>9.23 <span class="ff1 wsb03">在局部变量域中执行代码 </span>355</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
