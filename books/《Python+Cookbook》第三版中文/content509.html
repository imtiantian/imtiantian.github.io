<div id="pf1fd" class="pf w0 h0" data-page-no="1fd"><div class="pc pc1fd w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1fd.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff6 fs3 fc0 sc0 ls0 ws7ec">subprocess <span class="ff1 ws1216">模<span class="_ _6"></span>块<span class="_ _6"></span>对<span class="_ _6"></span>于<span class="_ _6"></span>依<span class="_ _6"></span>赖 <span class="ff4 ws1217">TTY </span><span class="wsa0">的<span class="_ _6"></span>外<span class="_ _6"></span>部<span class="_ _6"></span>命<span class="_ _6"></span>令<span class="_ _6"></span>不<span class="_ _6"></span>合<span class="_ _6"></span>适<span class="_ _6"></span>用。<span class="_ _0"></span>例如，<span class="_ _6"></span>你<span class="_ _6"></span>不<span class="_ _6"></span>能<span class="_ _0"></span>使用<span class="_ _6"></span>它<span class="_ _6"></span>来<span class="_ _6"></span>自</span></span></div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 ws4b3">动化一个用户输入密码的任务（比如一个 <span class="ff4 ws1218">ssh </span><span class="wsa0">会话）<span class="_ _f"></span>。这时候，你需要使用到第三方模</span></div><div class="t m0 x5 h7 y2c ff1 fs3 fc0 sc0 ls0 ws14">块了，比如基于著名的 <span class="ff6 ws25d">expect </span><span class="wsa0">家族的工具（<span class="ff4 ws1219">p<span class="_ _6"></span>exp<span class="_ _6"></span>ect </span>或类似的）</span></div><div class="t m0 x5 hd y1914 ff2 fs4 fc4 sc0 ls0 ws211">15.7<span class="_ _e"> </span>13.7 <span class="ff1">复制或者移动文件和目录</span></div><div class="t m0 x5 he y1915 ff2 fs2 fc4 sc0 ls0 ws212">15.7.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y1916 ff1 fs3 fc0 sc0 ls0 ws38">你想要复制或移动文件和目录，但是又不想调用 <span class="ff4 wsd7b">shell </span>命令。</div><div class="t m0 x5 he y31e3 ff2 fs2 fc4 sc0 ls0 ws212">15.7.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y31e4 ff6 fs3 fc0 sc0 ls0 ws3ce">shutil <span class="ff1">模块有很多便捷的函数可以复制文件和目录。使用起来非常简单，比如：</span></div><div class="t m0 x5 h10 y31e5 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">shutil</span></div><div class="t m0 x5 h11 y13c7 ffa fs5 fcd sc0 ls0 ws4"># Copy src to dst. (cp src dst)</div><div class="t m0 x5 hf y31e6 ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copy(src, dst)</span></div><div class="t m0 x5 h11 y31e7 ffa fs5 fcd sc0 ls0 ws4"># Copy files, but preserve metadata (cp -p src dst)</div><div class="t m0 x5 hf y31e8 ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copy2(src, dst)</span></div><div class="t m0 x5 h11 y31e9 ffa fs5 fcd sc0 ls0 ws4"># Copy directory tree (cp -R src dst)</div><div class="t m0 x5 hf y31ea ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copytree(src, dst)</span></div><div class="t m0 x5 h11 y31eb ffa fs5 fcd sc0 ls0 ws4"># Move src to dst (mv src dst)</div><div class="t m0 x5 hf y31ec ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">move(src, dst)</span></div><div class="t m0 x0 h7 y1cc0 ff1 fs3 fc0 sc0 lse ws121a">这些函数的参数都是字符串形式的文件或目录名。底层语义模拟了类似的 <span class="ff4 ls0 wsfff">Unix <span class="ff1">命</span></span></div><div class="t m0 x5 h9 y31ed ff1 fs3 fc0 sc0 ls0">令，如上面的注释部分。</div><div class="t m0 x0 h9 y31ee ff1 fs3 fc0 sc0 ls0 wsa0">默认情况下，对于符号<span class="_ _6"></span>链接而已这些命令处理的<span class="_ _6"></span>是它指向的东西。例如，如<span class="_ _6"></span>果源文</div><div class="t m0 x5 h9 y31ef ff1 fs3 fc0 sc0 ls13 wse5">件是一个符号链接<span class="_ _1"></span>，那么目标文件将会是符号链接指向的文件。如果你只想复制符号<span class="_ _c"></span></div><div class="t m0 x5 h7 y31f0 ff1 fs3 fc0 sc0 ls0 ws14">链接本身，那么需要指定关键字参数 <span class="ff6 ws1f3">follow<span class="_ _7"> </span>symlinks <span class="ff4 ls83">,</span></span>如下：</div><div class="t m0 x0 h9 y31f1 ff1 fs3 fc0 sc0 ls0">如果你想保留被复制目录中的符号链接，像这样做：</div><div class="t m0 x5 hf ya7e ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copytree(src, dst, symlinks</span><span class="fc6">=<span class="fca">True</span></span>)</div><div class="t m0 x0 h9 y31f2 ff6 fs3 fc0 sc0 ls0 ws65d">copytree() <span class="ff1 ls10 wsdf">可以让你在复制过程中选择性的忽略某些文件或目录。你可以提供一<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y31f3 ff1 fs3 fc0 sc0 ls0 wsa0">个<span class="_ _6"></span>忽略<span class="_ _6"></span>函<span class="_ _6"></span>数，<span class="_ _6"></span>接<span class="_ _6"></span>受<span class="_ _6"></span>一个<span class="_ _6"></span>目<span class="_ _6"></span>录<span class="_ _6"></span>名<span class="_ _6"></span>和<span class="_ _6"></span>文件<span class="_ _6"></span>名<span class="_ _6"></span>列<span class="_ _6"></span>表<span class="_ _6"></span>作<span class="_ _6"></span>为输<span class="_ _6"></span>入，<span class="_ _6"></span>返<span class="_ _6"></span>回<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _6"></span>忽略<span class="_ _6"></span>的<span class="_ _6"></span>名<span class="_ _6"></span>称<span class="_ _6"></span>列<span class="_ _6"></span>表。例</div><div class="t m0 x5 h9 y31f4 ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 hf y31f5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">ignore_pyc_files<span class="fc0 ws13b">(dirname, filenames):</span></span></div><div class="t m0 x15 hf ybb4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws15f">[name </span><span class="ws160">in <span class="ff8 fc0 ws16e">filenames </span><span class="ws157">if <span class="ff8 fc0 ws13a">name<span class="fc6 ls34">.</span>endswith(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">.pyc<span class="ff9 ls34">&apos;</span></span>)]</span></span></span></div><div class="t m0 x5 hf y31f6 ff8 fs5 fc0 sc0 ls0 ws13a">shutil<span class="fc6 ls34">.</span><span class="ws4">copytree(src, dst, ignore<span class="fc6 ls34">=</span>ignore_pyc_files)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.7.<span class="_ _36"> </span>13.7 <span class="ff1 ws512">复制或者移动文件和目录 </span>500</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
