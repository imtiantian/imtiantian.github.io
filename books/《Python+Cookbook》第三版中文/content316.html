<div id="pf13c" class="pf w0 h0" data-page-no="13c"><div class="pc pc13c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg13c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x17 hf y1ac ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span><span class="ws13b">log(level, logmsg)</span></div><div class="t m0 x17 hf y1ad ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x16 hf y1ae ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x15 hf y1af ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">decorate</span></div><div class="t m0 x5 h11 y355 ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y410 ff7 fs5 fc12 sc0 ls0 ws156">@logged<span class="ff8 fc0 ws13a">(logging<span class="fc6 ls34">.</span>DEBUG)</span></div><div class="t m0 x5 hf y411 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></div><div class="t m0 x15 hf yba ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></div><div class="t m0 x5 hf ybed ff7 fs5 fc12 sc0 ls0 ws156">@logged<span class="ff8 fc0 ws13a">(logging<span class="fc6 ls34">.</span><span class="ws16e">CRITICAL, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">example<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf ybee ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">():</span></span></div><div class="t m0 x15 hf ybef ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Spam!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h9 y1273 ff1 fs3 fc0 sc0 ls0 wsbbe">初看起来，<span class="_ _8"></span>这种实现看上去很复杂，<span class="_ _8"></span>但是核心思想很简单。<span class="_ _8"></span>最外层的函数 <span class="ff6">logged()</span></div><div class="t m0 x5 h9 y2142 ff1 fs3 fc0 sc0 ls0 wsbbf">接受参数并将它们作用在内部的装饰器函数上面。内层的函数 <span class="ff6 ws87e">decorate() </span>接受一个函</div><div class="t m0 x5 h9 y2143 ff1 fs3 fc0 sc0 ls13 wse5">数作为参数<span class="_ _1"></span>，然后在函数上面放置一个包装器。这里的关键点是包装器是可以使用传<span class="_ _c"></span></div><div class="t m0 x5 h9 y2144 ff1 fs3 fc0 sc0 ls0 ws14">递给 <span class="ff6 ws1f3">logged() </span>的参数的。</div><div class="t m0 x5 he y2145 ff2 fs2 fc4 sc0 ls0 ws212">11.4.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2146 ff1 fs3 fc0 sc0 ls22 ws119">定义一个接受参数的包装器看上去比较复杂主要是因为底层的调用序列。特别的<span class="_ _1"></span>，</div><div class="t m0 x5 h9 y2147 ff1 fs3 fc0 sc0 ls0">如果你有下面这个代码：</div><div class="t m0 x5 hf y2148 ff7 fs5 fc12 sc0 ls0 ws156">@decorator<span class="ff8 fc0 ws4">(x, y, z)</span></div><div class="t m0 x5 hf y2149 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">func<span class="fc0 ws13b">(a, b):</span></span></div><div class="t m0 x15 h10 y214a ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h7 y214b ff1 fs3 fc0 sc0 ls0 wsa0">装饰器处理过程跟下面的调用是等效的<span class="ff4">;</span></div><div class="t m0 x5 hf y214c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">func<span class="fc0 ws13b">(a, b):</span></span></div><div class="t m0 x15 h10 y214d ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y214e ff8 fs5 fc0 sc0 ls0 ws13c">func <span class="fc6 ls32">=</span><span class="ws4">decorator(x, y, z)(func)</span></div><div class="t m0 x0 h9 y214f ff6 fs3 fc0 sc0 ls0 wsbc0">decorator(x,<span class="_ _23"> </span>y,<span class="_ _1c"> </span>z) <span class="ff1 lsa8 ws3de">的返回结果必须是一个可调用对象，它接受一个函数作为参<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y2150 ff1 fs3 fc0 sc0 ls0 ws14">数并包装它，可以参考 <span class="ff4 ws2b4">9.7 </span>小节中另外一个可接受参数的包装器例子。</div><div class="t m0 x5 hd y2151 ff2 fs4 fc4 sc0 ls0 ws9c6">11.5<span class="_ _e"> </span>9.5 <span class="ff1">可自定义属性的装饰器</span></div><div class="t m0 x5 he y1c42 ff2 fs2 fc4 sc0 ls0 ws212">11.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2152 ff1 fs3 fc0 sc0 ls3a ws153">你想写一个装饰器来包装一个函数，并且允许用户提供参数在运行时控制装饰器行</div><div class="t m0 x5 h9 y2153 ff1 fs3 fc0 sc0 ls0">为。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.5.<span class="_ _5"> </span>9.5 <span class="ff1 ws9db">可自定义属性的装饰器 </span>307</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
