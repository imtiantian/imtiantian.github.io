<div id="pf246" class="pf w0 h0" data-page-no="246"><div class="pc pc246 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg246.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff4 fs3 fc0 sc0 ls0 ws146d">swig <span class="ff1 ls149 ws937">的输出就是两个文件<span class="_ _c"></span>，<span class="ff4 ls0 ws146e">sample wrap.c<span class="_ _18"> </span></span><span class="ls1a5">和<span class="ff4 ls0 wsa5">sample.p<span class="_ _c"></span>y<span class="ff1 ls149 ws937">。后面的文件就是用户需</span></span></span></span></div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 ws146f">要<span class="_ _0"></span>导<span class="_ _6"></span>入<span class="_ _0"></span>的。<span class="_ _0"></span>而 <span class="ff4 ws146e">sample wrap.c<span class="_ _18"> </span></span><span class="ws1470">文<span class="_ _6"></span>件<span class="_ _0"></span>是<span class="_ _0"></span>需<span class="_ _6"></span>要<span class="_ _0"></span>被<span class="_ _0"></span>编<span class="_ _6"></span>译<span class="_ _0"></span>到<span class="_ _0"></span>名<span class="_ _6"></span>叫 <span class="ff6 ws1471">sample </span><span class="ws1472">的<span class="_ _0"></span>支<span class="_ _0"></span>持<span class="_ _6"></span>模<span class="_ _0"></span>块<span class="_ _0"></span>的 <span class="ff4 ls27a">C</span>代</span></span></div><div class="t m0 x5 h9 y2c ff1 fs3 fc0 sc0 ls0 wsa0">码。<span class="_ _6"></span>这个<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>通<span class="_ _6"></span>过<span class="_ _6"></span>跟普<span class="_ _6"></span>通<span class="_ _6"></span>扩<span class="_ _6"></span>展<span class="_ _6"></span>模<span class="_ _6"></span>块一<span class="_ _6"></span>样<span class="_ _6"></span>的<span class="_ _6"></span>技<span class="_ _6"></span>术<span class="_ _6"></span>来完<span class="_ _6"></span>成。<span class="_ _6"></span>例<span class="_ _6"></span>如，<span class="_ _6"></span>你<span class="_ _6"></span>创<span class="_ _6"></span>建了<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _6"></span>如<span class="_ _6"></span>下<span class="_ _6"></span>所示</div><div class="t m0 x5 h9 y2d ff1 fs3 fc0 sc0 ls4">的<span class="ff6 ls0 ws26f">setup.py <span class="ff1">文件：</span></span></div><div class="t m0 x5 h11 y37db ffa fs5 fcd sc0 ls0 ws4"># setup.py</div><div class="t m0 x5 hf y37dc ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2dd">distutils.core </span><span class="ws146">import <span class="ff8 fc0 ws13b">setup, Extension</span></span></div><div class="t m0 x5 hf y37dd ff8 fs5 fc0 sc0 ls0 ws13a">setup(name<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">sample<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x50 hf y253e ff8 fs5 fc0 sc0 ls0 ws13a">py_modules<span class="fc6">=</span><span class="ls34">[<span class="ff9 fc9">&apos;</span></span><span class="fc9">sample.py<span class="ff9 ls34">&apos;</span></span>],</div><div class="t m0 x50 hf y37de ff8 fs5 fc0 sc0 ls0 ws13a">ext_modules<span class="fc6 ls34">=</span>[</div><div class="t m0 x16 hf y37df ff8 fs5 fc0 sc0 ls0 ws13a">Extension(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">_sample<span class="ff9 ls34">&apos;</span></span>,</div><div class="t m0 x34 hf y37e0 ff8 fs5 fc0 sc0 ls34">[<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">sample_wrap.c</span>&apos;</span><span class="ls0">],</span></div><div class="t m0 x34 hf y37e1 ff8 fs5 fc0 sc0 ls0 ws3c7">include_dirs <span class="fc6 ls32">=</span>[],</div><div class="t m0 x34 hf y37e2 ff8 fs5 fc0 sc0 ls0 ws147">define_macros <span class="fc6 ls33">=</span>[],</div><div class="t m0 x34 hf y37e3 ff8 fs5 fc0 sc0 ls0 ws3c7">undef_macros <span class="fc6 ls32">=</span>[],</div><div class="t m0 x34 hf y37e4 ff8 fs5 fc0 sc0 ls0 ws3c7">library_dirs <span class="fc6 ls32">=</span>[],</div><div class="t m0 x34 hf y37e5 ff8 fs5 fc0 sc0 ls0 ws16e">libraries <span class="fc6 ls33">=</span><span class="ls34">[</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">sample</span>&apos;</span>]</div><div class="t m0 x34 hf y37e6 ff8 fs5 fc0 sc0 ls0">)</div><div class="t m0 x16 hf y1020 ff8 fs5 fc0 sc0 ls0">]</div><div class="t m0 x5 hf y37e7 ff8 fs5 fc0 sc0 ls0">)</div><div class="t m0 x0 h7 y37e8 ff1 fs3 fc0 sc0 ls0 wsc">要编译和测试，在 <span class="ff4 ws1473">setup.p<span class="_ _1"></span>y <span class="ff1 ws63">上执行 </span><span class="wsa5">p<span class="_ _1"></span>ython3<span class="ff1">，如下：</span></span></span></div><div class="t m0 x5 hf y37e9 ff8 fs5 fc0 sc0 ls0 ws4">bash % python3 setup.py build_ext --inplace</div><div class="t m0 x5 hf y37ea ff8 fs5 fc0 sc0 ls0 ws4">running build_ext</div><div class="t m0 x5 hf y37eb ff8 fs5 fc0 sc0 ls0 ws16d">building <span class="ff9 ws13b">&apos;</span><span class="ws13a">_sample<span class="ff9 ls33">&apos;</span>extension</span></div><div class="t m0 x5 hf y37ec ff8 fs5 fc0 sc0 ls0 ws4">gcc -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes</div><div class="t m0 x5 hf y37ed ff8 fs5 fc0 sc0 ls0 ws4">-I/usr/local/include/python3.3m -c sample_wrap.c</div><div class="t m0 x4b hf y37ee ff8 fs5 fc0 sc0 ls0 ws13b">-o build/temp.macosx-10.6-x86_64-3.3/sample_wrap.o</div><div class="t m0 x5 hf y37ef ff8 fs5 fc0 sc0 ls0 ws4">sample_wrap.c: In function <span class="ffc fs6 ws3d4">‘</span><span class="ws13a">SWIG_InitializeModule<span class="ffc fs6 ws3d4">’</span>:</span></div><div class="t m0 x5 hf y37f0 ff8 fs5 fc0 sc0 ls0 ws4">sample_wrap.c:3589: warning: statement with no effect</div><div class="t m0 x5 hf y37f1 ff8 fs5 fc0 sc0 ls0 ws4">gcc -bundle -undefined dynamic_lookup build/temp.macosx-10.6-x86_64-3.3/sample.o</div><div class="t m0 x4b hf y37f2 ff8 fs5 fc0 sc0 ls0 ws4">build/temp.macosx-10.6-x86_64-3.3/sample_wrap.o -o _sample.so -lsample</div><div class="t m0 x5 hf y37f3 ff8 fs5 fc0 sc0 ls0 ws4">bash %</div><div class="t m0 x0 h7 y30c2 ff1 fs3 fc0 sc0 ls0 ws14">如果一切正常的话，你会发现你就可以很方便的使用生成的 <span class="ff4 ls8">C</span>扩展模块了。例如：</div><div class="t m0 x5 h10 y19dc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sample</span></span></div><div class="t m0 x5 hf y19dd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>gcd(<span class="fc7">42</span><span class="ls34">,<span class="fc7">8</span></span>)</span></div><div class="t m0 x5 hf y37f4 ff8 fs5 fc8 sc0 ls0">2</div><div class="t m0 x5 hf y19de ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>divide(<span class="fc7">42</span>,<span class="fc7 ls34">8</span>)</span></div><div class="t m0 x5 hf y19df ff8 fs5 fc8 sc0 ls0 ws4">[5, 2]</div><div class="t m0 x5 hf y19e0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">p1 <span class="fc6 ls33">=</span><span class="ws13a">sample<span class="fc6 ls34">.</span>Point(<span class="fc7 ls34">2</span>,<span class="fc7 ls34">3</span>)</span></span></div><div class="t m0 x5 hf y37f5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">p2 <span class="fc6 ls33">=</span><span class="ws13a">sample<span class="fc6 ls34">.</span>Point(<span class="fc7 ls34">4</span>,<span class="fc7 ls34">5</span>)</span></span></div><div class="t m0 x5 hf y19e1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>distance(p1,p2)</span></div><div class="t m0 x5 hf y19e2 ff8 fs5 fc8 sc0 ls0">2.8284271247461903</div><div class="t m0 x5 hf y19e3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">p1<span class="fc6 ls34">.</span>x</span></div><div class="t m0 x5 hf y37f6 ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf y37f7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">p1<span class="fc6 ls34">.</span>y</span></div><div class="t m0 x5 hf y37f8 ff8 fs5 fc8 sc0 ls0">3.0</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.9.<span class="_ _36"> </span>15.9 <span class="ff1 ls81">用</span><span class="ws146a">WSIG <span class="ff1 ws16b">包装 </span><span class="ls246">C</span><span class="ff1 ws146b">代码 </span>573</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
