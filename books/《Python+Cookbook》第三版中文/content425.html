<div id="pf1a9" class="pf w0 h0" data-page-no="1a9"><div class="pc pc1a9 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a9.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y765 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">Hello World<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y766 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y2856 ff1 fs3 fc0 sc0 ls19 wsf4c">一般来讲，你不应该将 <span class="ff4 ls0 wsf4d">XML-RPC <span class="ff1 wsf4e">服务以<span class="_ _6"></span>公共 </span><span class="wsf4f">API </span></span><span class="ws22a">的方式暴露出来。对于这种情</span></div><div class="t m0 x5 h9 y2857 ff1 fs3 fc0 sc0 ls0">况，通常分布式应用程序会是一个更好的选择。</div><div class="t m0 x0 h7 y2858 ff4 fs3 fc0 sc0 ls0 wsf50">XML-RPC <span class="ff1 ls1e ws111">的一个缺点是它的性能<span class="_ _1"></span>。<span class="ff6 ls0 wsf51">SimpleXMLRPCServer </span>的实现是单线程的，所<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y2859 ff1 fs3 fc0 sc0 ls0 wsf52">以<span class="_ _6"></span>它<span class="_ _0"></span>不<span class="_ _6"></span>适<span class="_ _6"></span>合<span class="_ _0"></span>于<span class="_ _6"></span>大<span class="_ _6"></span>型<span class="_ _0"></span>程<span class="_ _6"></span>序，<span class="_ _6"></span>尽<span class="_ _0"></span>管<span class="_ _6"></span>我<span class="_ _6"></span>们<span class="_ _0"></span>在 <span class="ff4 wsf53">11.2 </span><span class="ls16 wsf3">小节中演示过它是可以通过多线程来执行<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y2b3f ff1 fs3 fc0 sc0 ls0 wsf54">的。另<span class="_ _6"></span>外，<span class="_ _6"></span>由于 <span class="ff4 wsf55">XML-RPC </span><span class="ls22 wsf56">将所有数据都序列化为 </span><span class="ff4 wsf57">XML </span><span class="ls22 ws119">格式，所以它会比其他的方</span></div><div class="t m0 x5 h9 y2b40 ff1 fs3 fc0 sc0 ls13 wse5">式运行的慢一些<span class="_ _1"></span>。但是它也有优点，这种方式的编码可以被绝大部分其他编程语言支<span class="_ _c"></span></div><div class="t m0 x5 h9 y2b41 ff1 fs3 fc0 sc0 ls0">持。通过使用这种方式，其他语言的客户端程序都能访问你的服务。</div><div class="t m0 x0 h7 y2b42 ff1 fs3 fc0 sc0 ls0 ws601">虽<span class="_ _6"></span>然 <span class="ff4 wsf58">XML-RPC </span><span class="ls48 ws242">有很多缺点<span class="_ _1"></span>，但是如果你需要快速构建一个简单远程过程调用系</span></div><div class="t m0 x5 h9 y2b43 ff1 fs3 fc0 sc0 ls0">统的话，它仍然值得去学习的。有时候，简单的方案就已经足够了。</div><div class="t m0 x5 hd y2b44 ff2 fs4 fc4 sc0 ls0 ws211">13.7<span class="_ _e"> </span>11.7 <span class="ff1 ws165">在不同的 </span><span class="wsce8">Python <span class="ff1">解释器之间交互</span></span></div><div class="t m0 x5 he y2b45 ff2 fs2 fc4 sc0 ls0 ws212">13.7.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y2b46 ff1 fs3 fc0 sc0 ls18 wsf59">你在不同的机器上面运行着多个 <span class="ff4 ls0 ws453">Python </span><span class="ws110">解释器实例，并希望能够在这些解释器之<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y1637 ff1 fs3 fc0 sc0 ls0">间通过消息来交换数据。</div><div class="t m0 x5 he y2b47 ff2 fs2 fc4 sc0 ls0 ws212">13.7.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2b48 ff1 fs3 fc0 sc0 lsfa wsf5a">通过使用 <span class="ff6 ls0 wsf5b">multiprocessing.connection </span><span class="ws60c">模块可以很容易的实现解释器之间的通<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y2b49 ff1 fs3 fc0 sc0 ls0">信。下面是一个简单的应答服务器例子：</div><div class="t m0 x5 hf y2b4a ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wsf5c">multiprocessing.connection </span><span class="ws146">import <span class="ff8 fc0">Listener</span></span></div><div class="t m0 x5 h10 y872 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">traceback</span></div><div class="t m0 x5 hf y2b4b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">echo_client<span class="fc0">(conn):</span></span></div><div class="t m0 x15 hf y2b4c ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf y2b4d ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x17 hf y2b4e ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="ws13a">conn<span class="fc6 ls34">.</span>recv()</span></div><div class="t m0 x17 hf y2b4f ff8 fs5 fc0 sc0 ls0 ws13a">conn<span class="fc6">.</span>send(msg)</div><div class="t m0 x15 hf y2b50 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">EOFError<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2b51 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Connection closed</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y2b52 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">echo_server<span class="fc0 ws13b">(address, authkey):</span></span></div><div class="t m0 x15 hf y2b53 ff8 fs5 fc0 sc0 ls0 ws13c">serv <span class="fc6 ls32">=</span><span class="ws4">Listener(address, authkey<span class="fc6 ls34">=</span>authkey)</span></div><div class="t m0 x15 hf y2b54 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2b55 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y2b56 ff8 fs5 fc0 sc0 ls0 ws145">client <span class="fc6 ls32">=</span><span class="ws13a">serv<span class="fc6 ls34">.</span>accept()</span></div><div class="t m0 x17 hf y2b57 ff8 fs5 fc0 sc0 ls0">echo_client(client)</div><div class="t m0 x16 hf y2b58 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">Exception<span class="fc0">:</span></span></div><div class="t m0 x17 hf y2b59 ff8 fs5 fc0 sc0 ls0 ws13a">traceback<span class="fc6 ls34">.</span>print_exc()</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.7.<span class="_ _5"> </span>11.7 <span class="ff1 ws16b">在不同的 </span><span class="wscda">Python <span class="ff1 wsf5d">解释器之间交互 </span>416</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
