<div id="pf41" class="pf w0 h0" data-page-no="41"><div class="pc pc41 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg41.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">re<span class="fc6 ls34">.</span>sub(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">\s+<span class="ff9 ls34">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9 ws286">&apos; &apos;</span><span class="ws4">, s)</span></span></div><div class="t m0 x5 hf y1ac ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">hello world<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2f1 ff1 fs3 fc0 sc0 ls0 ws375">通<span class="_ _6"></span>常<span class="_ _6"></span>情<span class="_ _6"></span>况<span class="_ _6"></span>下<span class="_ _6"></span>你<span class="_ _6"></span>想<span class="_ _6"></span>将<span class="_ _6"></span>字符<span class="_ _6"></span>串 <span class="ff6 ws177">strip </span><span class="ls14 ws174">操作和<span class="_ _6"></span>其他迭代操作相结合<span class="_ _1"></span>，比如从文件中读取<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2f2 ff1 fs3 fc0 sc0 ls0">多行数据。如果是这样的话，那么生成器表达式就可以大显身手了。比如：</div><div class="t m0 x5 hf y70e ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0 ws2a3">(filename) </span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y70f ff8 fs5 fc0 sc0 ls0 ws15f">lines <span class="fc6 ls33">=</span><span class="ws13a">(line<span class="fc6 ls34">.</span><span class="ws155">strip() <span class="ff7 fca ws139">for </span><span class="ws161">line <span class="ff7 fca ws160">in </span>f)</span></span></span></div><div class="t m0 x15 hf y710 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">line </span><span class="ws160">in <span class="ff8 fc0">lines:</span></span></div><div class="t m0 x16 hf y5db ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(line)</span></div><div class="t m0 x0 h9 y711 ff1 fs3 fc0 sc0 ls0 ws376">在这里，表达式 <span class="ff6 ws377">lines = (line.strip() for line in f)<span class="_ _a"> </span></span><span class="wsa0">执行数据转换操作。这</span></div><div class="t m0 x5 h9 y712 ff1 fs3 fc0 sc0 ls13 wse5">种方式非常高效<span class="_ _1"></span>，因为它不需要预先读取所有数据放到一个临时的列表中去。它仅仅<span class="_ _c"></span></div><div class="t m0 x5 h7 y713 ff1 fs3 fc0 sc0 ls0 ws63">只是创建一个生成器，并且每次返回行之前会先执行 <span class="ff4 ws378">strip </span>操作。</div><div class="t m0 x0 h7 y714 ff1 fs3 fc0 sc0 ls0 ws379">对于<span class="_ _6"></span>更<span class="_ _6"></span>高阶<span class="_ _6"></span>的 <span class="ff4 wsa5">strip</span><span class="ls6b ws37a">，你可能需要使用 </span><span class="ff6 ws37b">translate() </span><span class="ls6b ws28f">方法。请参阅下一节了解更多<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y715 ff1 fs3 fc0 sc0 ls0">关于字符串清理的内容。</div><div class="t m0 x5 hd y716 ff2 fs4 fc4 sc0 ls0 ws211">4.12<span class="_ _e"> </span>2.12 <span class="ff1">审查清理文本字符串</span></div><div class="t m0 x5 he y717 ff2 fs2 fc4 sc0 ls0 ws212">4.12.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y718 ff1 fs3 fc0 sc0 ls68 ws23f">一些无聊的幼稚黑客在你的网站页面表单中输入文本<span class="ff4 ls0 wsa5">”p<span class="_ _1"></span>ýtĥöñ”<span class="ff1 ls68 ws23f">，然后你想将这些字</span></span></div><div class="t m0 x5 h9 y719 ff1 fs3 fc0 sc0 ls0">符清理掉。</div><div class="t m0 x5 he y71a ff2 fs2 fc4 sc0 ls0 ws212">4.12.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y71b ff1 fs3 fc0 sc0 ls3a ws153">文本清理问题会涉及到包括文本解析与数据处理等一系列问题。在非常简单的情形</div><div class="t m0 x5 h7 y71c ff1 fs3 fc0 sc0 ls0 ws37c">下，<span class="_ _c"></span>你可能会选择使用字符串函数 <span class="ff4 wsa5">(</span><span class="ws37d">比如 <span class="ff6 ws37e">str.upper() </span><span class="ls93">和</span><span class="ff6 ws37e">str.lower() <span class="ff4 ls94">)</span></span>将文本转为标</span></div><div class="t m0 x5 h9 y71d ff1 fs3 fc0 sc0 ls0 ws37f">准<span class="_ _6"></span>格式。<span class="_ _6"></span>使<span class="_ _6"></span>用 <span class="ff6 ws380">str.replace() </span><span class="ws381">或<span class="_ _6"></span>者 <span class="ff6 ws382">re.sub() </span><span class="ls1e ws111">的简单替换操作能删除或者改变指定的<span class="_ _1"></span></span></span></div><div class="t m0 x5 h7 y71e ff1 fs3 fc0 sc0 ls36 ws383">字符序列<span class="_ _c"></span>。<span class="_ _6"></span>你同样还可以使用 <span class="ff4 ls0 ws384">2.9 </span><span class="ws385">小节的 <span class="ff6 ls0 ws386">unicodedata.normalize() <span class="ff1 ws387">函<span class="_ _6"></span>数<span class="_ _6"></span>将 <span class="ff4 wsa5">unico<span class="_ _6"></span>de</span></span></span></span></div><div class="t m0 x5 h9 y71f ff1 fs3 fc0 sc0 ls0">文本标准化。</div><div class="t m0 x0 h9 y720 ff1 fs3 fc0 sc0 ls0 wsa0">然后，有时候你可能还<span class="_ _6"></span>想在清理操作上更进一步。<span class="_ _6"></span>比如，你可能想消除整个<span class="_ _6"></span>区间上</div><div class="t m0 x5 h9 y721 ff1 fs3 fc0 sc0 ls48 ws388">的字符或者去除变音符<span class="_ _1"></span>。为了这样做，你可以使用经常会被忽视的 <span class="ff6 ls0">str.translate()</span></div><div class="t m0 x5 h9 y722 ff1 fs3 fc0 sc0 ls0">方法。为了演示，假设你现在有下面这个凌乱的字符串：</div><div class="t m0 x5 hf y3ed ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">pýtĥöñ<span class="ff7 ws156">\f</span>is<span class="ff7 ws156">\t</span>awesome<span class="ff7 ws156">\r\n<span class="ff9">&apos;</span></span></span></span></span></span></div><div class="t m0 x5 hf y723 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">s</span></div><div class="t m0 x5 hf y724 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">pýtĥöñ\x0cis\tawesome\r\n<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y725 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y726 ff1 fs3 fc0 sc0 ls0 ws389">第 一 步 是 清 理 空 白 字 符。 为 了 这 样 做， 先 创 建 一 个 小 的 转 换 表 格 然 后 使 用</div><div class="t m0 x5 h9 y727 ff6 fs3 fc0 sc0 ls0 ws1e2">translate() <span class="ff1">方法：</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.12.<span class="_ _5"> </span>2.12 <span class="ff1 ws2ad">审查清理文本字符串 </span>56</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
