<div id="pf18f" class="pf w0 h0" data-page-no="18f"><div class="pc pc18f w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg18f.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">check_url<span class="fc0">(path):</span></span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws157">if <span class="ff8 fc0 ws13a">path<span class="fc6 ls34">.</span>startswith(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x5 hf y1ad ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="fca ws146">return <span class="ff8 fc0">Finder()</span></span></div><div class="t m0 x5 hf y1ae ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">else<span class="ff8 fc0">:</span></span></div><div class="t m0 x5 hf y1af ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="fca ws16a">raise <span class="ff8 ws13a">ImportError<span class="fc0">()</span></span></span></div><div class="t m0 x5 h10 y1b0 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6">.</span>append(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://localhost:15000<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y410 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path_hooks[<span class="fc7 ls34">0</span><span class="ls32">]<span class="fc6">=</span></span>check_url</span></div><div class="t m0 x5 h10 y411 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fib</span></span></div><div class="t m0 x5 hf yba ff8 fs5 fc8 sc0 ls0 ws4">Looking for fib # Finder output!</div><div class="t m0 x5 hf y8c6 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf ybed ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf ybee ff8 fs5 fc2 sc0 ls0 ws13a">ImportError<span class="fc0 ws4">: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h11 ybf0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Notice installation of Finder in sys.path_importer_cache</span></div><div class="t m0 x5 hf yd7d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path_importer_cache[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">http://localhost:15000<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf ybf1 ff8 fs5 fc8 sc0 ls0 ws4">&lt;__main__.Finder object at 0x10064c850&gt;</div><div class="t m0 x5 hf ybf2 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 yaa9 ff1 fs3 fc0 sc0 ls51 wsde9">这就是本节最后部分的关键点。事实上，一个用来在 <span class="ff4 ls0 wsdea">sys.path <span class="ff1 wsdeb">中查找 </span><span class="wsdec">URL </span></span><span class="ws1c8">的自定</span></div><div class="t m0 x5 h9 y28c7 ff1 fs3 fc0 sc0 ls17 wsded">义路径检查函数已经构建完毕。当它们被<span class="_ _1"></span>碰到的时候，一个新的 <span class="ff6 ls0 ws3a0">UrlPathFinder <span class="ff1 wsa0">实例</span></span></div><div class="t m0 x5 h7 y28c8 ff1 fs3 fc0 sc0 ls0 wsdee">被创<span class="_ _6"></span>建并<span class="_ _6"></span>被<span class="_ _6"></span>放入 <span class="ff6 ws5ed">sys.path importer cache<span class="ff4 ls1c7">.</span></span><span class="wsdef">之<span class="_ _6"></span>后，所<span class="_ _6"></span>有<span class="_ _6"></span>需要<span class="_ _6"></span>检查 <span class="ff6 ws223">sys.path </span><span class="wsa0">的<span class="_ _6"></span>导入<span class="_ _6"></span>语</span></span></div><div class="t m0 x5 h9 y28c9 ff1 fs3 fc0 sc0 ls0">句都会使用你的自定义查找器。</div><div class="t m0 x0 h9 y28ca ff1 fs3 fc0 sc0 ls0 wscd4">基于路径导入的包处理稍微有点复杂，<span class="_ _1"></span>并且跟 <span class="ff6 wsdf0">find<span class="_ _7"> </span>loader() </span><span class="wsa0">方法返回值有关。<span class="_ _c"></span>对</span></div><div class="t m0 x5 h7 y1d60 ff1 fs3 fc0 sc0 ls0 wsa0">于简单模块，<span class="_ _6"></span><span class="ff6 ws259">find<span class="_ _7"> </span>loader() </span><span class="wsdf1">返回一个元组 <span class="ff4 wsdf2">(loader, None)</span><span class="wsdf3">，其中<span class="_ _6"></span>的 <span class="ff4 wsdf4">loader </span><span class="ls82 ws2f9">是一个用于</span></span></span></div><div class="t m0 x5 h9 y27df ff1 fs3 fc0 sc0 ls0">导入模块的加载器实例。</div><div class="t m0 x0 h7 y1185 ff1 fs3 fc0 sc0 ls60 ws3eb">对于一个普通的包<span class="_ _c"></span>，<span class="ff6 ls0 ws3e1">find loader()<span class="_ _18"> </span></span><span class="wsdf5">返回一个元组 <span class="ff4 ls0 wsdf6">(loader, path)<span class="ff1 wsdf7">，<span class="_ _6"></span>其<span class="_ _0"></span>中<span class="_ _6"></span>的 </span>loader</span></span></div><div class="t m0 x5 h7 y28cb ff1 fs3 fc0 sc0 ls54 wsdf8">是一个用于导入包（<span class="_ _8"></span>并执行 <span class="ff4 ls0 wsdf9">init .py<span class="ff1 wsa0">）<span class="_ _0"></span>的<span class="_ _12"></span>加<span class="_ _0"></span>载<span class="_ _12"></span>器<span class="_ _12"></span>实<span class="_ _0"></span>例，<span class="_ _12"></span></span><span class="wsdfa">path </span></span><span class="ws1e6">是一个会初始化包的<span class="_ _8"></span></span></div><div class="t m0 x32 h7 y28cc ff6 fs3 fc0 sc0 ls0 wsdfb">path <span class="ff1 wsdfc">属<span class="_ _6"></span>性<span class="_ _0"></span>的<span class="_ _6"></span>目<span class="_ _6"></span>录<span class="_ _0"></span>列<span class="_ _6"></span>表。<span class="_ _0"></span>例<span class="_ _6"></span>如，<span class="_ _6"></span>如<span class="_ _0"></span>果<span class="_ _6"></span>基<span class="_ _6"></span>础 <span class="ff4 wsdfd">URL </span><span class="lsb2">是</span><span class="ff4 fc3 wsdfe">http://<span class="_ _6"></span>lo<span class="_ _6"></span>calhost:<span class="_ _6"></span>15000 </span><span class="wsa0">并<span class="_ _0"></span>且<span class="_ _6"></span>一<span class="_ _6"></span>个</span></span></div><div class="t m0 x5 h7 y28cd ff1 fs3 fc0 sc0 ls0 wsdff">用<span class="_ _6"></span>户<span class="_ _6"></span>执<span class="_ _6"></span>行 <span class="ff6 wse00">import<span class="_ _1c"> </span>grok <span class="ff4 lse9">,</span></span><span class="ws172">那<span class="_ _6"></span>么 <span class="ff6 ws3e1">find loader() </span><span class="wse01">返<span class="_ _6"></span>回<span class="_ _6"></span>的 <span class="ff4 wse02">path </span><span class="wse03">就<span class="_ _6"></span>会<span class="_ _6"></span>是 <span class="ff4 wse04">[ ‘<span class="fc3 wsa5">h<span class="_ _1"></span>ttp://<span class="_ _6"></span>lo<span class="_ _6"></span>calhost:</span></span></span></span></span></div><div class="t m0 x5 h7 y5e8 ff4 fs3 fc3 sc0 ls0 wsa5">15000/grok<span class="fc0 ws9c">‘ ]</span></div><div class="t m0 x0 h9 y1c0 ff6 fs3 fc0 sc0 ls0 ws3e1">find loader()<span class="_ _1e"> </span><span class="ff1 ls67 ws234">还要能处理一个命名空间包<span class="_ _8"></span>。一个命名空间包中有一个合法的<span class="_ _d"></span></span></div><div class="t m0 x5 h7 y28ce ff1 fs3 fc0 sc0 ls1c8 wse05">包目录名<span class="_ _19"></span>，但是不存在 <span class="ff4 ls0 wse06">init<span class="_ _e"> </span>.py <span class="ff1 wsa0">文<span class="_ _12"></span>件。<span class="_ _12"></span>这<span class="_ _24"></span>样<span class="_ _12"></span>的<span class="_ _12"></span>话，<span class="_ _24"></span><span class="ff6 ws3e1">find loader()<span class="_ _26"> </span></span></span></span><span class="wse07">必须返回一个<span class="_ _8"></span></span></div><div class="t m0 x5 h7 y28cf ff1 fs3 fc0 sc0 ls0 wse08">元<span class="_ _0"></span>组 <span class="ff4 wse09">(None, path)</span><span class="ls1c9">，</span><span class="ff4 wse0a">path </span><span class="ls10c wse0b">是一个目录列表<span class="_ _d"></span>，由它来构建包的定义有 <span class="ff4 ls0 wse0c">init<span class="_ _e"> </span>.py <span class="ff1 wsa0">文<span class="_ _0"></span>件</span></span></span></div><div class="t m0 x5 h7 y28d0 ff1 fs3 fc0 sc0 ls1ac">的<span class="ff4 ls0 wsd41">path </span><span class="ls0 wse0d">属性。对于<span class="_ _6"></span>这种情况，<span class="_ _6"></span>导入机制<span class="_ _6"></span>会继续前<span class="_ _6"></span>行去检查 <span class="ff4 wsdea">sys.path </span><span class="wsa0">中的<span class="_ _6"></span>目录。如果</span></span></div><div class="t m0 x5 h9 y28d1 ff1 fs3 fc0 sc0 ls13 wse5">找到了命名空间包<span class="_ _1"></span>，所有的结果路径被加到一起来构建最终的命名空间包。关于命名<span class="_ _c"></span></div><div class="t m0 x5 h7 y1c6e ff1 fs3 fc0 sc0 ls0 ws38">空间包的更多信息请参考 <span class="ff4 wsca">10.5 </span>小节。</div><div class="t m0 x0 h7 y1f7e ff1 fs3 fc0 sc0 ls0 wsd32">所有的包都包含了一个内部路径设置，可以在 <span class="ff4 wse0e">path </span>属性中看到，例如：</div><div class="t m0 x5 h10 y28d2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">xml.etree.ElementTree</span></span></div><div class="t m0 x5 hf y28d3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">xml<span class="fc6 ls34">.</span>__path__</span></div><div class="t m0 x5 hf y28d4 ff8 fs5 fc8 sc0 ls34">[<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">/usr/local/lib/python3.3/xml</span><span class="ff9">&apos;</span><span class="ls0">]</span></div><div class="t m0 x5 hf y28d5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">xml<span class="fc6 ls34">.</span>etree<span class="fc6 ls34">.</span>__path__</span></div><div class="t m0 x5 hf y28d6 ff8 fs5 fc8 sc0 ls34">[<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">/usr/local/lib/python3.3/xml/etree</span><span class="ff9">&apos;</span><span class="ls0">]</span></div><div class="t m0 x5 hf y28d7 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 yadc ff1 fs3 fc0 sc0 ls0 wse0f">之 前 提 到，<span class="_ _5"> </span><span class="ff4 wsd41">path </span><span class="ls1ca wse10">的设置是通过 </span><span class="ff6 ws3e1">find loader()<span class="_ _1c"> </span></span><span class="ws389">方 法 返 回 值 控 制 的。 不 过，</span></div><div class="t m0 x32 h7 y552 ff4 fs3 fc0 sc0 ls0 wsd41">path <span class="ff1 ls10c wse11">接下来也被 </span><span class="wse12">sys.path ho<span class="_ _6"></span>oks<span class="_ _1e"> </span><span class="ff1 wsa0">中<span class="_ _0"></span>的<span class="_ _12"></span>函<span class="_ _0"></span>数<span class="_ _12"></span>处<span class="_ _0"></span>理。<span class="_ _12"></span>因<span class="_ _0"></span>此，<span class="_ _12"></span>但<span class="_ _12"></span>包<span class="_ _0"></span>的<span class="_ _12"></span>子<span class="_ _0"></span>组<span class="_ _12"></span>件<span class="_ _0"></span>被<span class="_ _12"></span>加<span class="_ _0"></span>载<span class="_ _12"></span>后，</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>390</div><a class="l" href="http://localhost:15000"><div class="d m1" style="border-style:none;position:absolute;left:530.791500px;bottom:524.634000px;width:115.417000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://localhost:15000/grok"><div class="d m1" style="border-style:none;position:absolute;left:656.583000px;bottom:502.965000px;width:85.554000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://localhost:15000/grok"><div class="d m1" style="border-style:none;position:absolute;left:108.000000px;bottom:481.296000px;width:57.600000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
