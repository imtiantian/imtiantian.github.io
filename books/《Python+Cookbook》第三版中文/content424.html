<div id="pf1a8" class="pf w0 h0" data-page-no="1a8"><div class="pc pc1a8 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a8.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">set(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">bar</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">set(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">spam</span>&apos;</span><span class="ls0 ws13b">, [</span><span class="fc7">1</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls32">,</span><span class="fc7">3</span><span class="ls0">])</span></span></div><div class="t m0 x5 hf y1ad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">keys()</span></span></span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc8 sc0 ls34">[<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">spam</span><span class="ff9">&apos;</span><span class="ls33">,<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">foo</span></span><span class="ff9">&apos;</span><span class="ls0">]</span></div><div class="t m0 x5 hf y1af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">get(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1b0 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">bar<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">get(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">spam</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y410 ff8 fs5 fc8 sc0 ls0 ws4">[1, 2, 3]</div><div class="t m0 x5 hf y411 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">delete(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">spam</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf yba ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">exists(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">spam</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y8c6 ff8 fs5 fc8 sc0 ls0">False</div><div class="t m0 x5 hf ybed ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y2b24 ff2 fs2 fc4 sc0 ls0 ws212">13.6.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y2b25 ff4 fs3 fc0 sc0 ls0 wsf47">XML-RPC <span class="ff1 ls35 ws144">可以让我们很容易的构造一个简单的远程调用服务。你所需要做的仅仅</span></div><div class="t m0 x5 h9 y1bfd ff1 fs3 fc0 sc0 ls22 wsf48">是创建一个服务器实例<span class="_ _1"></span>，通过它的方法 <span class="ff6 ls0 ws76f">register function() <span class="ff1 wsa0">来<span class="_ _6"></span>注册<span class="_ _6"></span>函<span class="_ _6"></span>数，然<span class="_ _6"></span>后<span class="_ _6"></span>使用</span></span></div><div class="t m0 x5 h9 y2b26 ff1 fs3 fc0 sc0 ls0 ws216">方法 <span class="ff6 wsf49">serve<span class="_ _7"> </span>forever() </span><span class="wsa0">启<span class="_ _6"></span>动它。<span class="_ _6"></span>在<span class="_ _6"></span>上<span class="_ _6"></span>面我<span class="_ _6"></span>们<span class="_ _6"></span>将这<span class="_ _6"></span>些<span class="_ _6"></span>步骤<span class="_ _6"></span>放<span class="_ _6"></span>在一<span class="_ _6"></span>起<span class="_ _6"></span>写到<span class="_ _6"></span>一<span class="_ _6"></span>个类<span class="_ _6"></span>中，<span class="_ _6"></span>不<span class="_ _6"></span>够</span></div><div class="t m0 x5 h9 y2b27 ff1 fs3 fc0 sc0 ls0">这并不是必须的。比如你还可以像下面这样创建一个服务器：</div><div class="t m0 x5 hf y2b28 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wsb44">xmlrpc.server </span><span class="ws146">import <span class="ff8 fc0">SimpleXMLRPCServer</span></span></div><div class="t m0 x5 hf y2b29 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0">(x,y):</span></span></div><div class="t m0 x15 hf y2b2a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls34">x<span class="fc6 ls0 ws13a">+<span class="fc0">y</span></span></span></div><div class="t m0 x5 hf y2b2b ff8 fs5 fc0 sc0 ls0 ws13c">serv <span class="fc6 ls32">=</span><span class="ws13a">SimpleXMLRPCServer((<span class="ff9 fc9 ws13b">&apos;&apos;</span><span class="ls33">,</span><span class="fc7">15000</span>))</span></div><div class="t m0 x5 hf y2b2c ff8 fs5 fc0 sc0 ls0 ws13a">serv<span class="fc6 ls34">.</span>register_function(add)</div><div class="t m0 x5 hf y2b2d ff8 fs5 fc0 sc0 ls0 ws13a">serv<span class="fc6 ls34">.</span>serve_forever()</div><div class="t m0 x0 h7 y2b2e ff4 fs3 fc0 sc0 ls0 wsf47">XML-RPC <span class="ff1 ls35 ws144">暴露出来的函数只能适用于部分数据类型，比如字符串、整形、列表和</span></div><div class="t m0 x5 h7 y2b2f ff1 fs3 fc0 sc0 ls17 wsf4a">字典。对于其他类型就得需要做些额外的功课了<span class="_ _1"></span>。例如，如果你想通过 <span class="ff4 ls0 wsf4b">XML-RPC <span class="ff1">传</span></span></div><div class="t m0 x5 h9 y2b30 ff1 fs3 fc0 sc0 ls0">递一个对象实例，实际上只有他的实例字典被处理：</div><div class="t m0 x5 hf y2b31 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">:</span></span></span></div><div class="t m0 x5 hf y2b32 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></span></div><div class="t m0 x5 hf y2b33 ff7 fs5 fc5 sc0 ls0 ws8e2">... <span class="ff8 fca ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></span></div><div class="t m0 x5 hf y2b34 ff7 fs5 fc5 sc0 ls0 ws8e2">... <span class="ff8 fca ws13a">self<span class="fc6">.<span class="fc0 ls33">y</span><span class="ls32">=</span><span class="fc0">y</span></span></span></div><div class="t m0 x5 h10 y2b35 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y2b36 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">Point(<span class="fc7 ls34">2</span></span>,<span class="fc7 ls34">3</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y2b37 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">set(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls0 ws13b">, p)</span></span></div><div class="t m0 x5 hf y2b38 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">get(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y2b39 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span>x<span class="ff9">&apos;</span><span class="ls0 ws13b">: 2, <span class="ff9">&apos;</span></span>y<span class="ff9">&apos;</span><span class="ls0 ws13b">: 3}</span></div><div class="t m0 x5 hf y2b3a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1813 ff1 fs3 fc0 sc0 ls0">类似的，对于二进制数据的处理也跟你想象的不太一样：</div><div class="t m0 x5 hf y2b3b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">set(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls0 ws13b">, b</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Hello World</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y2b3c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">get(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">foo</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y2b3d ff8 fs5 fc8 sc0 ls0 ws4">&lt;xmlrpc.client.Binary object at 0x10131d410&gt;</div><div class="t m0 x5 hf y2b3e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0">data</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.6.<span class="_ _5"> </span>11.6 <span class="ff1 ws16b">通过 </span><span class="wsf45">XML-RPC <span class="ff1 wsf46">实现简单的远程调用 </span>415</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
