<div id="pf149" class="pf w0 h0" data-page-no="149"><div class="pc pc149 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg149.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></div><div class="t m0 x15 hf y1ac ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></div><div class="t m0 x0 h9 y19a8 ff1 fs3 fc0 sc0 ls3d wsc07">这个方式跟之前的效果几乎一样，除了对于 <span class="ff6 ls0 ws20b">ncalls </span><span class="ws164">的访问现在是通过一个被绑定</span></div><div class="t m0 x5 h9 y2274 ff1 fs3 fc0 sc0 ls0">为属性的函数来实现，例如：</div><div class="t m0 x5 hf y2275 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y2276 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y2277 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">4</span><span class="ls32">,<span class="fc7 ls34">5</span></span>)</span></div><div class="t m0 x5 hf y2278 ff8 fs5 fc8 sc0 ls0">9</div><div class="t m0 x5 hf y2279 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add<span class="fc6 ls34">.</span>ncalls()</span></div><div class="t m0 x5 hf y227a ff8 fs5 fc8 sc0 ls0">2</div><div class="t m0 x5 hf y227b ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hd y227c ff2 fs4 fc4 sc0 ls0 ws211">11.10<span class="_ _e"> </span>9.10 <span class="ff1">为类和静态方法提供装饰器</span></div><div class="t m0 x5 he y227d ff2 fs2 fc4 sc0 ls0 wsadf">11.10.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y227e ff1 fs3 fc0 sc0 ls0">你想给类或静态方法提供装饰器。</div><div class="t m0 x5 he y227f ff2 fs2 fc4 sc0 ls0 wsadf">11.10.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2280 ff1 fs3 fc0 sc0 ls60 wsc08">给类或静态方法提供装饰器是很简单的<span class="_ _c"></span>，不过要确保装饰器在 <span class="ff6 ls0 wsc09">@classmethod <span class="ff1">或</span></span></div><div class="t m0 x5 h9 y2281 ff6 fs3 fc0 sc0 ls0 ws317">@staticmethod <span class="ff1">之前。例如：</span></div><div class="t m0 x5 h10 y2282 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y2283 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 h11 y2284 ffa fs5 fcd sc0 ls0 ws4"># A simple decorator</div><div class="t m0 x5 hf y2285 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">timethis<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y2286 ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y2287 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y2288 ff8 fs5 fc0 sc0 ls0 ws15f">start <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6">.</span>time()</span></div><div class="t m0 x16 hf y2289 ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x16 hf y228a ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>time()</span></div><div class="t m0 x16 hf y228b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(end<span class="fc6 ls34">-</span>start)</span></div><div class="t m0 x16 hf y228c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">r</span></div><div class="t m0 x15 hf y228d ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x5 h11 y228e ffa fs5 fcd sc0 ls0 ws4"># Class illustrating application of the decorator to different kinds of methods</div><div class="t m0 x5 hf y228f ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h10 y2290 ff7 fs5 fc12 sc0 ls0">@timethis</div><div class="t m0 x15 hf y2291 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">instance_method<span class="fc0">(<span class="fca">self</span><span class="ws4">, n):</span></span></span></div><div class="t m0 x16 hf y2292 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(</span><span class="ff8 ws13a">self<span class="fc0 ws4">, n)</span></span></div><div class="t m0 x16 hf y70b ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></div><div class="t m0 x17 hf y70c ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.10.<span class="_ _5"> </span>9.10 <span class="ff1 wsc0a">为类和静态方法提供装饰器 </span>320</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
