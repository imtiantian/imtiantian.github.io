<div id="pf153" class="pf w0 h0" data-page-no="153"><div class="pc pc153 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg153.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">String<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y1ac ff8 fs5 fc0 sc0 ls0 ws169">_expected_type <span class="fc6 ls32">=</span><span class="fca">str</span></div><div class="t m0 x5 h11 y1ae ffa fs5 fcd sc0 ls0 ws4"># Metaclass that uses an OrderedDict for class body</div><div class="t m0 x5 hf y1af ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">OrderedMeta<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y1b0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__new__<span class="fc0 ws4">(cls, clsname, bases, clsdict):</span></span></div><div class="t m0 x16 hf y355 ff8 fs5 fc0 sc0 ls32">d<span class="fc6 ls33">=<span class="fca ls0 ws13a">dict<span class="fc0">(clsdict)</span></span></span></div><div class="t m0 x16 hf y410 ff8 fs5 fc0 sc0 ls0 ws15f">order <span class="fc6 ls33">=</span>[]</div><div class="t m0 x16 hf y411 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, value </span><span class="ws160">in <span class="ff8 fc0 ws13a">clsdict<span class="fc6">.</span>items():</span></span></div><div class="t m0 x17 hf yba ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">isinstance<span class="fc0 ws4">(value, Typed):</span></span></div><div class="t m0 x18 hf y8c6 ff8 fs5 fc0 sc0 ls0 ws13a">value<span class="fc6 ls34">.</span><span class="ws15f">_name <span class="fc6 ls33">=</span>name</span></div><div class="t m0 x18 hf ybed ff8 fs5 fc0 sc0 ls0 ws13a">order<span class="fc6 ls34">.</span>append(name)</div><div class="t m0 x16 hf ybee ff8 fs5 fc0 sc0 ls0 ws13a">d[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">_order<span class="ff9 ls34">&apos;</span></span><span class="ls33">]<span class="fc6 ls32">=</span></span>order</div><div class="t m0 x16 hf ybef ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">type<span class="fc6 ls34">.</span><span class="fc0 ws4">__new__(cls, clsname, bases, d)</span></span></div><div class="t m0 x15 h10 yd7d ff7 fs5 fc12 sc0 ls0">@classmethod</div><div class="t m0 x15 hf ybf1 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__prepare__<span class="fc0 ws13b">(cls, clsname, bases):</span></span></div><div class="t m0 x16 hf ybf2 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">OrderedDict()</span></div><div class="t m0 x0 h9 y1701 ff1 fs3 fc0 sc0 ls24 wsc1d">在这个元类中<span class="_ _c"></span>，执行类主体时描述器的定义顺序会被一个 <span class="ff6 ls0 ws303">OrderedDict``<span class="ffc fs7 wsc1e">捕<span class="_ _6"></span>获<span class="_ _0"></span>到，</span></span></div><div class="t m0 x5 h9 y2388 ffc fs7 fc0 sc0 ls195 wsc1f">生成的有序名称从字典中提取出来并放入类属性 <span class="ff6 fs3 ls0 wsc20">``<span class="_ _7"> </span>order <span class="ff1 ls1f ws113">中。这样的话类中的方法可以通</span></span></div><div class="t m0 x5 h9 y2389 ff1 fs3 fc0 sc0 ls1e ws111">过多种方式来使用它<span class="_ _1"></span>。例如，下面是<span class="_ _1"></span>一个简单的类，使用这个排序字典来实现将<span class="_ _1"></span>一个</div><div class="t m0 x5 h7 y238a ff1 fs3 fc0 sc0 ls0 ws14">类实例的数据序列化为一行 <span class="ff4 ws5d">CSV </span>数据：</div><div class="t m0 x5 hf y238b ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Structure<span class="ff8 fc0 ws13a">(metaclass<span class="fc6 ls34">=</span>OrderedMeta):</span></span></div><div class="t m0 x15 hf y238c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">as_csv<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y238d ff7 fs5 fca sc0 ls0 ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">,</span>&apos;<span class="ff8 fc6">.<span class="fc0 ls0 ws13a">join(<span class="fca">str</span>(<span class="fca">getattr</span><span class="ls34">(</span><span class="fca">self</span><span class="ws155">,name)) </span></span></span></span><span class="ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">_order)</span></span></span></span></span></div><div class="t m0 x5 h11 y238e ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y238f ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y2390 ff8 fs5 fc0 sc0 ls0 ws13c">name <span class="fc6 ls32">=</span>String()</div><div class="t m0 x15 hf y2391 ff8 fs5 fc0 sc0 ls0 ws145">shares <span class="fc6 ls32">=</span>Integer()</div><div class="t m0 x15 hf y2392 ff8 fs5 fc0 sc0 ls0 ws15f">price <span class="fc6 ls33">=</span>Float()</div><div class="t m0 x15 hf y2393 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, shares, price):</span></span></span></div><div class="t m0 x16 hf y2394 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y2395 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">shares </span><span class="ls32">=</span><span class="fc0">shares</span></span></div><div class="t m0 x16 hf y2396 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">price </span><span class="ls32">=</span><span class="fc0">price</span></span></div><div class="t m0 x0 h7 y2397 ff1 fs3 fc0 sc0 ls0 ws38">我们在交互式环境中测试一下这个 <span class="ff4 wsc21">Sto<span class="_ _6"></span>c<span class="_ _1"></span>k <span class="ff1">类：</span></span></div><div class="t m0 x5 hf y2398 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">GOOG<span class="ff9 ls34">&apos;</span></span>,<span class="fc7">100</span><span class="ls34">,</span><span class="fc7">490.1</span>)</span></span></div><div class="t m0 x5 hf y2399 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y239a ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">GOOG<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y239b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">as_csv()</span></span></span></div><div class="t m0 x5 hf y239c ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">GOOG,100,490.1<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y239d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">AAPL<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">a lot<span class="ff9">&apos;</span></span><span class="ls33">,</span><span class="fc7">610.23</span>)</span></span></div><div class="t m0 x5 hf y239e ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y239f ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y23a0 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;dupmethod.py&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">34</span><span class="ls33">,</span><span class="ff7 fca ws157">in </span>__init__</span></div><div class="t m0 x5 hf y23a1 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: shares expects &lt;class <span class="ff9 ls34">&apos;</span><span class="ws13a">int<span class="ff9 ls34">&apos;</span>&gt;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.14.<span class="_ _5"> </span>9.14 <span class="ff1 wsaf4">捕获类的属性定义顺序 </span>330</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
