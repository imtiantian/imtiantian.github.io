<div id="pf4d" class="pf w0 h0" data-page-no="4d"><div class="pc pc4d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg4d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">4.18.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y236 ff1 fs3 fc0 sc0 ls0">假如你有下面这样一个文本字符串：</div><div class="t m0 x5 hf y87d ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">foo = 23 + 42 * 10<span class="ff9">&apos;</span></span></div><div class="t m0 x0 h9 y87e ff1 fs3 fc0 sc0 ls0 wsa0">为了令牌化字符串，你<span class="_ _6"></span>不仅需要匹配模式，还得<span class="_ _6"></span>指定模式的类型。比如，你<span class="_ _6"></span>可能想</div><div class="t m0 x5 h9 y87f ff1 fs3 fc0 sc0 ls0">将字符串像下面这样转换为序列对：</div><div class="t m0 x5 hf y880 ff8 fs5 fc0 sc0 ls0 ws145">tokens <span class="fc6 ls33">=</span><span class="ws13a">[(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">NAME<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">foo<span class="ff9 ws13b">&apos;</span></span><span class="ws4">), (<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">EQ<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">=<span class="ff9 ls34">&apos;</span></span><span class="ws4">), (<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">NUM<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">23<span class="ff9 ls34">&apos;</span></span><span class="ws4">), (<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">PLUS<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;<span class="ff8">+</span><span class="ls0 ws13b">&apos;</span></span></span>),</span></div><div class="t m0 x15 hf y881 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">NUM</span>&apos;</span><span class="ls33">,<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">42</span><span class="ls34">&apos;</span></span><span class="ls0 ws13b">), (<span class="ff9 fc9">&apos;<span class="ff8 ws13a">TIMES</span><span class="ls34">&apos;</span></span><span class="ls32">,</span></span></span><span class="ff9 fc9">&apos;<span class="ff8">*</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0 ws4">), (</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">NUM</span>&apos;</span><span class="ls32">,<span class="fc7 ls0 ws13a">10<span class="ff9 fc9 ws13b">&apos;<span class="ff8">)]</span></span></span></span></div><div class="t m0 x0 h9 y882 ff1 fs3 fc0 sc0 ls3a ws153">为了执行这样的切分，第一步就是像下面这样利用命名捕获组的正则表达式来定义</div><div class="t m0 x5 h9 y883 ff1 fs3 fc0 sc0 ls0">所有可能的令牌，包括空格：</div><div class="t m0 x5 h10 y884 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">re</span></div><div class="t m0 x5 hf y885 ff8 fs5 fc0 sc0 ls0 ws13c">NAME <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">(?P&lt;NAME&gt;[a-zA-Z_][a-zA-Z_0-9]*)<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y886 ff8 fs5 fc0 sc0 ls0 ws158">NUM <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">(?P&lt;NUM&gt;\d+)<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y887 ff8 fs5 fc0 sc0 ls0 ws13c">PLUS <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">(?P&lt;PLUS&gt;\+)<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y70 ff8 fs5 fc0 sc0 ls0 ws15f">TIMES <span class="fc6 ls33">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;<span class="ff8 ws13a">(?P&lt;TIMES&gt;\*)</span>&apos;</span></span></span></div><div class="t m0 x5 hf y888 ff8 fs5 fc0 sc0 ls0 ws159">EQ <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;EQ&gt;=)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y889 ff8 fs5 fc0 sc0 ls0 ws159">WS <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;WS&gt;\s+)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y88a ff8 fs5 fc0 sc0 ls0 ws2a3">master_pat <span class="fc6 ls32">=</span><span class="ws13a">re<span class="fc6 ls34">.</span>compile(<span class="ff9 fc9 ls34">&apos;<span class="ffd ls0 ws13b">|</span>&apos;<span class="ff8 fc6">.</span></span><span class="ws4">join([NAME, NUM, PLUS, TIMES, EQ, WS]))</span></span></div><div class="t m0 x0 h9 y88b ff1 fs3 fc0 sc0 ls0 wsc">在上面的模式中， <span class="ff6 ws303">?P<span class="ff10 ws305">&lt;</span>TOKENNAME<span class="ff10 lsb3">&gt;</span></span>用于给一个模式命名，供后面使用。</div><div class="t m0 x0 h9 y88c ff1 fs3 fc0 sc0 ls6f ws417">下一步<span class="_ _1"></span>，为了令牌化<span class="_ _1"></span>，使用模式对象很少被人知道的 <span class="ff6 ls0 ws418">scanner() </span><span class="ws2a7">方法<span class="_ _1"></span>。这个方法<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y88d ff1 fs3 fc0 sc0 ls2b ws419">会创建一个 <span class="ff6 ls0 ws41a">scanner </span><span class="ws41b">对象，在这个对象上不断的调用 <span class="ff6 ls0 ws41c">match() </span><span class="ws12e">方法会一步步的扫描目</span></span></div><div class="t m0 x5 h9 y88e ff1 fs3 fc0 sc0 ls0 ws14">标文本，每步一个匹配。下面是演示一个 <span class="ff6 ws23a">scanner </span>对象如何工作的交互式例子：</div><div class="t m0 x5 hf y88f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws155">scanner <span class="fc6 ls32">=</span><span class="ws13a">master_pat<span class="fc6 ls34">.</span>scanner(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">foo = 42<span class="ff9">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y890 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y891 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_sre.SRE_Match object at 0x100677738&gt;</div><div class="t m0 x5 hf y892 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0 ws4">lastgroup, _</span><span class="ls34">.</span><span class="fc0">group()</span></span></span></div><div class="t m0 x5 hf y893 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">NAME</span><span class="ff9">&apos;</span><span class="ls33">,<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">foo</span></span><span class="ff9">&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y894 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y895 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_sre.SRE_Match object at 0x100677738&gt;</div><div class="t m0 x5 hf y896 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0 ws4">lastgroup, _</span><span class="ls34">.</span><span class="fc0">group()</span></span></span></div><div class="t m0 x5 hf y897 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">WS</span><span class="ff9">&apos;</span><span class="ls32">,<span class="ff9 ls0 ws41d">&apos; &apos;<span class="ff8">)</span></span></span></div><div class="t m0 x5 hf y898 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y899 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_sre.SRE_Match object at 0x100677738&gt;</div><div class="t m0 x5 hf y89a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0 ws4">lastgroup, _</span><span class="ls34">.</span><span class="fc0">group()</span></span></span></div><div class="t m0 x5 hf y89b ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">EQ</span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span>=<span class="ff9 ls0 ws13b">&apos;<span class="ff8">)</span></span></div><div class="t m0 x5 hf y89c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y89d ff8 fs5 fc8 sc0 ls0 ws4">&lt;_sre.SRE_Match object at 0x100677738&gt;</div><div class="t m0 x5 hf y89e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0 ws4">lastgroup, _</span><span class="ls34">.</span><span class="fc0">group()</span></span></span></div><div class="t m0 x5 hf y89f ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">WS</span><span class="ff9">&apos;</span><span class="ls32">,<span class="ff9 ls0 ws41d">&apos; &apos;<span class="ff8">)</span></span></span></div><div class="t m0 x5 hf y8a0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y8a1 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_sre.SRE_Match object at 0x100677738&gt;</div><div class="t m0 x5 hf y8a2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">_<span class="fc6 ls0 ws13a">.<span class="fc0 ws4">lastgroup, _</span><span class="ls34">.</span><span class="fc0">group()</span></span></span></div><div class="t m0 x5 hf y8a3 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">NUM<span class="ff9 ws13b">&apos;</span><span class="ls33">,</span></span><span class="ff9">&apos;</span><span class="ls0 ws13a">42</span><span class="ff9">&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.18.<span class="_ _5"> </span>2.18 <span class="ff1 ws3ba">字符串令牌解析 </span>68</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
