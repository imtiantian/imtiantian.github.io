<div id="pf15b" class="pf w0 h0" data-page-no="15b"><div class="pc pc15b w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg15b.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls3a ws153">作为一个具体的应用例子，下面定义了一个元类，它会拒绝任何有混合大小写名字</div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 ws38">作为方法的类定义（可能是想气死 <span class="ff4 wsc50">Ja<span class="_ _1"></span>v<span class="_ _c"></span>a <span class="ff1 wsa0">程序员<span class="fff ws8fd">ˆ ˆ</span>）<span class="_ _f"></span>：</span></span></div><div class="t m0 x5 hf y2455 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">NoMixedCaseMeta<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y2456 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__new__<span class="fc0 ws4">(cls, clsname, bases, clsdict):</span></span></div><div class="t m0 x16 hf y2457 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 fc0">clsdict:</span></span></div><div class="t m0 x17 hf y2458 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">name<span class="fc6 ls34">.</span><span class="ws1f4">lower() <span class="fc6 ws15c">!= </span>name:</span></span></div><div class="t m0 x18 hf y2459 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Bad attribute name: <span class="ff9 ls32">&apos;<span class="ff8 fc6">+</span></span></span>name)</span></span></div><div class="t m0 x16 hf y245a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws4">__new__(cls, clsname, bases, clsdict)</span></span></span></div><div class="t m0 x5 hf y245b ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Root<span class="ff8 fc0 ws13a">(metaclass<span class="fc6">=</span>NoMixedCaseMeta):</span></span></div><div class="t m0 x15 h10 y245c ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y245d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">(Root):</span></div><div class="t m0 x15 hf y245e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">foo_bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws159">): <span class="ffa fcd ws13b"># Ok</span></span></span></span></div><div class="t m0 x16 h10 y245f ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y2460 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">B</span><span class="ff8 fc0">(Root):</span></div><div class="t m0 x15 hf y2461 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">fooBar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws159">): <span class="ffa fcd ws13b"># TypeError</span></span></span></span></div><div class="t m0 x16 h10 y2462 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y2fc ff1 fs3 fc0 sc0 ls0 wsa0">作为更高级和实用的<span class="_ _6"></span>例子，下面有一个元类，它用<span class="_ _6"></span>来检测重载方法，确保它<span class="_ _6"></span>的调用</div><div class="t m0 x5 h9 y2fd ff1 fs3 fc0 sc0 ls0">参数跟父类中原始方法有着相同的参数签名。</div><div class="t m0 x5 hf yc35 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2f0">inspect </span><span class="ws1ff">import <span class="ff8 fc0">signature</span></span></div><div class="t m0 x5 h10 y2463 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">logging</span></div><div class="t m0 x5 hf y2464 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">MatchSignaturesMeta<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y2465 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, clsname, bases, clsdict):</span></span></span></div><div class="t m0 x16 hf y2466 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__init__(clsname, bases, clsdict)</span></span></div><div class="t m0 x16 hf y2467 ff8 fs5 fc0 sc0 ls0 ws158">sup <span class="fc6 ls32">=</span><span class="fca ws13a">super</span><span class="ls34">(</span><span class="fca ws13a">self</span><span class="ls33">,</span><span class="fca ws13a">self</span>)</div><div class="t m0 x16 hf y2468 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, value </span><span class="ws160">in <span class="ff8 fc0 ws13a">clsdict<span class="fc6">.</span>items():</span></span></div><div class="t m0 x17 hf y2469 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">name<span class="fc6 ls34">.</span>startswith(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">_<span class="ff9">&apos;</span></span></span><span class="ls32">)</span></span>or not <span class="ff8 ws13a">callable<span class="fc0">(value):</span></span></div><div class="t m0 x18 h10 y246a ff7 fs5 fca sc0 ls0">continue</div><div class="t m0 x17 h11 y246b ffa fs5 fcd sc0 ls0 ws4"># Get the previous definition (if any) and compare the signatures</div><div class="t m0 x17 hf y246c ff8 fs5 fc0 sc0 ls0 ws1f5">prev_dfn <span class="fc6 ls33">=</span><span class="fca ws13a">getattr<span class="fc0">(sup,name,</span>None</span>)</div><div class="t m0 x17 hf y246d ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">prev_dfn:</span></div><div class="t m0 x18 hf y246e ff8 fs5 fc0 sc0 ls0 ws1f5">prev_sig <span class="fc6 ls33">=</span>signature(prev_dfn)</div><div class="t m0 x18 hf y246f ff8 fs5 fc0 sc0 ls0 ws1f4">val_sig <span class="fc6 ls33">=</span>signature(value)</div><div class="t m0 x18 hf y2470 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws1f5">prev_sig <span class="fc6 ws15c">!= </span>val_sig:</span></div><div class="t m0 x29 hf y2471 ff8 fs5 fc0 sc0 ls0 ws13a">logging<span class="fc6">.</span>warning(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Signature mismatch in </span><span class="ffa fcf">%s</span><span class="fc9 ls33">.</span><span class="ffa fcf ws159">%s <span class="ff8 fc9">!= </span><span class="ws13a">%s<span class="ff9 fc9 ws13b">&apos;</span></span></span>,</div><div class="t m0 x37 hf y2472 ff8 fs5 fc0 sc0 ls0 ws13a">value<span class="fc6 ls34">.</span><span class="ws13b">__qualname__, prev_sig, val_sig)</span></div><div class="t m0 x5 h11 y1d85 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y1b7e ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Root<span class="ff8 fc0 ws13a">(metaclass<span class="fc6">=</span>MatchSignaturesMeta):</span></span></div><div class="t m0 x15 h10 y32e ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y330 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">(Root):</span></div><div class="t m0 x15 hf y331 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">foo<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, x, y):</span></span></span></div><div class="t m0 x16 h10 y332 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.17.<span class="_ _5"> </span>9.17 <span class="ff1 wsb03">在类上强制使用编程规约 </span>338</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
