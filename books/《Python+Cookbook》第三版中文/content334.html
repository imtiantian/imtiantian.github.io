<div id="pf14e" class="pf w0 h0" data-page-no="14e"><div class="pc pc14e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg14e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls0 wsc">参考 <span class="ff4 wsca">9.16 </span>小节获取更多关于函数签名的信息。</div><div class="t m0 x5 hd y12a2 ff2 fs4 fc4 sc0 ls0 ws211">11.12<span class="_ _e"> </span>9.12 <span class="ff1">使用装饰器扩充类的功能</span></div><div class="t m0 x5 he y12a3 ff2 fs2 fc4 sc0 ls0 wsadf">11.12.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1b44 ff1 fs3 fc0 sc0 ls3a ws153">你想通过反省或者重写类定义的某部分来修改它的行为，但是你又不希望使用继承</div><div class="t m0 x5 h9 y1fb9 ff1 fs3 fc0 sc0 ls0">或元类的方式。</div><div class="t m0 x5 he y2303 ff2 fs2 fc4 sc0 ls0 wsadf">11.12.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2304 ff1 fs3 fc0 sc0 ls56 ws1fa">这种情况可能是类装饰器最好的使用场景了<span class="_ _c"></span>。例如<span class="_ _1"></span>，下面是一个重写了特殊方法<span class="_ _1"></span></div><div class="t m0 x32 h9 y1fbc ff6 fs3 fc0 sc0 ls0 wsc15">getattribute <span class="ff1">的类装饰器，可以打印日志：</span></div><div class="t m0 x5 hf y2305 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">log_getattribute<span class="fc0">(cls):</span></span></div><div class="t m0 x15 h11 y2306 ffa fs5 fcd sc0 ls0 ws4"># Get the original implementation</div><div class="t m0 x15 hf y176a ff8 fs5 fc0 sc0 ls0 ws23c">orig_getattribute <span class="fc6 ls32">=</span><span class="ws13a">cls<span class="fc6">.</span>__getattribute__</span></div><div class="t m0 x15 h11 y1cdf ffa fs5 fcd sc0 ls0 ws4"># Make a new definition</div><div class="t m0 x15 hf y2307 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">new_getattribute<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name):</span></span></span></div><div class="t m0 x16 hf y2308 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">getting:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, name)</span></span></span></span></div><div class="t m0 x16 hf y2309 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">orig_getattribute(<span class="fca">self</span><span class="ws13b">, name)</span></span></div><div class="t m0 x15 h11 y230a ffa fs5 fcd sc0 ls0 ws4"># Attach to the class and return</div><div class="t m0 x15 hf y230b ff8 fs5 fc0 sc0 ls0 ws13a">cls<span class="fc6 ls34">.</span><span class="ws1f8">__getattribute__ <span class="fc6 ls33">=</span>new_getattribute</span></div><div class="t m0 x15 hf y230c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">cls</span></div><div class="t m0 x5 h11 y230d ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 h10 y230e ff7 fs5 fc12 sc0 ls0">@log_getattribute</div><div class="t m0 x5 hf y230f ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y2310 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>,x):</span></span></div><div class="t m0 x16 hf y2311 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></div><div class="t m0 x15 hf y2312 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 h10 y2313 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y1e ff1 fs3 fc0 sc0 ls0">下面是使用效果：</div><div class="t m0 x5 hf y2314 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">A(<span class="fc7">42</span>)</span></span></div><div class="t m0 x5 hf y2315 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">x</span></span></span></div><div class="t m0 x5 hf y2316 ff8 fs5 fc8 sc0 ls0 ws4">getting: x</div><div class="t m0 x5 hf y2317 ff8 fs5 fc8 sc0 ls0">42</div><div class="t m0 x5 hf y2318 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">a<span class="fc6 ls0 ws13a">.<span class="fc0">spam()</span></span></span></div><div class="t m0 x5 hf y2319 ff8 fs5 fc8 sc0 ls0 ws4">getting: spam</div><div class="t m0 x5 hf y231a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.12.<span class="_ _5"> </span>9.12 <span class="ff1 wsb03">使用装饰器扩充类的功能 </span>325</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
