<div id="pf19b" class="pf w0 h0" data-page-no="19b"><div class="pc pc19b w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg19b.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h10 yb1e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">requests</span></span></div><div class="t m0 x5 hf yb1f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">requests<span class="fc6">.</span>get(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">http://httpbin.org/get?name=Dave&amp;n=37<span class="ff9 ls34">&apos;</span></span>,</span></span></div><div class="t m0 x5 hf yb20 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws155">headers <span class="fc6 ls32">=</span><span class="ls33">{</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">User-agent</span>&apos;</span><span class="ls33">:</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">goaway/1.0</span><span class="ls32">&apos;</span></span>})</span></div><div class="t m0 x5 hf yb21 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">r</span><span class="fc6 ws13a">.</span>json</span></div><div class="t m0 x5 hf yb22 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">resp[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">headers<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf yb23 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">User-Agent<span class="ff9 ws13b">&apos;</span><span class="ls33">:</span></span><span class="ff9">&apos;</span><span class="ls0 ws13a">goaway/1.0</span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span><span class="ls0 ws13a">Content-Length</span><span class="ff9">&apos;</span><span class="ls32">:<span class="ff9 ls0 ws13b">&apos;&apos;</span>,</span><span class="ff9">&apos;</span><span class="ls0 ws13a">Content-Type<span class="ff9 ws13b">&apos;</span><span class="ls33">:</span><span class="ff9 ws13b">&apos;&apos;</span>,</span></div><div class="t m0 x5 hf yb24 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">Accept-Encoding</span><span class="ls0 ws13b">&apos;<span class="ff8 ls33">:</span></span>&apos;<span class="ff8 ls0 ws13b">gzip, deflate, compress</span>&apos;<span class="ff8 ls32">,</span>&apos;<span class="ff8 ls0 ws13a">Connection</span>&apos;<span class="ff8 ls0">:</span></div><div class="t m0 x5 hf yb25 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">keep-alive</span>&apos;<span class="ff8 ls32">,</span>&apos;<span class="ff8 ls0 ws13a">Host</span>&apos;<span class="ff8 ls32">:</span>&apos;<span class="ff8 ls0 ws13a">httpbin.org</span><span class="ls0 ws13b">&apos;<span class="ff8 ls33">,</span></span>&apos;<span class="ff8 ls0 ws13a">Accept</span>&apos;<span class="ff8 ls32">:</span>&apos;<span class="ff8 ls0 ws13a">*/*</span>&apos;<span class="ff8 ls0">}</span></div><div class="t m0 x5 hf yb26 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">resp[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">args<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf yb27 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">name</span><span class="ff9">&apos;</span><span class="ls33">:<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">Dave</span></span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span>n<span class="ff9">&apos;</span><span class="ls32">:</span><span class="ff9">&apos;</span><span class="ls0 ws13a">37</span><span class="ff9">&apos;</span><span class="ls0">}</span></div><div class="t m0 x5 hf yfda ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y29c7 ff1 fs3 fc0 sc0 ls10 wsa34">在要同一个真正的站点进行交互前，先在 <span class="ff4 ls0 wsea8">h<span class="_ _c"></span>ttpbin.org <span class="ff1 ls10 wsdf">这样的网站上做实验常常是</span></span></div><div class="t m0 x5 h7 y29c8 ff1 fs3 fc0 sc0 ls77 wsea9">可取的办法<span class="_ _c"></span>。尤其是当我们面对 <span class="ff4 ls1d4">3</span><span class="ws2d4">次登录失败就会关闭账户这样的风险时尤为有用<span class="_ _1"></span></span></div><div class="t m0 x38 h7 y29c9 ff1 fs3 fc0 sc0 ls0 ws38">（不要尝试自己编写 <span class="ff4 ws86">HTTP </span><span class="wsa0">认证客户端来登录你的银行账户）<span class="_ _f"></span>。</span></div><div class="t m0 x0 h7 y29ca ff1 fs3 fc0 sc0 ls0 wseaa">尽<span class="_ _6"></span>管<span class="_ _6"></span>本<span class="_ _6"></span>节<span class="_ _6"></span>没<span class="_ _6"></span>有<span class="_ _6"></span>涉<span class="_ _6"></span>及， <span class="ff6 wseab">request </span><span class="wseac">库<span class="_ _6"></span>还<span class="_ _6"></span>对<span class="_ _6"></span>许<span class="_ _6"></span>多<span class="_ _6"></span>高<span class="_ _6"></span>级<span class="_ _6"></span>的 <span class="ff4 wsead">HTTP </span><span class="wsa0">客<span class="_ _0"></span>户端<span class="_ _6"></span>协<span class="_ _6"></span>议<span class="_ _6"></span>提<span class="_ _6"></span>供<span class="_ _6"></span>了<span class="_ _0"></span>支持，</span></span></div><div class="t m0 x5 h7 y29cb ff1 fs3 fc0 sc0 ls0 ws7a2">比如 <span class="ff4 wsa5">OA<span class="_ _c"></span>uth<span class="ff1 ls1d5">。</span><span class="ff6 wseae">requests <span class="ff1 wsa0">模<span class="_ _6"></span>块<span class="_ _6"></span>的<span class="_ _6"></span>文档<span class="_ _6"></span>（</span></span><span class="fc3">http://do<span class="_ _6"></span>cs.p<span class="_ _1"></span>ython-requests.org<span class="fc0 ls5c">)<span class="ff1 ls0 wsa0">质<span class="_ _6"></span>量很<span class="_ _6"></span>高<span class="_ _6"></span>（坦</span></span></span></span></div><div class="t m0 x5 h9 y29cc ff1 fs3 fc0 sc0 ls0 wsa0">白说比在这短短的一节的篇幅中所提供的任何信息都好）<span class="_ _f"></span>，<span class="_ _1"></span>可以参考文档以获得更多地</div><div class="t m0 x5 h9 y29cd ff1 fs3 fc0 sc0 ls0">信息。</div><div class="t m0 x5 hd y29ce ff2 fs4 fc4 sc0 ls0 ws211">13.2<span class="_ _e"> </span>11.2 <span class="ff1 ws165">创建 </span><span class="wseaf">TCP <span class="ff1">服务器</span></span></div><div class="t m0 x5 he y29cf ff2 fs2 fc4 sc0 ls0 ws212">13.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y11b9 ff1 fs3 fc0 sc0 ls0 wsc">你想实现一个服务器，通过 <span class="ff4 wseb0">TCP </span>协议和客户端通信。</div><div class="t m0 x5 he y29d0 ff2 fs2 fc4 sc0 ls0 ws212">13.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y29d1 ff1 fs3 fc0 sc0 ls0 wsd64">创建<span class="_ _6"></span>一<span class="_ _6"></span>个 <span class="ff4 wseb1">TCP </span><span class="ls30 wseb2">服务器的一个简单方法是使用 </span><span class="ff6 wseb3">socketserver </span><span class="wsa0">库。例<span class="_ _6"></span>如，<span class="_ _6"></span>下面<span class="_ _6"></span>是<span class="_ _6"></span>一</span></div><div class="t m0 x5 h9 y29d2 ff1 fs3 fc0 sc0 ls0">个简单的应答服务器：</div><div class="t m0 x5 hf y29d3 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws96c">socketserver </span><span class="ws146">import <span class="ff8 fc0 ws4">BaseRequestHandler, TCPServer</span></span></div><div class="t m0 x5 hf y29d4 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">EchoHandler<span class="ff8 fc0">(BaseRequestHandler):</span></span></div><div class="t m0 x15 hf y29d5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">handle<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y29d6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Got connection from<span class="ff9">&apos;</span></span></span><span class="ls33">,</span></span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">client_address)</span></span></div><div class="t m0 x16 hf y29d7 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x17 hf y29d8 ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span><span class="fc0">request<span class="fc6 ls34">.</span>recv(<span class="fc7">8192</span>)</span></span></div><div class="t m0 x17 hf y29d9 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 fc0">msg:</span></div><div class="t m0 x18 h10 y29da ff7 fs5 fca sc0 ls0">break</div><div class="t m0 x17 hf y29db ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">request</span><span class="ls34">.</span><span class="fc0">send(msg)</span></span></div><div class="t m0 x5 hf y29dc ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y29dd ff8 fs5 fc0 sc0 ls0 ws13c">serv <span class="fc6 ls32">=</span><span class="ws13a">TCPServer((<span class="ff9 fc9 ws13b">&apos;&apos;</span><span class="ls33">,</span><span class="fc7">20000</span><span class="ws13b">), EchoHandler)</span></span></div><div class="t m0 x15 hf y29de ff8 fs5 fc0 sc0 ls0 ws13a">serv<span class="fc6 ls34">.</span>serve_forever()</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.2.<span class="_ _5"> </span>11.2 <span class="ff1 ws16b">创建 </span><span class="wseb4">TCP <span class="ff1 wseb5">服务器 </span>402</span></div><a class="l" href="http://docs.python-requests.org"><div class="d m1" style="border-style:none;position:absolute;left:417.496500px;bottom:787.518000px;width:163.353000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
