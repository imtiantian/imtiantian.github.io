<div id="pf183" class="pf w0 h0" data-page-no="183"><div class="pc pc183 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg183.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y1e8 ffa fs5 fcd sc0 ls0 ws4"># fib.py</div><div class="t m0 x5 hf y1e9 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="fc9 ls34">&quot;I<span class="ff9">&apos;</span><span class="ls0 ws13b">m fib&quot;</span></span>)</span></div><div class="t m0 x5 hf y903 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">fib<span class="fc0">(n):</span></span></div><div class="t m0 x15 hf y1eb ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&lt;<span class="fc7 ls34">2</span></span><span class="ls0">:</span></span></div><div class="t m0 x16 hf y1ec ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc7">1</span></div><div class="t m0 x15 hf y904 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf y905 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">fib(n<span class="fc6">-<span class="fc7 ls34">1</span></span><span class="ls32">)<span class="fc6 ls33">+</span></span>fib(n<span class="fc6">-<span class="fc7 ls34">2</span></span>)</span></div><div class="t m0 x5 h11 y907 ffa fs5 fcd sc0 ls0 ws4"># grok/__init__.py</div><div class="t m0 x5 hf y908 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="fc9 ls34">&quot;I<span class="ff9">&apos;</span><span class="ls0 ws13b">m grok.__init__&quot;</span></span>)</span></div><div class="t m0 x5 h11 ybd8 ffa fs5 fcd sc0 ls0 ws4"># grok/blah.py</div><div class="t m0 x5 hf ybd9 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="fc9 ls34">&quot;I<span class="ff9">&apos;</span><span class="ls0 ws13b">m grok.blah&quot;</span></span>)</span></div><div class="t m0 x0 h9 y27d8 ff1 fs3 fc0 sc0 ls3a ws153">这里的目的是允许这些文件作为模块被远程访问。也许最简单的方式就是将它们发</div><div class="t m0 x5 h7 y27d9 ff1 fs3 fc0 sc0 ls0 ws14">布到一个 <span class="ff4 wsda1">w<span class="_ _1"></span>eb <span class="ff1 ws38">服务器上面。在 </span><span class="wsda2">testco<span class="_ _6"></span>de <span class="ff1 ws14">目录中像下面这样运行 </span><span class="wsa5">Python<span class="ff1">：</span></span></span></span></div><div class="t m0 x5 hf y27da ff8 fs5 fc0 sc0 ls0 ws4">bash % cd testcode</div><div class="t m0 x5 hf y27db ff8 fs5 fc0 sc0 ls0 ws4">bash % python3 -m http.server 15000</div><div class="t m0 x5 hf y11e3 ff8 fs5 fc0 sc0 ls0 ws4">Serving HTTP on 0.0.0.0 port 15000 ...</div><div class="t m0 x0 h7 y27dc ff1 fs3 fc0 sc0 ls22 wsda3">服务器运行起来后再启动一个单独的 <span class="ff4 ls0 ws759">Python </span><span class="wsda4">解释器<span class="_ _1"></span>。确保你可以使用 <span class="ff6 ls0 ws3cf">urllib <span class="ff1">访</span></span></span></div><div class="t m0 x5 h9 y27dd ff1 fs3 fc0 sc0 ls0">问到远程文件。例如：</div><div class="t m0 x5 hf y27de ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws51a">urllib.request </span><span class="ws1ff">import <span class="ff8 fc0">urlopen</span></span></span></div><div class="t m0 x5 hf y27df ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">urlopen(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://localhost:15000/fib.py<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y27e0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">data <span class="fc6 ls32">=</span><span class="ls34">u</span><span class="fc6 ws13a">.<span class="fc0">read()</span><span class="ls34">.</span><span class="fc0">decode(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y27e1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0">(data)</span></span></div><div class="t m0 x5 hf y27e2 ff8 fs5 fc8 sc0 ls0 ws4"># fib.py</div><div class="t m0 x5 hf y27e3 ff8 fs5 fc8 sc0 ls0 ws13a">print(&quot;I<span class="ff9 ls34">&apos;</span><span class="ws13b">m fib&quot;)</span></div><div class="t m0 x5 hf y27e4 ff8 fs5 fc8 sc0 ls0 ws4">def fib(n):</div><div class="t m0 x15 hf y27e5 ff8 fs5 fc8 sc0 ls0 ws4">if n &lt; 2:</div><div class="t m0 x16 hf y27e6 ff8 fs5 fc8 sc0 ls0 ws13b">return 1</div><div class="t m0 x15 hf y27e7 ff8 fs5 fc8 sc0 ls0">else:</div><div class="t m0 x16 hf y27e8 ff8 fs5 fc8 sc0 ls0 ws4">return fib(n-1) + fib(n-2)</div><div class="t m0 x5 hf y27e9 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y27ea ff1 fs3 fc0 sc0 lsd3 ws312">从这个服务器加载源代码是接下来本节的基础<span class="_ _c"></span>。为了替代手动的通过 <span class="ff6 ls0">urlopen()</span></div><div class="t m0 x5 h7 y1f0a ff1 fs3 fc0 sc0 ls0 ws14">来收集源文件，我们通过自定义 <span class="ff4 wsda5">imp<span class="_ _6"></span>ort </span>语句来在后台自动帮我们做到。</div><div class="t m0 x0 h9 y1d9b ff1 fs3 fc0 sc0 ls0">加载远程模块的第一种方法是创建一个显示的加载函数来完成它。例如：</div><div class="t m0 x5 h10 y83b ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">imp</span></div><div class="t m0 x5 h10 y83c ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">urllib.request</span></div><div class="t m0 x5 h10 y83d ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf ycf5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">load_module<span class="fc0">(url):</span></span></div><div class="t m0 x15 hf y83f ff8 fs5 fc0 sc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">urllib<span class="fc6 ls34">.</span>request<span class="fc6 ls34">.</span>urlopen(url)</span></div><div class="t m0 x15 hf y840 ff8 fs5 fc0 sc0 ls0 ws145">source <span class="fc6 ls32">=</span><span class="ls34">u<span class="fc6">.</span></span><span class="ws13a">read()<span class="fc6 ls34">.</span>decode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x15 hf y841 ff8 fs5 fc0 sc0 ls0 ws158">mod <span class="fc6 ls32">=</span><span class="ws13a">sys<span class="fc6 ls34">.</span>modules<span class="fc6 ls34">.</span><span class="ws4">setdefault(url, imp<span class="fc6 ls34">.</span>new_module(url))</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>378</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
