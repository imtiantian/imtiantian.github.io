<div id="pff2" class="pf w0 h0" data-page-no="f2"><div class="pc pcf2 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgf2.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws9c6">10.2<span class="_ _e"> </span>8.2 <span class="ff1">自定义字符串的格式化</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws212">10.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y114 ff1 fs3 fc0 sc0 ls0 wsc">你想通过 <span class="ff6 ws26f">format() </span>函数和字符串方法使得一个对象能支持自定义的格式化。</div><div class="t m0 x5 he y1a2c ff2 fs2 fc4 sc0 ls0 ws212">10.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1a2d ff1 fs3 fc0 sc0 ls0 ws911">为了自定义字符串的格式化，我们需要在类上面定义 <span class="ff6 ws308">format<span class="_ _e"> </span>() </span>方法。例如：</div><div class="t m0 x5 hf y1a2e ff8 fs5 fc0 sc0 ls0 ws16d">_formats <span class="fc6 ls32">=</span>{</div><div class="t m0 x15 hf y1a2f ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">ymd</span><span class="ls32">&apos;<span class="ff8 fc0 ls33">:</span><span class="ls0 ws13b">&apos;<span class="ff8 ws13a">{d.year}-{d.month}-{d.day}</span></span></span>&apos;<span class="ff8 fc0 ls0">,</span></div><div class="t m0 x15 hf y1a30 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">mdy</span><span class="ls32">&apos;<span class="ff8 fc0 ls33">:</span><span class="ls0 ws13b">&apos;<span class="ff8 ws13a">{d.month}/{d.day}/{d.year}</span></span></span>&apos;<span class="ff8 fc0 ls0">,</span></div><div class="t m0 x15 hf y1a31 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">dmy</span><span class="ls32">&apos;<span class="ff8 fc0 ls33">:</span><span class="ls0 ws13b">&apos;<span class="ff8 ws13a">{d.day}/{d.month}/{d.year}</span>&apos;</span></span></div><div class="t m0 x15 hf y1a32 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y1a33 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Date<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1a34 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, year, month, day):</span></span></span></div><div class="t m0 x16 hf y1a35 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">year </span><span class="ls33">=</span><span class="fc0">year</span></span></div><div class="t m0 x16 hf y1a36 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">month </span><span class="ls32">=</span><span class="fc0">month</span></span></div><div class="t m0 x16 hf y1a37 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws158">day </span><span class="ls33">=</span><span class="fc0">day</span></span></div><div class="t m0 x15 hf y1a38 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__format__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, code):</span></span></span></div><div class="t m0 x16 hf y1a39 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">code <span class="fc6 ws159">== <span class="ff9 fc9 ws13b">&apos;&apos;</span></span>:</span></div><div class="t m0 x17 hf y1a3a ff8 fs5 fc0 sc0 ls0 ws161">code <span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">ymd<span class="ff9">&apos;</span></span></div><div class="t m0 x16 hf y1a3b ff8 fs5 fc0 sc0 ls0 ws158">fmt <span class="fc6 ls32">=</span>_formats[code]</div><div class="t m0 x16 hf y1a3c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">fmt<span class="fc6 ls34">.</span>format(d<span class="fc6">=<span class="fca">self</span></span>)</span></div><div class="t m0 x0 h9 y1a3d ff1 fs3 fc0 sc0 ls0 wsc">现在 <span class="ff6 ws27b">Date </span>类的实例可以支持格式化操作了，如同下面这样：</div><div class="t m0 x5 hf y1a3e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">d<span class="fc6 ls33">=</span><span class="ls0 ws13a">Date(<span class="fc7">2012</span><span class="ls33">,</span><span class="fc7">12</span><span class="ls33">,</span><span class="fc7">21</span>)</span></span></div><div class="t m0 x5 hf y1a3f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">format(d)</span></div><div class="t m0 x5 hf y1a40 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">2012-12-21<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1a41 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws16e">format(d, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">mdy<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y177 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">12/21/2012<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1a42 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">The date is {:ymd}<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span><span class="fc0">format(d)</span></span></span></div><div class="t m0 x5 hf y1a43 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">The date is 2012-12-21<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1a44 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">The date is {:mdy}<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span><span class="fc0">format(d)</span></span></span></div><div class="t m0 x5 hf y1a45 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">The date is 12/21/2012<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1a46 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y1a47 ff2 fs2 fc4 sc0 ls0 ws212">10.2.3 <span class="ff1">讨论</span></div><div class="t m0 x31 h7 y1a48 ff6 fs3 fc0 sc0 ls0 ws589">format<span class="_ _e"> </span>() <span class="ff1 ls17 ws9dc">方法给 </span><span class="ff4 ws587">Python <span class="ff1 ls17 wsf6">的字符串格式化功能提供了一个钩子。这里需要着重<span class="_ _1"></span></span></span></div><div class="t m0 x5 h9 y2d0 ff1 fs3 fc0 sc0 ls18 ws110">强调的是格式化代码的解析工作完全由类自己决定。因此<span class="_ _1"></span>，格式化代码可以是任何值。</div><div class="t m0 x5 h9 y1a49 ff1 fs3 fc0 sc0 ls0 ws38">例如，参考下面来自 <span class="ff6 ws26f">datetime </span>模块中的代码：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">10.2.<span class="_ _5"> </span>8.2 <span class="ff1 ws9db">自定义字符串的格式化 </span>233</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
