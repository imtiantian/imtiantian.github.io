<div id="pfd6" class="pf w0 h0" data-page-no="d6"><div class="pc pcd6 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgd6.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h9 y2a ff1 fs3 fc0 sc0 ls13 wse5">字段的顺序都以这个顺序为准<span class="_ _1"></span>。这么做可以帮助避免额外输入，但是在定义的中间我<span class="_ _c"></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">们仍然可能切换顺序的。比如，你可能有一些比较复杂的结构，就像下面这样：</div><div class="t m0 x5 hf y48d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ShapeFile<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y48e ff8 fs5 fc0 sc0 ls0 ws1f5">_fields_ <span class="fc6 ls33">=</span><span class="ws13b">[ (<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">&gt;i<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">file_code<span class="ff9 ws13b">&apos;</span></span><span class="ws15c">), </span><span class="ffa fcd"># Big endian</span></span></div><div class="t m0 x16 hf y48f ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">20s</span><span class="ls34">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">unused</span>&apos;</span><span class="ls0">),</span></span></div><div class="t m0 x16 hf y490 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">i<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">file_length</span>&apos;</span><span class="ls0">),</span></div><div class="t m0 x16 hf y7ab ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">&lt;i</span>&apos;</span><span class="ls33">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">version</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0 ws15c">), <span class="ffa fcd ws13b"># Little endian</span></span></div><div class="t m0 x16 hf y1760 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">i<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">shape_type</span>&apos;</span><span class="ls0">),</span></div><div class="t m0 x16 hf y1761 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">min_x</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1762 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">min_y</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1763 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">max_x</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1764 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">max_y</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y359 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">min_z</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1765 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">max_z</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1766 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">min_m</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">),</span></div><div class="t m0 x16 hf y1767 ff8 fs5 fc0 sc0 ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;</span><span class="fc9">d<span class="ff9">&apos;</span></span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">max_m</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0 ws4">) ]</span></div><div class="t m0 x0 h9 y1768 ff1 fs3 fc0 sc0 ls0 wsa0">之前<span class="_ _6"></span>我<span class="_ _6"></span>们<span class="_ _6"></span>提<span class="_ _6"></span>到过，<span class="_ _6"></span><span class="ff6 ws8f0">memoryview() </span><span class="ls2d ws132">的使用可以帮助我们避免内存的复制。当结构存<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y1769 ff1 fs3 fc0 sc0 ls0 wsa0">在<span class="_ _6"></span>嵌<span class="_ _6"></span>套<span class="_ _6"></span>的时<span class="_ _6"></span>候，<span class="_ _6"></span><span class="ff6 ws34d">memoryviews </span><span class="ls48 ws242">可以叠加同一内存区<span class="_ _6"></span>域上定义的机构的不同部分<span class="_ _1"></span>。这个</span></div><div class="t m0 x5 h9 y176a ff1 fs3 fc0 sc0 ls13 wse5">特性比较微妙<span class="_ _1"></span>，但是它关注的是内存视图与普通字节数组的切片操作行为。如果你在<span class="_ _c"></span></div><div class="t m0 x5 h9 y176b ff1 fs3 fc0 sc0 ls13 wse5">一个字节字符串或字节数组上执行切片操作<span class="_ _1"></span>，你通常会得到一个数据的拷贝。而内存<span class="_ _c"></span></div><div class="t m0 x5 h9 y176c ff1 fs3 fc0 sc0 ls1e ws111">视图切片不是这样的<span class="_ _1"></span>，它仅仅是在已存在的内存上面叠加而已<span class="_ _1"></span>。因此，这种方式<span class="_ _1"></span>更加</div><div class="t m0 x5 h9 y176d ff1 fs3 fc0 sc0 ls0">高效。</div><div class="t m0 x0 h7 y176e ff1 fs3 fc0 sc0 ls0 ws8f1">还<span class="_ _12"></span>有<span class="_ _0"></span>很<span class="_ _12"></span>多<span class="_ _12"></span>相<span class="_ _0"></span>关<span class="_ _12"></span>的<span class="_ _12"></span>章<span class="_ _0"></span>节<span class="_ _12"></span>可<span class="_ _12"></span>以<span class="_ _12"></span>帮<span class="_ _0"></span>助<span class="_ _12"></span>我<span class="_ _12"></span>们<span class="_ _0"></span>扩<span class="_ _12"></span>展<span class="_ _12"></span>这<span class="_ _12"></span>里<span class="_ _0"></span>讨<span class="_ _12"></span>论<span class="_ _12"></span>的<span class="_ _0"></span>方<span class="_ _12"></span>案。<span class="_ _12"></span>参<span class="_ _12"></span>考 <span class="ff4 ws8f2">8.13 </span><span class="wsa0">小<span class="_ _0"></span>节<span class="_ _12"></span>使<span class="_ _12"></span>用</span></div><div class="t m0 x5 h7 y176f ff1 fs3 fc0 sc0 ls54 ws1e6">描述器构建一个类型系统<span class="_ _8"></span>。<span class="ff4 ls0 ws8f3">8.10 </span>小节有更多关于延迟计算属<span class="_ _6"></span>性值的讨论<span class="_ _8"></span>，并且跟<span class="_ _8"></span></div><div class="t m0 x5 h7 y1770 ff4 fs3 fc0 sc0 ls0 ws8f4">NestedStruct <span class="ff1 wsa0">描述器<span class="_ _6"></span>的实<span class="_ _6"></span>现也有<span class="_ _6"></span>关。</span><span class="ws438">9.19 <span class="ff1 ls3d ws164">小节有一个使用元类来初始化类成员的例子，<span class="_ _1"></span></span></span></div><div class="t m0 x5 h7 y1771 ff1 fs3 fc0 sc0 ls12c">和<span class="ff6 ls0 ws8f5">StructureMeta </span><span class="ls2b ws12e">类非常相似。</span><span class="ff4 ls0 ws8f6">Python </span>的<span class="ff6 ls0 ws8f7">ctypes </span><span class="ls2b ws12e">源码同样也很有趣，它提供了对定</span></div><div class="t m0 x5 h9 y1772 ff1 fs3 fc0 sc0 ls0">义数据结构、数据结构嵌套这些相似功能的支持。</div><div class="t m0 x5 hd y1773 ff2 fs4 fc4 sc0 ls0 ws211">8.13<span class="_ _e"> </span>6.13 <span class="ff1">数据的累加与统计操作</span></div><div class="t m0 x5 he y1774 ff2 fs2 fc4 sc0 ls0 ws212">8.13.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1775 ff1 fs3 fc0 sc0 ls0">你需要处理一个很大的数据集并需要计算数据总和或其他统计量。</div><div class="t m0 x5 he y1776 ff2 fs2 fc4 sc0 ls0 ws212">8.13.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1777 ff1 fs3 fc0 sc0 ls3a ws153">对于任何涉及到统计、时间序列以及其他相关技术的数据分析问题，都可以考虑使</div><div class="t m0 x5 h7 y1778 ff1 fs3 fc0 sc0 ls4">用<span class="ff4 fc3 ls0 ws8f8">P<span class="_ _1"></span>andas <span class="ff1 ls4">库<span class="fc0 ls0">。</span></span></span></div><div class="t m0 x0 h7 y1779 ff1 fs3 fc0 sc0 ls0 ws495">为了让你先体验下，下面是一个使用 <span class="ff4 ws8f8">P<span class="_ _1"></span>andas <span class="ff1 ws8f9">来分析芝加哥城市的 <span class="fc3 wsa0">老鼠和啮齿类动</span></span></span></div><div class="t m0 x5 h7 y177a ff1 fs3 fc3 sc0 ls0 ws8fa">物数据库 <span class="fc0 ls1f ws8fb">的例子。在我写这篇文章的时候，这个数据库是一个拥有大概 <span class="ff4 ls0 ws8fc">74,000 </span><span class="ws113">行数据</span></span></div><div class="t m0 x5 h7 y177b ff1 fs3 fc0 sc0 ls4">的<span class="ff4 ls0 ws5d">CSV <span class="ff1">文件。</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">8.13.<span class="_ _5"> </span>6.13 <span class="ff1 ws509">数据的累加与统计操作 </span>205</div><a class="l" href="http://pandas.pydata.org/"><div class="d m1" style="border-style:none;position:absolute;left:131.779500px;bottom:237.243000px;width:52.829000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://data.cityofchicago.org/Service-Requests/311-Service-Requests-Rodent-Baiting/97t6-zrhs"><div class="d m1" style="border-style:none;position:absolute;left:659.352000px;bottom:205.531500px;width:83.708000px;height:14.016000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="https://data.cityofchicago.org/Service-Requests/311-Service-Requests-Rodent-Baiting/97t6-zrhs"><div class="d m1" style="border-style:none;position:absolute;left:108.000000px;bottom:183.862500px;width:47.870000px;height:14.016000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
