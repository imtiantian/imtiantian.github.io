<div id="pfec" class="pf w0 h0" data-page-no="ec"><div class="pc pcec w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgec.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y765 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 h10 y766 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">multiprocessing</span></div><div class="t m0 x15 hf y767 ff8 fs5 fc0 sc0 ls0 ws13c">pool <span class="fc6 ls32">=</span><span class="ws13a">multiprocessing<span class="fc6 ls34">.</span>Pool()</span></div><div class="t m0 x15 hf y768 ff8 fs5 fc0 sc0 ls0 ws208">apply_async <span class="fc6 ls32">=</span><span class="ws13a">pool<span class="fc6 ls34">.</span>apply_async</span></div><div class="t m0 x15 h11 y76a ffa fs5 fcd sc0 ls0 ws4"># Run the test function</div><div class="t m0 x15 hf y76b ff8 fs5 fc0 sc0 ls0">test()</div><div class="t m0 x0 h9 y19ca ff1 fs3 fc0 sc0 ls3a ws153">实际上你会发现这个真的就是这样的，但是要解释清楚具体的控制流得需要点时间</div><div class="t m0 x5 h9 y19cb ff1 fs3 fc0 sc0 ls0">了。</div><div class="t m0 x0 h9 y19cc ff1 fs3 fc0 sc0 ls3a ws153">将复杂的控制流隐藏到生成器函数背后的例子在标准库和第三方包中都能看到。比</div><div class="t m0 x5 h9 y19cd ff1 fs3 fc0 sc0 ls0 ws9b5">如，<span class="_ _6"></span>在 <span class="ff6 ws9b6">contextlib </span><span class="ws2b6">中的 <span class="ff6 ws390">@contextmanager </span><span class="ls1e ws111">装饰器使用了一个令人费解的技巧，通过<span class="_ _1"></span></span></span></div><div class="t m0 x5 h9 y19ce ff1 fs3 fc0 sc0 ls0 ws9b7">一个 <span class="ff6 ws9b8">yield </span><span class="ls2c ws9b9">语句将进入和离开上下文管理器粘合在一起。另外非常流行的 </span><span class="ff6 ws9ba">Twisted </span>包</div><div class="t m0 x5 h9 y19cf ff1 fs3 fc0 sc0 ls0">中也包含了非常类似的内联回调。</div><div class="t m0 x5 hd y19d0 ff2 fs4 fc4 sc0 ls0 ws211">9.12<span class="_ _e"> </span>7.12 <span class="ff1">访问闭包中定义的变量</span></div><div class="t m0 x5 he y19d1 ff2 fs2 fc4 sc0 ls0 ws212">9.12.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y19d2 ff1 fs3 fc0 sc0 ls0">你想要扩展函数中的某个闭包，允许它能访问和修改函数的内部变量。</div><div class="t m0 x5 he y19d3 ff2 fs2 fc4 sc0 ls0 ws212">9.12.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y19d4 ff1 fs3 fc0 sc0 ls0 wsa0">通常来讲，闭包的内部<span class="_ _6"></span>变量对于外界来讲是完全<span class="_ _6"></span>隐藏的。但是，你可以通过<span class="_ _6"></span>编写访</div><div class="t m0 x5 h9 y19d5 ff1 fs3 fc0 sc0 ls0">问函数并将其作为函数属性绑定到闭包上来实现这个目的。例如：</div><div class="t m0 x5 hf y19d6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">sample<span class="fc0">():</span></span></div><div class="t m0 x15 hf y19d7 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></div><div class="t m0 x15 h11 y19d8 ffa fs5 fcd sc0 ls0 ws13b"># Closure function</div><div class="t m0 x15 hf y19d9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">func<span class="fc0">():</span></span></div><div class="t m0 x16 hf y19da ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">n=</span>&apos;</span><span class="ls0 ws4">, n)</span></span></div><div class="t m0 x15 h11 y19db ffa fs5 fcd sc0 ls0 ws4"># Accessor methods for n</div><div class="t m0 x15 hf y19dc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get_n<span class="fc0">():</span></span></div><div class="t m0 x16 hf y19dd ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">n</span></div><div class="t m0 x15 hf y19de ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">set_n<span class="fc0">(value):</span></span></div><div class="t m0 x16 hf y19df ff8 fs5 fc0 sc0 ls0 ws13b">nonlocal n</div><div class="t m0 x16 hf y19e0 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls33">=</span><span class="ls0">value</span></div><div class="t m0 x15 h11 y19e1 ffa fs5 fcd sc0 ls0 ws4"># Attach as function attributes</div><div class="t m0 x15 hf y19e2 ff8 fs5 fc0 sc0 ls0 ws13a">func<span class="fc6 ls34">.</span><span class="ws15f">get_n <span class="fc6 ls32">=</span>get_n</span></div><div class="t m0 x15 hf y19e3 ff8 fs5 fc0 sc0 ls0 ws13a">func<span class="fc6 ls34">.</span><span class="ws15f">set_n <span class="fc6 ls32">=</span>set_n</span></div><div class="t m0 x15 hf y19e4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">func</span></div><div class="t m0 x0 h7 y19e5 ff1 fs3 fc0 sc0 ls0 wsa0">下面是使用的例子<span class="ff4">:</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">9.12.<span class="_ _5"> </span>7.12 <span class="ff1 ws509">访问闭包中定义的变量 </span>227</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
