<div id="pf4e" class="pf w0 h0" data-page-no="4e"><div class="pc pc4e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg4e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">scanner<span class="fc6 ls34">.</span>match()</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y85b ff1 fs3 fc0 sc0 ls3a ws153">实际使用这种技术的时候，可以很容易的像下面这样将上述代码打包到一个生成器</div><div class="t m0 x5 h9 y85c ff1 fs3 fc0 sc0 ls0">中：</div><div class="t m0 x5 hf y8a4 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">generate_tokens<span class="fc0 ws13b">(pat, text):</span></span></div><div class="t m0 x5 hf y8a5 ff8 fs5 fc0 sc0 ls0 ws15f">Token <span class="fc6 ls33">=</span><span class="ws13a">namedtuple(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Token<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, [<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">type<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">value<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x5 hf y8a6 ff8 fs5 fc0 sc0 ls0 ws155">scanner <span class="fc6 ls32">=</span><span class="ws13a">pat<span class="fc6 ls34">.</span>scanner(text)</span></div><div class="t m0 x5 hf y8a7 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">m</span><span class="ws160">in <span class="ff8 ws13a">iter<span class="fc0">(scanner<span class="fc6 ls34">.</span><span class="ws145">match, </span></span>None<span class="fc0">):</span></span></span></div><div class="t m0 x15 hf y8a8 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0 ws13a">Token(m<span class="fc6 ls34">.</span><span class="ws4">lastgroup, m<span class="fc6 ls34">.</span>group())</span></span></div><div class="t m0 x5 h11 y8a9 ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y8aa ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws158">tok </span><span class="ws157">in <span class="ff8 fc0 ws41e">generate_tokens(master_pat, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">foo = 42<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x15 hf y8ab ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(tok)</span></div><div class="t m0 x5 h11 y8ac ffa fs5 fcd sc0 ls0 ws4"># Produces output</div><div class="t m0 x5 h11 y8ad ffa fs5 fcd sc0 ls0 ws4"># Token(type=<span class="ffb ls34">&apos;</span><span class="ws13a">NAME<span class="ffb ls34">&apos;</span><span class="ws13b">, value=<span class="ffb">&apos;</span></span>foo<span class="ffb ws13b">&apos;</span>)</span></div><div class="t m0 x5 h11 y8ae ffa fs5 fcd sc0 ls0 ws4"># Token(type=<span class="ffb ls34">&apos;</span><span class="ws13a">WS<span class="ffb ws13b">&apos;</span></span>, value=<span class="ffb ws41d">&apos; &apos;</span>)</div><div class="t m0 x5 h11 y8af ffa fs5 fcd sc0 ls0 ws4"># Token(type=<span class="ffb ls34">&apos;</span><span class="ws13a">EQ<span class="ffb ws13b">&apos;</span></span>, value=<span class="ffb ls34">&apos;<span class="ffa">=</span><span class="ls0 ws13b">&apos;</span></span>)</div><div class="t m0 x5 h11 y8b0 ffa fs5 fcd sc0 ls0 ws4"># Token(type=<span class="ffb ls34">&apos;</span><span class="ws13a">WS<span class="ffb ws13b">&apos;</span></span>, value=<span class="ffb ws41d">&apos; &apos;</span>)</div><div class="t m0 x5 h11 y8b1 ffa fs5 fcd sc0 ls0 ws4"># Token(type=<span class="ffb ls34">&apos;</span><span class="ws13a">NUM<span class="ffb ls34">&apos;</span></span>, value=<span class="ffb ls34">&apos;</span><span class="ws13a">42<span class="ffb ls34">&apos;</span>)</span></div><div class="t m0 x0 h9 y8b2 ff1 fs3 fc0 sc0 ls30 ws138">如果你想过滤令牌流，你可以定义更多的生成器函数或者使用一个生成器表达式<span class="_ _c"></span>。</div><div class="t m0 x5 h9 y8b3 ff1 fs3 fc0 sc0 ls0">比如，下面演示怎样过滤所有的空白令牌：</div><div class="t m0 x5 hf y8b4 ff8 fs5 fc0 sc0 ls0 ws145">tokens <span class="fc6 ls33">=</span><span class="ws161">(tok <span class="ff7 fca ws139">for </span><span class="ws158">tok <span class="ff7 fca ws157">in </span><span class="ws4">generate_tokens(master_pat, text)</span></span></span></div><div class="t m0 x17 hf y8b5 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">tok<span class="fc6 ls34">.</span><span class="ws161">type <span class="fc6 ws15c">!= <span class="ff9 fc9 ws13b">&apos;</span></span></span><span class="fc9">WS<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y8b6 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws158">tok </span><span class="ws157">in <span class="ff8 fc0">tokens:</span></span></div><div class="t m0 x15 hf y8b7 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(tok)</span></div><div class="t m0 x5 he y8b8 ff2 fs2 fc4 sc0 ls0 ws212">4.18.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y8b9 ff1 fs3 fc0 sc0 ls22 ws119">通常来讲令牌化是很多高级文本解析与处理的第一步。为了使用上面的扫描方法<span class="_ _1"></span>，</div><div class="t m0 x5 h9 y8ba ff1 fs3 fc0 sc0 ls2d ws132">你需要记住这里一些重要的几点。第一点就是你必须确认你使用正则表达式指定了所<span class="_ _1"></span></div><div class="t m0 x5 h9 y8bb ff1 fs3 fc0 sc0 ls13 wse5">有输入中可能出现的文本序列<span class="_ _1"></span>。如果有任何不可匹配的文本出现了，扫描就会直接停<span class="_ _c"></span></div><div class="t m0 x5 h9 y8bc ff1 fs3 fc0 sc0 ls0">止。这也是为什么上面例子中必须指定空白字符令牌的原因。</div><div class="t m0 x0 h9 y8bd ff1 fs3 fc0 sc0 ls19 ws41f">令牌的顺序也是有影响的。 <span class="ff6 ls0 ws3db">re </span><span class="ws22a">模块会按照指定好的顺序去做匹配<span class="_ _1"></span>。因此，如果一<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y8be ff1 fs3 fc0 sc0 ls0">个模式恰好是另一个更长模式的子字符串，那么你需要确定长模式写在前面。比如：</div><div class="t m0 x5 hf y8bf ff8 fs5 fc0 sc0 ls0 ws159">LT <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;LT&gt;&lt;)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y8c0 ff8 fs5 fc0 sc0 ls0 ws159">LE <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;LE&gt;&lt;=)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y8c1 ff8 fs5 fc0 sc0 ls0 ws159">EQ <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;EQ&gt;=)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y8c2 ff8 fs5 fc0 sc0 ls0 ws2a3">master_pat <span class="fc6 ls32">=</span><span class="ws13a">re<span class="fc6 ls34">.</span>compile(<span class="ff9 fc9 ls34">&apos;<span class="ffd ls0 ws13b">|</span>&apos;<span class="ff8 fc6">.</span></span><span class="ws13b">join([LE, LT, EQ])) <span class="ffa fcd ws4"># Correct</span></span></span></div><div class="t m0 x5 h14 y8c3 ffa fs5 fcd sc0 ls0 ws4"># master_pat = re.compile(<span class="ffb ls34">&apos;</span><span class="ffd ws13b">|<span class="ffb">&apos;</span></span>.join([LT, LE, EQ])) # Incorrect</div><div class="t m0 x0 h7 y8c4 ff1 fs3 fc0 sc0 ls0 wsa0">第二<span class="_ _6"></span>个<span class="_ _6"></span>模式<span class="_ _6"></span>是<span class="_ _6"></span>错<span class="_ _6"></span>的，因<span class="_ _6"></span>为<span class="_ _6"></span>它会<span class="_ _6"></span>将<span class="_ _6"></span>文本<span class="ff12 ws305">&lt;<span class="ff4 lsb4">=</span></span><span class="ws420">匹<span class="_ _6"></span>配<span class="_ _6"></span>为令<span class="_ _6"></span>牌 <span class="ff4 ws421">L<span class="_ _d"></span>T <span class="ff1 ws422">紧跟<span class="_ _6"></span>着 </span><span class="wsa5">EQ<span class="ff1 wsa0">，<span class="_ _6"></span>而不<span class="_ _6"></span>是<span class="_ _6"></span>单<span class="_ _6"></span>独</span></span></span></span></div><div class="t m0 x5 h7 y8c5 ff1 fs3 fc0 sc0 ls0 ws38">的令牌 <span class="ff4 wsa5">LE</span>，这个并不是我们想要的结果。</div><div class="t m0 x0 h9 y674 ff1 fs3 fc0 sc0 ls0">最后，你需要留意下子字符串形式的模式。比如，假设你有如下两个模式：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.18.<span class="_ _5"> </span>2.18 <span class="ff1 ws3ba">字符串令牌解析 </span>69</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
