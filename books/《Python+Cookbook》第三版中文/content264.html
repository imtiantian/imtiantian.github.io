<div id="pf108" class="pf w0 h0" data-page-no="108"><div class="pc pc108 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg108.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf ye9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf yea ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf yeb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">perimeter</span></span></span></div><div class="t m0 x5 hf yec ff8 fs5 fc8 sc0 ls0 ws4">Computing perimeter</div><div class="t m0 x5 hf yed ff8 fs5 fc8 sc0 ls0">25.132741228718345</div><div class="t m0 x5 hf yee ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">perimeter</span></span></span></div><div class="t m0 x5 hf yef ff8 fs5 fc8 sc0 ls0">25.132741228718345</div><div class="t m0 x5 hf yf0 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1c92 ff1 fs3 fc0 sc0 ls0 wsc">仔细观察你会发现消息 <span class="ff6 wsae2">Computing<span class="_ _11"> </span>area </span><span class="ls4">和</span><span class="ff6 ws284">Computing<span class="_ _26"> </span>perimeter </span>仅仅出现一次。</div><div class="t m0 x5 he y1c93 ff2 fs2 fc4 sc0 ls0 wsadf">10.10.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1bdb ff1 fs3 fc0 sc0 ls0 wsa0">很多时候，构造一个延<span class="_ _6"></span>迟计算属性的主要目的是<span class="_ _6"></span>为了提升性能。例如，你可<span class="_ _6"></span>以避免</div><div class="t m0 x5 h9 y1c94 ff1 fs3 fc0 sc0 ls2c ws12f">计算这些属性值，除非你真的需要它们。这里演示的方案就是用来实现这<span class="_ _1"></span>样的效果的，</div><div class="t m0 x5 h9 y1c95 ff1 fs3 fc0 sc0 ls0">只不过它是通过以非常高效的方式使用描述器的一个精妙特性来达到这种效果的。</div><div class="t m0 x0 h7 y1c96 ff1 fs3 fc0 sc0 ls0 wsae3">正如在<span class="_ _6"></span>其他小<span class="_ _6"></span>节 <span class="ff4 wsa5">(</span><span class="ls17b">如</span><span class="ff4 wsae4">8.9 </span><span class="wsa0">小节<span class="ff4 ls17c">)</span><span class="ls2c ws12f">所讲的那样，当一个描述器被放入一个类的定义时，</span></span></div><div class="t m0 x5 h9 yd01 ff1 fs3 fc0 sc0 ls23 wsae5">每次访问属性时它的 <span class="ff6 ls0 wsae6">get<span class="_ _e"> </span>() </span><span class="ls17d">、<span class="ff6 ls0 wsae6">set<span class="_ _e"> </span>() </span><span class="ls17e">和<span class="ff6 ls0 wsae6">delete<span class="_ _e"> </span>() </span></span></span><span class="ws11a">方法就会被触发<span class="_ _c"></span>。不过<span class="_ _1"></span>，<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y1c97 ff1 fs3 fc0 sc0 ls30 wsae7">如果一个描述器仅仅只定义了一个 <span class="ff6 ls0 wsae8">get<span class="_ _e"> </span>() <span class="ff1 wsa0">方<span class="_ _6"></span>法的<span class="_ _6"></span>话，<span class="_ _6"></span>它<span class="_ _6"></span>比通<span class="_ _6"></span>常<span class="_ _6"></span>的具<span class="_ _6"></span>有<span class="_ _6"></span>更<span class="_ _6"></span>弱的<span class="_ _6"></span>绑<span class="_ _6"></span>定。</span></span></div><div class="t m0 x5 h9 y1c98 ff1 fs3 fc0 sc0 ls0 ws911">特别地，只有当被访问属性不在实例底层的字典中时 <span class="ff6 ws308">get<span class="_ _e"> </span>() </span>方法才会被触发。</div><div class="t m0 x0 h9 yefb ff6 fs3 fc0 sc0 ls0 wsae9">lazyproperty <span class="ff1 wsaea">类利用这一点，使用 </span><span class="wsaeb">get<span class="_ _e"> </span>() <span class="ff1 wsa0">方法在实例中存储计算出来的值，<span class="_ _c"></span>这</span></span></div><div class="t m0 x5 h7 y1c99 ff1 fs3 fc0 sc0 ls0 wsaec">个<span class="_ _6"></span>实例<span class="_ _6"></span>使<span class="_ _6"></span>用<span class="_ _6"></span>相<span class="_ _6"></span>同<span class="_ _6"></span>的<span class="_ _6"></span>名<span class="_ _6"></span>字作<span class="_ _6"></span>为<span class="_ _6"></span>它<span class="_ _6"></span>的 <span class="ff4 wsa5">prop<span class="_ _6"></span>erty</span><span class="wsa0">。这<span class="_ _6"></span>样<span class="_ _6"></span>一<span class="_ _6"></span>来，结<span class="_ _6"></span>果<span class="_ _6"></span>值<span class="_ _6"></span>被<span class="_ _6"></span>存<span class="_ _6"></span>储<span class="_ _6"></span>在<span class="_ _6"></span>实例<span class="_ _6"></span>字<span class="_ _6"></span>典<span class="_ _6"></span>中<span class="_ _6"></span>并</span></div><div class="t m0 x5 h7 y1c9a ff1 fs3 fc0 sc0 ls0 ws38">且以后就不需要再去计算这个 <span class="ff4 wsa75">prop<span class="_ _6"></span>ert<span class="_ _1"></span>y <span class="ff1">了。你可以尝试更深入的例子来观察结果：</span></span></div><div class="t m0 x5 hf y1c9b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">Circle(<span class="fc7">4.0</span>)</span></span></div><div class="t m0 x5 h11 y1c9c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Get instance variables</span></div><div class="t m0 x5 hf y1c9d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">vars<span class="fc0">(c)</span></span></div><div class="t m0 x5 hf y1c9e ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">radius</span><span class="ff9">&apos;</span><span class="ls0 ws13b">: 4.0}</span></div><div class="t m0 x5 h11 y1c9f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Compute area and observe variables afterward</span></div><div class="t m0 x5 hf y1ca0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y16f4 ff8 fs5 fc8 sc0 ls0 ws4">Computing area</div><div class="t m0 x5 hf y16f5 ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf y16f6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">vars<span class="fc0">(c)</span></span></div><div class="t m0 x5 hf y16f7 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">area</span><span class="ff9">&apos;</span><span class="ls0 ws71d">: 50.26548245743669, </span><span class="ff9">&apos;</span><span class="ls0 ws13a">radius</span><span class="ff9">&apos;</span><span class="ls0 ws4">: 4.0}</span></div><div class="t m0 x5 h11 y1ca1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Notice access doesn<span class="ffb ls34">&apos;</span>t invoke property anymore</span></div><div class="t m0 x5 hf y1ca2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y16a7 ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 h11 y16fc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Delete the variable and see property trigger again</span></div><div class="t m0 x5 hf y16fd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">del <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></span></div><div class="t m0 x5 hf y1443 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">vars<span class="fc0">(c)</span></span></div><div class="t m0 x5 hf y16fe ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">radius</span><span class="ff9">&apos;</span><span class="ls0 ws13b">: 4.0}</span></div><div class="t m0 x5 hf y1ca3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y1ca4 ff8 fs5 fc8 sc0 ls0 ws4">Computing area</div><div class="t m0 x5 hf y1ca5 ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf y1ca6 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.10.<span class="_ _5"> </span>8.10 <span class="ff1 wsae1">使用延迟计算属性 </span>255</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
