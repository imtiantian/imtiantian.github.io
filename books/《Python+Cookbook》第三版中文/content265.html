<div id="pf109" class="pf w0 h0" data-page-no="109"><div class="pc pc109 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg109.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0">这种方案有一个小缺陷就是计算出的值被创建后是可以被修改的。例如：</div><div class="t m0 x5 hf y1ca7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y1ca8 ff8 fs5 fc8 sc0 ls0 ws4">Computing area</div><div class="t m0 x5 hf y1ca9 ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf y1caa ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0 ws13c">area </span><span class="ls32">=</span><span class="fc7">25</span></span></span></div><div class="t m0 x5 hf y1cab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y1cac ff8 fs5 fc8 sc0 ls0">25</div><div class="t m0 x5 hf y1cad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1cae ff1 fs3 fc0 sc0 ls0">如果你担心这个问题，那么可以使用一种稍微没那么高效的实现，就像下面这样：</div><div class="t m0 x5 hf y1caf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">lazyproperty<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y1cb0 ff8 fs5 fc0 sc0 ls0 ws13c">name <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">_lazy_<span class="ff9 ls33">&apos;</span><span class="fc6 ls32">+</span><span class="fc0">func<span class="fc6 ls34">.</span>__name__</span></span></div><div class="t m0 x15 h10 y1cb1 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf y1cb2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">lazy<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1cb3 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">hasattr<span class="fc0 ls34">(</span>self<span class="fc0 ws13b">, name):</span></span></div><div class="t m0 x17 hf y1cb4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">getattr<span class="fc0 ls34">(</span>self<span class="fc0 ws13b">, name)</span></span></div><div class="t m0 x16 hf y1cb5 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1cb6 ff8 fs5 fc0 sc0 ls0 ws15f">value <span class="fc6 ls33">=</span><span class="ws13a">func(<span class="fca">self</span>)</span></div><div class="t m0 x17 hf y1cb7 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ls34">(</span>self<span class="fc0 ws4">, name, value)</span></div><div class="t m0 x17 hf y1cb8 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">value</span></div><div class="t m0 x15 hf y1cb9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">lazy</span></div><div class="t m0 x0 h9 y1cba ff1 fs3 fc0 sc0 ls0">如果你使用这个版本，就会发现现在修改操作已经不被允许了：</div><div class="t m0 x5 hf y1cbb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">Circle(<span class="fc7">4.0</span>)</span></span></div><div class="t m0 x5 hf y1cbc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y1cbd ff8 fs5 fc8 sc0 ls0 ws4">Computing area</div><div class="t m0 x5 hf y1cbe ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf y1222 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">area</span></span></span></div><div class="t m0 x5 hf y1cbf ff8 fs5 fc8 sc0 ls0">50.26548245743669</div><div class="t m0 x5 hf y46 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0 ws13c">area </span><span class="ls32">=</span><span class="fc7">25</span></span></span></div><div class="t m0 x5 hf y1cc0 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1cc1 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y141c ff8 fs5 fc2 sc0 ls0 ws13a">AttributeError<span class="fc0 ws4">: can<span class="ff9 ls34">&apos;</span><span class="ws13b">t set attribute</span></span></div><div class="t m0 x5 hf y1cc2 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1cc3 ff1 fs3 fc0 sc0 ls0 wsaed">然而，<span class="_ _6"></span>这种方<span class="_ _6"></span>案有<span class="_ _6"></span>一个<span class="_ _6"></span>缺点就<span class="_ _6"></span>是所<span class="_ _6"></span>有 <span class="ff4 wsaee">get </span><span class="wsaef">操作<span class="_ _6"></span>都必须<span class="_ _6"></span>被定<span class="_ _6"></span>向到<span class="_ _6"></span>属性的 <span class="ff6 ws66c">getter </span><span class="wsa0">函<span class="_ _6"></span>数</span></span></div><div class="t m0 x5 h9 y1cc4 ff1 fs3 fc0 sc0 ls13 wse5">上去<span class="_ _1"></span>。这个跟之前简单的在实例字典中查找值的方案相比效率要低一点。如果想获取<span class="_ _c"></span></div><div class="t m0 x5 h7 y1cc5 ff1 fs3 fc0 sc0 ls0 wsaf0">更多<span class="_ _6"></span>关于 <span class="ff4 wsaf1">prop<span class="_ _6"></span>erty </span><span class="ls12 wsaf2">和可管理属性的信息<span class="_ _1"></span>，可以参考 <span class="ff4 ls0 wsaf3">8.6 </span><span class="wse4">小节。而描述器的相关内容可<span class="_ _1"></span></span></span></div><div class="t m0 x5 h7 y1cc6 ff1 fs3 fc0 sc0 ls0 ws14">以在 <span class="ff4 ws2b4">8.9 </span>小节找到。</div><div class="t m0 x5 hd y1cc7 ff2 fs4 fc4 sc0 ls0 ws211">10.11<span class="_ _e"> </span>8.11 <span class="ff1">简化数据结构的初始化</span></div><div class="t m0 x5 he y1cc8 ff2 fs2 fc4 sc0 ls0 wsadf">10.11.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1cc9 ff1 fs3 fc0 sc0 ls0 ws9d6">你写了很多仅仅用作数据结构的类，不想写太多烦人的 <span class="ff6 ws308">init<span class="_ _e"> </span>() </span>函数</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.11.<span class="_ _5"> </span>8.11 <span class="ff1 wsaf4">简化数据结构的初始化 </span>256</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
