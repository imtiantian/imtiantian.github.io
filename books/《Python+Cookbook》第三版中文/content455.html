<div id="pf1c7" class="pf w0 h0" data-page-no="1c7"><div class="pc pc1c7 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1c7.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y181 ffa fs5 fcd sc0 ls0 ws4"># Wait for the thread to start</div><div class="t m0 x5 hf y182 ff8 fs5 fc0 sc0 ls0 ws13a">started_evt<span class="fc6 ls34">.</span>wait()</div><div class="t m0 x5 hf y183 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">countdown is running<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h7 y2dcd ff1 fs3 fc0 sc0 ls0 wsa0">当你执行这段代码，<span class="_ _3"></span>“<span class="ff4 ws1077">countdo<span class="_ _c"></span>wn is running<span class="ff1 ls35 ws144">”总是显示在“</span><span class="ws1078">countdo<span class="_ _c"></span>wn starting<span class="ff1 wsa0">”之</span></span></span></div><div class="t m0 x5 h7 y2dce ff1 fs3 fc0 sc0 ls0 ws1079">后显<span class="_ _6"></span>示。<span class="_ _6"></span>这是<span class="_ _6"></span>由<span class="_ _6"></span>于使<span class="_ _6"></span>用 <span class="ff4 ws107a">ev<span class="_ _1"></span>ent <span class="ff1 ws107b">来协调<span class="_ _6"></span>线<span class="_ _6"></span>程，使<span class="_ _6"></span>得<span class="_ _6"></span>主线<span class="_ _6"></span>程<span class="_ _6"></span>要等<span class="_ _6"></span>到 <span class="ff6 ws107c">countdown() </span><span class="wsa0">函数<span class="_ _6"></span>输<span class="_ _6"></span>出</span></span></span></div><div class="t m0 x5 h9 y2dcf ff1 fs3 fc0 sc0 ls0">启动信息后，才能继续执行。</div><div class="t m0 x5 he y2dd0 ff2 fs2 fc4 sc0 ls0 ws212">14.2.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y140 ff4 fs3 fc0 sc0 ls0 ws107d">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 ws107e">对<span class="_ _6"></span>象最<span class="_ _6"></span>好<span class="_ _6"></span>单<span class="_ _6"></span>次使<span class="_ _6"></span>用，<span class="_ _6"></span>就是<span class="_ _6"></span>说，<span class="_ _6"></span>你<span class="_ _6"></span>创建<span class="_ _6"></span>一<span class="_ _6"></span>个 </span>ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 wsa0">对<span class="_ _6"></span>象，让<span class="_ _6"></span>某<span class="_ _6"></span>个<span class="_ _6"></span>线程<span class="_ _6"></span>等<span class="_ _6"></span>待<span class="_ _6"></span>这个</span></div><div class="t m0 x5 h9 y2dd1 ff1 fs3 fc0 sc0 ls12 wsb6d">对象，一旦这个对象被设置<span class="_ _1"></span>为真，你就应该丢弃它<span class="_ _1"></span>。尽管可以通过 <span class="ff6 ls0 wsb6e">clear() <span class="ff1 wsa0">方法<span class="_ _6"></span>来<span class="_ _6"></span>重</span></span></div><div class="t m0 x5 h7 y17f0 ff1 fs3 fc0 sc0 ls8f">置<span class="ff4 ls0 ws107f">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 ws1080">对象，但是很难确保安全地清理 </span><span class="ws1081">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 wsa0">对象并对它重新赋值。很可能会发生错</span></span></span></div><div class="t m0 x5 h7 y2dd2 ff1 fs3 fc0 sc0 ls0 ws1082">过<span class="_ _6"></span>事<span class="_ _6"></span>件、<span class="_ _6"></span>死<span class="_ _6"></span>锁<span class="_ _6"></span>或者<span class="_ _6"></span>其<span class="_ _6"></span>他<span class="_ _6"></span>问<span class="_ _6"></span>题<span class="_ _6"></span>（特<span class="_ _6"></span>别<span class="_ _6"></span>是，<span class="_ _6"></span>你<span class="_ _6"></span>无<span class="_ _6"></span>法<span class="_ _6"></span>保<span class="_ _6"></span>证<span class="_ _6"></span>重<span class="_ _6"></span>置 <span class="ff4 ws1083">ev<span class="_ _1"></span>ent <span class="ff1 ls14 ws174">对象的代码<span class="_ _1"></span>会在线程再</span></span></div><div class="t m0 x5 h7 y2dd3 ff1 fs3 fc0 sc0 ls68 ws1084">次等待这个 <span class="ff4 ls0 ws1085">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 ls68 ws1086">对象之前执行）<span class="_ _f"></span>。如果一个线程需要不停地重复使用 <span class="ff4 ls0 ws1085">ev<span class="_ _c"></span>ent <span class="ff1 wsa0">对象，你</span></span></span></span></div><div class="t m0 x5 h9 y2dd4 ff1 fs3 fc0 sc0 ls0 ws1087">最好使用 <span class="ff6 ws721">Condition </span><span class="ls51 ws1088">对象来代替。下面的代码使用 </span><span class="ff6 ws721">Condition </span><span class="ls51 ws1c8">对象实现了一个周期定</span></div><div class="t m0 x5 h9 y2dd5 ff1 fs3 fc0 sc0 ls0">时器，每当定时器超时的时候，其他线程都可以监测到：</div><div class="t m0 x5 h10 y2dd6 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">threading</span></div><div class="t m0 x5 h10 y2dd7 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y2dd8 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">PeriodicTimer<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2dd9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, interval):</span></span></span></div><div class="t m0 x16 hf y2dda ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws51e">_interval </span><span class="ls32">=</span><span class="fc0">interval</span></span></div><div class="t m0 x16 hf y2ddb ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_flag </span><span class="ls32">=</span><span class="fc7">0</span></span></div><div class="t m0 x16 hf y2ddc ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws158">_cv </span><span class="ls33">=</span><span class="fc0">threading</span><span class="ls34">.</span><span class="fc0">Condition()</span></span></div><div class="t m0 x15 hf y2ddd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">start<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y2719 ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">threading<span class="fc6 ls34">.</span>Thread(target<span class="fc6 ls34">=</span><span class="fca">self<span class="fc6 ls34">.</span></span>run)</span></div><div class="t m0 x16 hf y271a ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws145">daemon <span class="fc6 ls33">=</span><span class="fca">True</span></span></div><div class="t m0 x16 hf y2dde ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x15 hf y2ddf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y2de0 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y2de1 ffa fs5 fc9 sc0 ls0 ws4">Run the timer and notify waiting threads after each interval</div><div class="t m0 x16 h15 y2de2 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y2de3 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x17 hf y2de4 ff8 fs5 fc0 sc0 ls0 ws13a">time<span class="fc6">.</span>sleep(<span class="fca">self<span class="fc6">.</span></span>_interval)</div><div class="t m0 x17 hf y2de5 ff7 fs5 fca sc0 ls0 ws218">with <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_cv:</span></span></div><div class="t m0 x41 hf y2de6 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws15f">_flag <span class="fc6 ws1a1">^= <span class="fc7">1</span></span></span></div><div class="t m0 x41 hf y2de7 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_cv<span class="fc6 ls34">.</span>notify_all()</span></div><div class="t m0 x15 hf y2de8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wait_for_tick<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y2de9 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y2dea ffa fs5 fc9 sc0 ls0 ws4">Wait for the next tick of the timer</div><div class="t m0 x16 h15 y2deb ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y2dec ff7 fs5 fca sc0 ls0 ws218">with <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_cv:</span></span></div><div class="t m0 x17 hf y2ded ff8 fs5 fc0 sc0 ls0 ws16e">last_flag <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>_flag</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">14.2.<span class="_ _36"> </span>12.2 <span class="ff1 ws509">判断线程是否已经启动 </span>446</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
