<div id="pf245" class="pf w0 h0" data-page-no="245"><div class="pc pc245 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg245.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls0 ws4">%extend Point {</div><div class="t m0 x15 hf y1ac ff8 fs5 fc0 sc0 ls0 ws4">/* Constructor for Point objects */</div><div class="t m0 x15 hf y1ad ff8 fs5 fc0 sc0 ls0 ws4">Point(double x, double y) {</div><div class="t m0 x16 hf y1ae ff8 fs5 fc0 sc0 ls0 ws4">Point *p = (Point *) malloc(sizeof(Point));</div><div class="t m0 x16 hf y1af ff8 fs5 fc0 sc0 ls0 ws13b">p-&gt;x = x;</div><div class="t m0 x16 hf y1b0 ff8 fs5 fc0 sc0 ls0 ws13b">p-&gt;y = y;</div><div class="t m0 x16 hf y355 ff8 fs5 fc0 sc0 ls0 ws13b">return p;</div><div class="t m0 x3c hf y410 ff8 fs5 fc0 sc0 ls0">};</div><div class="t m0 x5 hf y411 ff8 fs5 fc0 sc0 ls0">};</div><div class="t m0 x5 hf y8c6 ff8 fs5 fc0 sc0 ls0 ws4">/* Map int *remainder as an output argument */</div><div class="t m0 x5 hf ybed ff8 fs5 fc0 sc0 ls0 ws4">%include typemaps.i</div><div class="t m0 x5 hf ybee ff8 fs5 fc0 sc0 ls0 ws4">%apply int *OUTPUT { int * remainder };</div><div class="t m0 x5 hf ybf0 ff8 fs5 fc0 sc0 ls0 ws4">/* Map the argument pattern (double *a, int n) to arrays */</div><div class="t m0 x5 hf yd7d ff8 fs5 fc0 sc0 ls0 ws4">%typemap(in) (double *a, int n)(Py_buffer view) {</div><div class="t m0 x19 hf ybf1 ff8 fs5 fc0 sc0 ls0 ws4">view.obj = NULL;</div><div class="t m0 x19 hf ybf2 ff8 fs5 fc0 sc0 ls0 ws4">if (PyObject_GetBuffer($input, &amp;view, PyBUF_ANY_CONTIGUOUS <span class="ffd lsbd">|</span>PyBUF_FORMAT) == -1) {</div><div class="t m0 x15 hf ybf3 ff8 fs5 fc0 sc0 ls0">SWIG_fail;</div><div class="t m0 x19 hf ybf4 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf ybf5 ff8 fs5 fc0 sc0 ls0 ws4">if (strcmp(view.format,&quot;d&quot;) != 0) {</div><div class="t m0 x15 hf ybf6 ff8 fs5 fc0 sc0 ls0 ws4">PyErr_SetString(PyExc_TypeError, &quot;Expected an array of doubles&quot;);</div><div class="t m0 x15 hf ybf7 ff8 fs5 fc0 sc0 ls0">SWIG_fail;</div><div class="t m0 x19 hf ybf8 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf ybf9 ff8 fs5 fc0 sc0 ls0 ws4">$1 = (double *) view.buf;</div><div class="t m0 x19 hf ybfa ff8 fs5 fc0 sc0 ls0 ws4">$2 = view.len / sizeof(double);</div><div class="t m0 x5 hf ybfb ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y1ed7 ff8 fs5 fc0 sc0 ls0 ws4">%typemap(freearg) (double *a, int n) {</div><div class="t m0 x19 hf y1ed8 ff8 fs5 fc0 sc0 ls0 ws4">if (view$argnum.obj) {</div><div class="t m0 x15 hf y1f83 ff8 fs5 fc0 sc0 ls0">PyBuffer_Release(&amp;view$argnum);</div><div class="t m0 x19 hf y1ed9 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y1eda ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y1f84 ff8 fs5 fc0 sc0 ls0 ws4">/* C declarations to be included in the extension module */</div><div class="t m0 x5 hf y1edc ff8 fs5 fc0 sc0 ls0 ws4">extern int gcd(int, int);</div><div class="t m0 x5 hf y1edd ff8 fs5 fc0 sc0 ls0 ws4">extern int in_mandel(double x0, double y0, int n);</div><div class="t m0 x5 hf y1ede ff8 fs5 fc0 sc0 ls0 ws4">extern int divide(int a, int b, int *remainder);</div><div class="t m0 x5 hf y1edf ff8 fs5 fc0 sc0 ls0 ws4">extern double avg(double *a, int n);</div><div class="t m0 x5 hf y2516 ff8 fs5 fc0 sc0 ls0 ws4">typedef struct Point {</div><div class="t m0 x15 hf y1ee1 ff8 fs5 fc0 sc0 ls0 ws13b">double x,y;</div><div class="t m0 x5 hf y1ee2 ff8 fs5 fc0 sc0 ls0 ws4">} Point;</div><div class="t m0 x5 hf y1f85 ff8 fs5 fc0 sc0 ls0 ws4">extern double distance(Point *p1, Point *p2);</div><div class="t m0 x0 h7 y37d8 ff1 fs3 fc0 sc0 ls0 ws38">一旦你写好了接口文件，就可以在命令行工具中调用 <span class="ff4 ws146c">Swig </span>了：</div><div class="t m0 x5 hf y37d9 ff8 fs5 fc0 sc0 ls0 ws4">bash % swig -python -py3 sample.i</div><div class="t m0 x5 hf y37da ff8 fs5 fc0 sc0 ls0 ws4">bash %</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.9.<span class="_ _36"> </span>15.9 <span class="ff1 ls81">用</span><span class="ws146a">WSIG <span class="ff1 ws16b">包装 </span><span class="ls246">C</span><span class="ff1 ws146b">代码 </span>572</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
