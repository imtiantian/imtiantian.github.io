<div id="pf139" class="pf w0 h0" data-page-no="139"><div class="pc pc139 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg139.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf ya0f ff8 fs5 fc8 sc0 ls0 ws4">countdown 0.008917808532714844</div><div class="t m0 x5 hf ya10 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__name__</span></div><div class="t m0 x5 hf ya11 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">countdown<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf ya12 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__doc__</span></div><div class="t m0 x5 hf y20f8 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">\n\tCounts down\n\t<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y20f9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__annotations__</span></div><div class="t m0 x5 hf y20fa ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span>n<span class="ff9">&apos;</span><span class="ls0 ws13b">: &lt;class </span><span class="ff9">&apos;</span><span class="ls0 ws13a">int</span><span class="ff9">&apos;</span><span class="ls0">&gt;}</span></div><div class="t m0 x5 hf y20fb ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y20fc ff2 fs2 fc4 sc0 ls0 ws212">11.2.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1525 ff1 fs3 fc0 sc0 ls6d ws2a0">在编写装饰器的时候复制元信息是一个非常重要的部分<span class="_ _8"></span>。如果你忘记了使用<span class="_ _8"></span></div><div class="t m0 x5 h9 y20fd ff6 fs3 fc0 sc0 ls0 wsba7">@wraps <span class="ff1 ls18c wsba8">，那么你会发现被装饰函数丢失了所有有用的信息<span class="_ _d"></span>。比如如果忽略 <span class="ff6 ls0">@wraps</span></span></div><div class="t m0 x5 h9 y20fe ff1 fs3 fc0 sc0 ls0">后的效果是下面这样的：</div><div class="t m0 x5 hf y20ff ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__name__</span></div><div class="t m0 x5 hf y2100 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">wrapper<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y2101 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__doc__</span></div><div class="t m0 x5 hf y2102 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__annotations__</span></div><div class="t m0 x5 hf y2103 ff8 fs5 fc8 sc0 ls0">{}</div><div class="t m0 x5 hf y2104 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2105 ff6 fs3 fc0 sc0 ls0 wsba9">@wraps <span class="ff1 wsbaa">有一个重要特征是它能让你通过属性 </span><span class="wsbab">wrapped <span class="ff1 wsa0">直接访问被包装函数。例</span></span></div><div class="t m0 x5 h7 y2106 ff1 fs3 fc0 sc0 lsb">如<span class="ff4 ls0">:</span></div><div class="t m0 x5 hf y2107 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__wrapped__(<span class="fc7">100000</span>)</span></div><div class="t m0 x5 hf y2108 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x31 h9 y1a22 ff6 fs3 fc0 sc0 ls0 wsb1d">wrapped <span class="ff1">属性还能让被装饰函数正确暴露底层的参数签名信息。例如：</span></div><div class="t m0 x5 hf y8b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws2f0">inspect </span><span class="ws146">import <span class="ff8 fc0">signature</span></span></span></div><div class="t m0 x5 hf y2109 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0">(signature(countdown))</span></span></div><div class="t m0 x5 hf y66 ff8 fs5 fc8 sc0 ls0">(n:int)</div><div class="t m0 x5 hf y210a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1a73 ff1 fs3 fc0 sc0 ls3a ws153">一个很普遍的问题是怎样让装饰器去直接复制原始函数的参数签名信息，如果想自</div><div class="t m0 x5 h9 y210b ff1 fs3 fc0 sc0 ls3a wsbac">己手动实现的话需要做大量的工作，最好就简单的使用 <span class="ff6 ls0 wsbad">wrapped <span class="ff1 wsa0">装饰器。通过底层</span></span></div><div class="t m0 x5 h7 y210c ff1 fs3 fc0 sc0 ls17a">的<span class="ff6 ls0 wsbae">wrapped </span><span class="ls0 ws63">属性访问到函数签名信息。更多关于签名的内容可以参考 <span class="ff4 ws1d0">9.16 </span>小节。</span></div><div class="t m0 x5 hd y210d ff2 fs4 fc4 sc0 ls0 ws9c6">11.3<span class="_ _e"> </span>9.3 <span class="ff1">解除一个装饰器</span></div><div class="t m0 x5 he y210e ff2 fs2 fc4 sc0 ls0 ws212">11.3.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y210f ff1 fs3 fc0 sc0 ls3a ws153">一个装饰器已经作用在一个函数上，你想撤销它，直接访问原始的未包装的那个函</div><div class="t m0 x5 h9 y1212 ff1 fs3 fc0 sc0 ls0">数。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.3.<span class="_ _5"> </span>9.3 <span class="ff1 ws3ba">解除一个装饰器 </span>304</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
