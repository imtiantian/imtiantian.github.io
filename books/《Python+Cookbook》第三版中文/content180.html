<div id="pfb4" class="pf w0 h0" data-page-no="b4"><div class="pc pcb4 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgb4.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff8 fs5 fc0 sc0 ls0">]</div><div class="t m0 x5 hf y1ad ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">stocks.csv<span class="ff9 ls34">&apos;</span></span><span class="ls34">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">w<span class="ff9">&apos;</span></span></span><span class="ls32">)</span></span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y1ae ff8 fs5 fc0 sc0 ls0 ws15f">f_csv <span class="fc6 ls33">=</span><span class="ws13a">csv<span class="fc6 ls34">.</span><span class="ws13b">DictWriter(f, headers)</span></span></div><div class="t m0 x15 hf y1af ff8 fs5 fc0 sc0 ls0 ws13a">f_csv<span class="fc6">.</span>writeheader()</div><div class="t m0 x15 hf y1b0 ff8 fs5 fc0 sc0 ls0 ws13a">f_csv<span class="fc6">.</span>writerows(rows)</div><div class="t m0 x5 he y1381 ff2 fs2 fc4 sc0 ls0 ws135">8.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y1382 ff1 fs3 fc0 sc0 ls17 ws779">你应该总是优先选择 <span class="ff4 ls0 ws77a">csv </span><span class="ws77b">模块分割或解析 <span class="ff4 ls0 ws77c">CSV </span><span class="wsf6">数据。例如<span class="_ _c"></span>，你可能会像编写类似</span></span></div><div class="t m0 x5 h9 y1383 ff1 fs3 fc0 sc0 ls0">下面这样的代码：</div><div class="t m0 x5 hf y1384 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">stocks.csv<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x5 hf y1385 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13c">line </span><span class="ws157">in <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y1386 ff8 fs5 fc0 sc0 ls0 ws158">row <span class="fc6 ls32">=</span><span class="ws13a">line<span class="fc6 ls34">.</span>split(<span class="ff9 fc9 ls34">&apos;<span class="ff8">,</span><span class="ls0 ws13b">&apos;</span></span>)</span></div><div class="t m0 x15 h11 y1387 ffa fs5 fcd sc0 ls0 ws13b"># process row</div><div class="t m0 x15 hf y1388 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 y1389 ff1 fs3 fc0 sc0 ls3a ws153">使用这种方式的一个缺点就是你仍然需要去处理一些棘手的细节问题。比如，如果</div><div class="t m0 x5 h9 y138a ff1 fs3 fc0 sc0 ls0 wsa0">某<span class="_ _6"></span>些字<span class="_ _6"></span>段<span class="_ _6"></span>值<span class="_ _6"></span>被<span class="_ _6"></span>引<span class="_ _6"></span>号包<span class="_ _6"></span>围，<span class="_ _6"></span>你<span class="_ _6"></span>不<span class="_ _6"></span>得<span class="_ _6"></span>不去<span class="_ _6"></span>除<span class="_ _6"></span>这<span class="_ _6"></span>些<span class="_ _6"></span>引<span class="_ _6"></span>号。<span class="_ _6"></span>另外，<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _6"></span>被引<span class="_ _6"></span>号<span class="_ _6"></span>包<span class="_ _6"></span>围<span class="_ _6"></span>的<span class="_ _6"></span>字段</div><div class="t m0 x5 h9 y138b ff1 fs3 fc0 sc0 ls0">碰巧含有一个逗号，那么程序就会因为产生一个错误大小的行而出错。</div><div class="t m0 x0 h7 y138c ff1 fs3 fc0 sc0 ls0 wsa0">默认情<span class="_ _6"></span>况下，<span class="ff6 ws77d">csv </span><span class="ls2c ws77e">库可识别 </span><span class="ff4 ws77f">Microsoft Excel </span><span class="ls2c ws77e">所使用的 </span><span class="ff4 ws766">CSV </span><span class="ls2c ws12f">编码规则。这或许也是</span></div><div class="t m0 x5 h7 yf7e ff1 fs3 fc0 sc0 ls1e ws780">最常见的形式<span class="_ _1"></span>，并且也会给你带来最好的兼容性。然而<span class="_ _c"></span>，如<span class="_ _6"></span>果你查看 <span class="ff4 ls0 ws781">csv <span class="ff1 wsa0">的文<span class="_ _6"></span>档，<span class="_ _6"></span>就</span></span></div><div class="t m0 x5 h7 y138d ff1 fs3 fc0 sc0 ls0 ws782">会发<span class="_ _6"></span>现<span class="_ _6"></span>有<span class="_ _6"></span>很多<span class="_ _6"></span>种<span class="_ _6"></span>方<span class="_ _6"></span>法将<span class="_ _6"></span>它<span class="_ _6"></span>应用<span class="_ _6"></span>到<span class="_ _6"></span>其<span class="_ _6"></span>他编<span class="_ _6"></span>码<span class="_ _6"></span>格式<span class="_ _6"></span>上 <span class="ff4 wsa5">(</span><span class="wsa0">如<span class="_ _6"></span>修<span class="_ _6"></span>改分<span class="_ _6"></span>割<span class="_ _6"></span>字符<span class="_ _6"></span>等<span class="ff4 ls1b">)</span>。<span class="_ _6"></span>例<span class="_ _6"></span>如，如<span class="_ _6"></span>果<span class="_ _6"></span>你</span></div><div class="t m0 x5 h7 yf80 ff1 fs3 fc0 sc0 ls0 ws14">想读取以 <span class="ff4 ws783">tab </span>分割的数据，可以这样做：</div><div class="t m0 x5 h11 y138e ffa fs5 fcd sc0 ls0 ws4"># Example of reading tab-separated values</div><div class="t m0 x5 hf y138f ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">stock.tsv<span class="ff9 ws13b">&apos;</span></span><span class="ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y1390 ff8 fs5 fc0 sc0 ls0 ws15f">f_tsv <span class="fc6 ls33">=</span><span class="ws13a">csv<span class="fc6 ls34">.</span><span class="ws13b">reader(f, delimiter<span class="fc6 ls34">=<span class="ff9 fc9">&apos;<span class="ff7 ls0 ws156">\t</span>&apos;</span></span>)</span></span></div><div class="t m0 x15 hf y1391 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws158">row </span><span class="ws157">in <span class="ff8 fc0">f_tsv:</span></span></div><div class="t m0 x16 h11 y1392 ffa fs5 fcd sc0 ls0 ws13b"># Process row</div><div class="t m0 x16 hf y1393 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h7 y1394 ff1 fs3 fc0 sc0 ls0 ws784">如果<span class="_ _6"></span>你正<span class="_ _6"></span>在读<span class="_ _6"></span>取 <span class="ff4 ws77c">CSV </span><span class="ls42 ws186">数据并将它们转换为命名元组，需要注意对列名进行合法性<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y1395 ff1 fs3 fc0 sc0 ls0 ws14">认证。例如，一个 <span class="ff4 ws5d">CSV </span>格式文件有一个包含非法标识符的列头行，类似下面这样：</div><div class="t m0 x5 hf y1396 ff8 fs5 fc0 sc0 ls0 ws4">StreetAddress,Num-Premises,Latitude,Longitude 5412NCLARK,10,41.980262,-87.668452</div><div class="t m0 x0 h9 y1397 ff1 fs3 fc0 sc0 ls18 ws785">这样最终会导致在创建一个命名元组时产生一个 <span class="ff6 ls0 ws141">ValueError </span><span class="ws110">异常而失败。为了解</span></div><div class="t m0 x5 h9 y1398 ff1 fs3 fc0 sc0 ls0 wsa0">决<span class="_ _6"></span>这问<span class="_ _6"></span>题，<span class="_ _6"></span>你<span class="_ _6"></span>可<span class="_ _6"></span>能<span class="_ _6"></span>不得<span class="_ _6"></span>不<span class="_ _6"></span>先<span class="_ _6"></span>去<span class="_ _6"></span>修<span class="_ _6"></span>正列<span class="_ _6"></span>标<span class="_ _6"></span>题。<span class="_ _6"></span>例<span class="_ _6"></span>如，<span class="_ _6"></span>可<span class="_ _6"></span>以像<span class="_ _6"></span>下<span class="_ _6"></span>面<span class="_ _6"></span>这<span class="_ _6"></span>样<span class="_ _6"></span>在非<span class="_ _6"></span>法<span class="_ _6"></span>标<span class="_ _6"></span>识<span class="_ _6"></span>符<span class="_ _6"></span>上使</div><div class="t m0 x5 h9 y1399 ff1 fs3 fc0 sc0 ls0">用一个正则表达式替换：</div><div class="t m0 x5 h10 y139a ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">re</span></div><div class="t m0 x5 hf y139b ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">stock.csv<span class="ff9 ws13b">&apos;</span></span><span class="ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y139c ff8 fs5 fc0 sc0 ls0 ws15f">f_csv <span class="fc6 ls33">=</span><span class="ws13a">csv<span class="fc6 ls34">.</span>reader(f)</span></div><div class="t m0 x15 hf y139d ff8 fs5 fc0 sc0 ls0 ws155">headers <span class="fc6 ls32">=</span><span class="ws4">[ re<span class="fc6 ls34">.</span><span class="ws13a">sub(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">[^a-zA-Z_]<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">_<span class="ff9 ls34">&apos;</span></span></span>, h) <span class="ff7 fca ws139">for </span><span class="ls32">h</span><span class="ff7 fca ws157">in <span class="ff8 ws13a">next</span></span>(f_csv) ]</span></div><div class="t m0 x15 hf y139e ff8 fs5 fc0 sc0 ls0 ws158">Row <span class="fc6 ls32">=</span><span class="ws13a">namedtuple(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Row<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, headers)</span></span></div><div class="t m0 x15 hf y139f ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">r</span><span class="ws157">in <span class="ff8 fc0">f_csv:</span></span></div><div class="t m0 x16 hf y13a0 ff8 fs5 fc0 sc0 ls0 ws158">row <span class="fc6 ls32">=</span><span class="ws13a">Row(<span class="fc6 ls34">*</span>r)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.1.<span class="_ _5"> </span>6.1 <span class="ff1 ws16b">读写 </span><span class="ws777">CSV <span class="ff1 ws778">数据 </span>171</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
