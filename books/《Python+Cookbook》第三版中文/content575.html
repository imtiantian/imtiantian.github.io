<div id="pf23f" class="pf w0 h0" data-page-no="23f"><div class="pc pc23f w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg23f.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y3746 ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x5 hf y3747 ff8 fs5 fc0 sc0 ls0 ws4">/* Load a symbol from a module */</div><div class="t m0 x5 hf y3748 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *import_name(const char *modname, const char *symbol) {</div><div class="t m0 x19 hf y3749 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *u_name, *module;</div><div class="t m0 x19 hf y374a ff8 fs5 fc0 sc0 ls0 ws4">u_name = PyUnicode_FromString(modname);</div><div class="t m0 x19 hf y374b ff8 fs5 fc0 sc0 ls0 ws4">module = PyImport_Import(u_name);</div><div class="t m0 x19 hf y374c ff8 fs5 fc0 sc0 ls0">Py_DECREF(u_name);</div><div class="t m0 x19 hf y374d ff8 fs5 fc0 sc0 ls0 ws4">return PyObject_GetAttrString(module, symbol);</div><div class="t m0 x5 hf y374e ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y374f ff8 fs5 fc0 sc0 ls0 ws4">/* Simple embedding example */</div><div class="t m0 x5 hf y3750 ff8 fs5 fc0 sc0 ls0 ws4">int main() {</div><div class="t m0 x19 hf y1f16 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *pow_func;</div><div class="t m0 x19 hf y3751 ff8 fs5 fc0 sc0 ls0 ws4">double x;</div><div class="t m0 x19 hf y3752 ff8 fs5 fc0 sc0 ls0">Py_Initialize();</div><div class="t m0 x19 hf y3753 ff8 fs5 fc0 sc0 ls0 ws4">/* Get a reference to the math.pow function */</div><div class="t m0 x19 hf y3754 ff8 fs5 fc0 sc0 ls0 ws4">pow_func = import_name(&quot;math&quot;,&quot;pow&quot;);</div><div class="t m0 x19 hf y3755 ff8 fs5 fc0 sc0 ls0 ws4">/* Call it using our call_func() code */</div><div class="t m0 x19 hf y3756 ff8 fs5 fc0 sc0 ls0 ws4">for (x = 0.0; x &lt; 10.0; x += 0.1) {</div><div class="t m0 x15 hf y150f ff8 fs5 fc0 sc0 ls0 ws4">printf(&quot;%0.2f %0.2f\n&quot;, x, call_func(pow_func,x,2.0));</div><div class="t m0 x19 hf y3757 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3758 ff8 fs5 fc0 sc0 ls0 ws4">/* Done */</div><div class="t m0 x19 hf y3759 ff8 fs5 fc0 sc0 ls0">Py_DECREF(pow_func);</div><div class="t m0 x19 hf y375a ff8 fs5 fc0 sc0 ls0">Py_Finalize();</div><div class="t m0 x19 hf y375b ff8 fs5 fc0 sc0 ls0 ws4">return 0;</div><div class="t m0 x5 hf y375c ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x0 h7 y375d ff1 fs3 fc0 sc0 ls0 ws141b">要构建例子代码，<span class="_ _c"></span>你需要编译 <span class="ff4 ls26a">C</span><span class="ws141c">并将它链接到 <span class="ff4 ws141d">Python </span><span class="ws775">解释器。下面的 <span class="ff4 ws141e">Mak<span class="_ _c"></span>eﬁle <span class="ff1">可</span></span></span></span></div><div class="t m0 x5 h9 y375e ff1 fs3 fc0 sc0 ls0 wsa0">以教你怎样做（不过在你机器上面需要一些配置）<span class="_ _f"></span>。</div><div class="t m0 x5 hf y375f ff8 fs5 fc0 sc0 ls0">all::</div><div class="t m0 x16 hf y3760 ff8 fs5 fc0 sc0 ls0 ws4">cc -g embed.c -I/usr/local/include/python3.3m \</div><div class="t m0 x48 hf y3761 ff8 fs5 fc0 sc0 ls0 ws4">-L/usr/local/lib/python3.3/config-3.3m -lpython3.3m</div><div class="t m0 x0 h9 y3762 ff1 fs3 fc0 sc0 ls0">编译并运行会产生类似下面的输出：</div><div class="t m0 x5 hf y3763 ff8 fs5 fc0 sc0 ls0 ws4">0.00 0.00</div><div class="t m0 x5 hf y3764 ff8 fs5 fc0 sc0 ls0 ws4">0.10 0.01</div><div class="t m0 x5 hf y3765 ff8 fs5 fc0 sc0 ls0 ws4">0.20 0.04</div><div class="t m0 x5 hf y2a30 ff8 fs5 fc0 sc0 ls0 ws4">0.30 0.09</div><div class="t m0 x5 hf y25e2 ff8 fs5 fc0 sc0 ls0 ws4">0.40 0.16</div><div class="t m0 x5 hf y25e3 ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x0 h9 y349d ff1 fs3 fc0 sc0 ls3a ws153">下面是一个稍微不同的例子，展示了一个扩展函数，它接受一个可调用对象和其他</div><div class="t m0 x5 h9 y3766 ff1 fs3 fc0 sc0 ls0 ws14">参数，并将它们传递给 <span class="ff6 ws25d">call<span class="_ _7"> </span>func() </span>来做测试：</div><div class="t m0 x5 hf y3767 ff8 fs5 fc0 sc0 ls0 ws4">/* Extension function for testing the C-Python callback */</div><div class="t m0 x5 hf y3768 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *py_call_func(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y3769 ff8 fs5 fc0 sc0 ls0 ws4">PyObject *func;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.6.<span class="_ _36"> </span>15.6 <span class="ff1 ls81">从</span><span class="ls260">C</span><span class="ff1 ws7da">语言中调用 </span><span class="wscda">Python <span class="ff1 ws42c">代码 </span>566</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
