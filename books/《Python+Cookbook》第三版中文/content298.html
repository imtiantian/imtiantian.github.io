<div id="pf12a" class="pf w0 h0" data-page-no="12a"><div class="pc pc12a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg12a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UnaryOperator<span class="ff8 fc0">(Node):</span></span></div><div class="t m0 x15 hf y1ac ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, operand):</span></span></span></div><div class="t m0 x16 hf y1ad ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">operand </span><span class="ls33">=</span><span class="fc0">operand</span></span></div><div class="t m0 x5 hf y1af ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">BinaryOperator<span class="ff8 fc0">(Node):</span></span></div><div class="t m0 x15 hf y1b0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, left, right):</span></span></span></div><div class="t m0 x16 hf y355 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">left </span><span class="ls33">=</span><span class="fc0">left</span></span></div><div class="t m0 x16 hf y410 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">right </span><span class="ls32">=</span><span class="fc0">right</span></span></div><div class="t m0 x5 hf yba ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Add<span class="ff8 fc0">(BinaryOperator):</span></span></div><div class="t m0 x15 h10 y8c6 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf ybee ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Sub<span class="ff8 fc0">(BinaryOperator):</span></span></div><div class="t m0 x15 h10 ybef ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf yd7d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Mul<span class="ff8 fc0">(BinaryOperator):</span></span></div><div class="t m0 x15 h10 ybf1 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf ybf3 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Div<span class="ff8 fc0">(BinaryOperator):</span></span></div><div class="t m0 x15 h10 ybf4 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf ybf6 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Negate<span class="ff8 fc0">(UnaryOperator):</span></span></div><div class="t m0 x15 h10 ybf7 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf ybf9 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Number<span class="ff8 fc0">(Node):</span></span></div><div class="t m0 x15 hf ybfa ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, value):</span></span></span></div><div class="t m0 x16 hf ybfb ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">value </span><span class="ls32">=</span><span class="fc0">value</span></span></div><div class="t m0 x5 h11 y1ed7 ffa fs5 fcd sc0 ls0 ws4"># A sample visitor class that evaluates expressions</div><div class="t m0 x5 hf y1ed8 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Evaluator<span class="ff8 fc0">(NodeVisitor):</span></span></div><div class="t m0 x15 hf y1f83 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Number<span class="fc0">(<span class="fca">self</span><span class="ws4">, node):</span></span></span></div><div class="t m0 x16 hf y1ed9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">node<span class="fc6 ls34">.</span>value</span></div><div class="t m0 x15 hf y1edb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Add<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1f84 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">+</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y1edc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Sub<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1edd ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">-</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y1edf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Mul<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1ee0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">*</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y1ee1 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Div<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1ee2 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">/</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y1f85 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Negate<span class="fc0">(<span class="fca">self</span><span class="ws4">, node):</span></span></span></div><div class="t m0 x16 hf y1ee4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc6 ls34">-</span><span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">visit(node</span>.<span class="fc0">operand)</span></span></span></div><div class="t m0 x5 hf y1ee6 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 h11 y1f86 ffa fs5 fcd sc0 ls0 ws4"># 1 + 2*(3-4) / 5</div><div class="t m0 x15 hf y1543 ff8 fs5 fc0 sc0 ls0 ws159">t1 <span class="fc6 ls33">=</span><span class="ws13a">Sub(Number(<span class="fc7">3</span><span class="ws4">), Number(</span><span class="fc7">4</span>))</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.22.<span class="_ _5"> </span>8.22 <span class="ff1 wsb03">不用递归实现访问者模式 </span>289</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
