<div id="pf39" class="pf w0 h0" data-page-no="39"><div class="pc pc39 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg39.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws134">4.5<span class="_ _e"> </span>2.5 <span class="ff1">字符串搜索和替换</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws135">4.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2b2 ff1 fs3 fc0 sc0 ls0">你想在字符串中搜索和匹配指定的文本模式</div><div class="t m0 x5 he y2b3 ff2 fs2 fc4 sc0 ls0 ws135">4.5.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2b4 ff1 fs3 fc0 sc0 ls0 ws14">对于简单的字面模式，直接使用 <span class="ff6 ws309">str.repalce() </span>方法即可，比如：</div><div class="t m0 x5 hf y618 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">text <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">yeah, but no, but yeah, but no, but yeah<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y619 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">text<span class="fc6 ls34">.</span>replace(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">yeah<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">yep<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y61a ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">yep, but no, but yep, but no, but yep<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y61b ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y61c ff1 fs3 fc0 sc0 ls0 ws30a">对于复杂<span class="_ _6"></span>的模式，请使<span class="_ _6"></span>用 <span class="ff6 ws30b">re </span><span class="ws30c">模块中的 <span class="ff6 ws30d">sub() </span><span class="wsa0">函数。<span class="_ _6"></span>为了说明这个，<span class="_ _6"></span>假设你想<span class="_ _6"></span>将形</span></span></div><div class="t m0 x5 h9 y61d ff1 fs3 fc0 sc0 ls0 ws14">式为 <span class="ff6 ws2d1">11/27/2012 </span>的日期字符串改成 <span class="ff6 ws17c">2012-11-27 </span>。示例如下：</div><div class="t m0 x5 hf y61e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">text <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">Today is 11/27/2012. PyCon starts 3/13/2013.<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h10 y61f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">re</span></span></div><div class="t m0 x5 hf y620 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">re<span class="fc6 ls34">.</span>sub(<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0">(\d+)/(\d+)/(\d+)</span><span class="ff9">&apos;</span></span><span class="ls32">,<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0">\3-\1-\2</span><span class="ff9">&apos;</span></span></span><span class="ws13b">, text)</span></span></div><div class="t m0 x5 hf y621 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Today is 2012-11-27. PyCon starts 2013-3-13.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y622 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y623 ff6 fs3 fc0 sc0 ls0 ws30d">sub() <span class="ff1 ls51 ws1c8">函数中的第一个参数是被匹配的模式，第二个参数是替换模式<span class="_ _1"></span>。反斜杠数字</span></div><div class="t m0 x5 h9 y624 ff1 fs3 fc0 sc0 ls0 ws14">比如 <span class="ffd ls84">\<span class="ff6 ls86">3</span></span>指向前面模式的捕获组号。</div><div class="t m0 x0 h9 y625 ff1 fs3 fc0 sc0 ls0">如果你打算用相同的模式做多次替换，考虑先编译它来提升性能。比如：</div><div class="t m0 x5 h10 y626 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">re</span></span></div><div class="t m0 x5 hf y627 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws155">datepat <span class="fc6 ls32">=</span><span class="ws13a">re<span class="fc6">.</span>compile(<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0">(\d+)/(\d+)/(\d+)</span><span class="ff9">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y628 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">datepat<span class="fc6 ls34">.</span>sub(<span class="fc9">r<span class="ff9 ls34">&apos;</span>\3-\1-\2<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, text)</span></span></div><div class="t m0 x5 hf y629 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Today is 2012-11-27. PyCon starts 2013-3-13.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y62a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y62b ff1 fs3 fc0 sc0 ls0">对于更加复杂的替换，可以传递一个替换回调函数来代替，比如：</div><div class="t m0 x5 hf y62c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws248">calendar </span><span class="ws146">import <span class="ff8 fc0">month_abbr</span></span></span></div><div class="t m0 x5 hf y62d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">change_date<span class="fc0">(m):</span></span></span></div><div class="t m0 x5 hf y62e ff7 fs5 fc5 sc0 ls0 ws139">... <span class="ff8 fc0 ws1f5">mon_name <span class="fc6 ls33">=</span><span class="ws13a">month_abbr[<span class="fca">int</span>(m<span class="fc6">.</span>group(<span class="fc7">1</span>))]</span></span></div><div class="t m0 x5 hf y62f ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13b">{} {} {}<span class="ff9">&apos;</span><span class="fc6 ls34">.</span><span class="fc0 ws13a">format(m<span class="fc6 ls34">.</span>group(<span class="fc7 ls34">2</span><span class="ws13b">), mon_name, m<span class="fc6 ls34">.</span></span>group(<span class="fc7 ls34">3</span>))</span></span></span></span></div><div class="t m0 x5 h10 y630 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y631 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">datepat<span class="fc6 ls34">.</span><span class="ws13b">sub(change_date, text)</span></span></div><div class="t m0 x5 hf y632 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Today is 27 Nov 2012. PyCon starts 13 Mar 2013.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y633 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y634 ff1 fs3 fc0 sc0 ls0 wsfd">一个替换回调函数的参数是一个 <span class="ff6 ws30e">match </span><span class="ws30f">对象，也就是 <span class="ff6 ws310">match() </span></span>或者 <span class="ff6 ws311">find() </span>返回的</div><div class="t m0 x5 h9 y635 ff1 fs3 fc0 sc0 ls0 ws38">对象。使用 <span class="ff6 ws23a">group() </span>方法来提取特定的匹配部分。回调函数最后返回替换字符串。</div><div class="t m0 x0 h9 y636 ff1 fs3 fc0 sc0 ls16 ws312">如果除了替换后的结果外<span class="_ _c"></span>，你还想知道有多少替换发生了<span class="_ _1"></span>，可以使用 <span class="ff6 ls0">re.subn()</span></div><div class="t m0 x5 h9 y637 ff1 fs3 fc0 sc0 ls0">来代替。比如：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">4.5.<span class="_ _5"> </span>2.5 <span class="ff1 ws2fa">字符串搜索和替换 </span>48</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
