<div id="pf106" class="pf w0 h0" data-page-no="106"><div class="pc pc106 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg106.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">Point(<span class="fc7 ls34">2<span class="fc0">,</span><span class="ls0">3</span></span>)</span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">p<span class="fc6 ls0 ws13a">.</span><span class="ls33">x</span></span><span class="ffa fcd ws4"># Calls Point.x.__get__(p, Point)</span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0">2</div><div class="t m0 x5 hf y1ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">Point<span class="fc6">.</span><span class="ls33">x</span><span class="ffa fcd ws4"># Calls Point.x.__get__(None, Point)</span></span></div><div class="t m0 x5 hf y1af ff8 fs5 fc8 sc0 ls0 ws4">&lt;__main__.Integer object at 0x100671890&gt;</div><div class="t m0 x5 hf y1b0 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1b1 ff1 fs3 fc0 sc0 ls3a ws153">描述器通常是那些使用到装饰器或元类的大型框架中的一个组件。同时它们的使用</div><div class="t m0 x5 h9 y1b2 ff1 fs3 fc0 sc0 ls1e ws111">也被隐藏在后面<span class="_ _1"></span>。举个例子，下面是<span class="_ _1"></span>一些更高级的基于描述器的代码，并涉及到<span class="_ _1"></span>一个</div><div class="t m0 x5 h9 y1cc ff1 fs3 fc0 sc0 ls0">类装饰器：</div><div class="t m0 x5 h11 y1c58 ffa fs5 fcd sc0 ls0 ws4"># Descriptor for a type-checked attribute</div><div class="t m0 x5 hf y1c59 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Typed<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c5a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, expected_type):</span></span></span></div><div class="t m0 x16 hf y1c5b ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y1c5c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws5a4">expected_type </span><span class="ls32">=</span><span class="fc0">expected_type</span></span></div><div class="t m0 x15 hf yfdc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__get__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, cls):</span></span></span></div><div class="t m0 x16 hf y1c5d ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">instance </span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1c5e ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">self</span></div><div class="t m0 x16 hf y1c5f ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1c60 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6 ls34">.</span></span>name]</span></div><div class="t m0 x15 hf y1c61 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__set__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, value):</span></span></span></div><div class="t m0 x16 hf y1c62 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws155">(value, </span>self<span class="fc6 ls34">.</span><span class="fc0">expected_type):</span></span></div><div class="t m0 x17 hf y1c63 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws16d">Expected <span class="ff9 ls32">&apos;</span><span class="fc6 ls33">+</span></span></span>str<span class="fc0">(</span>self<span class="fc6 ls34">.</span><span class="fc0">expected_type))</span></span></div><div class="t m0 x16 hf y1c64 ff8 fs5 fc0 sc0 ls0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws15f">name] <span class="fc6 ls32">=</span>value</span></div><div class="t m0 x15 hf y1c65 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__delete__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance):</span></span></span></div><div class="t m0 x16 hf y1c66 ff7 fs5 fca sc0 ls0 ws139">del <span class="ff8 fc0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6">.</span></span>name]</span></div><div class="t m0 x5 h11 y1c67 ffa fs5 fcd sc0 ls0 ws4"># Class decorator that applies it to selected attributes</div><div class="t m0 x5 hf y1c68 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">typeassert<span class="fc0 ls34">(</span><span class="fc6">**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x15 hf y1c69 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorate<span class="fc0">(cls):</span></span></div><div class="t m0 x16 hf y38a ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, expected_type </span><span class="ws157">in <span class="ff8 fc0 ws13a">kwargs<span class="fc6 ls34">.</span>items():</span></span></div><div class="t m0 x17 h11 y38b ffa fs5 fcd sc0 ls0 ws4"># Attach a Typed descriptor to the class</div><div class="t m0 x17 hf y1c6a ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ws4">(cls, name, Typed(name, expected_type))</span></div><div class="t m0 x16 hf y1c6b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">cls</span></div><div class="t m0 x15 hf y1c6c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">decorate</span></div><div class="t m0 x5 h11 y1c6d ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y1c6e ff7 fs5 fc12 sc0 ls0 ws156">@typeassert<span class="ff8 fc0 ws13a">(name<span class="fc6">=<span class="fca">str</span></span><span class="ws13b">, shares<span class="fc6 ls34">=</span></span><span class="fca">int</span><span class="ws4">, price<span class="fc6 ls34">=</span></span><span class="fca">float</span>)</span></div><div class="t m0 x5 hf y1c6f ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c70 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, shares, price):</span></span></span></div><div class="t m0 x16 hf y1c71 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y1c72 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">shares </span><span class="ls32">=</span><span class="fc0">shares</span></span></div><div class="t m0 x16 hf y1c73 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">price </span><span class="ls32">=</span><span class="fc0">price</span></span></div><div class="t m0 x0 h9 y1c74 ff1 fs3 fc0 sc0 ls3a ws153">最后要指出的一点是，如果你只是想简单的自定义某个类的单个属性访问的话就不</div><div class="t m0 x5 h7 y1c75 ff1 fs3 fc0 sc0 ls12 wsadb">用去写描述器了。这种情况下使用 <span class="ff4 ls0 wsadc">8.6 </span><span class="ws514">小节介绍的 <span class="ff4 ls0 wsadd">property </span><span class="wse4">技术<span class="_ _1"></span>会更加容易。当程序<span class="_ _1"></span></span></span></div><div class="t m0 x5 h7 y1c76 ff1 fs3 fc0 sc0 ls1f wsade">中有很多重复代码的时候描述器就很有用了 <span class="ff4 ls1b">(</span><span class="ws113">比如你想在你代码的很多地方使用描述器</span></div><div class="t m0 x5 h7 y1c77 ff1 fs3 fc0 sc0 ls0 wsa0">提供的功能或者将它作为一个函数库特性<span class="ff4 ls1b">)</span>。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">10.9.<span class="_ _5"> </span>8.9 <span class="ff1 ws9db">创建新的类或实例属性 </span>253</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
