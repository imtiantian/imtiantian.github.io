<div id="pf145" class="pf w0 h0" data-page-no="145"><div class="pc pc145 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg145.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws9c6">11.8<span class="_ _e"> </span>9.8 <span class="ff1">将装饰器定义为类的一部分</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws212">11.8.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y658 ff1 fs3 fc0 sc0 ls0">你想在类中定义装饰器，并将其作用在其他函数或方法上。</div><div class="t m0 x5 he y6ee ff2 fs2 fc4 sc0 ls0 ws212">11.8.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y6ef ff1 fs3 fc0 sc0 ls3a ws153">在类里面定义装饰器很简单，但是你首先要确认它的使用方式。比如到底是作为一</div><div class="t m0 x5 h9 y6f0 ff1 fs3 fc0 sc0 ls0">个实例方法还是类方法。下面我们用例子来阐述它们的不同：</div><div class="t m0 x5 hf ye06 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 hf ye07 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 h11 ye08 ffa fs5 fcd sc0 ls0 ws4"># Decorator as an instance method</div><div class="t m0 x15 hf ye09 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorator1<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, func):</span></span></span></div><div class="t m0 x16 hf ye0a ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x16 hf y2210 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x17 hf ye0b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Decorator 1</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x17 hf ye0c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x16 hf ye0d ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x15 h11 y2211 ffa fs5 fcd sc0 ls0 ws4"># Decorator as a class method</div><div class="t m0 x15 h10 ye0f ff7 fs5 fc12 sc0 ls0">@classmethod</div><div class="t m0 x15 hf ye10 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorator2<span class="fc0 ws4">(cls, func):</span></span></div><div class="t m0 x16 hf y41d ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x16 hf y2212 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x17 hf y2213 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Decorator 2</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x17 hf y2214 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x16 hf y2215 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x0 h9 y2216 ff1 fs3 fc0 sc0 ls0">下面是一使用例子：</div><div class="t m0 x5 h11 y2217 ffa fs5 fcd sc0 ls0 ws4"># As an instance method</div><div class="t m0 x5 hf y2218 ff8 fs5 fc0 sc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0">A()</span></div><div class="t m0 x5 h10 y2219 ff7 fs5 fc12 sc0 ls0">@a.decorator1</div><div class="t m0 x5 hf y221a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">():</span></span></div><div class="t m0 x15 h10 y221b ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h11 y221c ffa fs5 fcd sc0 ls0 ws4"># As a class method</div><div class="t m0 x5 h10 y221d ff7 fs5 fc12 sc0 ls0">@A.decorator2</div><div class="t m0 x5 hf y221e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">grok<span class="fc0">():</span></span></div><div class="t m0 x15 h10 y221f ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y2220 ff1 fs3 fc0 sc0 ls0">仔细观察可以发现一个是实例调用，一个是类调用。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.8.<span class="_ _5"> </span>9.8 <span class="ff1 ws23b">将装饰器定义为类的一部分 </span>316</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
