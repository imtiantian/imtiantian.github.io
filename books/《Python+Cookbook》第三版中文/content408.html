<div id="pf198" class="pf w0 h0" data-page-no="198"><div class="pc pc198 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg198.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls1e wse7c">如果你需要使用 <span class="ff4 ls0 wse7d">POST </span><span class="ws111">方法在请求主体中发送查询参数<span class="_ _1"></span>，可以将参数编码后作为</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0 ws38">可选参数提供给 <span class="ff6 ws1d1">urlopen() </span>函数，就像这样：</div><div class="t m0 x5 hf yd14 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">urllib <span class="fca">import <span class="ff8 fc0 ws13b">request, parse</span></span></span></div><div class="t m0 x5 h11 yd16 ffa fs5 fcd sc0 ls0 ws4"># Base URL being accessed</div><div class="t m0 x5 hf yd17 ff8 fs5 fc0 sc0 ls0 ws158">url <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">http://httpbin.org/post<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 yd19 ffa fs5 fcd sc0 ls0 ws4"># Dictionary of query parameters (if any)</div><div class="t m0 x5 hf y297f ff8 fs5 fc0 sc0 ls0 ws15f">parms <span class="fc6 ls33">=</span>{</div><div class="t m0 x3c hf yd1a ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">name1</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">value1</span><span class="ls0 ws13b">&apos;<span class="ff8 fc0">,</span></span></div><div class="t m0 x3c hf yd1b ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">name2</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">value2<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf yd1c ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 h11 yd1e ffa fs5 fcd sc0 ls0 ws4"># Encode the query string</div><div class="t m0 x5 hf yd1f ff8 fs5 fc0 sc0 ls0 ws208">querystring <span class="fc6 ls32">=</span><span class="ws13a">parse<span class="fc6 ls34">.</span>urlencode(parms)</span></div><div class="t m0 x5 h11 y2980 ffa fs5 fcd sc0 ls0 ws4"># Make a POST request and read the response</div><div class="t m0 x5 hf y2981 ff8 fs5 fc0 sc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">request<span class="fc6 ls34">.</span><span class="ws13b">urlopen(url, querystring<span class="fc6 ls34">.</span></span>encode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ascii<span class="ff9 ls34">&apos;</span></span>))</span></div><div class="t m0 x5 hf ya3 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">u<span class="fc6">.</span></span>read()</div><div class="t m0 x0 h7 y2982 ff1 fs3 fc0 sc0 ls16 wse7e">如果你需要在发出的请求中提供一些自定义的 <span class="ff4 ls0 wse7f">HTTP <span class="ff1 wse80">头，<span class="_ _6"></span>例<span class="_ _0"></span>如<span class="_ _6"></span>修<span class="_ _6"></span>改 <span class="ff6 ws303">user-<span class="_ _0"></span>agent</span></span></span></div><div class="t m0 x5 h7 y2983 ff1 fs3 fc0 sc0 ls0 wsa0">字<span class="_ _12"></span>段<span class="ff4 ls1d2">,</span><span class="ls6d wse81">可以创建一个包含字段值的字典<span class="_ _8"></span>，并创建一个 <span class="ff4 ls0 wse82">Request </span><span class="ws2a0">实例然后将其传给<span class="_ _19"></span></span></span></div><div class="t m0 x5 h9 y2984 ff6 fs3 fc0 sc0 ls0 ws1d1">urlopen() <span class="ff1">，如下：</span></div><div class="t m0 x5 hf y2985 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">urllib <span class="fca">import <span class="ff8 fc0 ws13b">request, parse</span></span></span></div><div class="t m0 x5 hf y2986 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x5 h11 y2987 ffa fs5 fcd sc0 ls0 ws4"># Extra headers</div><div class="t m0 x5 hf y2988 ff8 fs5 fc0 sc0 ls0 ws155">headers <span class="fc6 ls32">=</span>{</div><div class="t m0 x15 hf y2989 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">User-agent</span><span class="ls32">&apos;<span class="ff8 fc0 ls33">:</span></span>&apos;<span class="ff8 ls0 ws13a">none/ofyourbusiness</span>&apos;<span class="ff8 fc0 ls0">,</span></div><div class="t m0 x15 hf y298a ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">Spam</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">Eggs<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y298b ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y298c ff8 fs5 fc0 sc0 ls0 ws158">req <span class="fc6 ls32">=</span><span class="ws13a">request<span class="fc6 ls34">.</span><span class="ws4">Request(url, querystring</span><span class="fc6">.</span>encode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ascii<span class="ff9 ls34">&apos;</span></span><span class="ws13b">), headers<span class="fc6 ls34">=</span>headers)</span></span></div><div class="t m0 x5 h11 y298d ffa fs5 fcd sc0 ls0 ws4"># Make a request and read the response</div><div class="t m0 x5 hf y298e ff8 fs5 fc0 sc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">request<span class="fc6 ls34">.</span>urlopen(req)</span></div><div class="t m0 x5 hf y298f ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">u<span class="fc6">.</span></span>read()</div><div class="t m0 x0 h7 y1fb2 ff1 fs3 fc0 sc0 ls0 wse0f">如 果 需 要 交 互 的 服 务 比 上 面 的 例 子 都 要 复 杂， 也 许 应 该 去 看 看<span class="_ _1c"> </span><span class="ff4 wse83">requests </span>库</div><div class="t m0 x38 h7 y2990 ff1 fs3 fc0 sc0 lsb">（<span class="ff4 fc3 ls0 wsa5">h<span class="_ _1"></span>ttps://<span class="_ _0"></span>pypi.p<span class="_ _c"></span>ython.org/<span class="_ _12"></span>p<span class="_ _1"></span>ypi/<span class="_ _12"></span>requests<span class="ff1 fc0 ls1d3 wse84">）<span class="_ _28"></span>。例如<span class="_ _19"></span>，下面这个示例采用 <span class="ff4 ls0 wse85">requests <span class="ff1 wsa0">库<span class="_ _12"></span>重</span></span></span></span></div><div class="t m0 x5 h9 y2991 ff1 fs3 fc0 sc0 ls0">新实现了上面的操作：</div><div class="t m0 x5 h10 y2992 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">requests</span></div><div class="t m0 x5 h11 y2993 ffa fs5 fcd sc0 ls0 ws4"># Base URL being accessed</div><div class="t m0 x5 hf y2994 ff8 fs5 fc0 sc0 ls0 ws158">url <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">http://httpbin.org/post<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 y2995 ffa fs5 fcd sc0 ls0 ws4"># Dictionary of query parameters (if any)</div><div class="t m0 x5 hf y2996 ff8 fs5 fc0 sc0 ls0 ws15f">parms <span class="fc6 ls33">=</span>{</div><div class="t m0 x3c hf y1b43 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">name1</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">value1</span><span class="ls0 ws13b">&apos;<span class="ff8 fc0">,</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.1.<span class="_ _5"> </span>11.1 <span class="ff1 ws16b">作为客户端与 </span><span class="wse86">HTTP <span class="ff1 wse87">服务交互 </span>399</span></div><a class="l" href="https://pypi.python.org/pypi/requests"><div class="d m1" style="border-style:none;position:absolute;left:121.809000px;bottom:308.656500px;width:200.188000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
