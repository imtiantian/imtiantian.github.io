<div id="pf14" class="pf w0 h0" data-page-no="14"><div class="pc pc14 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg14.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y181 ffa fs5 fcd sc0 ls0 ws4"># Example use on a file</div><div class="t m0 x5 hf y182 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y183 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="fc9">r<span class="ff9">&apos;</span><span class="ls0">../../cookbook/somefile.txt</span><span class="ff9">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x16 hf y184 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">line, prevlines </span><span class="ws160">in <span class="ff8 fc0 ws16e">search(f, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">python<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="fc7 ls34">5</span></span>):</span></span></div><div class="t m0 x17 hf y185 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws15f">pline </span><span class="ws157">in <span class="ff8 fc0">prevlines:</span></span></div><div class="t m0 x18 hf y186 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws4">(pline, end<span class="fc6 ls34">=</span><span class="ff9 fc9 ws13b">&apos;&apos;</span>)</span></div><div class="t m0 x17 hf y187 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws4">(line, end<span class="fc6 ws13a">=<span class="ff9 fc9 ls34">&apos;&apos;</span></span>)</span></div><div class="t m0 x17 hf y188 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8">-</span><span class="ls32">&apos;<span class="ff8 fc6">*<span class="fc7 ls0 ws13a">20<span class="fc0">)</span></span></span></span></span></span></div><div class="t m0 x5 he y189 ff2 fs2 fc4 sc0 ls0 ws135">3.3.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y18a ff1 fs3 fc0 sc0 ls0 ws16f">我们在写查询元素的代码时，<span class="_ _c"></span>通常会使用包含 <span class="ff6 ws170">yield </span><span class="wsa0">表达式的生成器函数，也就是</span></div><div class="t m0 x5 h9 y18b ff1 fs3 fc0 sc0 ls13 wse5">我们上面示例代码中的那样<span class="_ _1"></span>。这样可以将搜索过程代码和使用搜索结果代码解耦。如<span class="_ _c"></span></div><div class="t m0 x5 h7 y18c ff1 fs3 fc0 sc0 ls0 ws14">果你还不清楚什么是生成器，请参看 <span class="ff4 ws171">4.3 </span>节。</div><div class="t m0 x0 h9 y18d ff1 fs3 fc0 sc0 ls0 ws172">使<span class="_ _6"></span>用 <span class="ff6 ws173">deque(maxlen=N) </span><span class="ls14 ws174">构造函数会新建一个固定大小的队列<span class="_ _c"></span>。当新的元素加入并</span></div><div class="t m0 x5 h9 y18e ff1 fs3 fc0 sc0 ls0">且这个队列已满的时候，最老的元素会自动被移除掉。</div><div class="t m0 x0 h9 y18f ff1 fs3 fc0 sc0 ls0">代码示例：</div><div class="t m0 x5 hf y190 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">q<span class="fc6 ls33">=</span><span class="ls0 ws13a">deque(maxlen<span class="fc6">=<span class="fc7 ls34">3</span></span>)</span></span></div><div class="t m0 x5 hf y191 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">1</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y192 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">2</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y193 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">3</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y194 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">q</span></div><div class="t m0 x5 hf y195 ff8 fs5 fc8 sc0 ls0 ws4">deque([1, 2, 3], maxlen=3)</div><div class="t m0 x5 hf y196 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">4</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y197 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">q</span></div><div class="t m0 x5 hf y198 ff8 fs5 fc8 sc0 ls0 ws4">deque([2, 3, 4], maxlen=3)</div><div class="t m0 x5 hf y199 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">5</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y19a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">q</span></div><div class="t m0 x5 hf y19b ff8 fs5 fc8 sc0 ls0 ws4">deque([3, 4, 5], maxlen=3)</div><div class="t m0 x0 h7 y19c ff1 fs3 fc0 sc0 ls0 ws175">尽管你也可以手动在一个列表上实现这一的操作 <span class="ff4 ls1b">(</span><span class="wsa0">比如增加、删除等等<span class="ff4 ls1b">)</span>。但是这里</span></div><div class="t m0 x5 h9 y19d ff1 fs3 fc0 sc0 ls0">的队列方案会更加优雅并且运行得更快些。</div><div class="t m0 x0 h9 y19e ff1 fs3 fc0 sc0 ls0 ws176">更<span class="_ _6"></span>一<span class="_ _6"></span>般<span class="_ _6"></span>的， <span class="ff6 ws177">deque </span><span class="ls14 ws174">类可以被用在任何你只需要一个简单队列数据结构的场合<span class="_ _1"></span>。如</span></div><div class="t m0 x5 h9 y19f ff1 fs3 fc0 sc0 ls13 wse5">果你不设置最大队列大小<span class="_ _1"></span>，那么就会得到一个无限大小队列，你可以在队列的两端执<span class="_ _c"></span></div><div class="t m0 x5 h9 y1a0 ff1 fs3 fc0 sc0 ls0">行添加和弹出元素的操作。</div><div class="t m0 x0 h9 y1a1 ff1 fs3 fc0 sc0 ls0">代码示例：</div><div class="t m0 x5 hf y1a2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">q<span class="fc6 ls33">=</span><span class="ls0">deque()</span></span></div><div class="t m0 x5 hf y1a3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">1</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1a4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">2</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1a5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">append(</span></span><span class="fc7">3</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1a6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">q</span></div><div class="t m0 x5 hf y1a7 ff8 fs5 fc8 sc0 ls0 ws4">deque([1, 2, 3])</div><div class="t m0 x5 hf y1a8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">appendleft(</span></span><span class="fc7">4</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1a9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">q</span></div><div class="t m0 x5 hf y1aa ff8 fs5 fc8 sc0 ls0 ws4">deque([4, 1, 2, 3])</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">3.3.<span class="_ _5"> </span>1.3 <span class="ff1 ws16b">保留最后 </span><span class="ls3f">N</span><span class="ff1 ws16c">个元素 </span>11</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
