<div id="pf159" class="pf w0 h0" data-page-no="159"><div class="pc pc159 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg159.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">s3 <span class="fc6 ls33">=</span><span class="ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">100</span><span class="ls32">,</span><span class="fc7">490.1</span><span class="ws13b">, shares<span class="fc6 ls34">=</span></span><span class="fc7">50</span>)</span></span></div><div class="t m0 x5 hf y1ac ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 h11 y1ad ffa fs5 fcd sc0 ls0">...</div><div class="t m0 x5 hf y1ae ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: multiple values for argument <span class="ff9 ls34">&apos;</span><span class="ws13a">shares<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y1af ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y2428 ff2 fs2 fc4 sc0 ls0 wsadf">11.16.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2429 ff1 fs3 fc0 sc0 ls19b wsc45">在我们需要构建通用函数库<span class="_ _19"></span>、<span class="_ _6"></span>编写装饰器或实现代理的时候<span class="_ _19"></span>，对于 <span class="ff6 ls0 wsc46">*args <span class="ff1">和</span></span></div><div class="t m0 x5 h9 y242a ff6 fs3 fc0 sc0 ls0 wsc47">**kwargs <span class="ff1 ls19c wsc48">的使用是很普遍的<span class="_ _8"></span>。<span class="_ _6"></span>但是<span class="_ _8"></span>，这样的函数有一个缺点就是当你想<span class="_ _6"></span>要实现自<span class="_ _8"></span></span></div><div class="t m0 x5 h7 y1b65 ff1 fs3 fc0 sc0 ls0 wsc49">己的<span class="_ _6"></span>参数检<span class="_ _6"></span>验时，代<span class="_ _6"></span>码就<span class="_ _6"></span>会笨拙<span class="_ _6"></span>混乱。<span class="_ _6"></span>在 <span class="ff4 wsc4a">8.11 </span><span class="wsa0">小节里<span class="_ _6"></span>面有<span class="_ _6"></span>这样一<span class="_ _6"></span>个例<span class="_ _6"></span>子。这时<span class="_ _6"></span>候我们</span></div><div class="t m0 x5 h9 y242b ff1 fs3 fc0 sc0 ls0">可以通过一个签名对象来简化它。</div><div class="t m0 x0 h9 y242c ff1 fs3 fc0 sc0 ls3a ws153">在最后的一个方案实例中，我们还可以通过使用自定义元类来创建签名对象。下面</div><div class="t m0 x5 h9 y242d ff1 fs3 fc0 sc0 ls0">演示怎样来实现：</div><div class="t m0 x5 hf y1e5d ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2f0">inspect </span><span class="ws1ff">import <span class="ff8 fc0 ws13b">Signature, Parameter</span></span></div><div class="t m0 x5 hf y242e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">make_sig<span class="fc0">(<span class="fc6 ls34">*</span>names):</span></span></div><div class="t m0 x15 hf y242f ff8 fs5 fc0 sc0 ls0 ws15f">parms <span class="fc6 ls33">=</span><span class="ws13b">[Parameter(name, Parameter<span class="fc6 ws13a">.</span>POSITIONAL_OR_KEYWORD)</span></div><div class="t m0 x17 hf y2430 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws157">in <span class="ff8 fc0">names]</span></span></div><div class="t m0 x15 hf y2431 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">Signature(parms)</span></div><div class="t m0 x5 hf y1e64 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">StructureMeta<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y2432 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__new__<span class="fc0 ws4">(cls, clsname, bases, clsdict):</span></span></div><div class="t m0 x16 hf y116e ff8 fs5 fc0 sc0 ls0 ws13a">clsdict[<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">__signature__<span class="ff9 ls34">&apos;</span></span><span class="ls32">]<span class="fc6">=</span></span>make_sig(<span class="fc6 ls34">*</span>clsdict<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">_fields<span class="ff9 ls34">&apos;</span></span>,[]))</div><div class="t m0 x16 hf y2433 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws4">__new__(cls, clsname, bases, clsdict)</span></span></span></div><div class="t m0 x5 hf y2434 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Structure<span class="ff8 fc0 ws13a">(metaclass<span class="fc6 ls34">=</span>StructureMeta):</span></span></div><div class="t m0 x15 hf y2435 ff8 fs5 fc0 sc0 ls0 ws155">_fields <span class="fc6 ls32">=</span>[]</div><div class="t m0 x15 hf y2436 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y2437 ff8 fs5 fc0 sc0 ls0 ws150">bound_values <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6">.<span class="fc0">__signature__</span><span class="ls34">.</span><span class="fc0">bind(</span><span class="ls34">*</span></span></span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></div><div class="t m0 x16 hf y2438 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, value </span><span class="ws160">in <span class="ff8 fc0 ws13a">bound_values<span class="fc6 ls34">.</span>arguments<span class="fc6">.</span>items():</span></span></div><div class="t m0 x17 hf y2439 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ls34">(</span>self<span class="fc0 ws4">, name, value)</span></div><div class="t m0 x5 h11 y243a ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y2050 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y2051 ff8 fs5 fc0 sc0 ls0 ws155">_fields <span class="fc6 ls32">=</span><span class="ls34">[<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13a">name<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">shares</span><span class="ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">price<span class="ff9 ls34">&apos;</span></span>]</div><div class="t m0 x5 hf y2053 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y243b ff8 fs5 fc0 sc0 ls0 ws155">_fields <span class="fc6 ls32">=</span><span class="ls34">[<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13a">x<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">y<span class="ff9">&apos;</span></span></span>]</div><div class="t m0 x0 h9 y243c ff1 fs3 fc0 sc0 ls19 wsc4b">当我们自定义签名的时候，将签名存储在特定的属性 <span class="ff6 ls0 wsc4c">signature </span><span class="ws22a">中通常是很有<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y243d ff1 fs3 fc0 sc0 lsa8 wsc4d">用的。这样的话<span class="_ _1"></span>，在使用 <span class="ff6 ls0 ws3dd">inspect </span><span class="ws3de">模块执行内省的代码就能发现签名并将它作为调用</span></div><div class="t m0 x5 h9 y243e ff1 fs3 fc0 sc0 ls0">约定。</div><div class="t m0 x5 h10 y573 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">inspect</span></span></div><div class="t m0 x5 hf y574 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(inspect<span class="fc6 ls34">.</span>signature(Stock))</span></span></div><div class="t m0 x5 hf y575 ff8 fs5 fc8 sc0 ls0 ws4">(name, shares, price)</div><div class="t m0 x5 hf y576 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(inspect<span class="fc6 ls34">.</span>signature(Point))</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.16.<span class="_ _5"> </span>9.16 <span class="fc2 wsc41">*</span><span class="wsc42">a<span class="_ _c"></span>rgs <span class="ff1 ls7f">和</span><span class="wsc43">**kwa<span class="_ _c"></span>rgs <span class="ff1 wsc44">的强制参数签名 </span>336</span></span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
