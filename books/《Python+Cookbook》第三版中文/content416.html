<div id="pf1a0" class="pf w0 h0" data-page-no="1a0"><div class="pc pc1a0 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a0.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y432 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">socket <span class="fca">import <span class="ff8 fc0 ws13b">socket, AF_INET, SOCK_DGRAM</span></span></span></div><div class="t m0 x5 h10 y433 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf yde6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">time_server<span class="fc0">(address):</span></span></div><div class="t m0 x15 hf y1d08 ff8 fs5 fc0 sc0 ls0 ws13c">sock <span class="fc6 ls32">=</span><span class="ws4">socket(AF_INET, SOCK_DGRAM)</span></div><div class="t m0 x15 hf y1d09 ff8 fs5 fc0 sc0 ls0 ws13a">sock<span class="fc6 ls34">.</span>bind(address)</div><div class="t m0 x15 hf y2843 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y1d0a ff8 fs5 fc0 sc0 ls0 ws13b">msg, addr <span class="fc6 ls33">=</span><span class="ws13a">sock<span class="fc6 ls34">.</span>recvfrom(<span class="fc7">8192</span>)</span></div><div class="t m0 x16 hf y1d0b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Got message from<span class="ff9">&apos;</span><span class="fc0 ws4">, addr)</span></span></span></span></div><div class="t m0 x16 hf y1d0c ff8 fs5 fc0 sc0 ls0 ws161">resp <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>ctime()</span></div><div class="t m0 x16 hf y2844 ff8 fs5 fc0 sc0 ls0 ws13a">sock<span class="fc6">.</span>sendto(resp<span class="fc6 ls34">.</span>encode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ascii<span class="ff9 ws13b">&apos;</span></span><span class="ws4">), addr)</span></div><div class="t m0 x5 hf y2a54 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y2a55 ff8 fs5 fc0 sc0 ls0 ws13a">time_server((<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls32">,</span><span class="fc7">20000</span>))</div><div class="t m0 x5 hd y2a56 ff2 fs4 fc4 sc0 ls0 ws211">13.4<span class="_ _e"> </span>11.4 <span class="ff1 ws165">通过 </span><span class="wsef2">CIDR <span class="ff1 ws357">地址生成对应的 </span><span class="wsef3">IP <span class="ff1">地址集</span></span></span></div><div class="t m0 x5 he y2a57 ff2 fs2 fc4 sc0 ls0 ws212">13.4.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y2a58 ff1 fs3 fc0 sc0 ls0 wsef4">你<span class="_ _6"></span>有<span class="_ _6"></span>一个 <span class="ff4 wsef5">CIDR </span><span class="wsa0">网<span class="_ _6"></span>络<span class="_ _6"></span>地<span class="_ _6"></span>址<span class="_ _6"></span>比<span class="_ _6"></span>如<span class="_ _6"></span>“<span class="ff4 wsa5">123.45.67.89/27</span>”<span class="_ _31"></span>，<span class="_ _6"></span>你<span class="_ _6"></span>想<span class="_ _6"></span>将<span class="_ _6"></span>其<span class="_ _6"></span>转<span class="_ _6"></span>换<span class="_ _6"></span>成它<span class="_ _6"></span>所<span class="_ _6"></span>代<span class="_ _6"></span>表<span class="_ _6"></span>的<span class="_ _6"></span>所</span></div><div class="t m0 x5 h7 y2a59 ff1 fs3 fc0 sc0 ls4">有<span class="ff4 ls0 ws8d">IP </span><span class="ls0 wsa0">（比如，<span class="_ _3"></span>“<span class="ff4 wsa5">123.45.67.64</span>”<span class="ff4 ls83">,</span><span class="lsb">“</span><span class="ff4 wsa5">123.45.67.65</span>”<span class="ff4 ls83">,</span><span class="lsb">…<span class="ff4 ls1de">,</span>“</span><span class="ff4 wsa5">123.45.67.95</span>”<span class="ff4 ls1b">)</span>）</span></div><div class="t m0 x5 he y291a ff2 fs2 fc4 sc0 ls0 ws212">13.4.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2a5a ff1 fs3 fc0 sc0 ls0 wsc">可以使用 <span class="ff6 ws1d1">ipaddress </span>模块很容易的实现这样的计算。例如：</div><div class="t m0 x5 h10 y17b9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">ipaddress</span></span></div><div class="t m0 x5 hf y17ba ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws158">net <span class="fc6 ls32">=</span><span class="ws13a">ipaddress<span class="fc6 ls34">.</span>ip_network(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">123.45.67.64/27<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2a5b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">net</span></div><div class="t m0 x5 hf y1353 ff8 fs5 fc8 sc0 ls0 ws13a">IPv4Network(<span class="ff9 ws13b">&apos;</span>123.45.67.64/27<span class="ff9 ls34">&apos;</span>)</div><div class="t m0 x5 hf y1354 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ls32">a</span><span class="ws157">in <span class="ff8 fc0">net:</span></span></span></div><div class="t m0 x5 hf y17bd ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(a)</span></span></div><div class="t m0 x5 h10 y17be ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y17bf ff8 fs5 fc8 sc0 ls0">123.45.67.64</div><div class="t m0 x5 hf y17c0 ff8 fs5 fc8 sc0 ls0">123.45.67.65</div><div class="t m0 x5 hf y17c1 ff8 fs5 fc8 sc0 ls0">123.45.67.66</div><div class="t m0 x5 hf y2a5c ff8 fs5 fc8 sc0 ls0">123.45.67.67</div><div class="t m0 x5 hf y2a5d ff8 fs5 fc8 sc0 ls0">123.45.67.68</div><div class="t m0 x5 h10 y2a5e ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y2a5f ff8 fs5 fc8 sc0 ls0">123.45.67.95</div><div class="t m0 x5 hf y25f2 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hf y25f4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">net6 <span class="fc6 ls32">=</span><span class="ws13a">ipaddress<span class="fc6">.</span>ip_network(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">12:3456:78:90ab:cd:ef01:23:30/125<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2a60 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">net6</span></div><div class="t m0 x5 hf y2a61 ff8 fs5 fc8 sc0 ls0 ws13a">IPv6Network(<span class="ff9 ws13b">&apos;</span>12:3456:78:90ab:cd:ef01:23:30/125<span class="ff9 ls34">&apos;</span>)</div><div class="t m0 x5 hf y2a62 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ls32">a</span><span class="ws157">in <span class="ff8 fc0">net6:</span></span></span></div><div class="t m0 x5 hf y2a63 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(a)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.4.<span class="_ _5"> </span>11.4 <span class="ff1 ws16b">通过 </span><span class="wsef6">CIDR <span class="ff1 ws7da">地址生成对应的 </span><span class="wsef7">IP <span class="ff1 wsef8">地址集 </span>407</span></span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
