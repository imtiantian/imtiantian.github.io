<div id="pfc6" class="pf w0 h0" data-page-no="c6"><div class="pc pcc6 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgc6.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls0 ws856">依<span class="_ _0"></span>据 <span class="ff4 wsa5">PEP249</span><span class="ls139 ws857">，通过这种形式提供数据<span class="_ _d"></span>，可以很容易的使用 <span class="ff4 ls0 ws858">Python </span><span class="ws859">标准数据库<span class="_ _c"></span></span></span></div><div class="t m0 x5 h7 y2b ff4 fs3 fc0 sc0 ls0 ws85a">API <span class="ff1 ls35 ws256">和关系型数据库进行交互。所有数据库上的操作都通过 </span><span class="ws85b">SQL <span class="ff1 ls35 ws144">查询语句来完成。每</span></span></div><div class="t m0 x5 h9 y2c ff1 fs3 fc0 sc0 ls0">一行输入输出数据用一个元组来表示。</div><div class="t m0 x0 h7 y99 ff1 fs3 fc0 sc0 ls1f ws85c">为了演示说明，你可以使用 <span class="ff4 ls0 ws72c">Python </span><span class="ws85d">标准库中的 <span class="ff6 ls0 ws85e">sqlite3 </span><span class="ws113">模块。如果你使用的是一</span></span></div><div class="t m0 x5 h7 y9a ff1 fs3 fc0 sc0 ls1e ws85f">个不同的数据库 <span class="ff4 ls1b">(</span><span class="ls0 ws860">比<span class="_ _6"></span>如 <span class="ff4 wsa5">MySql</span><span class="ls13a">、</span><span class="ff4 ws861">P<span class="_ _1"></span>ostgresql <span class="ff1 ws862">或<span class="_ _6"></span>者 </span><span class="wsa5">ODBC)<span class="ff1 ls1e ws111">，还得安装相应的第三方模块<span class="_ _1"></span></span></span></span></span></div><div class="t m0 x5 h9 y9b ff1 fs3 fc0 sc0 ls0">来提供支持。不过相应的编程接口几乎都是一样的，除了一点点细微差别外。</div><div class="t m0 x0 h9 y31 ff1 fs3 fc0 sc0 ls19 ws863">第一步是连接到数据库。通常你要执行 <span class="ff6 ls0 ws864">connect() </span><span class="ws22a">函数<span class="_ _1"></span>，给它提供一些数据库名、</span></div><div class="t m0 x5 h9 y32 ff1 fs3 fc0 sc0 ls0">主机、用户名、密码和其他必要的一些参数。例如：</div><div class="t m0 x5 h10 y1592 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sqlite3</span></span></div><div class="t m0 x5 hf y1593 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">db <span class="fc6 ls33">=</span><span class="ws13a">sqlite3<span class="fc6">.</span>connect(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">database.db<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y1594 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1595 ff1 fs3 fc0 sc0 ls0 wsa0">为了处理数据，下一步<span class="_ _6"></span>你需要创建一个游标。一旦<span class="_ _6"></span>你有了游标，那么你就可<span class="_ _6"></span>以执行</div><div class="t m0 x5 h7 y1596 ff4 fs3 fc0 sc0 ls0 ws865">SQL <span class="ff1">查询语句了。比如：</span></div><div class="t m0 x5 hf y1597 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">db<span class="fc6 ls34">.</span>cursor()</span></span></div><div class="t m0 x5 hf y1598 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">execute(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws4">create table portfolio (symbol text, shares integer, price real)</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1599 ff8 fs5 fc8 sc0 ls0 ws4">&lt;sqlite3.Cursor object at 0x10067a730&gt;</div><div class="t m0 x5 hf y12c7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">db<span class="fc6 ls34">.</span>commit()</span></div><div class="t m0 x5 hf y12c8 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y159a ff1 fs3 fc0 sc0 ls0">为了向数据库表中插入多条记录，使用类似下面这样的语句：</div><div class="t m0 x5 hf y159b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">executemany(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws4">insert into portfolio values (?,?,?)</span>&apos;</span><span class="ls0 ws13b">, stocks)</span></span></div><div class="t m0 x5 hf y159c ff8 fs5 fc8 sc0 ls0 ws4">&lt;sqlite3.Cursor object at 0x10067a730&gt;</div><div class="t m0 x5 hf y159d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">db<span class="fc6 ls34">.</span>commit()</span></div><div class="t m0 x5 hf y640 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y159e ff1 fs3 fc0 sc0 ls0">为了执行某个查询，使用像下面这样的语句：</div><div class="t m0 x5 hf y159f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ws158">row </span><span class="ws157">in <span class="ff8 fc0 ws13a">db<span class="fc6 ls34">.</span>execute(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">select * from portfolio<span class="ff9 ls34">&apos;</span></span>):</span></span></span></div><div class="t m0 x5 hf y15a0 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(row)</span></span></div><div class="t m0 x5 h10 y15a1 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y15a2 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">GOOG</span><span class="ff9">&apos;</span><span class="ls0 ws4">, 100, 490.1)</span></div><div class="t m0 x5 hf y15a3 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">AAPL</span><span class="ff9">&apos;</span><span class="ls0 ws4">, 50, 545.75)</span></div><div class="t m0 x5 hf y15a4 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">FB</span><span class="ff9">&apos;</span><span class="ls0 ws13b">, 150, 7.45)</span></div><div class="t m0 x5 hf y15a5 ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">HPQ<span class="ff9 ws13b">&apos;</span><span class="ws4">, 75, 33.2)</span></span></div><div class="t m0 x5 hf y15a6 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y15a7 ff1 fs3 fc0 sc0 ls3a ws153">如果你想接受用户输入作为参数来执行查询操作，必须确保你使用下面这样的占位</div><div class="t m0 x5 h7 y15a8 ff1 fs3 fc0 sc0 ls4">符<span class="ff4 ls0 wsa5">‘‘<span class="_ _0"></span>?‘‘<span class="ff1">来进行引用参数：</span></span></div><div class="t m0 x5 hf y15a9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws16e">min_price <span class="fc6 ls33">=</span><span class="fc7">100</span></span></div><div class="t m0 x5 hf y15aa ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ws158">row </span><span class="ws157">in <span class="ff8 fc0 ws13a">db<span class="fc6 ls34">.</span>execute(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">select * from portfolio where price &gt;= ?<span class="ff9 ws13b">&apos;</span></span>,</span></span></span></div><div class="t m0 x2d hf y15ab ff8 fs5 fc8 sc0 ls0">(min_price,)):</div><div class="t m0 x5 hf y15ac ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(row)</span></span></div><div class="t m0 x5 h10 y15ad ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y15ae ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">GOOG</span><span class="ff9">&apos;</span><span class="ls0 ws4">, 100, 490.1)</span></div><div class="t m0 x5 hf y15af ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">AAPL</span><span class="ff9">&apos;</span><span class="ls0 ws4">, 50, 545.75)</span></div><div class="t m0 x5 hf y15b0 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.8.<span class="_ _5"> </span>6.8 <span class="ff1 ws855">与关系型数据库的交互 </span>189</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
