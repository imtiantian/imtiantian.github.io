<div id="pfc7" class="pf w0 h0" data-page-no="c7"><div class="pc pcc7 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgc7.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws135">8.8.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y236 ff1 fs3 fc0 sc0 lsa8 ws866">在比较低的级别上和数据库交互是非常简单的。你只需提供 <span class="ff4 ls0 ws867">SQL </span><span class="ws3de">语句并调用相应<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y237 ff1 fs3 fc0 sc0 ls13 wse5">的模块就可以更新或提取数据了<span class="_ _1"></span>。虽说如此，还是有一些比较棘手的细节问题需要你<span class="_ _c"></span></div><div class="t m0 x5 h9 y238 ff1 fs3 fc0 sc0 ls0">逐个列出去解决。</div><div class="t m0 x0 h7 y278 ff1 fs3 fc0 sc0 ls18 ws868">一个难点是数据库中的数据和 <span class="ff4 ls0 wsf8">Python </span><span class="ws110">类型直接的映射。对于日期类型，通常可以<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y279 ff1 fs3 fc0 sc0 ls0 ws869">使用 <span class="ff6 ws86a">datetime </span><span class="ws86b">模<span class="_ _6"></span>块<span class="_ _6"></span>中的 <span class="ff6 ws86a">datetime </span><span class="ls6b ws86c">实例，或者可能是 </span><span class="ff6 ws806">time </span><span class="ls6b ws28f">模块中的系统时间戳<span class="_ _1"></span>。对</span></span></div><div class="t m0 x5 h9 y27a ff1 fs3 fc0 sc0 ls0 ws86d">于数字<span class="_ _6"></span>类型，特别<span class="_ _6"></span>是使用<span class="_ _6"></span>到小数的<span class="_ _6"></span>金融数据，<span class="_ _6"></span>可以用 <span class="ff6 ws41c">decimal </span><span class="ws86e">模<span class="_ _6"></span>块中的 <span class="ff6 ws41c">Decimal </span><span class="wsa0">实例</span></span></div><div class="t m0 x5 h9 y27b ff1 fs3 fc0 sc0 ls1e ws111">来表示<span class="_ _1"></span>。不幸的是，对于不同的数据<span class="_ _1"></span>库而言具体映射规则是不一样的，你必须参<span class="_ _1"></span>考相</div><div class="t m0 x5 h9 ya59 ff1 fs3 fc0 sc0 ls0">应的文档。</div><div class="t m0 x0 h7 ya5a ff1 fs3 fc0 sc0 ls0 ws86f">另<span class="_ _6"></span>外<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _0"></span>更<span class="_ _6"></span>加<span class="_ _6"></span>复<span class="_ _6"></span>杂<span class="_ _6"></span>的<span class="_ _0"></span>问题<span class="_ _0"></span>就<span class="_ _6"></span>是 <span class="ff4 ws870">SQL </span><span class="ws871">语<span class="_ _6"></span>句<span class="_ _6"></span>字<span class="_ _6"></span>符<span class="_ _0"></span>串的<span class="_ _0"></span>构造。<span class="_ _0"></span>你<span class="_ _6"></span>千<span class="_ _6"></span>万<span class="_ _6"></span>不<span class="_ _6"></span>要<span class="_ _0"></span>使<span class="_ _6"></span>用 <span class="ff4">Python</span></span></div><div class="t m0 x5 h7 ya5b ff1 fs3 fc0 sc0 ls2b ws872">字符串格式化操作符 <span class="ff4 ls1b">(</span><span class="ls0 wsa0">如<span class="ff4 ws873">%) </span><span class="ws265">或者 <span class="ff6 ws874">.format() </span></span></span><span class="ws12e">方法来创建这样的字符串。如果传递给这</span></div><div class="t m0 x5 h7 ya5c ff1 fs3 fc0 sc0 ls68 ws875">些格式化操作符的值来自于用户的输入，那么你的程序就很有可能遭受 <span class="ff4 ls0 ws876">SQL <span class="ff1 wsa0">注入攻击</span></span></div><div class="t m0 x5 h7 y15b1 ff4 fs3 fc0 sc0 ls0 wsa5">(<span class="ff1 ws877">参考 </span><span class="fc3 ws878">h<span class="_ _1"></span>ttp://xk<span class="_ _1"></span>cd.com/327 <span class="fc0 ls1b">)<span class="ff1 ls0 ws879">。查询语句中的通配符 <span class="ff6 ls13b">?</span><span class="ls1f ws113">指示后台数据库使用它自己的字</span></span></span></span></div><div class="t m0 x5 h9 y15b2 ff1 fs3 fc0 sc0 ls0">符串替换机制，这样更加的安全。</div><div class="t m0 x0 h9 y15b3 ff1 fs3 fc0 sc0 lsd3 ws87a">不幸的是<span class="_ _c"></span>，不同的数据库后台对于通配符的使用是不一样的<span class="_ _1"></span>。大部分模块使用 <span class="ff6 ls0">?</span></div><div class="t m0 x5 h7 y15b4 ff1 fs3 fc0 sc0 ls13c">或<span class="ff6 ls0 ws87b">%s </span><span class="ls0 wsa0">，还有其他一些使用了不同的符号，<span class="_ _1"></span>比如<span class="ff4 ws87c">:0 </span><span class="lsb">或</span><span class="ff4 ws87c">:1 </span>来指示参数。同样的，<span class="_ _1"></span>你还是得</span></div><div class="t m0 x5 h9 y15b5 ff1 fs3 fc0 sc0 ls0 ws87d">去参考你使用的数据库模块相应的文档。一个数据库模块的 <span class="ff6 ws87e">paramstyle </span>属性包含了参</div><div class="t m0 x5 h9 y15b6 ff1 fs3 fc0 sc0 ls0">数引用风格的信息。</div><div class="t m0 x0 h7 y15b7 ff1 fs3 fc0 sc0 ls2d ws87f">对于简单的数据库数据的读写问题<span class="_ _1"></span>，使用数据库 <span class="ff4 ls0 ws880">API </span><span class="ws132">通常非常简单。如果你要处<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y15b8 ff1 fs3 fc0 sc0 ls2d ws881">理更加复杂的问题，建议你使用更加高级的接口<span class="_ _c"></span>，比如一个对象关<span class="_ _6"></span>系映射 <span class="ff4 ls0 ws882">ORM <span class="ff1 wsa0">所提</span></span></div><div class="t m0 x5 h7 y15b9 ff1 fs3 fc0 sc0 ls68 ws883">供的接口。类似 <span class="ff6 ls0 ws884">SQLAlchemy </span><span class="ws885">这样的库允许你使用 <span class="ff4 ls0 ws886">Python </span><span class="ws23f">类来表示一个数据库表，并</span></span></div><div class="t m0 x5 h7 y15ba ff1 fs3 fc0 sc0 ls0 ws38">且能在隐藏底层 <span class="ff4 ws865">SQL </span>的情况下实现各种数据库的操作。</div><div class="t m0 x5 hd y15bb ff2 fs4 fc4 sc0 ls0 ws134">8.9<span class="_ _e"> </span>6.9 <span class="ff1">编码和解码十六进制数</span></div><div class="t m0 x5 he y15bc ff2 fs2 fc4 sc0 ls0 ws135">8.9.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y15bd ff1 fs3 fc0 sc0 ls3a ws153">你想将一个十六进制字符串解码成一个字节字符串或者将一个字节字符串编码成一</div><div class="t m0 x5 h9 y15be ff1 fs3 fc0 sc0 ls0">个十六进制字符串。</div><div class="t m0 x5 he y405 ff2 fs2 fc4 sc0 ls0 ws135">8.9.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y15bf ff1 fs3 fc0 sc0 ls17 ws887">如果你只是简单的解码或编码一个十六进制的原始字符串，可以使用　 <span class="ff6 ls0">binascii</span></div><div class="t m0 x5 h9 y15c0 ff1 fs3 fc0 sc0 ls0">模块。例如：</div><div class="t m0 x5 h11 y15c1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Initial byte string</span></div><div class="t m0 x5 hf y15c2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls34">b</span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">hello</span>&apos;</span></div><div class="t m0 x5 h11 y15c3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Encode as hex</span></div><div class="t m0 x5 h10 y15c4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">binascii</span></span></div><div class="t m0 x5 hf y15c5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">h<span class="fc6 ls33">=</span><span class="ls0 ws13a">binascii<span class="fc6">.</span>b2a_hex(s)</span></span></div><div class="t m0 x5 hf y15c6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">h</span></div><div class="t m0 x5 hf y15c7 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">68656c6c6f<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.9.<span class="_ _5"> </span>6.9 <span class="ff1 ws855">编码和解码十六进制数 </span>190</div><a class="l" href="http://xkcd.com/327"><div class="d m1" style="border-style:none;position:absolute;left:156.576000px;bottom:824.341500px;width:108.017000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
