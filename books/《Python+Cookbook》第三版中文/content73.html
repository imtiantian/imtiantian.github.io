<div id="pf49" class="pf w0 h0" data-page-no="49"><div class="pc pc49 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg49.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">safesub<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">dict<span class="fc0">):</span></span></div><div class="t m0 x5 h12 y1ac ffa fs5 fc9 sc0 ls0 ws158">&quot;&quot;&quot; <span class="ffc fs6 ws3d3">防止 </span>key <span class="ffc fs6 ws3d4">找不到</span>&quot;&quot;&quot;</div><div class="t m0 x5 hf y1ad ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__missing__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, key):</span></span></span></div><div class="t m0 x15 hf y1ae ff7 fs5 fca sc0 ls0 ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">{</span><span class="ls33">&apos;<span class="ff8 fc6 ls32">+<span class="fc0 ls0 ws158">key </span><span class="ls33">+</span></span><span class="ls0 ws13b">&apos;</span></span><span class="ff8">}</span><span class="ls0">&apos;</span></span></div><div class="t m0 x0 h9 y80c ff1 fs3 fc0 sc0 ls0 ws14">现在你可以利用这个类包装输入后传递给 <span class="ff6 ws17d">format<span class="_ _7"> </span>map() </span>：</div><div class="t m0 x5 hf y80d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">del <span class="ff8 fc0 ls32">n</span><span class="ffa fcd ws4"># Make sure n is undefined</span></span></div><div class="t m0 x5 hf y80e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">format_map(safesub(<span class="fca">vars</span>()))</span></span></span></div><div class="t m0 x5 hf y80f ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has {n} messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y810 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y811 ff1 fs3 fc0 sc0 ls3a ws153">如果你发现自己在代码中频繁的执行这些步骤，你可以将变量替换步骤用一个工具</div><div class="t m0 x5 h9 y812 ff1 fs3 fc0 sc0 ls0">函数封装起来。就像下面这样：</div><div class="t m0 x5 h10 y813 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf y814 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">sub<span class="fc0">(text):</span></span></div><div class="t m0 x15 hf y815 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">text<span class="fc6 ls34">.</span>format_map(safesub(sys<span class="fc6">.</span>_getframe(<span class="fc7">1</span><span class="ls34">)<span class="fc6">.</span></span>f_locals))</span></div><div class="t m0 x0 h9 y262 ff1 fs3 fc0 sc0 ls0">现在你可以像下面这样写了：</div><div class="t m0 x5 hf y816 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">name <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">Guido<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y817 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">37</span></span></span></div><div class="t m0 x5 hf y818 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(sub(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Hello {name}<span class="ff9">&apos;</span></span>))</span></span></div><div class="t m0 x5 hf y819 ff8 fs5 fc8 sc0 ls0 ws4">Hello Guido</div><div class="t m0 x5 hf y81a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(sub(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">You have {n} messages.<span class="ff9 ls34">&apos;</span></span>))</span></span></div><div class="t m0 x5 hf y81b ff8 fs5 fc8 sc0 ls0 ws4">You have 37 messages.</div><div class="t m0 x5 hf y81c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(sub(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Your favorite color is {color}<span class="ff9 ws13b">&apos;</span></span>))</span></span></div><div class="t m0 x5 hf y81d ff8 fs5 fc8 sc0 ls0 ws4">Your favorite color is {color}</div><div class="t m0 x5 hf y81e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y81f ff2 fs2 fc4 sc0 ls0 ws212">4.15.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y820 ff1 fs3 fc0 sc0 ls0 ws3d5">多<span class="_ _6"></span>年<span class="_ _6"></span>以<span class="_ _6"></span>来<span class="_ _6"></span>由于 <span class="ff4 ws3d6">Python </span><span class="ls14 ws174">缺乏对变量替换的内置支持而导致了各种不同的解决方案。<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y821 ff1 fs3 fc0 sc0 ls2d ws132">作为本节中展示的一个可能的解决方案，你可以有时候会看到像下面这样的字符串格<span class="_ _1"></span></div><div class="t m0 x5 h9 y822 ff1 fs3 fc0 sc0 ls0">式化代码：</div><div class="t m0 x5 hf y823 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">name <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">Guido<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y824 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">37</span></span></span></div><div class="t m0 x5 hf y825 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">%(name) has %(n) messages.</span><span class="ls32">&apos;<span class="ff8 fc6">%<span class="fca ls0 ws13a">vars<span class="fc0">()</span></span></span></span></span></div><div class="t m0 x5 hf y826 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has 37 messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y827 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y828 ff1 fs3 fc0 sc0 ls0">你可能还会看到字符串模板的使用：</div><div class="t m0 x5 h10 y7ea ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">string</span></span></div><div class="t m0 x5 hf y7eb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">string<span class="fc6 ls34">.</span>Template(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">$name has $n messages.<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y829 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">substitute(<span class="fca">vars</span>())</span></span></span></div><div class="t m0 x5 hf y82a ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has 37 messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y82b ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.15.<span class="_ _5"> </span>2.15 <span class="ff1 ws2a4">字符串中插入变量 </span>64</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
