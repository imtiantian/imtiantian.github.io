<div id="pf46" class="pf w0 h0" data-page-no="46"><div class="pc pc46 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg46.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls0 ws371">加<span class="_ _6"></span>号 <span class="ff4 ws3bb">(+) </span><span class="ls14 ws174">操作符在作为一些复杂字符串格式化的替代方案的时候通常也工作的很</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">好，比如：</div><div class="t m0 x5 hf y48d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">{} {}<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span></span>format(a,b))</span></span></div><div class="t m0 x5 hf y48e ff8 fs5 fc8 sc0 ls0 ws4">Is Chicago Not Chicago?</div><div class="t m0 x5 hf y48f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">+</span><span class="ff9 fc9 ws38a">&apos; &apos; </span><span class="fc6 ls33">+</span>b)</span></span></div><div class="t m0 x5 hf y490 ff8 fs5 fc8 sc0 ls0 ws4">Is Chicago Not Chicago?</div><div class="t m0 x5 hf y7ab ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y7ac ff1 fs3 fc0 sc0 ls22 ws119">如果你想在源码中将两个字面字符串合并起来，你只需要简单的将它们放到一起<span class="_ _1"></span>，</div><div class="t m0 x5 h7 y7ad ff1 fs3 fc0 sc0 ls0 ws14">不需要用加号 <span class="ff4 wsa5">(+)</span>。比如：</div><div class="t m0 x5 hf y7ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Hello<span class="ff9 ws286">&apos; &apos;</span>World<span class="ff9">&apos;</span></span></span></span></span></div><div class="t m0 x5 hf y7af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf y7b0 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">HelloWorld<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y7b1 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y7b2 ff2 fs2 fc4 sc0 ls0 ws212">4.14.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y7b3 ff1 fs3 fc0 sc0 ls3a ws153">字符串合并可能看上去并不需要用一整节来讨论。但是不应该小看这个问题，程序</div><div class="t m0 x5 h9 y7b4 ff1 fs3 fc0 sc0 ls0">员通常在字符串格式化的时候因为选择不当而给应用程序带来严重性能损失。</div><div class="t m0 x0 h7 y7b5 ff1 fs3 fc0 sc0 ls49 ws3bc">最重要的需要引起注意的是<span class="_ _1"></span>，当我们使用加号 <span class="ff4 ls0 ws3bd">(+) </span><span class="ws1a6">操作符去连接大量的字符串的<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y7b6 ff1 fs3 fc0 sc0 ls1e ws111">时候是非常低效率的<span class="_ _1"></span>，因为加号连接会引起内存复制以及垃圾回收操作<span class="_ _1"></span>。特别的<span class="_ _1"></span>，你</div><div class="t m0 x5 h9 y7b7 ff1 fs3 fc0 sc0 ls0">永远都不应像下面这样写字符串连接代码：</div><div class="t m0 x5 hf y7b8 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=<span class="ff9 fc9 ls0 ws13b">&apos;&apos;</span></span></div><div class="t m0 x5 hf y7b9 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">p</span><span class="ws160">in <span class="ff8 fc0">parts:</span></span></div><div class="t m0 x15 hf y7ba ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls0 ws1a1">+= <span class="fc0">p</span></span></div><div class="t m0 x0 h7 y7bb ff1 fs3 fc0 sc0 ls68 ws3be">这种写法会比使用 <span class="ff6 ls0 ws3bf">join() </span><span class="ws3c0">方法运行的要慢一些，因为每一次执行 <span class="ff4 ls0 ws3c1">+= </span><span class="ws23f">操作的时候</span></span></div><div class="t m0 x5 h9 y7bc ff1 fs3 fc0 sc0 ls2d ws132">会创建一个新的字符串对象。你最好是先收集所有的字符串片段然后再将它们连接起<span class="_ _1"></span></div><div class="t m0 x5 h9 y7bd ff1 fs3 fc0 sc0 ls0">来。</div><div class="t m0 x0 h7 y7be ff1 fs3 fc0 sc0 ls2c ws3c2">一个相对比较聪明的技巧是利用生成器表达式 <span class="ff4 ls0 wsa5">(<span class="ff1 ws3c3">参考 </span><span class="ws3c4">1.19 <span class="ff1 wsa0">小节</span><span class="lsa6">)</span></span></span><span class="ws12f">转换数据为字符串</span></div><div class="t m0 x5 h9 y7bf ff1 fs3 fc0 sc0 ls0">的同时合并字符串，比如：</div><div class="t m0 x5 hf y7c0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">data <span class="fc6 ls32">=</span><span class="ls34">[</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">ACME</span><span class="ls34">&apos;</span></span><span class="ls33">,</span><span class="fc7 ws13a">50</span><span class="ls32">,</span><span class="fc7 ws13a">91.1</span>]</span></div><div class="t m0 x5 hf y7c1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">,</span>&apos;<span class="ff8 fc6">.<span class="fc0 ls0 ws13a">join(<span class="fca">str</span><span class="ws158">(d) </span></span></span></span><span class="fca ws38d">for <span class="ff8 fc0 ls33">d</span><span class="ws157">in <span class="ff8 fc0">data)</span></span></span></div><div class="t m0 x5 hf y7c2 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">ACME,50,91.1<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y7c3 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y7c4 ff1 fs3 fc0 sc0 ls3a ws153">同样还得注意不必要的字符串连接操作。有时候程序员在没有必要做连接操作的时</div><div class="t m0 x5 h9 y7c5 ff1 fs3 fc0 sc0 ls0">候仍然多此一举。比如在打印的时候：</div><div class="t m0 x5 hf y7c6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">+<span class="ff9 fc9 ls34">&apos;<span class="ff8">:</span><span class="ls32">&apos;</span></span><span class="ls33">+</span><span class="fc0">b</span><span class="ls33">+</span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">:</span><span class="ls32">&apos;</span></span><span class="fc6 ls33">+</span>c) <span class="ffa fcd ws4"># Ugly</span></span></div><div class="t m0 x5 hf y7c7 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8">:</span>&apos;</span><span class="fc6">.</span><span class="ws4">join([a, b, c])) <span class="ffa fcd ws13b"># Still ugly</span></span></span></div><div class="t m0 x5 hf y7c8 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws4">(a, b, c, sep<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13a">:<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span><span class="ffa fcd"># Better</span></span></div><div class="t m0 x0 h7 y7c9 ff1 fs3 fc0 sc0 ls0 ws3c5">当混合使用 <span class="ff4 ws3c6">I/O </span><span class="wsa0">操作和字符串连接操作的时候，<span class="_ _c"></span>有时候需要仔细研究你的程序。<span class="_ _c"></span>比</span></div><div class="t m0 x5 h9 y7ca ff1 fs3 fc0 sc0 ls0">如，考虑下面的两端代码片段：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.14.<span class="_ _5"> </span>2.14 <span class="ff1 ws3ba">合并拼接字符串 </span>61</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
