<div id="pf17" class="pf w0 h0" data-page-no="17"><div class="pc pc17 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg17.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1e8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">push<span class="fc0">(<span class="fca">self</span><span class="ws4">, item, priority):</span></span></span></div><div class="t m0 x16 hf y1e9 ff8 fs5 fc0 sc0 ls0 ws13a">heapq<span class="fc6 ls34">.</span>heappush(<span class="fca">self<span class="fc6">.</span></span><span class="ws4">_queue, (<span class="fc6 ls34">-</span><span class="ws16e">priority, </span></span><span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws13b">_index, item))</span></div><div class="t m0 x16 hf y1ea ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_index </span><span class="ws1a1">+= <span class="fc7">1</span></span></span></div><div class="t m0 x15 hf y1eb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">pop<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1ec ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">heapq<span class="fc6">.</span>heappop(<span class="fca">self<span class="fc6 ls34">.</span></span>_queue)[<span class="fc6">-<span class="fc7 ls34">1</span></span>]</span></div><div class="t m0 x0 h9 y1ed ff1 fs3 fc0 sc0 ls0">下面是它的使用方式：</div><div class="t m0 x5 hf y1ee ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws16a">class <span class="fcc ws156">Item<span class="ff8 fc0">:</span></span></span></div><div class="t m0 x5 hf y1ef ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name):</span></span></span></span></div><div class="t m0 x5 hf y1f0 ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fca ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls32">=</span><span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y1f1 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws139">def <span class="ff8 fcb ws13a">__repr__<span class="fc0">(<span class="fca">self</span>):</span></span></span></div><div class="t m0 x5 hf y1f2 ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="fca ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Item({!r})</span>&apos;</span><span class="ff8 fc6 ws13a">.<span class="fc0">format(<span class="fca">self</span></span><span class="ls34">.</span><span class="fc0">name)</span></span></span></div><div class="t m0 x5 h10 y1f3 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y1f4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">q<span class="fc6 ls33">=</span><span class="ls0">PriorityQueue()</span></span></div><div class="t m0 x5 hf y1f5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">push(Item(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">foo<span class="ff9 ws13b">&apos;</span></span><span class="ws159">), </span></span></span><span class="fc7">1</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1f6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">push(Item(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">bar<span class="ff9 ws13b">&apos;</span></span><span class="ws159">), </span></span></span><span class="fc7">5</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1f7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">push(Item(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">spam<span class="ff9 ls34">&apos;</span></span><span class="ws159">), </span></span></span><span class="fc7">4</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1f8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">push(Item(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">grok<span class="ff9 ls34">&apos;</span></span><span class="ws159">), </span></span></span><span class="fc7">1</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1f9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">pop()</span></span></span></div><div class="t m0 x5 hf y1fa ff8 fs5 fc8 sc0 ls0 ws13a">Item(<span class="ff9 ws13b">&apos;</span>bar<span class="ff9 ws13b">&apos;</span>)</div><div class="t m0 x5 hf y1fb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">pop()</span></span></span></div><div class="t m0 x5 hf y1fc ff8 fs5 fc8 sc0 ls0 ws13a">Item(<span class="ff9 ws13b">&apos;</span>spam<span class="ff9 ls34">&apos;</span>)</div><div class="t m0 x5 hf y1fd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">pop()</span></span></span></div><div class="t m0 x5 hf y1fe ff8 fs5 fc8 sc0 ls0 ws13a">Item(<span class="ff9 ws13b">&apos;</span>foo<span class="ff9 ws13b">&apos;</span>)</div><div class="t m0 x5 hf y1ff ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">q<span class="fc6 ls0 ws13a">.<span class="fc0">pop()</span></span></span></div><div class="t m0 x5 hf y200 ff8 fs5 fc8 sc0 ls0 ws13a">Item(<span class="ff9 ws13b">&apos;</span>grok<span class="ff9 ls34">&apos;</span>)</div><div class="t m0 x5 hf y201 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y202 ff1 fs3 fc0 sc0 ls0 ws1a4">仔<span class="_ _6"></span>细<span class="_ _6"></span>观<span class="_ _6"></span>察<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>发<span class="_ _6"></span>现，<span class="_ _6"></span>第<span class="_ _6"></span>一<span class="_ _6"></span>个 <span class="ff6 ws1a5">pop() </span><span class="ls49 ws1a6">操作返回优先级最高的元素<span class="_ _1"></span>。另外注意到如果</span></div><div class="t m0 x5 h7 y203 ff1 fs3 fc0 sc0 ls0 ws1a7">两个有着相同优先级的元素 <span class="ff4 ls4a">(</span><span class="ff6 ws1a8">foo </span><span class="ls4b">和</span><span class="ff6 ws1a9">grok <span class="ff4 wsa5">)</span></span><span class="wsa0">，<span class="_ _1"></span><span class="ff4 ws1aa">p<span class="_ _6"></span>op <span class="ff1">操作按照它们被插入到队列的顺序返</span></span></span></div><div class="t m0 x5 h9 y204 ff1 fs3 fc0 sc0 ls0">回的。</div><div class="t m0 x5 he y205 ff2 fs2 fc4 sc0 ls0 ws135">3.5.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y206 ff1 fs3 fc0 sc0 ls4c ws1ab">这一小节我们主要关注 <span class="ff6 ls0 ws1ac">heapq <span class="ff1 ws1ad">模 块 的 使 用。 函 数<span class="_ _e"> </span></span><span class="ws1ae">heapq.heappush() <span class="ff1">和</span></span></span></div><div class="t m0 x5 h7 y207 ff6 fs3 fc0 sc0 ls0 ws1af">heapq.heappop() <span class="ff1 ws1b0">分别在队列 </span><span class="ws1b1">queue <span class="ff1 ws1b2">上插入和删除第一个元素，并且队列 <span class="ff4 ws1b3">queue </span>保证</span></span></div><div class="t m0 x5 h7 y208 ff1 fs3 fc0 sc0 ls3d ws1b4">第一个元素拥有最小优先级 <span class="ff4 ls0 ws1b5">(1.4 </span><span class="ws164">节已经讨论过这个问题<span class="ff4 ls1b">)</span><span class="ls4d">。<span class="ff6 ls0 ws1b6">heappop() <span class="ff1 wsa0">函数总<span class="_ _6"></span>是返回<span class="ff4">”</span></span></span></span></span></div><div class="t m0 x5 h7 y209 ff1 fs3 fc0 sc0 ls0 wsa0">最小的<span class="ff4 ls4e">”</span><span class="ls1f ws1b7">的元素，这就是保证队列 </span><span class="ff4 ws1b8">p<span class="_ _6"></span>op </span><span class="ls1f ws1b9">操作返回正确元素的关键。另外，由于 </span><span class="ff4 ws1ba">push </span>和</div><div class="t m0 x5 h7 y20a ff4 fs3 fc0 sc0 ls0 ws1bb">p<span class="_ _6"></span>op <span class="ff1 ws1bc">操作时间复杂度为 </span><span class="ws1bd">O(log N)<span class="ff1 ws1be">，其中 </span><span class="ls4f">N</span><span class="ff1 ws1bf">是堆的大小，<span class="_ _1"></span>因此就算是 <span class="ff4 ls50">N</span>很大的时候它们</span></span></div><div class="t m0 x5 h9 y20b ff1 fs3 fc0 sc0 ls0">运行速度也依旧很快。</div><div class="t m0 x0 h9 y20c ff1 fs3 fc0 sc0 ls0 ws1c0">在上面代码中，队列包含<span class="_ _6"></span>了一个 <span class="ff6 ws1c1">(-priority,<span class="_ _11"> </span>index,<span class="_ _11"> </span>item) </span><span class="wsa0">的元组。优先级为负</span></div><div class="t m0 x5 h9 y20d ff1 fs3 fc0 sc0 ls2d ws132">数的目的是使得元素按照优先级从高到低排序。这个跟普通的按优先级从低到高排序<span class="_ _1"></span></div><div class="t m0 x5 h9 y20e ff1 fs3 fc0 sc0 ls0">的堆排序恰巧相反。</div><div class="t m0 x0 h9 y20f ff6 fs3 fc0 sc0 ls0 ws1c2">index <span class="ff1 ls1d ws1c3">变量的作用是保证同等优先级元素的正确排序<span class="_ _c"></span>。通过保存一个不断增加的</span></div><div class="t m0 x5 h9 y210 ff6 fs3 fc0 sc0 ls0 ws1c4">index <span class="ff1 ls30 ws1c5">下标变量，可以确保元素按照它们插入的顺序排序<span class="_ _c"></span>。而且， <span class="ff6 ls0 ws1c4">index </span><span class="ws138">变量也在相</span></span></div><div class="t m0 x5 h9 y211 ff1 fs3 fc0 sc0 ls0">同优先级元素比较的时候起到重要作用。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">3.5.<span class="_ _5"> </span>1.5 <span class="ff1 ws1a0">实现一个优先级队列 </span>14</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
