<div id="pf15d" class="pf w0 h0" data-page-no="15d"><div class="pc pc15d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg15d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">11.18<span class="_ _e"> </span>9.18 <span class="ff1">以编程方式定义类</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">11.18.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y114 ff1 fs3 fc0 sc0 ls3a ws153">你在写一段代码，最终需要创建一个新的类对象。你考虑将类的定义源代码以字符</div><div class="t m0 x5 h9 y115 ff1 fs3 fc0 sc0 ls0 ws8f9">串的形式发布出去。并且使用函数比如 <span class="ff6 ws25d">exec() </span><span class="wsa0">来执行它，但是你想寻找一个更加优雅</span></div><div class="t m0 x5 h9 y2484 ff1 fs3 fc0 sc0 ls0">的解决方案。</div><div class="t m0 x5 he y2485 ff2 fs2 fc4 sc0 ls0 wsadf">11.18.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 yf11 ff1 fs3 fc0 sc0 ls0 wsc63">你<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>使<span class="_ _6"></span>用<span class="_ _0"></span>函数 <span class="ff6 wsc64">types.new class()<span class="_ _18"> </span></span><span class="ls36 ws14a">来初始化新的类对象<span class="_ _c"></span>。你需要做的只是提供</span></div><div class="t m0 x5 h9 yf12 ff1 fs3 fc0 sc0 ls1e ws111">类的名字<span class="_ _1"></span>、父类元组、关键字参数<span class="_ _c"></span>，以及一个用成员变量填充类字<span class="_ _6"></span>典的回调函数<span class="_ _1"></span>。例</div><div class="t m0 x5 h9 y2486 ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 h11 yd42 ffa fs5 fcd sc0 ls0 ws4"># stock.py</div><div class="t m0 x5 h11 yd43 ffa fs5 fcd sc0 ls0 ws4"># Example of making a class manually from parts</div><div class="t m0 x5 h11 y2487 ffa fs5 fcd sc0 ls0 ws4"># Methods</div><div class="t m0 x5 hf y2488 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, shares, price):</span></span></span></div><div class="t m0 x15 hf y22ce ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws161">name <span class="fc6 ls33">=</span>name</span></div><div class="t m0 x15 hf y2489 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws145">shares <span class="fc6 ls32">=</span>shares</span></div><div class="t m0 x15 hf y248a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws15f">price <span class="fc6 ls32">=</span>price</span></div><div class="t m0 x5 hf y248b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">cost<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x15 hf y248c ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws145">shares <span class="fc6 ls32">*</span></span>self<span class="fc6 ls34">.</span><span class="fc0">price</span></span></div><div class="t m0 x5 hf y248d ff8 fs5 fc0 sc0 ls0 ws16d">cls_dict <span class="fc6 ls32">=</span>{</div><div class="t m0 x15 hf y248e ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">__init__</span><span class="ls33">&apos;<span class="ff8 fc0 ls0 ws13b">: __init__,</span></span></div><div class="t m0 x15 hf y248f ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">cost</span><span class="ls32">&apos;<span class="ff8 fc0 ls0 ws4">: cost,</span></span></div><div class="t m0 x5 hf y2490 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 h11 y2491 ffa fs5 fcd sc0 ls0 ws4"># Make a class</div><div class="t m0 x5 h10 y2492 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">types</span></div><div class="t m0 x5 hf y1755 ff8 fs5 fc0 sc0 ls0 ws15f">Stock <span class="fc6 ls33">=</span><span class="ws13a">types<span class="fc6 ls34">.</span>new_class(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Stock<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, (), {}, <span class="ff7 fca ws146">lambda </span>ns: ns<span class="fc6 ls34">.</span>update(cls_dict))</span></span></div><div class="t m0 x5 hf y2493 ff8 fs5 fc0 sc0 ls0 ws13a">Stock<span class="fc6">.</span><span class="ws2a3">__module__ <span class="fc6 ls33">=</span>__name__</span></div><div class="t m0 x0 h9 y2494 ff1 fs3 fc0 sc0 ls0">这种方式会构建一个普通的类对象，并且按照你的期望工作：</div><div class="t m0 x5 hf y2495 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ls34">&apos;</span></span></span>,<span class="fc7 ls0 ws13a">50</span><span class="ls33">,<span class="fc7 ls0 ws13a">91.1<span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y2496 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">s</span></div><div class="t m0 x5 hf y2497 ff8 fs5 fc8 sc0 ls0 ws4">&lt;stock.Stock object at 0x1006a9b10&gt;</div><div class="t m0 x5 hf y2498 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">cost()</span></span></span></div><div class="t m0 x5 hf y2499 ff8 fs5 fc8 sc0 ls0">4555.0</div><div class="t m0 x5 hf y249a ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y249b ff1 fs3 fc0 sc0 ls0 wsc65">这 种 方 法 中， 一 个 比 较 难 理 解 的 地 方 是 在 调 用 完<span class="_ _e"> </span><span class="ff6 wsc64">types.new class()<span class="_ _13"> </span></span>对</div><div class="t m0 x5 h9 y249c ff6 fs3 fc0 sc0 ls0 wsc66">Stock. module<span class="_ _33"> </span><span class="ff1 ls14f wsc67">的赋值<span class="_ _d"></span>。每次当一个类被定义后<span class="_ _d"></span>，它的 <span class="ff6 ls0 wsc68">module </span><span class="ws91d">属性包含定义<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y249d ff1 fs3 fc0 sc0 ls0 wsc69">它的<span class="_ _6"></span>模<span class="_ _6"></span>块名。<span class="_ _6"></span>这<span class="_ _6"></span>个<span class="_ _6"></span>名字<span class="_ _6"></span>用<span class="_ _6"></span>于生<span class="_ _6"></span>成 <span class="ff6 ws8e8">repr<span class="_ _e"> </span>() </span><span class="wsa0">方<span class="_ _6"></span>法的<span class="_ _6"></span>输<span class="_ _6"></span>出。它<span class="_ _6"></span>同<span class="_ _6"></span>样<span class="_ _6"></span>也被<span class="_ _6"></span>用<span class="_ _6"></span>于很<span class="_ _6"></span>多<span class="_ _6"></span>库，比</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.18.<span class="_ _5"> </span>9.18 <span class="ff1 wsae1">以编程方式定义类 </span>340</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
