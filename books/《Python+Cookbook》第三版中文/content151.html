<div id="pf97" class="pf w0 h0" data-page-no="97"><div class="pc pc97 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg97.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h10 yb1e ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">array</span></div><div class="t m0 x5 hf yb1f ff8 fs5 fc0 sc0 ls0 ws13c">nums <span class="fc6 ls32">=</span><span class="ws13a">array<span class="fc6">.</span>array(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">i<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, [<span class="fc7 ls34">1</span><span class="ls32">,<span class="fc7 ls34">2</span><span class="ls33">,</span></span></span><span class="fc7">3</span><span class="ls33">,</span><span class="fc7">4</span>])</span></div><div class="t m0 x5 hf yb20 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">data.bin<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">wb<span class="ff9 ls34">&apos;</span></span><span class="ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf yb21 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(nums)</span></span></div><div class="t m0 x0 h7 y108d ff1 fs3 fc0 sc0 lsa8 ws3de">这个适用于任何实现了被称之为<span class="ff4 ls109">”</span>缓冲接口<span class="_ _1"></span><span class="ff4 ls10a">”<span class="ff1 lsa8">的对象，这种对象会直接暴露其底层<span class="_ _1"></span></span></span></div><div class="t m0 x5 h9 y108e ff1 fs3 fc0 sc0 ls0">的内存缓冲区给能处理它的操作。二进制数据的写入就是这类操作之一。</div><div class="t m0 x0 h9 y108f ff1 fs3 fc0 sc0 ls18 ws661">很多对象还允许通过使用文件对象的 <span class="ff6 ls0 ws2e6">readinto() </span><span class="ws110">方法直接读取二进制数据到其底</span></div><div class="t m0 x5 h9 y1090 ff1 fs3 fc0 sc0 ls0">层的内存中去。比如：</div><div class="t m0 x5 h10 y1091 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">array</span></span></div><div class="t m0 x5 hf y1092 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">array<span class="fc6 ls34">.</span>array(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">i<span class="ff9">&apos;</span></span></span><span class="ws13b">, [<span class="fc7 ls34">0</span></span></span>,<span class="fc7 ls34">0</span>,<span class="fc7 ls34">0</span>,<span class="fc7 ls34">0</span><span class="ls33">,<span class="fc7 ls0 ws13a">0</span>,<span class="fc7 ls34">0</span></span>,<span class="fc7 ls34">0</span>,<span class="fc7 ls34">0</span><span class="ls0">])</span></span></div><div class="t m0 x5 hf y1093 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9">data.bin<span class="ff9 ws13b">&apos;</span><span class="fc0 ls33">,</span><span class="ff9 ls34">&apos;</span>rb<span class="ff9 ls34">&apos;</span><span class="fc0 ls32">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y1094 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">readinto(a)</span></span></span></div><div class="t m0 x5 h10 y1095 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y1096 ff8 fs5 fc8 sc0 ls0">16</div><div class="t m0 x5 hf y1097 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf y1098 ff8 fs5 fc8 sc0 ls0 ws13a">array(<span class="ff9 ls34">&apos;<span class="ff8">i</span>&apos;</span><span class="ws4">, [1, 2, 3, 4, 0, 0, 0, 0])</span></div><div class="t m0 x5 hf y1099 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y109a ff1 fs3 fc0 sc0 ls3a ws153">但是使用这种技术的时候需要格外小心，因为它通常具有平台相关性，并且可能会</div><div class="t m0 x5 h7 y109b ff1 fs3 fc0 sc0 ls0 ws662">依<span class="_ _6"></span>赖字<span class="_ _6"></span>长<span class="_ _6"></span>和<span class="_ _6"></span>字<span class="_ _6"></span>节顺<span class="_ _6"></span>序 <span class="ff4 wsa5">(</span><span class="wsa0">高<span class="_ _6"></span>位<span class="_ _6"></span>优先<span class="_ _6"></span>和<span class="_ _6"></span>低<span class="_ _6"></span>位<span class="_ _6"></span>优先<span class="ff4 wsa5">)</span><span class="ws663">。<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>查<span class="_ _6"></span>看 <span class="ff4 ws664">5.9 </span><span class="ls2d ws132">小节中另外一个读取二进</span></span></span></div><div class="t m0 x5 h9 y109c ff1 fs3 fc0 sc0 ls0">制数据到可修改缓冲区的例子。</div><div class="t m0 x5 hd y109d ff2 fs4 fc4 sc0 ls0 ws134">7.5<span class="_ _e"> </span>5.5 <span class="ff1">文件不存在才能写入</span></div><div class="t m0 x5 he y109e ff2 fs2 fc4 sc0 ls0 ws135">7.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y109f ff1 fs3 fc0 sc0 ls3a ws153">你想像一个文件中写入数据，但是前提必须是这个文件在文件系统上不存在。也就</div><div class="t m0 x5 h9 y10a0 ff1 fs3 fc0 sc0 ls0">是不允许覆盖已存在的文件内容。</div><div class="t m0 x5 he y10a1 ff2 fs2 fc4 sc0 ls0 ws135">7.5.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y10a2 ff1 fs3 fc0 sc0 ls0 ws38">可以在 <span class="ff6 ws25d">open() </span>函数中使用 <span class="ff6 ls86">x</span><span class="ws63">模式来代替 <span class="ff6 ls86">w</span>模式的方法来解决这个问题。比如：</span></div><div class="t m0 x5 hf y10a3 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; with open(<span class="ff9 ls34">&apos;</span><span class="ws13a">somefile<span class="ff9 ws13b">&apos;</span><span class="ls33">,<span class="ff9 ls34">&apos;</span></span>wt<span class="ff9 ls34">&apos;</span><span class="ws13b">) as f:</span></span></div><div class="t m0 x5 hf y10a4 ff8 fs5 fc0 sc0 ls0 ws665">... f.write(<span class="ff9 ws13b">&apos;</span><span class="ws13a">Hello\n<span class="ff9 ls34">&apos;</span>)</span></div><div class="t m0 x5 hf y10a5 ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x5 hf y10a6 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; with open(<span class="ff9 ls34">&apos;</span><span class="ws13a">somefile<span class="ff9 ws13b">&apos;</span><span class="ls33">,<span class="ff9 ls34">&apos;</span></span>xt<span class="ff9 ls34">&apos;</span><span class="ws13b">) as f:</span></span></div><div class="t m0 x5 hf y10a7 ff8 fs5 fc0 sc0 ls0 ws665">... f.write(<span class="ff9 ws13b">&apos;</span><span class="ws13a">Hello\n<span class="ff9 ls34">&apos;</span>)</span></div><div class="t m0 x5 hf y10a8 ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x5 hf y10a9 ff8 fs5 fc0 sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 hf y10aa ff8 fs5 fc0 sc0 ls0 ws4">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</div><div class="t m0 x5 hf y10ab ff8 fs5 fc0 sc0 ls0 ws4">FileExistsError: [Errno 17] File exists: <span class="ff9 ls34">&apos;</span><span class="ws13a">somefile<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y10ac ff8 fs5 fc0 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y10ad ff1 fs3 fc0 sc0 ls0 wsc">如果文件是二进制的，使用 <span class="ff6 ws255">xb </span><span class="ws38">来代替 <span class="ff6">xt</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.5.<span class="_ _5"> </span>5.5 <span class="ff1 ws666">文件不存在才能写入 </span>142</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
