<div id="pf104" class="pf w0 h0" data-page-no="104"><div class="pc pc104 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg104.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws9c6">10.9<span class="_ _e"> </span>8.9 <span class="ff1">创建新的类或实例属性</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws212">10.9.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2b2 ff1 fs3 fc0 sc0 ls0">你想创建一个新的拥有一些额外功能的实例属性类型，比如类型检查。</div><div class="t m0 x5 he y2b3 ff2 fs2 fc4 sc0 ls0 ws212">10.9.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2b4 ff1 fs3 fc0 sc0 ls63 ws21f">如果你想创建一个全新的实例属性<span class="_ _c"></span>，可以通过一个描述器类的形式来定义它的功<span class="_ _1"></span></div><div class="t m0 x5 h9 y6d2 ff1 fs3 fc0 sc0 ls0">能。下面是一个例子：</div><div class="t m0 x5 h11 y1444 ffa fs5 fcd sc0 ls0 ws4"># Descriptor attribute for an integer type-checked attribute</div><div class="t m0 x5 hf y1445 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Integer<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c38 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name):</span></span></span></div><div class="t m0 x16 hf y1446 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x15 hf y1448 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__get__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, cls):</span></span></span></div><div class="t m0 x16 hf y1c39 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">instance </span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1449 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">self</span></div><div class="t m0 x16 hf y144a ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y144b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6 ls34">.</span></span>name]</span></div><div class="t m0 x15 hf y144d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__set__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, value):</span></span></span></div><div class="t m0 x16 hf y718 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws155">(value, </span>int<span class="fc0">):</span></span></div><div class="t m0 x17 hf y144e ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Expected an int<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x16 hf y144f ff8 fs5 fc0 sc0 ls0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws15f">name] <span class="fc6 ls32">=</span>value</span></div><div class="t m0 x15 hf y1451 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__delete__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance):</span></span></span></div><div class="t m0 x16 hf y1c3a ff7 fs5 fca sc0 ls0 ws139">del <span class="ff8 fc0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6">.</span></span>name]</span></div><div class="t m0 x0 h7 y81f ff1 fs3 fc0 sc0 ls17 wsac6">一个描述器就是一个实现了三个核心的属性访问操作 <span class="ff4 ls0 wsac7">(get, set, delete) <span class="ff1 wsa0">的<span class="_ _6"></span>类，分<span class="_ _6"></span>别</span></span></div><div class="t m0 x5 h9 y154c ff1 fs3 fc0 sc0 ls175">为<span class="ff6 ls0 wsac8">get<span class="_ _e"> </span>() </span><span class="ls176">、<span class="ff6 ls0 wsac8">set<span class="_ _e"> </span>() </span></span>和<span class="ff6 ls0 ws5f7">delete<span class="_ _e"> </span>() </span><span class="ls10 wsdf">这三个特殊的方法<span class="_ _1"></span>。这些方法接受一个实例</span></div><div class="t m0 x5 h9 y1c3b ff1 fs3 fc0 sc0 ls0">作为输入，之后相应的操作实例底层的字典。</div><div class="t m0 x0 h9 y1c3c ff1 fs3 fc0 sc0 ls3a ws153">为了使用一个描述器，需将这个描述器的实例作为类属性放到一个类的定义中。例</div><div class="t m0 x5 h9 y1c3d ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 hf y1c3e ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1c3f ff8 fs5 fc0 sc0 ls32">x<span class="fc6 ls33">=</span><span class="ls0 ws13a">Integer(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">x<span class="ff9">&apos;</span></span></span>)</span></div><div class="t m0 x15 hf y1c40 ff8 fs5 fc0 sc0 ls32">y<span class="fc6 ls33">=</span><span class="ls0 ws13a">Integer(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">y<span class="ff9">&apos;</span></span></span>)</span></div><div class="t m0 x15 hf y1c41 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></div><div class="t m0 x16 hf y1c42 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></div><div class="t m0 x16 hf y1c43 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">y</span><span class="ls32">=</span><span class="fc0">y</span></span></div><div class="t m0 x0 h7 y1c44 ff1 fs3 fc0 sc0 ls0 wsac9">当你这样做后，所有对描述器属性 <span class="ff4 wsa5">(</span><span class="ws22b">比如 <span class="ff4 ls177">x</span><span class="ls178">或</span><span class="ff4 wsaca">y) </span><span class="wsacb">的访问会被 <span class="ff6 ws9cc">get<span class="_ _e"> </span>() </span><span class="ls179">、</span><span class="ff6 ws9c3">set ()</span></span></span></div><div class="t m0 x5 h9 y1c45 ff1 fs3 fc0 sc0 ls17a">和<span class="ff6 ls0 ws308">delete<span class="_ _e"> </span>() <span class="ff1">方法捕获到。例如：</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">10.9.<span class="_ _5"> </span>8.9 <span class="ff1 ws9db">创建新的类或实例属性 </span>251</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
