<div id="pfa4" class="pf w0 h0" data-page-no="a4"><div class="pc pca4 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bga4.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y1e8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Open file with raw filename</span></div><div class="t m0 x5 hf y1e9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 ws13a">open<span class="fc0">(b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">jalapen<span class="ff7 ws156">\xcc\x83</span>o.txt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y1ea ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ws13a">(f<span class="fc6 ls34">.</span>read())</span></span></div><div class="t m0 x5 h10 y903 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y1eb ff8 fs5 fc8 sc0 ls0">Spicy!</div><div class="t m0 x5 hf y1ec ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 yd19 ff1 fs3 fc0 sc0 ls0 ws6ca">正如你所见，<span class="_ _c"></span>在最后两个操作中，当你给文件相关函数如 <span class="ff6 ws6cb">open() </span><span class="ls116">和</span><span class="ff6">os.listdir()</span></div><div class="t m0 x5 h9 y11de ff1 fs3 fc0 sc0 ls0">传递字节字符串时，文件名的处理方式会稍有不同。</div><div class="t m0 x5 he y11df ff2 fs2 fc4 sc0 ls0 ws212">7.14.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y106d ff1 fs3 fc0 sc0 ls56 ws1fa">通常来讲<span class="_ _c"></span>，你不需要担心文件名的编码和解码<span class="_ _1"></span>，普通的文件名操作应该就没问题<span class="_ _1"></span></div><div class="t m0 x5 h9 y11e0 ff1 fs3 fc0 sc0 ls13 wse5">了<span class="_ _1"></span>。但是，有些操作系统允许用户通过偶然或恶意方式去创建名字不符合默认编码的<span class="_ _c"></span></div><div class="t m0 x5 h7 ybe ff1 fs3 fc0 sc0 ls0 ws63">文件。这些文件名可能会神秘地中断那些需要处理大量文件的 <span class="ff4 ws5c">Python </span>程序。</div><div class="t m0 x0 h9 y11e1 ff1 fs3 fc0 sc0 ls3a ws153">读取目录并通过原始未解码方式处理文件名可以有效的避免这样的问题，尽管这样</div><div class="t m0 x5 h9 y11e2 ff1 fs3 fc0 sc0 ls0">会带来一定的编程难度。</div><div class="t m0 x0 h7 y11e3 ff1 fs3 fc0 sc0 ls0 ws14">关于打印不可解码的文件名，请参考 <span class="ff4 ws1d0">5.15 </span>小节。</div><div class="t m0 x5 hd y11e4 ff2 fs4 fc4 sc0 ls0 ws211">7.15<span class="_ _e"> </span>5.15 <span class="ff1">打印不合法的文件名</span></div><div class="t m0 x5 he y11e5 ff2 fs2 fc4 sc0 ls0 ws212">7.15.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y11e6 ff1 fs3 fc0 sc0 ls63 ws21f">你的程序获取了一个目录中的文件名列表<span class="_ _c"></span>，但是当它试着去打印文件名的时候程<span class="_ _1"></span></div><div class="t m0 x5 h9 y11e7 ff1 fs3 fc0 sc0 ls0 ws6cc">序<span class="_ _0"></span>崩<span class="_ _0"></span>溃，<span class="_ _6"></span>出<span class="_ _0"></span>现<span class="_ _0"></span>了 <span class="ff6 ws6cd">UnicodeEncodeError </span><span class="ls117 ws6ce">异常和一条奇怪的消息—<span class="_ _1d"></span>— <span class="ff6 ls0 ws6cf">surrogates not</span></span></div><div class="t m0 x5 h9 y11e8 ff6 fs3 fc0 sc0 ls0 ws23a">allowed <span class="ff1">。</span></div><div class="t m0 x5 he y11e9 ff2 fs2 fc4 sc0 ls0 ws212">7.15.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y11ea ff1 fs3 fc0 sc0 ls0">当打印未知的文件名时，使用下面的方法可以避免这样的错误：</div><div class="t m0 x5 hf y803 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bad_filename<span class="fc0">(filename):</span></span></div><div class="t m0 x15 hf y11eb ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">repr<span class="fc0">(filename)[<span class="fc7 ls34">1</span>:<span class="fc6 ls34">-<span class="fc7">1</span></span>]</span></span></div><div class="t m0 x5 hf y11ec ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y11ed ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(filename)</span></div><div class="t m0 x5 hf y11ee ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">UnicodeEncodeError<span class="fc0">:</span></span></div><div class="t m0 x15 hf y11ef ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(bad_filename(filename))</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.15.<span class="_ _5"> </span>5.15 <span class="ff1 ws544">打印不合法的文件名 </span>155</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
