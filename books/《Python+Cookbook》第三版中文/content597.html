<div id="pf255" class="pf w0 h0" data-page-no="255"><div class="pc pc255 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg255.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls0 ws1546">结果<span class="_ _6"></span>函<span class="_ _6"></span>数<span class="_ _6"></span>的使<span class="_ _6"></span>用<span class="_ _6"></span>方<span class="_ _6"></span>法如<span class="_ _6"></span>下。<span class="_ _6"></span>仔细<span class="_ _6"></span>观<span class="_ _6"></span>察<span class="_ _6"></span>嵌入<span class="_ _6"></span>了 <span class="ff4 ws1547">NULL </span><span class="ws1548">字<span class="_ _6"></span>节的<span class="_ _6"></span>字<span class="_ _6"></span>符<span class="_ _6"></span>串以<span class="_ _6"></span>及 <span class="ff4 ws1549">Unico<span class="_ _6"></span>de </span>支</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">持是怎样被拒绝的：</div><div class="t m0 x5 hf y3959 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Hello World<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y395a ff8 fs5 fc8 sc0 ls0 ws4">48 65 6c 6c 6f 20 57 6f 72 6c 64</div><div class="t m0 x5 hf y395b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Hello<span class="ff7 ws156">\x00</span>World<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y395c ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y395d ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y395e ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: must be bytes without null bytes, not bytes</span></div><div class="t m0 x5 hf y395f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Hello World</span><span class="ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3960 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y34 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y3961 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ls32">:<span class="ff9 ls34">&apos;</span><span class="ls0">str</span><span class="ff9">&apos;</span><span class="ls0 ws4">does not support the buffer interface</span></span></div><div class="t m0 x5 hf y3962 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y3963 ff1 fs3 fc0 sc0 ls0 ws154a">如<span class="_ _6"></span>果<span class="_ _6"></span>你<span class="_ _0"></span>想<span class="_ _6"></span>传<span class="_ _6"></span>递 <span class="ff4 ws154b">Unico<span class="_ _6"></span>de </span><span class="ws154c">字<span class="_ _6"></span>符<span class="_ _0"></span>串，<span class="_ _6"></span>在 <span class="ff6 ws149">PyArg ParseTuple()<span class="_ _7"> </span></span><span class="wsa0">中<span class="_ _0"></span>使<span class="_ _6"></span>用”<span class="_ _6"></span><span class="ff4 ls297">s</span>“格<span class="_ _0"></span>式码，<span class="_ _0"></span>如</span></span></div><div class="t m0 x5 h9 y3964 ff1 fs3 fc0 sc0 ls0">下：</div><div class="t m0 x5 hf y3965 ff8 fs5 fc0 sc0 ls0 ws4">static PyObject *py_print_chars(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y3966 ff8 fs5 fc0 sc0 ls0 ws4">char *s;</div><div class="t m0 x19 hf y3967 ff8 fs5 fc0 sc0 ls0 ws4">if (!PyArg_ParseTuple(args, &quot;s&quot;, &amp;s)) {</div><div class="t m0 x15 hf y3968 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y3969 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y396a ff8 fs5 fc0 sc0 ls0">print_chars(s);</div><div class="t m0 x19 hf y396b ff8 fs5 fc0 sc0 ls0">Py_RETURN_NONE;</div><div class="t m0 x5 hf y1b30 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x0 h7 y396c ff1 fs3 fc0 sc0 ls51 ws154d">当被使用的时候，它会自动将所有字符串转换为以 <span class="ff4 ls0 ws154e">NULL </span><span class="ws154f">结尾的 <span class="ff4 ls0 ws1550">UTF-8 <span class="ff1 wsa0">编码。例</span></span></span></div><div class="t m0 x5 h9 y396d ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 hf y396e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Hello World</span><span class="ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y396f ff8 fs5 fc8 sc0 ls0 ws4">48 65 6c 6c 6f 20 57 6f 72 6c 64</div><div class="t m0 x5 hf y3970 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Spicy Jalape<span class="ff7 ws156">\u00f1</span><span class="ls34">o<span class="ff9">&apos;</span></span></span></span><span class="lscf">)</span><span class="ffa fcd ws4"># Note: UTF-8 encoding</span></span></div><div class="t m0 x5 hf y3971 ff8 fs5 fc8 sc0 ls0 ws4">53 70 69 63 79 20 4a 61 6c 61 70 65 c3 b1 6f</div><div class="t m0 x5 hf y3972 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Hello<span class="ff7 ws156">\x00</span>World<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y36c9 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y36ca ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y3973 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: must be str without null characters, not str</span></div><div class="t m0 x5 hf y3974 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">print_chars(b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Hello World<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3975 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y3976 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y2ad2 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: must be str, not bytes</span></div><div class="t m0 x5 hf y3977 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3978 ff1 fs3 fc0 sc0 ls1f ws1551">如果因为某些原因，你要直接使用 <span class="ff6 ls0 ws1552">PyObject<span class="_ _11"> </span>* </span><span class="ws85d">而不能使用 <span class="ff6 ls0 wsed9">PyArg<span class="_ _16"> </span>ParseTuple() <span class="ff1">，</span></span></span></div><div class="t m0 x5 h9 y3979 ff1 fs3 fc0 sc0 ls49 ws1553">下面的例子向你展示了怎样从字节和字符串对象中检查和提取一个合适的 <span class="ff6 ls0 ws1554">char<span class="_ _1c"> </span>* <span class="ff1">引</span></span></div><div class="t m0 x5 h9 y397a ff1 fs3 fc0 sc0 ls0">用：</div><div class="t m0 x5 hf y397b ff8 fs5 fc0 sc0 ls0 ws4">/* Some Python Object (obtained somehow) */</div><div class="t m0 x5 hf y397c ff8 fs5 fc0 sc0 ls0 ws4">PyObject *obj;</div><div class="t m0 x5 hf yb42 ff8 fs5 fc0 sc0 ls0 ws4">/* Conversion from bytes */</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">17.13.<span class="_ _36"> </span>15.13 <span class="ff1 ws16b">传递 </span><span class="ws1544">NULL <span class="ff1 ws7da">结尾的字符串给 </span><span class="ls246">C</span><span class="ff1 ws1545">函数库 </span>588</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
