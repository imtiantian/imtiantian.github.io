<div id="pf14c" class="pf w0 h0" data-page-no="14c"><div class="pc pc14c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg14c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y15f ff8 fs5 fc8 sc0 ls5e ws209">123<span class="_ _15"></span></div><div class="t m0 x5 hf y160 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y22c2 ff2 fs2 fc4 sc0 ls0 wsadf">11.11.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y22c3 ff1 fs3 fc0 sc0 ls3a ws153">通过装饰器来给被包装函数增加参数的做法并不常见。尽管如此，有时候它可以避</div><div class="t m0 x5 h9 y22c4 ff1 fs3 fc0 sc0 ls0">免一些重复代码。例如，如果你有下面这样的代码：</div><div class="t m0 x5 hf y22c5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">a<span class="fc0 ls0 ws13b">(x, debug</span><span class="fc6">=</span></span><span class="ff8 ws13a">False<span class="fc0">):</span></span></div><div class="t m0 x15 hf y22c6 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">debug:</span></div><div class="t m0 x16 hf y22c7 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Calling a</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y22c8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">b<span class="fc0 ls0 ws4">(x, y, z, debug<span class="fc6 ws13a">=<span class="fca">False</span></span>):</span></span></div><div class="t m0 x15 hf y22c9 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">debug:</span></div><div class="t m0 x16 hf y22ca ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Calling b</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y22cb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">c<span class="fc0 ls0 ws13b">(x, y, debug</span><span class="fc6">=</span></span><span class="ff8 ws13a">False<span class="fc0">):</span></span></div><div class="t m0 x15 hf y22cc ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">debug:</span></div><div class="t m0 x16 hf y22cd ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Calling c</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x0 h9 y22ce ff1 fs3 fc0 sc0 ls0">那么你可以将其重构成这样：</div><div class="t m0 x5 hf y16d6 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 h10 y16d7 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">inspect</span></div><div class="t m0 x5 hf y16d9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">optional_debug<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y16da ff7 fs5 fca sc0 ls0 ws157">if <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">debug</span><span class="ls33">&apos;</span></span>in <span class="ff8 fc0 ws13a">inspect<span class="fc6 ls34">.</span>getargspec(func)<span class="fc6">.</span>args:</span></div><div class="t m0 x16 hf y22cf ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">debug argument already defined<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x15 hf y22d0 ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y22d1 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws4">args, debug</span><span class="ls34">=</span><span class="fca">False<span class="fc0 ls32">,</span></span><span class="ls34">**</span><span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y22d2 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">debug:</span></div><div class="t m0 x17 hf y22d3 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Calling</span>&apos;</span><span class="ls0 ws13b">, func</span><span class="fc6">.</span><span class="ls0">__name__)</span></span></div><div class="t m0 x16 hf y22d4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">func(<span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs)</span></div><div class="t m0 x15 hf y22d5 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x5 h10 y22d6 ff7 fs5 fc12 sc0 ls0">@optional_debug</div><div class="t m0 x5 hf y22d7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">a<span class="fc0 ls0">(x):</span></span></div><div class="t m0 x15 h10 y22d8 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h10 y22d9 ff7 fs5 fc12 sc0 ls0">@optional_debug</div><div class="t m0 x5 hf y22da ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">b<span class="fc0 ls0 ws13b">(x, y, z):</span></span></div><div class="t m0 x15 h10 y22db ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h10 y22dc ff7 fs5 fc12 sc0 ls0">@optional_debug</div><div class="t m0 x5 hf y22dd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">c<span class="fc0 ls0 ws13b">(x, y):</span></span></div><div class="t m0 x15 h10 y22de ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y22df ff1 fs3 fc0 sc0 ls14 wsc12">这种实现方案之所以行得通<span class="_ _1"></span>，在于强制关键字参数很容易被添加到接受 <span class="ff6 ls0 ws177">*args <span class="ff1">和</span></span></div><div class="t m0 x5 h9 y22e0 ff6 fs3 fc0 sc0 ls0 ws492">**kwargs <span class="ff1 wsa0">参数的<span class="_ _6"></span>函数中。<span class="_ _6"></span>通过<span class="_ _6"></span>使用强<span class="_ _6"></span>制关键<span class="_ _6"></span>字参数，<span class="_ _6"></span>它被作<span class="_ _6"></span>为一个<span class="_ _6"></span>特殊<span class="_ _6"></span>情况被<span class="_ _6"></span>挑选出</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.11.<span class="_ _5"> </span>9.11 <span class="ff1 wsb70">装饰器为被包装函数增加参数 </span>323</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
