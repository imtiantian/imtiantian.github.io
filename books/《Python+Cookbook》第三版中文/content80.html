<div id="pf50" class="pf w0 h0" data-page-no="50"><div class="pc pc50 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg50.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls61">在<span class="ff4 ls0 ws42d">EBNF </span><span class="ls0 ws42e">中，被<span class="_ _6"></span>包<span class="_ _6"></span>含<span class="_ _6"></span>在 <span class="ffd ls84">{</span><span class="ff6 ws303">...<span class="ffd ls84">}</span><span class="lsb7">*</span></span><span class="wsa0">中的<span class="_ _6"></span>规<span class="_ _6"></span>则是<span class="_ _6"></span>可<span class="_ _6"></span>选的。<span class="_ _6"></span><span class="ff5 fc2 ws75">*</span><span class="ws42f">代<span class="_ _6"></span>表 <span class="ff4 lsb8">0</span><span class="ws430">次或<span class="_ _6"></span>多<span class="_ _6"></span>次重<span class="_ _6"></span>复 <span class="ff4 wsa5">(</span></span></span>跟<span class="_ _6"></span>正</span></span></div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 wsa0">则表达式中意义是一样的<span class="ff4 wsa5">)</span>。</div><div class="t m0 x0 h7 y8dd ff1 fs3 fc0 sc0 ls0 ws431">现在，<span class="_ _6"></span>如果你<span class="_ _6"></span>对 <span class="ff4 ws432">BNF </span><span class="lse wsd8">的工作机制还不是很明白的话，就把它当做是一组左右符号</span></div><div class="t m0 x5 h7 y99 ff1 fs3 fc0 sc0 ls1f ws433">可相互替换的规则。一般来讲，解析的原理就是你利用 <span class="ff4 ls0 ws434">BNF </span><span class="ws113">完成多个替换和扩展以匹</span></div><div class="t m0 x5 h9 y9a ff1 fs3 fc0 sc0 lse ws435">配输入文本和语法规则。为了演示，假设你正在解析形如 <span class="ff6 ls0 ws436">3 + 4 * 5<span class="_ _16"> </span><span class="ff1 wsa0">的表达<span class="_ _6"></span>式。这<span class="_ _6"></span>个</span></span></div><div class="t m0 x5 h7 y9b ff1 fs3 fc0 sc0 ls3d ws437">表达式先要通过使用 <span class="ff4 ls0 ws438">2.18 </span><span class="ws164">节中介绍的技术分解为一组令牌流。结果可能是像下列这样<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y9c ff1 fs3 fc0 sc0 ls0">的令牌序列：</div><div class="t m0 x5 hf y8de ff8 fs5 fc0 sc0 ls0 ws158">NUM <span class="fc6 ls32">+</span>NUM <span class="fc6 ls33">*</span>NUM</div><div class="t m0 x0 h9 y8df ff1 fs3 fc0 sc0 ls0">在此基础上，解析动作会试着去通过替换操作匹配语法到输入令牌：</div><div class="t m0 x5 hf y8e0 ff8 fs5 fc0 sc0 ls0">expr</div><div class="t m0 x5 hf y8e1 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws13b">term { (<span class="fc6 ls34">+<span class="ffd ls0">|</span>-</span>) term }<span class="fc6">*</span></span></div><div class="t m0 x5 hf y8e2 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws13b">factor { (<span class="fc6 ls34">*<span class="ffd ls0">|<span class="ff8 ws13a">/</span></span></span></span>) factor }<span class="fc6 ls32">*</span>{ (<span class="fc6 ls34">+<span class="ffd ls0 ws13b">|</span>-</span><span class="ws13b">) term }<span class="fc6">*</span></span></div><div class="t m0 x5 hf y8e3 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws13b">NUM { (<span class="fc6 ws13a">*<span class="ffd ws13b">|</span><span class="ls34">/</span></span></span>) factor }<span class="fc6 ls33">*</span><span class="ws13b">{ (<span class="fc6 ls34">+<span class="ffd ls0">|</span>-</span>) term }<span class="fc6">*</span></span></div><div class="t m0 x5 hf y8e4 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws13b">NUM { (<span class="fc6 ws13a">+<span class="ffd ws13b">|</span><span class="ls34">-</span></span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8e5 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws13b">term { (<span class="fc6 ws13a">+<span class="ffd ws13b">|</span><span class="ls34">-</span></span></span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8e6 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws13b">factor { (<span class="fc6 ls34">*<span class="ffd ls0">|</span>/</span>) factor }<span class="fc6 ls32">*</span></span></span>{ (<span class="fc6 ws13a">+<span class="ffd ws13b">|</span><span class="ls34">-</span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8e7 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws13b">NUM { (<span class="fc6 ls34">*<span class="ffd ls0">|<span class="ff8 ws13a">/</span></span></span></span></span>) factor}<span class="fc6 ls32">*</span>{ (<span class="fc6 ws13a">+<span class="ffd ws13b">|</span><span class="ls34">-</span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8e8 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws158">NUM <span class="fc6 ls32">*</span></span></span>factor { (<span class="fc6 ws13a">*<span class="ffd ws13b">|</span><span class="ls34">/</span></span>) factor }<span class="fc6 ls33">*</span><span class="ws13b">{ (<span class="fc6 ls34">+<span class="ffd ls0">|<span class="ff8 ws13a">-</span></span></span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8e9 ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws158">NUM <span class="fc6 ls32">*</span></span></span>NUM { (<span class="fc6 ls34">*<span class="ffd ls0 ws13b">|</span>/</span><span class="ws13b">) factor }<span class="fc6 ls33">*</span>{ (<span class="fc6 ws13a">+<span class="ffd lsb9">|</span>-</span></span>) term }<span class="fc6">*</span></div><div class="t m0 x5 hf y8ea ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws158">NUM <span class="fc6 ls32">*</span></span></span>NUM { (<span class="fc6 ls34">+<span class="ffd ls0 ws13b">|</span>-</span><span class="ws13b">) term }<span class="fc6">*</span></span></div><div class="t m0 x5 hf y8eb ff8 fs5 fc0 sc0 ls0 ws4">expr ::<span class="fc6 ls33">=</span><span class="ws15b">NUM <span class="fc6 ls33">+</span><span class="ws158">NUM <span class="fc6 ls32">*</span>NUM</span></span></div><div class="t m0 x0 h9 y8ec ff1 fs3 fc0 sc0 ls3a ws153">下面所有的解析步骤可能需要花点时间弄明白，但是它们原理都是查找输入并试着</div><div class="t m0 x5 h7 y8ed ff1 fs3 fc0 sc0 ls63 ws439">去匹配语法规则<span class="_ _c"></span>。第一<span class="_ _6"></span>个输入令牌是 <span class="ff4 ls0 wsa5">NUM</span><span class="ws21f">，因此替换首先会匹配那个部分<span class="_ _c"></span>。一旦匹</span></div><div class="t m0 x5 h7 y624 ff1 fs3 fc0 sc0 ls68 ws43a">配成功，就会进入下一个令牌 <span class="ff4 lsd">+</span><span class="ws23f">，以此类推。当已经确定不能匹配下一个令牌的时候，</span></div><div class="t m0 x5 h7 y8ee ff1 fs3 fc0 sc0 ls42 ws43b">右边的部分 <span class="ff4 ls1b">(</span><span class="ls0 ws43c">比如 <span class="ffd lsba">{</span><span class="ff6 ws43d">(*/) factor <span class="ffd ls84">}</span><span class="lsbb">*<span class="ff4 lsbc">)</span></span></span></span><span class="ws186">就会被清理掉。在一个成功的解析中，整个右<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y8ef ff1 fs3 fc0 sc0 ls0">边部分会完全展开来匹配输入令牌流。</div><div class="t m0 x0 h9 y8f0 ff1 fs3 fc0 sc0 ls3a ws153">有了前面的知识背景，下面我们举一个简单示例来展示如何构建一个递归下降表达</div><div class="t m0 x5 h9 y8f1 ff1 fs3 fc0 sc0 ls0">式求值程序：</div><div class="t m0 x5 h11 y8f2 ffa fs5 fcd sc0 ls0 ws4">#!/usr/bin/env python</div><div class="t m0 x5 h11 y8f3 ffa fs5 fcd sc0 ls0 ws4"># -*- encoding: utf-8 -*-</div><div class="t m0 x5 h11 y8f4 ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x5 h12 y8f5 ffa fs5 fc9 sc0 ls0 ws145">Topic: <span class="ffc fs6">下降解析器</span></div><div class="t m0 x5 h11 y8f6 ffa fs5 fc9 sc0 ls0 ws4">Desc :</div><div class="t m0 x5 h11 y8f7 ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x5 h10 y8f8 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">re</span></div><div class="t m0 x5 h10 y8f9 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">collections</span></div><div class="t m0 x5 h11 y8fa ffa fs5 fcd sc0 ls0 ws4"># Token specification</div><div class="t m0 x5 hf y8fb ff8 fs5 fc0 sc0 ls0 ws158">NUM <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">(?P&lt;NUM&gt;\d+)<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y8fc ff8 fs5 fc0 sc0 ls0 ws13c">PLUS <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">(?P&lt;PLUS&gt;\+)<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y8fd ff8 fs5 fc0 sc0 ls0 ws15f">MINUS <span class="fc6 ls33">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;<span class="ff8 ws13a">(?P&lt;MINUS&gt;-)</span>&apos;</span></span></span></div><div class="t m0 x5 hf y8fe ff8 fs5 fc0 sc0 ls0 ws15f">TIMES <span class="fc6 ls33">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;<span class="ff8 ws13a">(?P&lt;TIMES&gt;\*)</span>&apos;</span></span></span></div><div class="t m0 x5 hf y8ff ff8 fs5 fc0 sc0 ls0 ws145">DIVIDE <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;DIVIDE&gt;/)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y900 ff8 fs5 fc0 sc0 ls0 ws145">LPAREN <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;LPAREN&gt;\()<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y901 ff8 fs5 fc0 sc0 ls0 ws145">RPAREN <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;RPAREN&gt;\))<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y902 ff8 fs5 fc0 sc0 ls0 ws159">WS <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>(?P&lt;WS&gt;\s+)<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.19.<span class="_ _5"> </span>2.19 <span class="ff1 ws42c">实现一个简单的递归下降分析器 </span>71</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
