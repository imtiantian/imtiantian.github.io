<div id="pfb0" class="pf w0 h0" data-page-no="b0"><div class="pc pcb0 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgb0.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y181 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">n</span><span class="ls32">=</span><span class="fc0">n</span></span></div><div class="t m0 x16 hf y182 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws158">thr </span><span class="ls33">=</span><span class="fc0">threading</span><span class="ls34">.</span><span class="fc0">Thread(target</span>=</span>self<span class="fc6 ls34">.</span><span class="fc0">run)</span></div><div class="t m0 x16 hf y183 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">thr</span>.<span class="fc0 ws145">daemon </span><span class="ls33">=</span></span>True</div><div class="t m0 x16 hf y184 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">thr</span>.<span class="fc0">start()</span></span></div><div class="t m0 x15 hf y186 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y187 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.<span class="fc0 ls32">n</span><span class="ls33">&gt;</span></span><span class="fc7">0<span class="fc0">:</span></span></span></div><div class="t m0 x17 hf y188 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls32">,</span></span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">n)</span></span></div><div class="t m0 x17 hf y98e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">n</span><span class="ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x17 hf y98f ff8 fs5 fc0 sc0 ls0 ws13a">time<span class="fc6">.</span>sleep(<span class="fc7">5</span>)</div><div class="t m0 x15 hf y991 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getstate__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y992 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">n</span></span></div><div class="t m0 x15 hf ya70 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setstate__<span class="fc0">(<span class="fca">self</span><span class="ws4">, n):</span></span></span></div><div class="t m0 x16 hf y994 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">__init__(n)</span></span></div><div class="t m0 x0 h9 ycff ff1 fs3 fc0 sc0 ls0">试着运行下面的序列化试验代码：</div><div class="t m0 x5 h10 y1333 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">countdown</span></span></div><div class="t m0 x5 hf y1334 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">countdown<span class="fc6 ls34">.</span>Countdown(<span class="fc7">30</span>)</span></span></div><div class="t m0 x5 hf y1335 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">T<span class="fc6 ls0 ws13a">-<span class="fc0 ws458">minus <span class="fc7">30</span></span></span></span></div><div class="t m0 x5 hf y1336 ff8 fs5 fc8 sc0 ls0 ws4">T-minus 29</div><div class="t m0 x5 hf y1337 ff8 fs5 fc8 sc0 ls0 ws4">T-minus 28</div><div class="t m0 x5 h10 y1338 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 h11 y1339 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># After a few moments</span></div><div class="t m0 x5 hf y133a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">cstate.p<span class="ff9 ls34">&apos;</span></span></span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">wb</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 h10 y133b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">pickle</span></span></div><div class="t m0 x5 hf y133c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span><span class="ws4">dump(c, f)</span></span></div><div class="t m0 x5 hf y133d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></span></div><div class="t m0 x0 h7 y133e ff1 fs3 fc0 sc0 ls0 wsc">然后退出 <span class="ff4 ws5c">Python </span>解析器并重启后再试验下：</div><div class="t m0 x5 hf y133f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">cstate.p<span class="ff9 ls34">&apos;</span></span></span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">rb</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1340 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>load(f)</span></div><div class="t m0 x5 hf y1341 ff8 fs5 fc8 sc0 ls0 ws4">countdown.Countdown object at 0x10069e2d0&gt;</div><div class="t m0 x5 hf y1342 ff8 fs5 fc8 sc0 ls0 ws4">T-minus 19</div><div class="t m0 x5 hf y1343 ff8 fs5 fc8 sc0 ls0 ws4">T-minus 18</div><div class="t m0 x5 h10 y1344 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x0 h9 y1345 ff1 fs3 fc0 sc0 ls0">你可以看到线程又奇迹般的重生了，从你第一次序列化它的地方又恢复过来。</div><div class="t m0 x0 h9 y1346 ff6 fs3 fc0 sc0 ls0 ws4cc">pickle <span class="ff1 ls2b ws753">对于大型的数据结构比如使用 </span><span class="ws754">array <span class="ff1 ls128">或</span><span class="ws755">numpy <span class="ff1 ls2b ws12e">模块创建的二进制数组效率</span></span></span></div><div class="t m0 x5 h9 yc80 ff1 fs3 fc0 sc0 ls13 wse5">并不是一个高效的编码方式<span class="_ _1"></span>。如果你需要移动大量的数组数据，你最好是先在一个文<span class="_ _c"></span></div><div class="t m0 x5 h7 y1347 ff1 fs3 fc0 sc0 ls35 ws756">件中将其保存为数组数据块或使用更高级的标准编码方式如 <span class="ff4 ls0 ws757">HDF5 (</span><span class="ws144">需要第三方库的支</span></div><div class="t m0 x5 h7 y1348 ff1 fs3 fc0 sc0 lsb">持<span class="ff4 ls0 wsa5">)<span class="ff1">。</span></span></div><div class="t m0 x0 h7 y1349 ff1 fs3 fc0 sc0 ls0 ws758">由于 <span class="ff6 ws3cf">pickle </span><span class="ls125">是</span><span class="ff4 ws759">Python </span><span class="ls22 ws119">特有的并且附着在源码上，所有如果需要长期存储数据的<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y134a ff1 fs3 fc0 sc0 ls0 wsa0">时<span class="_ _6"></span>候不<span class="_ _6"></span>应<span class="_ _6"></span>该<span class="_ _6"></span>选<span class="_ _6"></span>用<span class="_ _6"></span>它。例<span class="_ _6"></span>如，<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _6"></span>源<span class="_ _6"></span>码变<span class="_ _6"></span>动<span class="_ _6"></span>了，<span class="_ _6"></span>你<span class="_ _6"></span>所<span class="_ _6"></span>有<span class="_ _6"></span>的存<span class="_ _6"></span>储<span class="_ _6"></span>数<span class="_ _6"></span>据<span class="_ _6"></span>可<span class="_ _6"></span>能会<span class="_ _6"></span>被<span class="_ _6"></span>破<span class="_ _6"></span>坏<span class="_ _6"></span>并<span class="_ _6"></span>且变</div><div class="t m0 x5 h9 y134b ff1 fs3 fc0 sc0 ls1e ws111">得不可读取<span class="_ _1"></span>。坦白来讲，对于在数据<span class="_ _1"></span>库和存档文件中存储数据时，你最好使用更<span class="_ _1"></span>加标</div><div class="t m0 x5 h7 y134c ff1 fs3 fc0 sc0 ls0 ws38">准的数据编码格式如 <span class="ff4 wsa5">XML</span><span class="wsa0">，<span class="ff4 ws75a">CSV </span><span class="ls4">或</span><span class="ff4 wsa5">JSON</span>。这些编码格式更标准，可以被不同的语言</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.21.<span class="_ _5"> </span>5.21 <span class="ff1 ws36c">序列化 </span><span class="ws747">Python <span class="ff1 ws748">对象 </span>167</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
