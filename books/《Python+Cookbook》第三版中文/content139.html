<div id="pf8b" class="pf w0 h0" data-page-no="8b"><div class="pc pc8b w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg8b.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls3a ws153">为了处理这些文件，你可以定义一个由多个执行特定任务独立任务的简单生成器函</div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">数组成的容器。就像这样：</div><div class="t m0 x5 h10 yf49 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">os</span></div><div class="t m0 x5 h10 yf4a ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">fnmatch</span></div><div class="t m0 x5 h10 yf4b ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">gzip</span></div><div class="t m0 x5 h10 yf4c ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">bz2</span></div><div class="t m0 x5 h10 yf4d ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">re</span></div><div class="t m0 x5 hf yf4e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">gen_find<span class="fc0 ws13b">(filepat, top):</span></span></div><div class="t m0 x15 h15 yf4f ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 yf50 ffa fs5 fc9 sc0 ls0 ws4">Find all filenames in a directory tree that match a shell wildcard pattern</div><div class="t m0 x15 h15 y57c ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf yf51 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">path, dirlist, filelist </span><span class="ws157">in <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>walk(top):</span></span></div><div class="t m0 x16 hf yf52 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 fc0 ws13a">fnmatch<span class="fc6">.</span><span class="ws4">filter(filelist, filepat):</span></span></span></div><div class="t m0 x17 hf yf53 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0 ws13a">os<span class="fc6">.</span>path<span class="fc6 ls34">.</span>join(path,name)</span></div><div class="t m0 x5 hf yf54 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">gen_opener<span class="fc0">(filenames):</span></span></div><div class="t m0 x15 h15 yf55 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 yf56 ffa fs5 fc9 sc0 ls0 ws4">Open a sequence of filenames one at a time producing a file object.</div><div class="t m0 x15 h11 yf57 ffa fs5 fc9 sc0 ls0 ws4">The file is closed immediately when proceeding to the next iteration.</div><div class="t m0 x15 h15 yf58 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf yf59 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws1f5">filename </span><span class="ws160">in <span class="ff8 fc0">filenames:</span></span></div><div class="t m0 x16 hf yf5a ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">filename<span class="fc6 ls34">.</span>endswith(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">.gz<span class="ff9 ls34">&apos;</span></span>):</span></div><div class="t m0 x17 hf yf5b ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">gzip<span class="fc6">.</span><span class="ws169">open(filename, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x16 hf yf5c ff7 fs5 fca sc0 ls0 ws218">elif <span class="ff8 fc0 ws13a">filename<span class="fc6 ls34">.</span>endswith(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">.bz2<span class="ff9 ls34">&apos;</span></span>):</span></div><div class="t m0 x17 hf yf5d ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">bz2<span class="fc6 ls34">.</span><span class="ws47a">open(filename, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x16 hf yf5e ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf yf5f ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open</span></span><span class="ls0 ws2a3">(filename, <span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">rt</span>&apos;</span>)</span></div><div class="t m0 x16 hf yf60 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0">f</span></div><div class="t m0 x16 hf yf61 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x5 hf yf62 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">gen_concatenate<span class="fc0">(iterators):</span></span></div><div class="t m0 x15 h15 yf63 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 yf64 ffa fs5 fc9 sc0 ls0 ws4">Chain a sequence of iterators together into a single sequence.</div><div class="t m0 x15 h15 yf65 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf yf66 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws159">it </span><span class="ws157">in <span class="ff8 fc0">iterators:</span></span></div><div class="t m0 x16 hf yf67 ff7 fs5 fca sc0 ls0 ws583">yield from <span class="ff8 fc0">it</span></div><div class="t m0 x5 hf yf68 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">gen_grep<span class="fc0 ws13b">(pattern, lines):</span></span></div><div class="t m0 x15 h15 yf69 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 yf6a ffa fs5 fc9 sc0 ls0 ws4">Look for a regex pattern in a sequence of lines</div><div class="t m0 x15 h15 yf6b ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf yf6c ff8 fs5 fc0 sc0 ls0 ws158">pat <span class="fc6 ls32">=</span><span class="ws13a">re<span class="fc6">.</span>compile(pattern)</span></div><div class="t m0 x15 hf yf6d ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">line </span><span class="ws160">in <span class="ff8 fc0">lines:</span></span></div><div class="t m0 x16 hf yf6e ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">pat<span class="fc6 ls34">.</span>search(line):</span></div><div class="t m0 x17 hf yf6f ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0">line</span></div><div class="t m0 x0 h9 yf70 ff1 fs3 fc0 sc0 ls3a ws153">现在你可以很容易的将这些函数连起来创建一个处理管道。比如，为了查找包含单</div><div class="t m0 x5 h7 yf71 ff1 fs3 fc0 sc0 ls4">词<span class="ff4 ls0 ws5e0">p<span class="_ _1"></span>ython <span class="ff1">的所有日志行，你可以这样做：</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">6.13.<span class="_ _5"> </span>4.13 <span class="ff1 ws533">创建数据处理管道 </span>130</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
