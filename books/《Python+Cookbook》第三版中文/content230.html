<div id="pfe6" class="pf w0 h0" data-page-no="e6"><div class="pc pce6 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bge6.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls3a ws153">这样写也能实现同样的效果，不过相比而已会显得比较臃肿，对于阅读代码的人来</div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 ws97f">讲<span class="_ _6"></span>也更<span class="_ _6"></span>加<span class="_ _6"></span>难<span class="_ _6"></span>懂。<span class="_ _6"></span>这<span class="_ _6"></span>时<span class="_ _6"></span>候<span class="_ _6"></span>使用 <span class="ff6 ws980">partial() </span><span class="ls1e ws981">可以更加<span class="_ _6"></span>直观的表达你的意图 </span><span class="ff4 wsa5">(</span><span class="wsa0">给某<span class="_ _6"></span>些<span class="_ _6"></span>参<span class="_ _6"></span>数<span class="_ _6"></span>预</span></div><div class="t m0 x5 h7 y2c ff1 fs3 fc0 sc0 ls0 wsa0">先赋值<span class="ff4 wsa5">)</span>。</div><div class="t m0 x5 hd y1914 ff2 fs4 fc4 sc0 ls0 ws134">9.9<span class="_ _e"> </span>7.9 <span class="ff1">将单方法的类转换为函数</span></div><div class="t m0 x5 he y1915 ff2 fs2 fc4 sc0 ls0 ws135">9.9.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1916 ff1 fs3 fc0 sc0 ls0 ws982">你有一个除 <span class="ff6 ws536">init<span class="_ _e"> </span>() </span><span class="wsa0">方法外只定义了一个方法的类。<span class="_ _1"></span>为了简化代码，你想将它转</span></div><div class="t m0 x5 h9 y1917 ff1 fs3 fc0 sc0 ls0">换成一个函数。</div><div class="t m0 x5 he y1918 ff2 fs2 fc4 sc0 ls0 ws135">9.9.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1919 ff1 fs3 fc0 sc0 ls0 wsa0">大多数情况下，可以使<span class="_ _6"></span>用闭包来将单个方法的类<span class="_ _6"></span>转换成函数。举个例子，下<span class="_ _6"></span>面示例</div><div class="t m0 x5 h7 y191a ff1 fs3 fc0 sc0 ls0 ws14">中的类允许使用者根据某个模板方案来获取到 <span class="ff4 ws30">URL </span>链接地址。</div><div class="t m0 x5 hf y191b ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2dd">urllib.request </span><span class="ws146">import <span class="ff8 fc0">urlopen</span></span></div><div class="t m0 x5 hf y191c ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UrlTemplate<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y191d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, template):</span></span></span></div><div class="t m0 x16 hf y191e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">template </span><span class="ls32">=</span><span class="fc0">template</span></span></div><div class="t m0 x15 hf y191f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">open<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y1920 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">urlopen(<span class="fca">self<span class="fc6">.</span></span>template<span class="fc6 ls34">.</span>format_map(kwargs))</span></div><div class="t m0 x5 h11 y1921 ffa fs5 fcd sc0 ls0 ws4"># Example use. Download stock data from yahoo</div><div class="t m0 x5 hf y1922 ff8 fs5 fc0 sc0 ls0 ws15f">yahoo <span class="fc6 ls33">=</span><span class="ws13a">UrlTemplate(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://finance.yahoo.com/d/quotes.csv?s={names}&amp;f={fields}<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1923 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13c">line </span><span class="ws157">in <span class="ff8 fc0 ws13a">yahoo<span class="fc6 ls34">.</span>open(names<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">IBM,AAPL,FB<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, fields<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">sl1c1v<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x15 hf y1924 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(line<span class="fc6 ls34">.</span>decode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>))</span></div><div class="t m0 x0 h9 y506 ff1 fs3 fc0 sc0 ls0">这个类可以被一个更简单的函数来代替：</div><div class="t m0 x5 hf y1925 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">urltemplate<span class="fc0">(template):</span></span></div><div class="t m0 x15 hf y1926 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">opener<span class="fc0 ls34">(</span><span class="fc6">**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y1927 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">urlopen(template<span class="fc6">.</span>format_map(kwargs))</span></div><div class="t m0 x15 hf y1684 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">opener</span></div><div class="t m0 x5 h11 y1928 ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y1929 ff8 fs5 fc0 sc0 ls0 ws15f">yahoo <span class="fc6 ls33">=</span><span class="ws13a">urltemplate(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://finance.yahoo.com/d/quotes.csv?s={names}&amp;f={fields}<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y192a ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13c">line </span><span class="ws157">in <span class="ff8 fc0 ws13a">yahoo(names<span class="fc6">=<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">IBM,AAPL,FB<span class="ff9 ls34">&apos;</span></span></span><span class="ws13b">, fields</span><span class="fc6">=<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sl1c1v<span class="ff9 ws13b">&apos;</span></span></span>):</span></span></div><div class="t m0 x15 hf y192b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(line<span class="fc6 ls34">.</span>decode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>))</span></div><div class="t m0 x5 he y192c ff2 fs2 fc4 sc0 ls0 ws135">9.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1214 ff1 fs3 fc0 sc0 ls3a ws153">大部分情况下，你拥有一个单方法类的原因是需要存储某些额外的状态来给方法使</div><div class="t m0 x5 h7 y192d ff1 fs3 fc0 sc0 ls0 ws983">用。<span class="_ _6"></span>比<span class="_ _6"></span>如，定<span class="_ _6"></span>义 <span class="ff4 ws984">UrlT<span class="_ _d"></span>emplate <span class="ff1 ls40 ws180">类的唯一目的就是先在某个地方存储模板值，以便将来<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">9.9.<span class="_ _5"> </span>7.9 <span class="ff1 ws68e">将单方法的类转换为函数 </span>221</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
