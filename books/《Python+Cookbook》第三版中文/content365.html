<div id="pf16d" class="pf w0 h0" data-page-no="16d"><div class="pc pc16d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg16d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 wscc8">上面<span class="_ _6"></span>代<span class="_ _6"></span>码<span class="_ _6"></span>里，当<span class="_ _6"></span>你<span class="_ _6"></span>调<span class="_ _6"></span>用 <span class="ff6 ws5ed">locals() </span><span class="wscc9">获取<span class="_ _6"></span>局<span class="_ _6"></span>部变<span class="_ _6"></span>量<span class="_ _6"></span>时，<span class="_ _6"></span>你获<span class="_ _6"></span>得<span class="_ _6"></span>的<span class="_ _6"></span>是传<span class="_ _6"></span>递<span class="_ _6"></span>给 <span class="ff6 wscca">exec() </span>的</span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls13 wse5">局部变量的一个拷贝<span class="_ _1"></span>。通过在代码执行后审查这个字典的值，那就能获取修改后的值<span class="_ _c"></span></div><div class="t m0 x5 h9 y2c ff1 fs3 fc0 sc0 ls0">了。下面是一个演示例子：</div><div class="t m0 x5 hf yec3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test2<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y14d1 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></span></div><div class="t m0 x5 hf yec4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws158">loc <span class="fc6 ls32">=</span><span class="fca ws13a">locals</span>()</span></div><div class="t m0 x5 hf yec5 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">before:</span>&apos;</span><span class="ls0 ws13b">, loc)</span></span></span></div><div class="t m0 x5 hf y14d2 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">x += 1<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf yec6 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">after:</span>&apos;</span><span class="ls0 ws13b">, loc)</span></span></span></div><div class="t m0 x5 hf yec7 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">x =</span>&apos;</span><span class="ls0 ws13b">, x)</span></span></span></div><div class="t m0 x5 h10 yec8 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf yec9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test2()</span></div><div class="t m0 x5 hf yeca ff8 fs5 fc8 sc0 ls0 ws4">before: {<span class="ff9 ws13b">&apos;</span><span class="ls34">x<span class="ff9">&apos;</span></span><span class="ws13b">: 0}</span></div><div class="t m0 x5 hf y35a ff8 fs5 fc8 sc0 ls0 ws4">after: {<span class="ff9 ls34">&apos;</span><span class="ws13a">loc<span class="ff9 ws13b">&apos;</span></span>: {...}, <span class="ff9 ls34">&apos;</span><span class="ws13a">x<span class="ff9 ls34">&apos;</span></span>: 1}</div><div class="t m0 x5 hf y59b ff8 fs5 fc8 sc0 ls5e ws209">x=0<span class="_ _15"></span></div><div class="t m0 x5 hf y14d3 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y25e9 ff1 fs3 fc0 sc0 ls0 wsccb">仔细观察最后一步的输出，除非你将 <span class="ff6 wsccc">loc </span><span class="ws5fe">中被修改后的值手动赋值给 <span class="ff4 wsa5">x</span><span class="wsccd">，<span class="_ _c"></span>否则 <span class="ff4 ls1aa">x</span>变</span></span></div><div class="t m0 x5 h9 y25ea ff1 fs3 fc0 sc0 ls0">量值是不会变的。</div><div class="t m0 x0 h9 y25eb ff1 fs3 fc0 sc0 ls0 wscce">在使用 <span class="ff6 wsccf">locals() </span><span class="wscd0">的时候，<span class="_ _1"></span>你需要注意操作顺序。每次它被调用的时候， <span class="ff6">locals()</span></span></div><div class="t m0 x5 h9 ybf6 ff1 fs3 fc0 sc0 ls2d ws132">会获取局部变量值中的值并覆盖字典中相应的变量。请注意观察下下面这个试验的输<span class="_ _1"></span></div><div class="t m0 x5 h9 y25ec ff1 fs3 fc0 sc0 ls0">出结果：</div><div class="t m0 x5 hf y25ed ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test3<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y25ee ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></span></div><div class="t m0 x5 hf y16be ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws158">loc <span class="fc6 ls32">=</span><span class="fca ws13a">locals</span>()</span></div><div class="t m0 x5 hf y16bf ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(loc)</span></span></div><div class="t m0 x5 hf y16c0 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">x += 1<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya9 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(loc)</span></span></div><div class="t m0 x5 hf y16c1 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fca ws13a">locals<span class="fc0">()</span></span></div><div class="t m0 x5 hf yba7 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(loc)</span></span></div><div class="t m0 x5 h10 y6e3 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y16c2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test3()</span></div><div class="t m0 x5 hf y16c3 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span>x<span class="ff9">&apos;</span><span class="ls0 ws13b">: 0}</span></div><div class="t m0 x5 hf y16c4 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">loc<span class="ff9 ws13b">&apos;</span><span class="ws4">: {...}, </span></span><span class="ff9">&apos;</span><span class="ls0 ws13a">x</span><span class="ff9">&apos;</span><span class="ls0 ws4">: 1}</span></div><div class="t m0 x5 hf y16c5 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">loc<span class="ff9 ws13b">&apos;</span><span class="ws4">: {...}, </span></span><span class="ff9">&apos;</span><span class="ls0 ws13a">x</span><span class="ff9">&apos;</span><span class="ls0 ws4">: 0}</span></div><div class="t m0 x5 hf y12c ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y25ef ff1 fs3 fc0 sc0 ls0 wsc">注意最后一次调用 <span class="ff6 ws26f">locals() </span><span class="ws38">的时候 <span class="ff4 ls155">x</span>的值是如何被覆盖掉的。</span></div><div class="t m0 x0 h9 y25f0 ff1 fs3 fc0 sc0 ls0 wsfe">作为 <span class="ff6 wscd1">locals() </span><span class="wscd2">的一个替代方案，你可以使用你自己的字典，<span class="_ _c"></span>并将它传递给 <span class="ff6">exec()</span></span></div><div class="t m0 x5 h9 y25f1 ff1 fs3 fc0 sc0 ls0">。例如：</div><div class="t m0 x5 hf yfab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">test4<span class="fc0">():</span></span></span></div><div class="t m0 x5 hf y25f2 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=<span class="fc7 ls0">13</span></span></span></div><div class="t m0 x5 hf y25f3 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws158">loc <span class="fc6 ls32">=</span><span class="ls33">{</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">a</span><span class="ls33">&apos;</span></span><span class="ws13b">: a }</span></span></div><div class="t m0 x5 hf y25f4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ws158">glb <span class="fc6 ls32">=</span><span class="ws4">{ }</span></span></div><div class="t m0 x5 hf y1030 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">exec<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls5e ws209">b=a+1<span class="_ _15"></span><span class="ff9 ls0 ws13b">&apos;<span class="ff8 fc0 ws4">, glb, loc)</span></span></span></span></span></span></div><div class="t m0 x5 hf y25f5 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">loc[<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">b<span class="ff9">&apos;</span></span></span>]</span></span></div><div class="t m0 x5 hf y25f6 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(b)</span></span></div><div class="t m0 x5 h10 y25f7 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.23.<span class="_ _5"> </span>9.23 <span class="ff1 wsb03">在局部变量域中执行代码 </span>356</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
