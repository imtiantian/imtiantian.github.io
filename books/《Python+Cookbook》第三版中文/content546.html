<div id="pf222" class="pf w0 h0" data-page-no="222"><div class="pc pc222 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg222.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 wsd91">16.13<span class="_ _e"> </span>14.13 <span class="ff1">给你的程序做性能测试</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">16.13.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y658 ff1 fs3 fc0 sc0 ls0">你想测试你的程序运行所花费的时间并做性能测试。</div><div class="t m0 x5 he y6ee ff2 fs2 fc4 sc0 ls0 wsadf">16.13.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y340e ff1 fs3 fc0 sc0 lse ws1302">如果你只是简单的想测试下你的程序整体花费的时间，通常使用 <span class="ff4 ls0 ws703">Unix </span><span class="wsd8">时间函数就<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y18bb ff1 fs3 fc0 sc0 ls0">行了，比如：</div><div class="t m0 x5 hf y34fc ff8 fs5 fc0 sc0 ls0 ws4">bash % time python3 someprogram.py</div><div class="t m0 x5 hf y34fd ff8 fs5 fc0 sc0 ls0 ws4">real 0m13.937s</div><div class="t m0 x5 hf y34fe ff8 fs5 fc0 sc0 ls0 ws4">user 0m12.162s</div><div class="t m0 x5 hf y34ff ff8 fs5 fc0 sc0 ls0 ws1303">sys 0m0.098s</div><div class="t m0 x5 hf y3500 ff8 fs5 fc0 sc0 ls0 ws4">bash %</div><div class="t m0 x0 h9 y3501 ff1 fs3 fc0 sc0 ls0 ws14">如果你还需要一个程序各个细节的详细报告，可以使用 <span class="ff6 ws1f3">cProfile </span>模块：</div><div class="t m0 x5 hf y3502 ff8 fs5 fc0 sc0 ls0 ws4">bash % python3 -m cProfile someprogram.py</div><div class="t m0 x2b hf y15d4 ff8 fs5 fc0 sc0 ls0 ws4">859647 function calls in 16.016 CPU seconds</div><div class="t m0 x3c hf y3503 ff8 fs5 fc0 sc0 ls0 ws4">Ordered by: standard name</div><div class="t m0 x3c hf yc17 ff8 fs5 fc0 sc0 ls0 ws1303">ncalls tottime percall cumtime percall<span class="_ _1e"> </span>filename:lineno(function)</div><div class="t m0 x3c hf y3504 ff8 fs5 fc0 sc0 ls0 ws1304">263169 0.080 0.000 0.080 0.000<span class="_ _1e"> </span>someprogram.py:16(frange)</div><div class="t m0 x50 hf y3505 ff8 fs5 fc0 sc0 ls0 ws1304">513 0.001 0.000 0.002 0.000<span class="_ _1e"> </span>someprogram.py:30(generate_mandel)</div><div class="t m0 x3c hf y3506 ff8 fs5 fc0 sc0 ls0 ws1304">262656 0.194 0.000<span class="_ _3a"> </span>15.295 0.000<span class="_ _26"> </span>someprogram.py:32(&lt;genexpr&gt;)</div><div class="t m0 x16 hf y3507 ff8 fs5 fc0 sc0 ls0 ws1305">1<span class="_ _22"> </span>0.036<span class="_ _22"> </span>0.036 16.077 16.077<span class="_ _1e"> </span>someprogram.py:4(&lt;module&gt;)</div><div class="t m0 x3c hf y3508 ff8 fs5 fc0 sc0 ls0 ws1305">262144 15.021<span class="_ _22"> </span>0.000 15.021<span class="_ _22"> </span>0.000<span class="_ _1e"> </span>someprogram.py:4(in_mandelbrot)</div><div class="t m0 x16 hf y3509 ff8 fs5 fc0 sc0 ls0 ws1304">1 0.000 0.000 0.000 0.000<span class="_ _1e"> </span>os.py:746(urandom)</div><div class="t m0 x16 hf y350a ff8 fs5 fc0 sc0 ls0 ws1304">1 0.000 0.000 0.000 0.000<span class="_ _1e"> </span>png.py:1056(_readable)</div><div class="t m0 x16 hf y350b ff8 fs5 fc0 sc0 ls0 ws1304">1 0.000 0.000 0.000 0.000<span class="_ _1e"> </span>png.py:1073(Reader)</div><div class="t m0 x16 hf y350c ff8 fs5 fc0 sc0 ls0 ws1304">1 0.227 0.227 0.438 0.438<span class="_ _1e"> </span>png.py:163(&lt;module&gt;)</div><div class="t m0 x50 hf y350d ff8 fs5 fc0 sc0 ls0 ws1304">512 0.010 0.000 0.010 0.000<span class="_ _1e"> </span>png.py:200(group)</div><div class="t m0 x15 hf y350e ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x5 hf y350f ff8 fs5 fc0 sc0 ls0 ws4">bash %</div><div class="t m0 x0 h9 y3510 ff1 fs3 fc0 sc0 ls3a ws153">不过通常情况是介于这两个极端之间。比如你已经知道代码运行时在少数几个函数</div><div class="t m0 x5 h9 y2ca7 ff1 fs3 fc0 sc0 ls0">中花费了绝大部分时间。对于这些函数的性能测试，可以使用一个简单的装饰器：</div><div class="t m0 x5 h11 y3511 ffa fs5 fcd sc0 ls0 ws4"># timethis.py</div><div class="t m0 x5 h10 y3512 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y3513 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 hf y3514 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">timethis<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y3515 ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y3516 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.13.<span class="_ _36"> </span>14.13 <span class="ff1 wsd98">给你的程序做性能测试 </span>537</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
