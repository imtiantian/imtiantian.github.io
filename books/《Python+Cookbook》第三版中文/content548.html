<div id="pf224" class="pf w0 h0" data-page-no="224"><div class="pc pc224 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg224.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h9 y2a ff1 fs3 fc0 sc0 ls0">值：</div><div class="t m0 x5 hf y3534 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">math.sqrt(2)<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">import math</span><span class="ls34">&apos;</span></span><span class="ws4">, number<span class="fc6 ls34">=</span></span><span class="fc7">10000000</span>)</span></div><div class="t m0 x5 hf y3535 ff8 fs5 fc8 sc0 ls0">1.434852126003534</div><div class="t m0 x5 hf y3536 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sqrt(2)<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">from math import sqrt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, number</span><span class="fc6">=<span class="fc7">10000000</span></span>)</span></div><div class="t m0 x5 hf y3537 ff8 fs5 fc8 sc0 ls0">1.0270336690009572</div><div class="t m0 x5 hf y3538 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y3539 ff2 fs2 fc4 sc0 ls0 wsadf">16.13.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y353a ff1 fs3 fc0 sc0 ls230 ws1309">当执行性能测试的时候<span class="_ _28"></span>，<span class="_ _6"></span>需要注意的是你获取的结果都是近似值<span class="_ _2e"></span>。<span class="_ _28"></span></div><div class="t m0 x5 h9 y5fb ff6 fs3 fc0 sc0 ls0 wsc64">time.perf counter()<span class="_ _b"> </span><span class="ff1 wsa0">函<span class="_ _12"></span>数<span class="_ _0"></span>会<span class="_ _0"></span>在<span class="_ _0"></span>给<span class="_ _12"></span>定<span class="_ _0"></span>平<span class="_ _0"></span>台<span class="_ _12"></span>上<span class="_ _0"></span>获<span class="_ _0"></span>取<span class="_ _0"></span>最<span class="_ _12"></span>高<span class="_ _0"></span>精<span class="_ _0"></span>度<span class="_ _0"></span>的<span class="_ _12"></span>计<span class="_ _0"></span>时<span class="_ _0"></span>值。<span class="_ _12"></span>不<span class="_ _0"></span>过，<span class="_ _0"></span>它<span class="_ _12"></span>仍<span class="_ _0"></span>然</span></div><div class="t m0 x5 h9 y353b ff1 fs3 fc0 sc0 ls1e ws111">还是基于时钟时间<span class="_ _1"></span>，很多因素会影响到它的精确度<span class="_ _1"></span>，比如机器负载。如果你对于<span class="_ _1"></span>执行</div><div class="t m0 x5 h9 y5fd ff1 fs3 fc0 sc0 ls0 ws38">时间更感兴趣，使用 <span class="ff6 ws25d">time.process<span class="_ _7"> </span>time() </span>来代替它。例如：</div><div class="t m0 x5 hf y30ec ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 hf y30ed ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">timethis<span class="fc0">(func):</span></span></div><div class="t m0 x15 hf y30ee ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x15 hf y30ef ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">wrapper<span class="fc0 ls34">(</span><span class="fc6">*<span class="fc0 ws458">args, </span>**<span class="fc0">kwargs):</span></span></span></div><div class="t m0 x16 hf y23c6 ff8 fs5 fc0 sc0 ls0 ws15f">start <span class="fc6 ls33">=</span><span class="ws13a">time<span class="fc6">.</span>process_time()</span></div><div class="t m0 x16 hf y30f0 ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">func(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x16 hf y30f1 ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="ws13a">time<span class="fc6 ls34">.</span>process_time()</span></div><div class="t m0 x16 hf y30f2 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">{}.{} : {}</span>&apos;</span><span class="fc6">.</span><span class="ls0 ws13a">format(func<span class="fc6">.</span><span class="ws4">__module__, func</span></span><span class="fc6">.</span><span class="ls0 ws13b">__name__, end <span class="fc6 ls32">-</span>start))</span></span></div><div class="t m0 x16 hf y622 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">r</span></div><div class="t m0 x15 hf y3f9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">wrapper</span></div><div class="t m0 x0 h9 y353c ff1 fs3 fc0 sc0 ls0 ws130a">最后，如果你想进行更深入的性能分析，那么你需要详细阅读 <span class="ff6 ws7f9">time </span><span class="wsa0">、<span class="_ _1"></span><span class="ff6 ws2cb">timeit <span class="ff1">和其</span></span></span></div><div class="t m0 x5 h9 y353d ff1 fs3 fc0 sc0 ls13 wse5">他相关模块的文档<span class="_ _1"></span>。这样你可以理解和平台相关的差异以及一些其他陷阱。还可以参<span class="_ _c"></span></div><div class="t m0 x5 h7 y353e ff1 fs3 fc0 sc0 ls4">考<span class="ff4 ls0 ws2aa">13.13 <span class="ff1">小节中相关的一个创建计时器类的例子。</span></span></div><div class="t m0 x5 hd y353f ff2 fs4 fc4 sc0 ls0 wsd91">16.14<span class="_ _e"> </span>14.14 <span class="ff1">加速程序运行</span></div><div class="t m0 x5 he y3540 ff2 fs2 fc4 sc0 ls0 wsadf">16.14.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y3541 ff1 fs3 fc0 sc0 ls0 ws130b">你的<span class="_ _6"></span>程序<span class="_ _6"></span>运行<span class="_ _6"></span>太慢，<span class="_ _6"></span>你<span class="_ _6"></span>想在<span class="_ _6"></span>不使<span class="_ _6"></span>用复<span class="_ _6"></span>杂技<span class="_ _6"></span>术比<span class="_ _6"></span>如 <span class="ff4 ls231">C</span><span class="ws130c">扩展<span class="_ _6"></span>或 <span class="ff4 ws130d">JIT </span><span class="wsa0">编<span class="_ _6"></span>译器<span class="_ _6"></span>的情<span class="_ _6"></span>况下<span class="_ _6"></span>加</span></span></div><div class="t m0 x5 h9 y3542 ff1 fs3 fc0 sc0 ls0">快程序运行速度。</div><div class="t m0 x5 he y3543 ff2 fs2 fc4 sc0 ls0 wsadf">16.14.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y175c ff1 fs3 fc0 sc0 ls12 wse4">关于程序优化的第一个准则是“不要优化<span class="_ _c"></span>”<span class="_ _31"></span>，第二个准则是“不要优化那些无关紧</div><div class="t m0 x5 h7 y3544 ff1 fs3 fc0 sc0 ls0 ws130e">要的部<span class="_ _6"></span>分”<span class="_ _31"></span>。如<span class="_ _6"></span>果你的<span class="_ _6"></span>程序运行<span class="_ _6"></span>缓慢，首<span class="_ _6"></span>先你得<span class="_ _6"></span>使用 <span class="ff4 ws130f">14.13 </span><span class="wsa0">小节<span class="_ _6"></span>的技术<span class="_ _6"></span>先对它进<span class="_ _6"></span>行性能</span></div><div class="t m0 x5 h9 y1bba ff1 fs3 fc0 sc0 ls0">测试找到问题所在。</div><div class="t m0 x0 h9 y8c4 ff1 fs3 fc0 sc0 ls3a ws153">通常来讲你会发现你得程序在少数几个热点地方花费了大量时间，不然内存的数据</div><div class="t m0 x5 h9 y8c5 ff1 fs3 fc0 sc0 ls0">处理循环。一旦你定位到这些点，你就可以使用下面这些实用技术来加速程序运行。</div><div class="t m0 x0 h9 y674 ff1 fs3 fc0 sc0 ls0">使用函数</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.14.<span class="_ _36"> </span>14.14 <span class="ff1 wse4d">加速程序运行 </span>539</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
