<div id="pf118" class="pf w0 h0" data-page-no="118"><div class="pc pc118 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg118.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1e8 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">B1<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h12 y1e9 ffa fs5 fc9 sc0 ls0 ws158">&quot;&quot;&quot; <span class="ffc fs6 ws3d4">简单的代理</span>&quot;&quot;&quot;</div><div class="t m0 x15 hf y903 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1eb ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws15c">_a </span><span class="ls32">=</span><span class="fc0">A()</span></span></div><div class="t m0 x15 hf y904 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">(<span class="fca">self</span><span class="ws4">, x):</span></span></span></div><div class="t m0 x16 h11 y905 ffa fs5 fcd sc0 ls0 ws4"># Delegate to the internal self._a instance</div><div class="t m0 x16 hf y906 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_a<span class="fc6 ls34">.</span>spam(x)</span></span></div><div class="t m0 x15 hf y908 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">foo<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h11 y909 ffa fs5 fcd sc0 ls0 ws4"># Delegate to the internal self._a instance</div><div class="t m0 x16 hf ybd8 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_a<span class="fc6 ls34">.</span>foo()</span></span></div><div class="t m0 x15 hf y90a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h10 y61 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y1dee ff1 fs3 fc0 sc0 ls0 wsa0">如果仅仅就两个方法<span class="_ _6"></span>需要代理，那么像这样写就<span class="_ _6"></span>足够了。但是，如果有大量<span class="_ _6"></span>的方法</div><div class="t m0 x5 h9 y1def ff1 fs3 fc0 sc0 ls0 ws911">需要代理，那么使用 <span class="ff6 ws308">getattr<span class="_ _e"> </span>() </span>方法或许或更好些：</div><div class="t m0 x5 hf y1df0 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">B2<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h12 y1df1 ffa fs5 fc9 sc0 ls0 ws158">&quot;&quot;&quot; <span class="ffc fs6 ws3d3">使用 </span><span class="ws208">__getattr__ <span class="ffc fs6 ws3d4">的代理，代理方法比较多时候</span>&quot;&quot;&quot;</span></div><div class="t m0 x15 hf y1df2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1df3 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws15c">_a </span><span class="ls32">=</span><span class="fc0">A()</span></span></div><div class="t m0 x15 hf y1df4 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h10 y1df5 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x15 h11 y7fb ffa fs5 fcd sc0 ls0 ws4"># Expose all of the methods defined on class A</div><div class="t m0 x15 hf y7fc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getattr__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, name):</span></span></span></div><div class="t m0 x16 h12 y7fd ffa fs5 fc9 sc0 ls0 ws158">&quot;&quot;&quot; <span class="ffc fs6 ws6e2">这个方法在访问的 </span><span class="ws16e">attribute <span class="ffc fs6">不存在的时候被调用</span></span></div><div class="t m0 x16 h11 y7fe ffa fs5 fc9 sc0 ls0 ws4">the __getattr__() method is actually a fallback method</div><div class="t m0 x16 h11 y7ff ffa fs5 fc9 sc0 ls0 ws4">that only gets called when an attribute is not found&quot;&quot;&quot;</div><div class="t m0 x16 hf y800 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">getattr<span class="fc0 ls34">(</span>self<span class="fc6">.<span class="fc0 ws4">_a, name)</span></span></span></div><div class="t m0 x31 h7 y1df6 ff6 fs3 fc0 sc0 ls0 wsb1d">getattr <span class="ff1 wsc">方法是在访问 <span class="ff4 ws7e6">attribute </span>不存在的时候被调用，使用演示：</span></div><div class="t m0 x5 hf y1df7 ff8 fs5 fc0 sc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0">B()</span></div><div class="t m0 x5 hf y1df8 ff8 fs5 fc0 sc0 ls34">b<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws458">bar() <span class="ffa fcd ws4"># Calls B.bar() (exists on B)</span></span></div><div class="t m0 x5 hf y1df9 ff8 fs5 fc0 sc0 ls34">b<span class="fc6 ls0 ws13a">.<span class="fc0">spam(<span class="fc7">42</span><span class="ls32">)</span><span class="ffa fcd ws4"># Calls B.__getattr__(<span class="ffb ls34">&apos;</span><span class="ws13a">spam<span class="ffb ws13b">&apos;</span></span>) and delegates to A.spam</span></span></span></div><div class="t m0 x0 h9 y1dfa ff1 fs3 fc0 sc0 ls0">另外一个代理例子是实现代理模式，例如：</div><div class="t m0 x5 h11 y1dfb ffa fs5 fcd sc0 ls0 ws4"># A proxy class that wraps around another object, but</div><div class="t m0 x5 h11 y14e5 ffa fs5 fcd sc0 ls0 ws4"># exposes its public attributes</div><div class="t m0 x5 hf y1dfc ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Proxy<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1dfd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, obj):</span></span></span></div><div class="t m0 x16 hf y1dfe ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">_obj </span><span class="ls33">=</span><span class="fc0">obj</span></span></div><div class="t m0 x15 h11 y1dff ffa fs5 fcd sc0 ls0 ws4"># Delegate attribute lookup to internal obj</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.15.<span class="_ _5"> </span>8.15 <span class="ff1 wsb0f">属性的代理访问 </span>271</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
