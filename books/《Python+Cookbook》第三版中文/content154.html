<div id="pf9a" class="pf w0 h0" data-page-no="9a"><div class="pc pc9a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg9a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y15f ffa fs5 fcd sc0 ls0 ws4"># bz2 compression</div><div class="t m0 x5 h10 y160 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">bz2</span></div><div class="t m0 x5 hf y956 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">bz2<span class="fc6 ls34">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.bz2<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">wt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y957 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(text)</span></span></div><div class="t m0 x0 h7 y10e6 ff1 fs3 fc0 sc0 ls0 ws681">如上，所有<span class="_ _6"></span>的 <span class="ff4 ws682">I/O </span><span class="ls2b ws683">操作都使用文本模式并执行 </span><span class="ff4 ws684">Unico<span class="_ _6"></span>de </span><span class="wsa0">的编码<span class="ff4 wsa5">/</span>解<span class="_ _6"></span>码。类似的，<span class="_ _6"></span>如</span></div><div class="t m0 x5 h9 y10e7 ff1 fs3 fc0 sc0 ls0 ws38">果你想操作二进制数据，使用 <span class="ff6 ws255">rb </span><span class="wsc">或者 <span class="ff6 ws308">wb </span>文件模式即可。</span></div><div class="t m0 x5 he y10e8 ff2 fs2 fc4 sc0 ls0 ws135">7.7.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y10e9 ff1 fs3 fc0 sc0 ls3a ws153">大部分情况下读写压缩数据都是很简单的。但是要注意的是选择一个正确的文件模</div><div class="t m0 x5 h9 y10ea ff1 fs3 fc0 sc0 ls1e ws111">式是非常重要的<span class="_ _1"></span>。如果你不指定模式<span class="_ _1"></span>，那么默认的就是二进制模式，如果这时候<span class="_ _1"></span>程序</div><div class="t m0 x5 h9 y10eb ff1 fs3 fc0 sc0 ls0 ws685">想<span class="_ _6"></span>要接<span class="_ _6"></span>受<span class="_ _6"></span>的<span class="_ _6"></span>是<span class="_ _6"></span>文<span class="_ _6"></span>本数<span class="_ _6"></span>据，<span class="_ _6"></span>那<span class="_ _6"></span>么<span class="_ _6"></span>就<span class="_ _6"></span>会出<span class="_ _6"></span>错。 <span class="ff6 ws686">gzip.open() </span><span class="ls10f">和</span><span class="ff6 ws687">bz2.open() </span><span class="wsa0">接<span class="_ _6"></span>受<span class="_ _6"></span>跟<span class="_ _6"></span>内<span class="_ _6"></span>置的</span></div><div class="t m0 x5 h9 y10ec ff6 fs3 fc0 sc0 ls0 ws25d">open() <span class="ff1 ws14">函数一样的参数，包括 </span><span class="ws303">encoding<span class="ff1 lsb">，</span>errors<span class="ff1 lsb">，</span><span class="ws472">newline <span class="ff1">等等。</span></span></span></div><div class="t m0 x0 h9 y10ed ff1 fs3 fc0 sc0 ls14 ws22f">当写入压缩数据时<span class="_ _1"></span>，可以使用 <span class="ff6 ls0 ws230">compresslevel </span><span class="ws174">这个可选的关键字参数来指定一个<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y10ee ff1 fs3 fc0 sc0 ls0">压缩级别。比如：</div><div class="t m0 x5 hf y10ef ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">gzip<span class="fc6">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.gz<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">wt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, compresslevel</span><span class="fc6">=<span class="fc7 ls34">5</span></span><span class="ls33">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y10f0 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(text)</span></span></div><div class="t m0 x0 h7 y1075 ff1 fs3 fc0 sc0 ls2c ws688">默认的等级是 <span class="ff4 ls6">9</span><span class="ws12f">，也是最高的压缩等级。等级越低性能越好，但是数据压缩程度也<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y10f1 ff1 fs3 fc0 sc0 ls0">越低。</div><div class="t m0 x0 h9 y10f2 ff1 fs3 fc0 sc0 ls0 ws689">最后一点， <span class="ff6 ws68a">gzip.open() </span><span class="ls110">和</span><span class="ff6 ws68b">bz2.open() </span><span class="wsa0">还有一个很少被知道的特性，它们可以作</span></div><div class="t m0 x5 h9 y10f3 ff1 fs3 fc0 sc0 ls0">用在一个已存在并以二进制模式打开的文件上。比如，下面代码是可行的：</div><div class="t m0 x5 h10 y10f4 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">gzip</span></div><div class="t m0 x5 hf y10f5 ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open</span></span><span class="ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">somefile.gz</span><span class="ls34">&apos;</span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">rb</span><span class="ls0 ws13b">&apos;</span></span><span class="ls0">)</span></div><div class="t m0 x5 hf y10f6 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">gzip<span class="fc6">.</span><span class="ws155">open(f, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws160">as <span class="ff8 fc0">g:</span></span></div><div class="t m0 x15 hf y10f7 ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ls34">g</span><span class="fc6 ws13a">.</span>read()</div><div class="t m0 x0 h9 y10f8 ff1 fs3 fc0 sc0 ls0 ws68c">这样就允许 <span class="ff6 ws364">gzip </span><span class="ls111">和</span><span class="ff6 ws68d">bz2 </span><span class="ls68 ws23f">模块可以工作<span class="_ _6"></span>在许多类文件对象上，比如套接字，管道和</span></div><div class="t m0 x5 h9 y10f9 ff1 fs3 fc0 sc0 ls0">内存中文件等。</div><div class="t m0 x5 hd y10fa ff2 fs4 fc4 sc0 ls0 ws134">7.8<span class="_ _e"> </span>5.8 <span class="ff1">固定大小记录的文件迭代</span></div><div class="t m0 x5 he y10fb ff2 fs2 fc4 sc0 ls0 ws135">7.8.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1a2 ff1 fs3 fc0 sc0 ls3a ws153">你想在一个固定长度记录或者数据块的集合上迭代，而不是在一个文件中一行一行</div><div class="t m0 x5 h9 y6ae ff1 fs3 fc0 sc0 ls0">的迭代。</div><div class="t m0 x5 he y10fc ff2 fs2 fc4 sc0 ls0 ws135">7.8.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y10fd ff1 fs3 fc0 sc0 ls0 ws38">通过下面这个小技巧使用 <span class="ff6 ws17a">iter </span><span class="ls5">和</span><span class="ff6 ws284">functools.partial() </span>函数：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.8.<span class="_ _5"> </span>5.8 <span class="ff1 ws68e">固定大小记录的文件迭代 </span>145</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
