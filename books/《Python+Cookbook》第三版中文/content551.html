<div id="pf227" class="pf w0 h0" data-page-no="227"><div class="pc pc227 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg227.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1e8 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x15 hf y1e9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">method<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x2b hf y1ea ff8 fs5 fc0 sc0 ls0 ws15f">value <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>value</div><div class="t m0 x2b hf y903 ff7 fs5 fca sc0 ls0 ws38d">for <span class="ff8 fc0 ls33">x</span><span class="ws157">in <span class="ff8 fc0">s:</span></span></div><div class="t m0 x3d hf y1eb ff8 fs5 fc0 sc0 ls0">op(value)</div><div class="t m0 x0 h9 y3577 ff1 fs3 fc0 sc0 ls0">避免不必要的抽象</div><div class="t m0 x0 h9 y3578 ff1 fs3 fc0 sc0 ls0 wsa0">任何时候当你使用额<span class="_ _6"></span>外的处理层（比如装饰器、<span class="_ _6"></span>属性访问、描述器）去包装<span class="_ _6"></span>你的代</div><div class="t m0 x5 h9 y3579 ff1 fs3 fc0 sc0 ls0">码时，都会让程序运行变慢。比如看下如下的这个类：</div><div class="t m0 x5 hf y357a ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y357b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></div><div class="t m0 x16 hf y357c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></div><div class="t m0 x16 hf y357d ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">y</span><span class="ls32">=</span><span class="fc0">y</span></span></div><div class="t m0 x15 h10 y2062 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf y357e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">y<span class="fc0 ls0 ws13a">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y357f ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_y</span></span></div><div class="t m0 x15 h10 y3580 ff7 fs5 fc12 sc0 ls0">@y.setter</div><div class="t m0 x15 hf y3581 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ls34">y<span class="fc0 ls0 ws13a">(<span class="fca">self</span><span class="ws4">, value):</span></span></span></div><div class="t m0 x16 hf y3582 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws15c">_y </span><span class="ls32">=</span><span class="fc0">value</span></span></div><div class="t m0 x0 h9 y3583 ff1 fs3 fc0 sc0 ls0">现在进行一个简单测试：</div><div class="t m0 x5 hf y3039 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws146">timeit <span class="fca">import <span class="ff8 fc0">timeit</span></span></span></span></div><div class="t m0 x5 hf y3584 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">A(<span class="fc7 ls34">1<span class="fc0">,</span><span class="ls0">2</span></span>)</span></span></div><div class="t m0 x5 hf y3585 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">a.x<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">from __main__ import a<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3586 ff8 fs5 fc8 sc0 ls0">0.07817923510447145</div><div class="t m0 x5 hf y3587 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">a.y<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws4">from __main__ import a<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3588 ff8 fs5 fc8 sc0 ls0">0.35766440676525235</div><div class="t m0 x5 hf ye95 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y3589 ff1 fs3 fc0 sc0 ls0 wsbbf">可以看到，访问属性 <span class="ff4 ls1aa">y</span><span class="ws1326">相比属性 <span class="ff4 ls237">x</span><span class="ws1138">而言慢的不止一点点，<span class="_ _c"></span>大概慢了 <span class="ff4 ws1327">4.5 </span><span class="wsa0">倍。如果你</span></span></span></div><div class="t m0 x5 h7 y358a ff1 fs3 fc0 sc0 ls0 ws1328">在意性能的话，<span class="_ _6"></span>那么就需要重新审<span class="_ _6"></span>视下对于 <span class="ff4 ls238">y</span><span class="wsa0">的属性访问<span class="_ _6"></span>器的定义是否真<span class="_ _6"></span>的有必要了。</span></div><div class="t m0 x5 h7 y358b ff1 fs3 fc0 sc0 ls77 ws1329">如果没有必要<span class="_ _c"></span>，就使用简单属性吧<span class="_ _c"></span>。如果仅仅是因为其他编程语言需要使用 <span class="ff4 ls0">getter/</span></div><div class="t m0 x5 h7 y358c ff4 fs3 fc0 sc0 ls0 ws963">setter <span class="ff1">函数就去修改代码风格，这个真的没有必要。</span></div><div class="t m0 x0 h9 y358d ff1 fs3 fc0 sc0 ls0">使用内置的容器</div><div class="t m0 x0 h7 y358e ff1 fs3 fc0 sc0 ls1e ws132a">内置的数据类型比如字符串<span class="_ _1"></span>、元组、列表<span class="_ _c"></span>、集合和字典都是使用 <span class="ff4 ls239">C</span><span class="ls0 wsa0">来<span class="_ _6"></span>实<span class="_ _6"></span>现<span class="_ _6"></span>的，<span class="_ _6"></span>运</span></div><div class="t m0 x5 h9 y358f ff1 fs3 fc0 sc0 ls0 wsa0">行起来非常快。如果你想自己实现新的数据结构（比如链接列表、平衡树等）<span class="_ _f"></span>，<span class="_ _1"></span>那么要</div><div class="t m0 x5 h9 y3590 ff1 fs3 fc0 sc0 ls0">想在性能上达到内置的速度几乎不可能，因此，还是乖乖的使用内置的吧。</div><div class="t m0 x0 h9 y3591 ff1 fs3 fc0 sc0 ls0">避免创建不必要的数据结构或复制</div><div class="t m0 x0 h9 y3592 ff1 fs3 fc0 sc0 ls0 wsa0">有时候程序员想显摆<span class="_ _6"></span>下，构造一些并没有必要的<span class="_ _6"></span>数据结构。例如，有人可能<span class="_ _6"></span>会像下</div><div class="t m0 x5 h9 y3593 ff1 fs3 fc0 sc0 ls0">面这样写：</div><div class="t m0 x5 hf y373 ff8 fs5 fc0 sc0 ls0 ws145">values <span class="fc6 ls33">=</span><span class="ws159">[x <span class="ff7 fca ws139">for </span><span class="ls32">x</span><span class="ff7 fca ws157">in </span>sequence]</span></div><div class="t m0 x5 hf y3594 ff8 fs5 fc0 sc0 ls0 ws155">squares <span class="fc6 ls32">=</span><span class="ws13a">[x<span class="fc6">*</span><span class="ls33">x</span><span class="ff7 fca ws139">for </span><span class="ls32">x</span><span class="ff7 fca ws157">in </span>values]</span></div><div class="t m0 x0 h9 y3595 ff1 fs3 fc0 sc0 ls63 ws21f">也许这里的想法是首先将一些值收集到一个列表中<span class="_ _c"></span>，然后使用列表推导来执行操<span class="_ _1"></span></div><div class="t m0 x5 h9 y3596 ff1 fs3 fc0 sc0 ls0">作。不过，第一个列表完全没有必要，可以简单的像下面这样写：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.14.<span class="_ _36"> </span>14.14 <span class="ff1 wse4d">加速程序运行 </span>542</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
