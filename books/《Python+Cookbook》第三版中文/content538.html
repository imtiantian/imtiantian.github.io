<div id="pf21a" class="pf w0 h0" data-page-no="21a"><div class="pc pc21a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg21a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">16.8.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y236 ff1 fs3 fc0 sc0 ls14 ws12c6">自定义异常类应该总是继承自内置的 <span class="ff6 ls0 ws33a">Exception </span><span class="ws174">类<span class="_ _1"></span>，或者是继承自那些本身就是</span></div><div class="t m0 x5 h9 y237 ff1 fs3 fc0 sc0 ls22b">从<span class="ff6 ls0 ws12c7">Exception </span><span class="ls0 ws12c8">继<span class="_ _6"></span>承<span class="_ _0"></span>而<span class="_ _6"></span>来<span class="_ _6"></span>的<span class="_ _0"></span>类。<span class="_ _6"></span>尽<span class="_ _0"></span>管<span class="_ _6"></span>所<span class="_ _0"></span>有<span class="_ _6"></span>类<span class="_ _6"></span>同<span class="_ _0"></span>时<span class="_ _6"></span>也<span class="_ _6"></span>继<span class="_ _0"></span>承<span class="_ _6"></span>自 <span class="ff6 ws12c9">BaseException </span></span><span class="ls21 ws116">，但你不应<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y238 ff1 fs3 fc0 sc0 ls42 ws12ca">该使用这个基类来定义新的异常。 <span class="ff6 ls0 ws12cb">BaseException </span><span class="ws186">是为系统退出异常而保留的<span class="_ _1"></span>，比如</span></div><div class="t m0 x5 h9 yea6 ff6 fs3 fc0 sc0 ls0 ws12cc">KeyboardInterrupt <span class="ff1 ls116">或</span><span class="ws12cd">SystemExit <span class="ff1 wsa0">以及其他那些会给应用发送信号而退出的异常。<span class="_ _c"></span>因</span></span></div><div class="t m0 x5 h9 y1a97 ff1 fs3 fc0 sc0 ls17 ws12ce">此，捕获这些异常本身没什么意义<span class="_ _1"></span>。这样的话，假如你继承 <span class="ff6 ls0 ws291">BaseException </span><span class="wsf6">可能会导<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y3439 ff1 fs3 fc0 sc0 ls0">致你的自定义异常不会被捕获而直接发送信号退出程序运行。</div><div class="t m0 x0 h9 y27b ff1 fs3 fc0 sc0 ls63 ws21f">在程序中引入自定义异常可以使得你的代码更具可读性<span class="_ _c"></span>，能清晰显示谁应该阅读<span class="_ _1"></span></div><div class="t m0 x5 h9 ya59 ff1 fs3 fc0 sc0 ls0 wsa0">这<span class="_ _6"></span>个代<span class="_ _6"></span>码。<span class="_ _6"></span>还<span class="_ _6"></span>有<span class="_ _6"></span>一<span class="_ _6"></span>种设<span class="_ _6"></span>计<span class="_ _6"></span>是<span class="_ _6"></span>将<span class="_ _6"></span>自<span class="_ _6"></span>定义<span class="_ _6"></span>异<span class="_ _6"></span>常<span class="_ _6"></span>通<span class="_ _6"></span>过<span class="_ _6"></span>继承<span class="_ _6"></span>组<span class="_ _6"></span>合<span class="_ _6"></span>起<span class="_ _6"></span>来。<span class="_ _6"></span>在<span class="_ _6"></span>复杂<span class="_ _6"></span>应<span class="_ _6"></span>用<span class="_ _6"></span>程<span class="_ _6"></span>序<span class="_ _6"></span>中，使</div><div class="t m0 x5 h9 y1a98 ff1 fs3 fc0 sc0 ls2c ws12f">用基类来分组各种异常类也是很有用的。它可以让用户捕获一个范围很窄的特定<span class="_ _1"></span>异常，</div><div class="t m0 x5 h9 y343a ff1 fs3 fc0 sc0 ls0">比如下面这样的：</div><div class="t m0 x5 hf y343b ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y343c ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">send(msg)</span></span></div><div class="t m0 x5 hf y343d ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0">ProtocolError:</span></div><div class="t m0 x15 hf y343e ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 y1efc ff1 fs3 fc0 sc0 ls0">你还能捕获更大范围的异常，就像下面这样：</div><div class="t m0 x5 hf y343f ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y2cd6 ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">send(msg)</span></span></div><div class="t m0 x5 hf y3440 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0">NetworkError:</span></div><div class="t m0 x15 hf y3441 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 y3442 ff1 fs3 fc0 sc0 ls22c ws12cf">如果你想定义的新异常重写了 <span class="ff6 ls0 ws12d0">init<span class="_ _e"> </span>() </span><span class="ws12d1">方法<span class="_ _1d"></span>，确保你使用所有参数调用<span class="_ _19"></span></span></div><div class="t m0 x5 h9 y3443 ff6 fs3 fc0 sc0 ls0 ws308">Exception.<span class="_ _e"> </span>init<span class="_ _e"> </span>() <span class="ff1">，例如：</span></div><div class="t m0 x5 hf y3444 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">CustomError<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">Exception<span class="fc0">):</span></span></div><div class="t m0 x15 hf y3445 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, message, status):</span></span></span></div><div class="t m0 x16 hf y3446 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__init__(message, status)</span></span></div><div class="t m0 x16 hf y3447 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">message </span><span class="ls33">=</span><span class="fc0">message</span></span></div><div class="t m0 x16 hf y3448 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">status </span><span class="ls32">=</span><span class="fc0">status</span></span></div><div class="t m0 x0 h7 y873 ff1 fs3 fc0 sc0 ls0 ws12d2">看上去有点<span class="_ _6"></span>奇怪，不过 <span class="ff4 ws12d3">Exception </span><span class="ls68 ws23f">的默认行为是接受所有传递的参数并将它们以元</span></div><div class="t m0 x5 h7 y874 ff1 fs3 fc0 sc0 ls0 wsc1a">组形式存储在 <span class="ff6 ws19e">.args </span><span class="wsa0">属性中<span class="ff4 ls22d">.</span><span class="ws12d4">很多其他函数库和部分 <span class="ff4 ws1062">Python </span></span>库默认所有异常都必须有</span></div><div class="t m0 x5 h9 y875 ff6 fs3 fc0 sc0 ls0 ws106c">.args <span class="ff1 ls14 ws174">属性<span class="_ _1"></span>，因此如果你忽略了这一步<span class="_ _1"></span>，你会发现有些时候你定义的新异常不会按照<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y3449 ff1 fs3 fc0 sc0 ls22 ws12d5">期望运行。为了演示 <span class="ff6 ls0 ws3d0">.args </span><span class="ws12d6">的使用<span class="_ _c"></span>，考虑下下面这个使用内置的 <span class="ff13 ls0 ws12d7">RuntimeErr<span class="_ _d"></span>or‘ <span class="ff1 wsa0">异<span class="_ _6"></span>常</span></span></span></div><div class="t m0 x5 h7 y344a ff1 fs3 fc0 sc0 ls0 ws38">的交互会话，注意看 <span class="ff4 ws12d8">raise </span>语句中使用的参数个数是怎样的：</div><div class="t m0 x5 hf y344b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">try<span class="ff8 fc0">:</span></span></div><div class="t m0 x5 hf y344c ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">It failed</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></span></div><div class="t m0 x5 hf y344d ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws146">except <span class="ff8 ws150">RuntimeError </span><span class="ws160">as <span class="ff8 fc0">e:</span></span></span></div><div class="t m0 x5 hf y344e ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ws13a">(e<span class="fc6 ls34">.</span>args)</span></span></div><div class="t m0 x5 h10 y24b9 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y344f ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">It failed</span><span class="ff9">&apos;</span><span class="ls0">,)</span></div><div class="t m0 x5 hf ybe8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">try<span class="ff8 fc0">:</span></span></div><div class="t m0 x5 hf y3450 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">It failed</span><span class="ls34">&apos;</span></span><span class="fc0 ls32">,</span><span class="fc7">42<span class="fc0 ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">spam<span class="ff9 ws13b">&apos;</span><span class="fc0">)</span></span></span></span></span></div><div class="t m0 x5 hf y3451 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws146">except <span class="ff8 ws150">RuntimeError </span><span class="ws160">as <span class="ff8 fc0">e:</span></span></span></div><div class="t m0 x5 hf y3452 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ws13a">(e<span class="fc6 ls34">.</span>args)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">16.8.<span class="_ _36"> </span>14.8 <span class="ff1 ws600">创建自定义异常 </span>529</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
