<div id="pf187" class="pf w0 h0" data-page-no="187"><div class="pc pc187 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg187.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1e8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">is_package<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, fullname):</span></span></span></div><div class="t m0 x16 hf y1e9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">False</span></div><div class="t m0 x5 h11 y903 ffa fs5 fcd sc0 ls0 ws4"># Package loader for a URL</div><div class="t m0 x5 hf y1eb ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UrlPackageLoader<span class="ff8 fc0">(UrlModuleLoader):</span></span></div><div class="t m0 x15 hf y1ec ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">load_module<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, fullname):</span></span></span></div><div class="t m0 x16 hf y904 ff8 fs5 fc0 sc0 ls0 ws158">mod <span class="fc6 ls32">=</span><span class="fca ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>load_module(fullname)</span></span></div><div class="t m0 x16 hf y905 ff8 fs5 fc0 sc0 ls0 ws13a">mod<span class="fc6 ls34">.</span><span class="ws1f5">__path__ <span class="fc6 ls33">=</span><span class="ls32">[</span></span><span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws13b">_baseurl ]</span></div><div class="t m0 x16 hf y906 ff8 fs5 fc0 sc0 ls0 ws13a">mod<span class="fc6 ls34">.</span><span class="ws6c3">__package__ <span class="fc6 ls33">=</span>fullname</span></div><div class="t m0 x15 hf y908 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get_filename<span class="fc0">(<span class="fca">self</span><span class="ws4">, fullname):</span></span></span></div><div class="t m0 x16 hf y909 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws1f5">_baseurl <span class="fc6 ls33">+</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">/</span><span class="ls32">&apos;</span></span><span class="fc6 ls33">+<span class="ff9 fc9 ls34">&apos;</span></span></span><span class="fc9">__init__.py<span class="ff9">&apos;</span></span></span></div><div class="t m0 x15 hf ybd9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">is_package<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, fullname):</span></span></span></div><div class="t m0 x16 hf y90a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">True</span></div><div class="t m0 x5 h11 y90b ffa fs5 fcd sc0 ls0 ws4"># Utility functions for installing/uninstalling the loader</div><div class="t m0 x5 hf y90c ff8 fs5 fc0 sc0 ls0 wsd67">_installed_meta_cache <span class="fc6 ls32">=</span><span class="ws4">{ }</span></div><div class="t m0 x5 hf y90d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">install_meta<span class="fc0">(address):</span></span></div><div class="t m0 x15 hf y90e ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws155">address </span>not in <span class="ff8 fc0">_installed_meta_cache:</span></div><div class="t m0 x16 hf y90f ff8 fs5 fc0 sc0 ls0 ws145">finder <span class="fc6 ls32">=</span>UrlMetaFinder(address)</div><div class="t m0 x16 hf y910 ff8 fs5 fc0 sc0 ls0 wsda9">_installed_meta_cache[address] <span class="fc6 ls33">=</span>finder</div><div class="t m0 x16 hf y911 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>meta_path<span class="fc6 ls34">.</span>append(finder)</div><div class="t m0 x16 hf ye93 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="ffa fcf ws159">%r </span><span class="fc9 ws4">installed on sys.meta_path<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, finder)</span></div><div class="t m0 x5 hf y913 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">remove_meta<span class="fc0">(address):</span></span></div><div class="t m0 x15 hf y914 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws155">address </span>in <span class="ff8 fc0">_installed_meta_cache:</span></div><div class="t m0 x16 hf y915 ff8 fs5 fc0 sc0 ls0 ws145">finder <span class="fc6 ls32">=</span><span class="ws13a">_installed_meta_cache<span class="fc6">.</span>pop(address)</span></div><div class="t m0 x16 hf y916 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>meta_path<span class="fc6 ls34">.</span>remove(finder)</div><div class="t m0 x16 hf y917 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="ffa fcf ws159">%r </span><span class="fc9 ws4">removed from sys.meta_path<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, finder)</span></div><div class="t m0 x0 h9 y2810 ff1 fs3 fc0 sc0 ls0">下面是一个交互会话，演示了如何使用前面的代码：</div><div class="t m0 x5 hf y2811 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; # importing currently fails</div><div class="t m0 x5 hf y2812 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; import fib</div><div class="t m0 x5 hf y2813 ff8 fs5 fc0 sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 hf y2814 ff8 fs5 fc0 sc0 ls0 ws4">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</div><div class="t m0 x5 hf y2815 ff8 fs5 fc0 sc0 ls0 ws4">ImportError: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y2816 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; # Load the importer and retry (it works)</div><div class="t m0 x5 hf y2817 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; import urlimport</div><div class="t m0 x5 hf y2818 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; urlimport.install_meta(<span class="ff9 ws13b">&apos;</span><span class="ws13a">http://localhost:15000<span class="ff9 ls34">&apos;</span>)</span></div><div class="t m0 x5 hf y2819 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; import fib</div><div class="t m0 x5 hf y281a ff8 fs5 fc0 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m fib</span></div><div class="t m0 x5 hf y281b ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; import spam</div><div class="t m0 x5 hf y281c ff8 fs5 fc0 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m spam</span></div><div class="t m0 x5 hf y281d ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; import grok.blah</div><div class="t m0 x5 hf y281e ff8 fs5 fc0 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m grok.__init__</span></div><div class="t m0 x5 hf y281f ff8 fs5 fc0 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m grok.blah</span></div><div class="t m0 x5 hf y2820 ff8 fs5 fc0 sc0 ls0 ws4">&gt;&gt;&gt; grok.blah.__file__</div><div class="t m0 x5 hf y2821 ff9 fs5 fc0 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">http://localhost:15000/grok/blah.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>382</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
