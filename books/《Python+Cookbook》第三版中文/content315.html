<div id="pf13b" class="pf w0 h0" data-page-no="13b"><div class="pc pc13b w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg13b.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add<span class="fc6 ls34">.</span>__wrapped__(<span class="fc7">2</span><span class="ls33">,</span><span class="fc7">3</span>)</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y2f1 ff1 fs3 fc0 sc0 ls0 ws38">下面我们在 <span class="ff4 wsbb9">Python3.4 </span>下测试：</div><div class="t m0 x5 hf yc28 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf yc29 ff8 fs5 fc8 sc0 ls0 ws4">Decorator 1</div><div class="t m0 x5 hf yc2a ff8 fs5 fc8 sc0 ls0 ws4">Decorator 2</div><div class="t m0 x5 hf yc2b ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y357 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add<span class="fc6 ls34">.</span>__wrapped__(<span class="fc7">2</span><span class="ls33">,</span><span class="fc7">3</span>)</span></div><div class="t m0 x5 hf y358 ff8 fs5 fc8 sc0 ls0 ws4">Decorator 2</div><div class="t m0 x5 hf yca3 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y1fa8 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1766 ff1 fs3 fc0 sc0 ls3d wsbba">最后要说的是，并不是所有的装饰器都使用了 <span class="ff6 ls0 ws20b">@wraps </span><span class="ws164">，因此这里的方案并不全部</span></div><div class="t m0 x5 h9 y14d3 ff1 fs3 fc0 sc0 ls0 wsbbb">适<span class="_ _6"></span>用。特<span class="_ _6"></span>别<span class="_ _6"></span>的，<span class="_ _6"></span>内<span class="_ _6"></span>置<span class="_ _6"></span>的<span class="_ _6"></span>装饰<span class="_ _6"></span>器 <span class="ff6 ws702">@staticmethod </span><span class="ls132">和</span><span class="ff6 wsbbc">@classmethod </span><span class="ls1e ws111">就没有遵循这个约定</span></div><div class="t m0 x5 h7 y2131 ff4 fs3 fc0 sc0 ls0 wsa5">(<span class="ff1 ws592">它们把原始函数存储在属性 <span class="ff6 wsbbd">func </span><span class="lsb">中</span></span>)<span class="ff1">。</span></div><div class="t m0 x5 hd y2132 ff2 fs4 fc4 sc0 ls0 ws9c6">11.4<span class="_ _e"> </span>9.4 <span class="ff1">定义一个带参数的装饰器</span></div><div class="t m0 x5 he y2133 ff2 fs2 fc4 sc0 ls0 ws212">11.4.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2134 ff1 fs3 fc0 sc0 ls0">你想定义一个可以接受参数的装饰器</div><div class="t m0 x5 he y2135 ff2 fs2 fc4 sc0 ls0 ws212">11.4.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2136 ff1 fs3 fc0 sc0 ls3a ws153">我们用一个例子详细阐述下接受参数的处理过程。假设你想写一个装饰器，给函数</div><div class="t m0 x5 h9 y2137 ff1 fs3 fc0 sc0 ls13 wse5">添加日志功能<span class="_ _1"></span>，当时允许用户指定日志的级别和其他的选项。下面是这个装饰器的定<span class="_ _c"></span></div><div class="t m0 x5 h9 y2138 ff1 fs3 fc0 sc0 ls0">义和使用示例：</div><div class="t m0 x5 hf y2139 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">wraps</span></span></div><div class="t m0 x5 h10 y213a ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">logging</span></div><div class="t m0 x5 hf y213b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">logged<span class="fc0 ws4">(level, name<span class="fc6 ls34">=</span></span><span class="fca">None<span class="fc0 ws13b">, message<span class="fc6 ls34">=</span></span>None<span class="fc0">):</span></span></span></div><div class="t m0 x15 h11 y213c ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x15 h11 y213d ffa fs5 fc9 sc0 ls0 ws4">Add logging to a function. level is the logging</div><div class="t m0 x15 h11 y213e ffa fs5 fc9 sc0 ls0 ws4">level, name is the logger name, and message is the</div><div class="t m0 x15 h11 yb62 ffa fs5 fc9 sc0 ls0 ws4">log message. If name and message aren<span class="ffb ls34">&apos;</span><span class="ws13b">t specified,</span></div><div class="t m0 x15 h11 yb63 ffa fs5 fc9 sc0 ls0 ws4">they default to the function<span class="ffb ls34">&apos;</span>s module and name.</div><div class="t m0 x15 h11 yb64 ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x15 hf yb65 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">decorate<span class="fc0">(func):</span></span></div><div class="t m0 x16 hf yb66 ff8 fs5 fc0 sc0 ls0 ws155">logname <span class="fc6 ls32">=</span><span class="ws13c">name <span class="ff7 fca ws157">if </span>name <span class="ff7 fca ws218">else </span><span class="ws13a">func<span class="fc6 ls34">.</span>__module__</span></span></div><div class="t m0 x16 hf y213f ff8 fs5 fc0 sc0 ls0 ws158">log <span class="fc6 ls32">=</span><span class="ws13a">logging<span class="fc6 ls34">.</span>getLogger(logname)</span></div><div class="t m0 x16 hf y2140 ff8 fs5 fc0 sc0 ls0 ws145">logmsg <span class="fc6 ls32">=</span><span class="ws155">message <span class="ff7 fca ws157">if </span>message <span class="ff7 fca ws15a">else </span><span class="ws13a">func<span class="fc6">.</span>__name__</span></span></div><div class="t m0 x16 hf y2141 ff7 fs5 fc12 sc0 ls0 ws156">@wraps<span class="ff8 fc0">(func)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.4.<span class="_ _5"> </span>9.4 <span class="ff1 ws281">定义一个带参数的装饰器 </span>306</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
