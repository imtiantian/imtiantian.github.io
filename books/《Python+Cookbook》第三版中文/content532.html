<div id="pf214" class="pf w0 h0" data-page-no="214"><div class="pc pc214 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg214.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y765 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y766 ff8 fs5 fc0 sc0 ls0 ws13a">unittest<span class="fc6">.</span>main()</div><div class="t m0 x0 h9 y205b ff1 fs3 fc0 sc0 ls3a ws153">这样的话测试文件就是可执行的，并且会将运行测试的结果打印到标准输出上。如</div><div class="t m0 x5 h9 y33a9 ff1 fs3 fc0 sc0 ls0 ws63">果你想重定向输出，就需要像下面这样修改 <span class="ff6 ws3ce">main() </span>函数：</div><div class="t m0 x5 h10 yc28 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf y33aa ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">main<span class="fc0">(out<span class="fc6">=</span>sys<span class="fc6">.</span><span class="ws4">stderr, verbosity</span><span class="fc6">=<span class="fc7 ls34">2</span></span>):</span></span></div><div class="t m0 x15 hf y33ab ff8 fs5 fc0 sc0 ls0 ws145">loader <span class="fc6 ls32">=</span><span class="ws13a">unittest<span class="fc6 ls34">.</span>TestLoader()</span></div><div class="t m0 x15 hf y33ac ff8 fs5 fc0 sc0 ls0 ws15f">suite <span class="fc6 ls33">=</span><span class="ws13a">loader<span class="fc6 ls34">.</span>loadTestsFromModule(sys<span class="fc6">.</span>modules[__name__])</span></div><div class="t m0 x15 hf y33ad ff8 fs5 fc0 sc0 ls0 ws13a">unittest<span class="fc6">.</span>TextTestRunner(out,verbosity<span class="fc6 ls34">=</span>verbosity)<span class="fc6 ls34">.</span>run(suite)</div><div class="t m0 x5 hf y33ae ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y33af ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9">testing.out<span class="ff9 ls34">&apos;</span><span class="fc0 ls32">,</span><span class="ff9 ls34">&apos;<span class="ff8">w</span><span class="ls0 ws13b">&apos;</span></span><span class="fc0 ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x16 hf y33b0 ff8 fs5 fc0 sc0 ls0">main(f)</div><div class="t m0 x5 he y33b1 ff2 fs2 fc4 sc0 ls0 ws212">16.4.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2f37 ff1 fs3 fc0 sc0 ls3a ws153">本节感兴趣的部分并不是将测试结果重定向到一个文件中，而是通过这样做向你展</div><div class="t m0 x5 h9 y33b2 ff1 fs3 fc0 sc0 ls0 ws14">示了 <span class="ff6 ws1f3">unittest </span>模块中一些值得关注的内部工作原理。</div><div class="t m0 x0 h9 y33b3 ff6 fs3 fc0 sc0 ls0 ws98f">unittest <span class="ff1 ls51 ws1c8">模块首先会组装一个测试套件。这个测试套件包含了你定义的各种方法。</span></div><div class="t m0 x5 h9 y33b4 ff1 fs3 fc0 sc0 ls0">一旦套件组装完成，它所包含的测试就可以被执行了。</div><div class="t m0 x0 h9 y33b5 ff1 fs3 fc0 sc0 ls0 ws12a5">这 两 步 是 分 开 的， <span class="ff6 ws12a6">unittest.TestLoader </span><span class="ls229 ws12a7">实例被用来组装测试套件<span class="_ _28"></span>。<span class="_ _20"></span></span></div><div class="t m0 x5 h9 y283 ff6 fs3 fc0 sc0 ls0 ws1282">loadTestsFromModule() <span class="ff1 ls2b ws12a8">是它定义的方法之一，用来收集测试用例。它会为 </span>TestCase</div><div class="t m0 x5 h9 y1320 ff1 fs3 fc0 sc0 ls139 ws859">类扫描某个模块并将其中的测试方法提取出来<span class="_ _d"></span>。如果你想进行细粒度的控制<span class="_ _c"></span>，可以<span class="_ _c"></span></div><div class="t m0 x5 h7 y1321 ff1 fs3 fc0 sc0 ls0 ws12a9">使<span class="_ _0"></span>用 <span class="ff6 ws12aa">loadTestsFromTestCase() </span><span class="ls22a ws12ab">方法来从某个继承 </span><span class="ff4 ws12ac">T<span class="_ _8"></span>estCase <span class="ff1 ls22a ws12ad">的类中提取测试方法<span class="_ _c"></span>。<span class="_ _d"></span></span></span></div><div class="t m0 x5 h9 y1b34 ff6 fs3 fc0 sc0 ls0 ws10bf">TextTestRunner <span class="ff1 ls2b ws12e">类是一个测试运行类的例子，这个类的主要用途是执行某个测试套件</span></div><div class="t m0 x5 h9 y33b6 ff1 fs3 fc0 sc0 ls42 ws12ae">中包含的测试方法。这个类跟执行 <span class="ff6 ls0 ws185">unittest.main() <span class="ff1 wsa0">函数所使<span class="_ _6"></span>用的<span class="_ _6"></span>测试<span class="_ _6"></span>运行<span class="_ _6"></span>器是<span class="_ _6"></span>一样</span></span></div><div class="t m0 x5 h9 y33b7 ff1 fs3 fc0 sc0 ls1e ws111">的<span class="_ _1"></span>。不过，我们在这里对它进行了一些列底层配置<span class="_ _c"></span>，包括输出文件<span class="_ _6"></span>和提升级别<span class="_ _1"></span>。尽管</div><div class="t m0 x5 h9 y33b8 ff1 fs3 fc0 sc0 ls0 ws12af">本节例子代码很少，但是能指导你如何对 <span class="ff6 ws12b0">unittest </span><span class="wsa0">框架进行更进一步的自定义。要想</span></div><div class="t m0 x5 h9 y33b9 ff1 fs3 fc0 sc0 ls0 wsdd3">自定义测试套件的装配方式，你可以对 <span class="ff6 ws12b1">TestLoader </span><span class="wsa0">类执行更多的操作。<span class="_ _1"></span>为了自定义测</span></div><div class="t m0 x5 h9 y33ba ff1 fs3 fc0 sc0 ls0 wsb9a">试运行，<span class="_ _1"></span>你可以构造一个自己的测试运行类来模拟 <span class="ff6 ws12b2">TextTestRunner </span><span class="wsa0">的功能。<span class="_ _1"></span>而这些已</span></div><div class="t m0 x5 h9 y33bb ff1 fs3 fc0 sc0 ls0 wsa0">经超出<span class="_ _6"></span>了本节<span class="_ _6"></span>的范<span class="_ _6"></span>围。<span class="ff6 ws492">unittest </span>模块<span class="_ _6"></span>的文档<span class="_ _6"></span>对底层<span class="_ _6"></span>实现原<span class="_ _6"></span>理有更<span class="_ _6"></span>深入<span class="_ _6"></span>的讲解，<span class="_ _6"></span>可以去</div><div class="t m0 x5 h9 y33bc ff1 fs3 fc0 sc0 ls0">看看。</div><div class="t m0 x5 hd y33bd ff2 fs4 fc4 sc0 ls0 ws211">16.5<span class="_ _e"> </span>14.5 <span class="ff1">忽略或期望测试失败</span></div><div class="t m0 x5 he y1645 ff2 fs2 fc4 sc0 ls0 ws212">16.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 yafd ff1 fs3 fc0 sc0 ls0">你想在单元测试中忽略或标记某些测试会按照预期运行失败。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">16.5.<span class="_ _36"> </span>14.5 <span class="ff1 ws544">忽略或期望测试失败 </span>523</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
