<div id="pfaf" class="pf w0 h0" data-page-no="af"><div class="pc pcaf w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgaf.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff6 fs3 fc0 sc0 ls0 ws749">pickle <span class="ff1 ws3f7">是一种 <span class="ff4 ws74a">Python </span><span class="wsa0">特有的自描述的数据编码。<span class="_ _1"></span>通过自描述，被序列化后的数据</span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls1e ws111">包含每个对象开始和结束以及它的类型信息<span class="_ _c"></span>。因此，你无需担心对象记录的定义<span class="_ _1"></span>，它<span class="_ _1"></span></div><div class="t m0 x5 h9 y2c ff1 fs3 fc0 sc0 ls0">总是能工作。举个例子，如果要处理多个对象，你可以这样做：</div><div class="t m0 x5 h10 y130b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">pickle</span></span></div><div class="t m0 x5 hf y130c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somedata<span class="ff9 ls34">&apos;</span></span></span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">wb</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y130d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>dump([<span class="fc7 ls34">1</span><span class="ls33">,</span><span class="fc7">2</span><span class="ls33">,</span><span class="fc7">3</span><span class="ls33">,<span class="fc7 ls34">4</span></span><span class="ws13b">], f)</span></span></div><div class="t m0 x5 hf y130e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>dump(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">hello<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, f)</span></span></div><div class="t m0 x5 hf y130f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>dump({<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Apple<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">Pear<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Banana<span class="ff9 ls34">&apos;</span></span><span class="ws13b">}, f)</span></span></div><div class="t m0 x5 hf y1310 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></span></div><div class="t m0 x5 hf y1311 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somedata<span class="ff9 ls34">&apos;</span></span></span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">rb</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y1312 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>load(f)</span></div><div class="t m0 x5 hf y1313 ff8 fs5 fc8 sc0 ls0 ws4">[1, 2, 3, 4]</div><div class="t m0 x5 hf y1314 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>load(f)</span></div><div class="t m0 x5 hf y1315 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">hello<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1316 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>load(f)</span></div><div class="t m0 x5 hf y1317 ff8 fs5 fc8 sc0 ls34">{<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">Apple</span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span><span class="ls0 ws13a">Pear</span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span><span class="ls0 ws13a">Banana</span><span class="ff9">&apos;</span><span class="ls0">}</span></div><div class="t m0 x5 hf y1318 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1319 ff1 fs3 fc0 sc0 ls0 wsa0">你还能序列化函数，类，<span class="_ _6"></span>还有接口，但是结果数据仅<span class="_ _6"></span>仅将它们的名称编码成<span class="_ _6"></span>对应的</div><div class="t m0 x5 h9 y131a ff1 fs3 fc0 sc0 ls0">代码对象。例如：</div><div class="t m0 x5 h10 y131b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">math</span></span></div><div class="t m0 x5 h10 y131c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">pickle.</span></span></div><div class="t m0 x5 hf y131d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">pickle<span class="fc6 ls34">.</span>dumps(math<span class="fc6 ls34">.</span>cos)</span></div><div class="t m0 x5 hf y131e ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x80\x03cmath\ncos\nq\x00.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y131f ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y283 ff1 fs3 fc0 sc0 ls0 wsa0">当数据反序列化回来<span class="_ _6"></span>的时候，会先假定所有的源<span class="_ _6"></span>数据时可用的。模块、类和<span class="_ _6"></span>函数会</div><div class="t m0 x5 h7 y1320 ff1 fs3 fc0 sc0 ls17 ws74b">自动按需导入进来。对于 <span class="ff4 ls0 ws587">Python </span><span class="wsf6">数据被不同机器上的解析器所共享的应用程序而言<span class="_ _1"></span>，</span></div><div class="t m0 x5 h9 y1321 ff1 fs3 fc0 sc0 ls0">数据的保存可能会有问题，因为所有的机器都必须访问同一个源代码。</div><div class="t m0 x0 h9 y1322 ff1 fs3 fc0 sc0 ls0">注</div><div class="t m0 x5 hf y1323 ffc fs6 fc0 sc0 ls0 ws6e2">千万不要对不信任的数据使用 <span class="ff8 fs5 ws13a">pickle.load()</span>。</div><div class="t m0 x5 hf y1324 ff8 fs5 fc0 sc0 ls0 ws145">pickle <span class="ffc fs6">在加载时有一个副作用就是它会自动加载相应模块并构造实例对象。</span></div><div class="t m0 x5 hf y1325 ffc fs6 fc0 sc0 ls0 ws6e4">但是某个坏人如果知道 <span class="ff8 fs5 ws145">pickle </span>的工作原理，</div><div class="t m0 x5 hf y1326 ffc fs6 fc0 sc0 ls0 ws6e4">他就可以创建一个恶意的数据导致 <span class="ff8 fs5 ws145">Python </span>执行随意指定的系统命令。</div><div class="t m0 x5 hf y1327 ffc fs6 fc0 sc0 ls0 ws6e2">因此，一定要保证 <span class="ff8 fs5 ws145">pickle </span>只在相互之间可以认证对方的解析器的内部使用。</div><div class="t m0 x0 h9 y1328 ff1 fs3 fc0 sc0 ls98 ws3a3">有些类型的对象是不能被序列化的<span class="_ _c"></span>。这些通常是那些依赖外部系统状态的对象<span class="_ _c"></span>，<span class="_ _c"></span></div><div class="t m0 x5 h9 y1329 ff1 fs3 fc0 sc0 ls126 ws74c">比如打开的文件<span class="_ _8"></span>，网络连接<span class="_ _8"></span>，线程<span class="_ _8"></span>，进程<span class="_ _8"></span>，栈帧等等<span class="_ _8"></span>。用户自定义类可以通<span class="_ _6"></span>过提<span class="_ _19"></span></div><div class="t m0 x5 h9 y132a ff1 fs3 fc0 sc0 ls127">供<span class="ff6 ls0 ws74d">getstate<span class="_ _e"> </span>() </span>和<span class="ff6 ls0 ws74d">setstate<span class="_ _e"> </span>() </span><span class="ls0 wsa0">方<span class="_ _6"></span>法<span class="_ _6"></span>来<span class="_ _6"></span>绕<span class="_ _6"></span>过<span class="_ _0"></span>这些<span class="_ _0"></span>限制。<span class="_ _0"></span>如果<span class="_ _0"></span>定义<span class="_ _0"></span>了这<span class="_ _0"></span>两个<span class="_ _6"></span>方<span class="_ _0"></span>法，</span></div><div class="t m0 x5 h9 y132b ff6 fs3 fc0 sc0 ls0 ws74e">pickle.dump() <span class="ff1 ws74f">就会调用 </span><span class="ws750">getstate<span class="_ _e"> </span>() <span class="ff1 ws751">获取序列化的对象。类似的， </span><span class="ws752">setstate ()</span></span></div><div class="t m0 x5 h9 y132c ff1 fs3 fc0 sc0 ls13 wse5">在反序列化时被调用<span class="_ _1"></span>。为了演示这个工作原理，下面是一个在内部定义了一个线程但<span class="_ _c"></span></div><div class="t m0 x5 h9 y132d ff1 fs3 fc0 sc0 ls0">仍然可以序列化和反序列化的类：</div><div class="t m0 x5 h11 y132e ffa fs5 fcd sc0 ls0 ws4"># countdown.py</div><div class="t m0 x5 h10 y132f ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 h10 y1330 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">threading</span></div><div class="t m0 x5 hf y1331 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Countdown<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1332 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, n):</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.21.<span class="_ _5"> </span>5.21 <span class="ff1 ws36c">序列化 </span><span class="ws747">Python <span class="ff1 ws748">对象 </span>166</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
