<div id="pf47" class="pf w0 h0" data-page-no="47"><div class="pc pc47 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg47.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y1ab ffa fs5 fcd sc0 ls0 ws4"># Version 1 (string concatenation)</div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws3c7">write(chunk1 <span class="fc6 ls32">+</span>chunk2)</span></div><div class="t m0 x5 h11 y1ae ffa fs5 fcd sc0 ls0 ws4"># Version 2 (separate I/O operations)</div><div class="t m0 x5 hf y1af ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(chunk1)</span></span></div><div class="t m0 x5 hf y1b0 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(chunk2)</span></span></div><div class="t m0 x0 h7 y7cb ff1 fs3 fc0 sc0 ls48 ws3c8">如果两个字符串很小<span class="_ _1"></span>，那么第一个版本性能会更好些<span class="_ _1"></span>，因为 <span class="ff4 ls0 ws3c9">I/<span class="_ _6"></span>O </span><span class="ws242">系统调用天生就<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y7cc ff1 fs3 fc0 sc0 ls1e ws111">慢<span class="_ _1"></span>。另外一方面，如果两个字符串很大<span class="_ _c"></span>，那么第二个版本可能会更<span class="_ _6"></span>加高效<span class="_ _1"></span>，因为它避</div><div class="t m0 x5 h9 y7cd ff1 fs3 fc0 sc0 ls13 wse5">免了创建一个很大的临时结果并且要复制大量的内存块数据<span class="_ _1"></span>。还是那句话，有时候是<span class="_ _c"></span></div><div class="t m0 x5 h9 y7ce ff1 fs3 fc0 sc0 ls0">需要根据你的应用程序特点来决定应该使用哪种方案。</div><div class="t m0 x0 h9 y7cf ff1 fs3 fc0 sc0 ls3a ws153">最后谈一下，如果你准备编写构建大量小字符串的输出代码，你最好考虑下使用生</div><div class="t m0 x5 h7 y7d0 ff1 fs3 fc0 sc0 ls0 ws38">成器函数，利用 <span class="ff4 ws3ca">yield </span>语句产生输出片段。比如：</div><div class="t m0 x5 hf y7d1 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">sample<span class="fc0">():</span></span></div><div class="t m0 x15 hf y7d2 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Is<span class="ff9">&apos;</span></span></span></div><div class="t m0 x15 hf y7d3 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Chicago<span class="ff9">&apos;</span></span></span></div><div class="t m0 x15 hf y7d4 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Not<span class="ff9">&apos;</span></span></span></div><div class="t m0 x15 hf y7d5 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Chicago?<span class="ff9">&apos;</span></span></span></div><div class="t m0 x0 h9 y7d6 ff1 fs3 fc0 sc0 ls22 ws119">这种方法一个有趣的方面是它并没有对输出片段到底要怎样组织做出假设。例如<span class="_ _1"></span>，</div><div class="t m0 x5 h9 y7d7 ff1 fs3 fc0 sc0 ls0 ws14">你可以简单的使用 <span class="ff6 ws25d">join() </span>方法将这些片段合并起来：</div><div class="t m0 x5 hf y7d8 ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls0 ws13a">.</span></span>join(sample())</div><div class="t m0 x0 h7 y7d9 ff1 fs3 fc0 sc0 ls0 ws14">或者你也可以将字符串片段重定向到 <span class="ff4 wsa5">I/O</span>：</div><div class="t m0 x5 hf y7da ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13c">part </span><span class="ws157">in <span class="ff8 fc0">sample():</span></span></div><div class="t m0 x15 hf y7db ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(part)</span></span></div><div class="t m0 x0 h7 y7dc ff1 fs3 fc0 sc0 ls0 ws38">再或者你还可以写出一些结合 <span class="ff4 ws59">I/O </span>操作的混合方案：</div><div class="t m0 x5 hf y7dd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">combine<span class="fc0 ws4">(source, maxsize):</span></span></div><div class="t m0 x15 hf y7de ff8 fs5 fc0 sc0 ls0 ws15f">parts <span class="fc6 ls33">=</span>[]</div><div class="t m0 x15 hf y7df ff8 fs5 fc0 sc0 ls0 ws13c">size <span class="fc6 ls32">=</span><span class="fc7">0</span></div><div class="t m0 x15 hf y7e0 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">part </span><span class="ws160">in <span class="ff8 fc0">source:</span></span></div><div class="t m0 x16 hf y7e1 ff8 fs5 fc0 sc0 ls0 ws13a">parts<span class="fc6 ls34">.</span>append(part)</div><div class="t m0 x16 hf y7e2 ff8 fs5 fc0 sc0 ls0 ws161">size <span class="fc6 ws1a1">+= <span class="fca ws13a">len</span></span>(part)</div><div class="t m0 x16 hf y7e3 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">size <span class="fc6 ls32">&gt;</span>maxsize:</span></div><div class="t m0 x17 hf y7e4 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ff8 fc6 ws13a">.<span class="fc0">join(parts)</span></span></div><div class="t m0 x17 hf y7e5 ff8 fs5 fc0 sc0 ls0 ws15f">parts <span class="fc6 ls33">=</span>[]</div><div class="t m0 x17 hf y7e6 ff8 fs5 fc0 sc0 ls0 ws161">size <span class="fc6 ls33">=</span><span class="fc7">0</span></div><div class="t m0 x16 hf y7e7 ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ff8 fc6 ws13a">.<span class="fc0">join(parts)</span></span></div><div class="t m0 x5 h12 y7e8 ffa fs5 fcd sc0 ls32">#<span class="ffc fs6 ls0">结合文件操作</span></div><div class="t m0 x5 hf y7e9 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">filename<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">w<span class="ff9 ls34">&apos;</span></span><span class="ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y7ea ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">part </span><span class="ws160">in <span class="ff8 fc0 ws23c">combine(sample(), <span class="fc7 ws13a">32768</span>):</span></span></div><div class="t m0 x16 hf y7eb ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(part)</span></span></div><div class="t m0 x0 h9 y7ec ff1 fs3 fc0 sc0 ls3a ws153">这里的关键点在于原始的生成器函数并不需要知道使用细节，它只负责生成字符串</div><div class="t m0 x5 h9 y7ed ff1 fs3 fc0 sc0 ls0">片段就行了。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.14.<span class="_ _5"> </span>2.14 <span class="ff1 ws3ba">合并拼接字符串 </span>62</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
