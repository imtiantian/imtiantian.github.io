<div id="pf99" class="pf w0 h0" data-page-no="99"><div class="pc pc99 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg99.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff6 fs3 fc0 sc0 ls0 ws675">io.StringIO <span class="ff1 ws676">只能<span class="_ _6"></span>用于文<span class="_ _6"></span>本。如<span class="_ _6"></span>果你<span class="_ _6"></span>要操作<span class="_ _6"></span>二进<span class="_ _6"></span>制数<span class="_ _6"></span>据，要使<span class="_ _6"></span>用 </span><span class="ws677">io.BytesIO <span class="ff1 wsa0">类来</span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">代替。比如：</div><div class="t m0 x5 hf y10cc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">io<span class="fc6 ls34">.</span>BytesIO()</span></span></div><div class="t m0 x5 hf y10cd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">write(b</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws4">binary data</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y10ce ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">getvalue()</span></span></span></div><div class="t m0 x5 hf y10cf ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">binary data<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y10d0 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y10d1 ff2 fs2 fc4 sc0 ls0 ws135">7.6.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y10d2 ff1 fs3 fc0 sc0 ls3a ws678">当你想模拟一个普通的文件的时候 <span class="ff6 ls0 ws239">StringIO </span><span class="ls10e">和<span class="ff6 ls0 ws679">BytesIO </span></span><span class="ws153">类是很有用的。比如，在</span></div><div class="t m0 x5 h9 y10d3 ff1 fs3 fc0 sc0 ls0 ws25a">单元测试中，你可以使用 <span class="ff6 ws25b">StringIO </span><span class="wsa0">来创建一个包含测试数据的类文件对象，这个对象</span></div><div class="t m0 x5 h9 y10d4 ff1 fs3 fc0 sc0 ls0">可以被传给某个参数为普通文件对象的函数。</div><div class="t m0 x0 h9 y10d5 ff1 fs3 fc0 sc0 ls0 ws67a">需要<span class="_ _6"></span>注<span class="_ _6"></span>意<span class="_ _6"></span>的是， <span class="ff6 ws3a9">StringIO </span><span class="ls96">和</span><span class="ff6 ws67b">BytesIO </span><span class="ls10 wsdf">实例并没有正确的整数类型<span class="_ _6"></span>的文件描述符<span class="_ _1"></span>。</span></div><div class="t m0 x5 h9 y10d6 ff1 fs3 fc0 sc0 ls13 wse5">因此<span class="_ _1"></span>，它们不能在那些需要使用真实的系统级文件如文件，管道或者是套接字的程序<span class="_ _c"></span></div><div class="t m0 x5 h9 y10d7 ff1 fs3 fc0 sc0 ls0">中使用。</div><div class="t m0 x5 hd y10d8 ff2 fs4 fc4 sc0 ls0 ws134">7.7<span class="_ _e"> </span>5.7 <span class="ff1">读写压缩文件</span></div><div class="t m0 x5 he y41b ff2 fs2 fc4 sc0 ls0 ws135">7.7.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y10d9 ff1 fs3 fc0 sc0 ls0 wsc">你想读写一个 <span class="ff4 ws67c">gzip </span><span class="ls4">或</span><span class="ff4 ws6f">bz2 </span>格式的压缩文件。</div><div class="t m0 x5 he y10da ff2 fs2 fc4 sc0 ls0 ws135">7.7.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y10db ff6 fs3 fc0 sc0 ls0 ws67d">gzip <span class="ff1 ls81">和</span><span class="ws67e">bz2 <span class="ff1 ls40 ws67f">模块可以很容易的处理这些文件<span class="_ _1"></span>。两个模块都为 <span class="ff6 ls0 ws680">open() </span><span class="ws180">函数提供了</span></span></span></div><div class="t m0 x5 h9 y10dc ff1 fs3 fc0 sc0 ls0">另外的实现来解决这个问题。比如，为了以文本形式读取压缩文件，可以这样做：</div><div class="t m0 x5 h11 y10dd ffa fs5 fcd sc0 ls0 ws4"># gzip compression</div><div class="t m0 x5 h10 y10de ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">gzip</span></div><div class="t m0 x5 hf y10df ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">gzip<span class="fc6">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.gz<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y10e0 ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ls34">f</span><span class="fc6 ws13a">.</span>read()</div><div class="t m0 x5 h11 y10e1 ffa fs5 fcd sc0 ls0 ws4"># bz2 compression</div><div class="t m0 x5 h10 y10e2 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">bz2</span></div><div class="t m0 x5 hf y10e3 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">bz2<span class="fc6 ls34">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.bz2<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y10e4 ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ls34">f</span><span class="fc6 ws13a">.</span>read()</div><div class="t m0 x0 h9 y10e5 ff1 fs3 fc0 sc0 ls0">类似的，为了写入压缩数据，可以这样做：</div><div class="t m0 x5 h11 y32f ffa fs5 fcd sc0 ls0 ws4"># gzip compression</div><div class="t m0 x5 h10 y330 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">gzip</span></div><div class="t m0 x5 hf y331 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">gzip<span class="fc6">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.gz<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">wt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y332 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(text)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.7.<span class="_ _5"> </span>5.7 <span class="ff1 ws64b">读写压缩文件 </span>144</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
