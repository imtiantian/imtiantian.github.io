<div id="pf24e" class="pf w0 h0" data-page-no="24e"><div class="pc pc24e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg24e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff8 fs5 fc0 sc0 ls0 ws13b">def __get__(self):</div><div class="t m0 x17 hf y1ac ff8 fs5 fc0 sc0 ls0 ws13b">return self._c_point.x</div><div class="t m0 x16 hf y1ad ff8 fs5 fc0 sc0 ls0 ws13b">def __set__(self, value):</div><div class="t m0 x17 hf y1ae ff8 fs5 fc0 sc0 ls0 ws13b">self._c_point.x = value</div><div class="t m0 x15 hf y1b0 ff8 fs5 fc0 sc0 ls0 ws13b">property y:</div><div class="t m0 x16 hf y355 ff8 fs5 fc0 sc0 ls0 ws13b">def __get__(self):</div><div class="t m0 x17 hf y410 ff8 fs5 fc0 sc0 ls0 ws13b">return self._c_point.y</div><div class="t m0 x16 hf y411 ff8 fs5 fc0 sc0 ls0 ws13b">def __set__(self, value):</div><div class="t m0 x17 hf yba ff8 fs5 fc0 sc0 ls0 ws13b">self._c_point.y = value</div><div class="t m0 x5 hf ybed ff8 fs5 fc0 sc0 ls0 ws4">def distance(Point p1, Point p2):</div><div class="t m0 x15 hf ybee ff8 fs5 fc0 sc0 ls0 ws13b">return csample.distance(p1._c_point, p2._c_point)</div><div class="t m0 x0 h7 y38c1 ff1 fs3 fc0 sc0 ls0 wsa0">在这里，<span class="_ _d"></span><span class="ff4 ws14f8">cdif <span class="ff1 ls290">类</span><span class="ff6 ws14f9">Point <span class="ff1 ls290">将</span></span><span class="ws14fa">Poin<span class="_ _c"></span>t <span class="ff1 ws14fb">声明为一个扩展类型。<span class="_ _c"></span>类属性 <span class="ff6 ws14fc">cdef csample.Point</span></span></span></span></div><div class="t m0 x5 h7 y2d31 ff6 fs3 fc0 sc0 ls0 ws3e3">* c point<span class="_ _a"> </span><span class="ff1 ws14fd">声明了一个实例变量，<span class="_ _d"></span>拥有一个指向底层 <span class="ff4 ws14fe">Poin<span class="_ _c"></span>t <span class="ff1 ws14ff">结构体的指针。 <span class="ff6 wsb75">cinit ()</span></span></span></span></div><div class="t m0 x5 h7 y38c2 ff1 fs3 fc0 sc0 ls291">和<span class="ff6 ls0 ws1500">dealloc<span class="_ _e"> </span>() </span><span class="ls82 ws1501">方法通过 </span><span class="ff6 ls0 ws8bd">malloc() </span><span class="ls199">和<span class="ff6 ls0 ws1502">free() </span><span class="ls82 ws1503">创建并销毁底层 <span class="ff4 lsd7">C</span></span><span class="ls0 wsa0">结构体。<span class="ff4 ls292">x</span><span class="ls12d">和<span class="ff4 ls292">y</span></span>属</span></span></div><div class="t m0 x5 h9 y38c3 ff1 fs3 fc0 sc0 ls17 ws1504">性的声明让你获取和设置底层结构体的属性值。 <span class="ff6 ls0 ws1505">distance() </span><span class="wsf6">的包装器还可以被修改，<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y38c4 ff1 fs3 fc0 sc0 ls0 ws14">使得它能接受 <span class="ff6 ws17d">Point </span><span class="ws63">扩展类型实例作为参数，而传递底层指针给 <span class="ff4 ls8">C</span>函数。</span></div><div class="t m0 x0 h7 y2c09 ff1 fs3 fc0 sc0 ls0 ws14">做了这个改变后，你会发现操作 <span class="ff4 ws13e6">P<span class="_ _1"></span>oin<span class="_ _1"></span>t <span class="ff1">对象就显得更加自然了：</span></span></div><div class="t m0 x5 h10 y38c5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sample</span></span></div><div class="t m0 x5 hf y38c6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">p1 <span class="fc6 ls33">=</span><span class="ws13a">sample<span class="fc6 ls34">.</span>Point(<span class="fc7 ls34">2</span>,<span class="fc7 ls34">3</span>)</span></span></div><div class="t m0 x5 hf y38c7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">p2 <span class="fc6 ls33">=</span><span class="ws13a">sample<span class="fc6 ls34">.</span>Point(<span class="fc7 ls34">4</span>,<span class="fc7 ls34">5</span>)</span></span></div><div class="t m0 x5 hf y38c8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">p1</span></div><div class="t m0 x5 hf y38c9 ff8 fs5 fc8 sc0 ls0 ws4">&lt;sample.Point object at 0x100447288&gt;</div><div class="t m0 x5 hf y38ca ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">p2</span></div><div class="t m0 x5 hf y38cb ff8 fs5 fc8 sc0 ls0 ws4">&lt;sample.Point object at 0x1004472a0&gt;</div><div class="t m0 x5 hf y38cc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">p1<span class="fc6 ls34">.</span>x</span></div><div class="t m0 x5 hf y38cd ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf y2b2f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">p1<span class="fc6 ls34">.</span>y</span></div><div class="t m0 x5 hf y38ce ff8 fs5 fc8 sc0 ls0">3.0</div><div class="t m0 x5 hf y38cf ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>distance(p1,p2)</span></div><div class="t m0 x5 hf y38d0 ff8 fs5 fc8 sc0 ls0">2.8284271247461903</div><div class="t m0 x5 hf y287e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y38d1 ff1 fs3 fc0 sc0 ls0 ws1506">本节已<span class="_ _6"></span>经演示了<span class="_ _6"></span>很多 <span class="ff4 ws14a9">Cython </span><span class="ls2c ws12f">的核心特性，你可以以此为基准来构建更多更高级的</span></div><div class="t m0 x5 h9 y21a1 ff1 fs3 fc0 sc0 ls0">包装。不过，你最好先去阅读下官方文档来了解更多信息。</div><div class="t m0 x0 h7 y38d2 ff1 fs3 fc0 sc0 ls0 ws38">接下来几节还会继续演示一些 <span class="ff4 wsba">Cython </span>的其他特性。</div><div class="t m0 x5 hd y1a92 ff2 fs4 fc4 sc0 ls0 wsd91">17.11<span class="_ _e"> </span>15.11 <span class="ff1 ls7c">用</span><span class="wsce8">Cython <span class="ff1">写高性能的数组操作</span></span></div><div class="t m0 x5 he y38d3 ff2 fs2 fc4 sc0 ls0 wsadf">17.11.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y38d4 ff1 fs3 fc0 sc0 ls3d ws1507">你要写高性能的操作来自 <span class="ff4 ls0 ws1508">NumPy </span><span class="ws1509">之类的数组计算函数。你已经知道了 <span class="ff4 ls0 ws14ad">Cython <span class="ff1">这</span></span></span></div><div class="t m0 x5 h9 y38d5 ff1 fs3 fc0 sc0 ls0">样的工具会让它变得简单，但是并不确定该怎样去做。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">17.11.<span class="_ _36"> </span>15.11 <span class="ff1 ls7f">用</span><span class="ws747">Cython <span class="ff1 ws150a">写高性能的数组操作 </span>581</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
