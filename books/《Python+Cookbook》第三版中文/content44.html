<div id="pf2c" class="pf w0 h0" data-page-no="2c"><div class="pc pc2c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg2c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 ws2ae">如果你真的需要改变然后的属性，那么可以使用命名元组实例的 <span class="ff6 ws2af">replace() </span>方法，</div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">它会创建一个全新的命名元组并将对应的字段用新的值取代。比如：</div><div class="t m0 x5 hf y48d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">_replace(shares</span><span class="ls34">=</span><span class="fc7">75<span class="fc0">)</span></span></span></span></span></div><div class="t m0 x5 hf y48e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">s</span></div><div class="t m0 x5 hf y48f ff8 fs5 fc8 sc0 ls0 ws13a">Stock(name=<span class="ff9 ls34">&apos;</span>ACME<span class="ff9 ws13b">&apos;</span><span class="ws4">, shares=75, price=123.45)</span></div><div class="t m0 x5 hf y490 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x1a h9 y491 ff6 fs3 fc0 sc0 ls0 ws2b0">replace() <span class="ff1 ls48 ws242">方法还有一个很有用的特性就是当你的命名元组拥有可选或者缺失字<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y492 ff1 fs3 fc0 sc0 ls13 wse5">段时候<span class="_ _1"></span>，它是一个非常方便的填充数据的方法。你可以先创建一个包含缺省值的原型<span class="_ _c"></span></div><div class="t m0 x5 h9 y493 ff1 fs3 fc0 sc0 ls0 ws2b1">元组，然后使用 <span class="ff6 ws1d1">replace() </span>方法创建新的值被更新过的实例。比如：</div><div class="t m0 x5 hf y494 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">namedtuple</span></span></div><div class="t m0 x5 hf y495 ff8 fs5 fc0 sc0 ls0 ws15f">Stock <span class="fc6 ls33">=</span><span class="ws13a">namedtuple(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Stock<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, [<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">name<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">shares<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">price<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">date<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">time<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x5 h11 y496 ffa fs5 fcd sc0 ls0 ws4"># Create a prototype instance</div><div class="t m0 x5 hf y497 ff8 fs5 fc0 sc0 ls0 ws151">stock_prototype <span class="fc6 ls32">=</span><span class="ws13a">Stock(<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls32">,<span class="fc7 ls34">0</span><span class="ls33">,</span></span><span class="fc7">0.0</span><span class="ls32">,</span><span class="fca">None</span><span class="ls33">,</span><span class="fca">None</span>)</span></div><div class="t m0 x5 h11 y498 ffa fs5 fcd sc0 ls0 ws4"># Function to convert a dictionary to a Stock</div><div class="t m0 x5 hf y499 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">dict_to_stock<span class="fc0">(s):</span></span></div><div class="t m0 x15 hf y49a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">stock_prototype<span class="fc6 ls34">.</span>_replace(<span class="fc6 ls34">**</span>s)</span></div><div class="t m0 x0 h9 y49b ff1 fs3 fc0 sc0 ls0">下面是它的使用方法：</div><div class="t m0 x5 hf y49c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls34">{</span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">:</span>&apos;</span><span class="ff8 ws13a">ACME</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">,</span>&apos;</span><span class="ff8 ws13a">shares</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">:<span class="fc7 ls0 ws13a">100</span>,</span>&apos;</span><span class="ff8 ws13a">price</span><span class="ls34">&apos;<span class="ff8 fc0 ls33">:<span class="fc7 ls0 ws13a">123.45<span class="fc0">}</span></span></span></span></span></div><div class="t m0 x5 hf y49d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">dict_to_stock(a)</span></div><div class="t m0 x5 hf y49e ff8 fs5 fc8 sc0 ls0 ws13a">Stock(name=<span class="ff9 ls34">&apos;</span>ACME<span class="ff9 ws13b">&apos;</span><span class="ws4">, shares=100, price=123.45, date=None, time=None)</span></div><div class="t m0 x5 hf y49f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls34">{</span></span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">:</span>&apos;</span><span class="ff8 ws13a">ACME</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">,</span>&apos;</span><span class="ff8 ws13a">shares</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">:<span class="fc7 ls0 ws13a">100</span>,</span>&apos;</span><span class="ff8 ws13a">price</span><span class="ls34">&apos;<span class="ff8 fc0 ls33">:<span class="fc7 ls0 ws13a">123.45</span><span class="ls32">,</span></span>&apos;</span><span class="ff8 ws13a">date</span><span class="ls34">&apos;<span class="ff8 fc0 ls32">:</span>&apos;</span><span class="ff8 ws13a">12/17/2012</span><span class="ls34">&apos;</span><span class="ff8 fc0">}</span></span></div><div class="t m0 x5 hf y1dc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">dict_to_stock(b)</span></div><div class="t m0 x5 hf y4a0 ff8 fs5 fc8 sc0 ls0 ws13a">Stock(name=<span class="ff9 ls34">&apos;</span>ACME<span class="ff9 ws13b">&apos;</span><span class="ws4">, shares=100, price=123.45, date=<span class="ff9 ls34">&apos;</span></span>12/17/2012<span class="ff9 ls34">&apos;</span><span class="ws4">, time=None)</span></div><div class="t m0 x5 hf y4a1 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y4a2 ff1 fs3 fc0 sc0 ls22 ws119">最后要说的是，如果你的目标是定义一个需要更新很多实例属性的高效数据结构<span class="_ _1"></span>，</div><div class="t m0 x5 h9 y4a3 ff1 fs3 fc0 sc0 ls3a ws2b2">那么命名元组并不是你的最佳选择。这时候你应该考虑定义一个包含 <span class="ff6 ls0 ws2b3">slots <span class="ff1 wsa0">方法的</span></span></div><div class="t m0 x5 h7 y4a4 ff1 fs3 fc0 sc0 ls4">类<span class="ff4 ls1b">(</span><span class="ls0 ws14">参考 <span class="ff4 ws2b4">8.4 </span><span class="wsa0">小节<span class="ff4 ls1b">)</span>。</span></span></div><div class="t m0 x5 hd y4a5 ff2 fs4 fc4 sc0 ls0 ws211">3.19<span class="_ _e"> </span>1.19 <span class="ff1">转换并同时计算数据</span></div><div class="t m0 x5 he y4a6 ff2 fs2 fc4 sc0 ls0 ws212">3.19.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y4a7 ff1 fs3 fc0 sc0 ls1e ws2b5">你需要在数据序列上执行聚集函数 <span class="ff4 ls1b">(</span><span class="ls0 ws2b6">比如 <span class="ff6 ws2b7">sum() <span class="ff4 ls70">,</span><span class="ws2b8">min() <span class="ff4 ls70">,</span></span>max() <span class="ff4 ls1b">)</span></span></span><span class="ws111">，但是首先你需</span></div><div class="t m0 x5 h9 y4a8 ff1 fs3 fc0 sc0 ls0">要先转换或者过滤数据</div><div class="t m0 x5 he y4a9 ff2 fs2 fc4 sc0 ls0 ws212">3.19.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y4aa ff1 fs3 fc0 sc0 ls63 ws21f">一个非常优雅的方式去结合数据计算与转换就是使用一个生成器表达式参数<span class="_ _c"></span>。比<span class="_ _1"></span></div><div class="t m0 x5 h9 y4ab ff1 fs3 fc0 sc0 ls0">如，如果你想计算平方和，可以像下面这样做：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">3.19.<span class="_ _5"> </span>1.19 <span class="ff1 ws2ad">转换并同时计算数据 </span>35</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
