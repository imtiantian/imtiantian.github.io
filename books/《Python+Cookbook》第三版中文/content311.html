<div id="pf137" class="pf w0 h0" data-page-no="137"><div class="pc pc137 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg137.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y20bf ff1 fs3 fc0 sc0 ls0">下面是使用装饰器的例子：</div><div class="t m0 x5 h10 y20c0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fc12">@timethis</span></div><div class="t m0 x5 hf y20c1 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></span></div><div class="t m0 x5 h10 y20c2 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffb fc9">&apos;&apos;&apos;</span></div><div class="t m0 x5 h11 y20c3 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffa fc9 ws13b">Counts down</span></div><div class="t m0 x5 h10 y20c4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ffb fc9">&apos;&apos;&apos;</span></div><div class="t m0 x5 hf y20c5 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x5 hf y20c6 ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x5 h10 y20c7 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y20c8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">100000</span>)</span></div><div class="t m0 x5 hf y20c9 ff8 fs5 fc8 sc0 ls0 ws4">countdown 0.008917808532714844</div><div class="t m0 x5 hf y20ca ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown(<span class="fc7">10000000</span>)</span></div><div class="t m0 x5 hf y20cb ff8 fs5 fc8 sc0 ls0 ws4">countdown 0.87188299392912</div><div class="t m0 x5 hf y20cc ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y20cd ff2 fs2 fc4 sc0 ls0 ws212">11.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y9dd ff1 fs3 fc0 sc0 ls3a ws153">一个装饰器就是一个函数，它接受一个函数作为参数并返回一个新的函数。当你像</div><div class="t m0 x5 h9 y20ce ff1 fs3 fc0 sc0 ls0">下面这样写：</div><div class="t m0 x5 h10 y20cf ff7 fs5 fc12 sc0 ls0">@timethis</div><div class="t m0 x5 hf y20d0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></div><div class="t m0 x15 h10 y20d1 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y20d2 ff1 fs3 fc0 sc0 ls0">跟像下面这样写其实效果是一样的：</div><div class="t m0 x5 hf y20d3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></div><div class="t m0 x15 h10 y20d4 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y20d5 ff8 fs5 fc0 sc0 ls0 ws16e">countdown <span class="fc6 ls33">=</span>timethis(countdown)</div><div class="t m0 x0 h9 y68a ff1 fs3 fc0 sc0 ls30 wsb97">顺便说一下，内置的装饰器比如 <span class="ff6 ls0 wsb98">@staticmethod,<span class="_ _23"> </span>@classmethod,@property <span class="ff1 wsa0">原<span class="_ _6"></span>理</span></span></div><div class="t m0 x5 h9 y12a ff1 fs3 fc0 sc0 ls0">也是一样的。例如，下面这两个代码片段是等价的：</div><div class="t m0 x5 hf y20d6 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">A</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 h10 y20d7 ff7 fs5 fc12 sc0 ls0">@classmethod</div><div class="t m0 x15 hf y20d8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">method<span class="fc0">(cls):</span></span></div><div class="t m0 x16 h10 y20d9 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y20da ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ls34">B</span><span class="ff8 fc0">:</span></div><div class="t m0 x15 h11 y20db ffa fs5 fcd sc0 ls0 ws4"># Equivalent definition of a class method</div><div class="t m0 x15 hf y20dc ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">method<span class="fc0">(cls):</span></span></div><div class="t m0 x16 h10 y20dd ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x15 hf y8d9 ff8 fs5 fc0 sc0 ls0 ws145">method <span class="fc6 ls32">=</span><span class="fca ws13a">classmethod</span>(method)</div><div class="t m0 x0 h9 y20de ff1 fs3 fc0 sc0 ls0 ws279">在上面的 <span class="ff6 wsb99">wrapper() </span><span class="wsb9a">函数中，<span class="_ _1"></span>装饰器内部定义了一个使用 <span class="ff6 wsb9b">*args </span><span class="ls18b">和</span><span class="ff6 wsb82">**kwargs </span>来接</span></div><div class="t m0 x5 h9 y20df ff1 fs3 fc0 sc0 ls13 wse5">受任意参数的函数<span class="_ _1"></span>。在这个函数里面调用了原始函数并将其结果返回，不过你还可以<span class="_ _c"></span></div><div class="t m0 x5 h7 y20e0 ff1 fs3 fc0 sc0 ls30 wsb9c">添加其他额外的代码 <span class="ff4 ls1b">(</span><span class="ls0 wsa0">比如<span class="_ _6"></span>计<span class="_ _6"></span>时<span class="ff4 wsa5">)</span></span><span class="ws138">。然后这个新的函数包装器被作为结果返回来代替原</span></div><div class="t m0 x5 h9 y20e1 ff1 fs3 fc0 sc0 ls0">始函数。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.1.<span class="_ _5"> </span>9.1 <span class="ff1 ws2ad">在函数上添加包装器 </span>302</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
