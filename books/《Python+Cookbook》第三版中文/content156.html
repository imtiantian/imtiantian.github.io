<div id="pf9c" class="pf w0 h0" data-page-no="9c"><div class="pc pc9c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg9c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y181 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Write a sample file</span></div><div class="t m0 x5 hf y182 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9">sample.bin<span class="ff9 ls34">&apos;</span><span class="fc0 ls32">,</span><span class="ff9 ls34">&apos;</span>wb<span class="ff9 ws13b">&apos;</span><span class="fc0 ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y183 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(b</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws4">Hello World</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 h10 y184 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y185 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws158">buf <span class="fc6 ls32">=</span><span class="ws13a">read_into_buffer(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">sample.bin<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y186 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">buf</span></div><div class="t m0 x5 hf y187 ff8 fs5 fc8 sc0 ls0 ws13a">bytearray(b<span class="ff9 ls34">&apos;</span><span class="ws13b">Hello World<span class="ff9">&apos;</span>)</span></div><div class="t m0 x5 hf y188 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">buf[<span class="fc7 ls34">0</span>:<span class="fc7 ls34">5</span><span class="ls32">]<span class="fc6 ls33">=</span><span class="ls34">b</span></span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Hallo<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y98e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">buf</span></div><div class="t m0 x5 hf y98f ff8 fs5 fc8 sc0 ls0 ws13a">bytearray(b<span class="ff9 ls34">&apos;</span><span class="ws13b">Hallo World<span class="ff9">&apos;</span>)</span></div><div class="t m0 x5 hf y990 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9">newsample.bin<span class="ff9 ls34">&apos;</span><span class="fc0 ls33">,</span><span class="ff9 ws13b">&apos;</span>wb<span class="ff9 ws13b">&apos;</span><span class="fc0 ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y991 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(buf)</span></span></span></div><div class="t m0 x5 h10 y992 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y993 ff8 fs5 fc8 sc0 ls0">11</div><div class="t m0 x5 hf ya70 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y1115 ff2 fs2 fc4 sc0 ls0 ws135">7.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1116 ff1 fs3 fc0 sc0 ls0 ws692">文件对<span class="_ _6"></span>象的 <span class="ff6 ws141">readinto() </span><span class="ls18 ws110">方法能被用来为预先分配内存的数组填充数据，甚至包括</span></div><div class="t m0 x5 h9 y1117 ff1 fs3 fc0 sc0 ls112">由<span class="ff6 ls0 ws693">array </span><span class="ls0 ws3f7">模块或 <span class="ff6 ws693">numpy </span><span class="ws694">库创建的数组。<span class="_ _1"></span>和普通 <span class="ff6 ws695">read() </span><span class="ws696">方法不同的是， <span class="ff6 ws697">readinto() </span>填</span></span></span></div><div class="t m0 x5 h9 y1118 ff1 fs3 fc0 sc0 ls13 wse5">充已存在的缓冲区而不是为新对象重新分配内存再返回它们<span class="_ _1"></span>。因此，你可以使用它来<span class="_ _c"></span></div><div class="t m0 x5 h9 y1119 ff1 fs3 fc0 sc0 ls13 wse5">避免大量的内存分配操作<span class="_ _1"></span>。比如，如果你读取一个由相同大小的记录组成的二进制文<span class="_ _c"></span></div><div class="t m0 x5 h9 y111a ff1 fs3 fc0 sc0 ls0">件时，你可以像下面这样写：</div><div class="t m0 x5 hf y111b ff8 fs5 fc0 sc0 ls0 ws208">record_size <span class="fc6 ls32">=</span><span class="fc7 ws159">32 <span class="ffa fcd ws4"># Size of each record (adjust value)</span></span></div><div class="t m0 x5 hf y111c ff8 fs5 fc0 sc0 ls0 ws158">buf <span class="fc6 ls32">=</span><span class="fca ws13a">bytearray</span>(record_size)</div><div class="t m0 x5 hf y111d ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rb<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y111e ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y111f ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls33">=</span><span class="ls0 ws13a">f<span class="fc6 ls34">.</span>readinto(buf)</span></div><div class="t m0 x16 hf y1120 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ls32">n<span class="fc6 ls33">&lt;</span><span class="ls0">record_size:</span></span></div><div class="t m0 x17 h10 y1121 ff7 fs5 fca sc0 ls0">break</div><div class="t m0 x16 h11 y1122 ffa fs5 fcd sc0 ls0 ws4"># Use the contents of buf</div><div class="t m0 x16 hf y1123 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 y1124 ff1 fs3 fc0 sc0 ls18 ws698">另外有一个有趣特性就是 <span class="ff6 ls0 ws2e6">memoryview </span><span class="ws110">，它可以通过零复制的方式对已存在的缓冲</span></div><div class="t m0 x5 h9 y1125 ff1 fs3 fc0 sc0 ls0">区执行切片操作，甚至还能修改它的内容。比如：</div><div class="t m0 x5 hf y1126 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">buf</span></div><div class="t m0 x5 hf y1127 ff8 fs5 fc8 sc0 ls0 ws13a">bytearray(b<span class="ff9 ls34">&apos;</span><span class="ws13b">Hello World<span class="ff9">&apos;</span>)</span></div><div class="t m0 x5 hf y1128 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">m1 <span class="fc6 ls33">=</span>memoryview(buf)</span></div><div class="t m0 x5 hf y1129 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">m2 <span class="fc6 ls33">=</span><span class="ws13a">m1[<span class="fc6">-<span class="fc7 ls34">5</span></span>:]</span></span></div><div class="t m0 x5 hf y112a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">m2</span></div><div class="t m0 x5 hf y112b ff8 fs5 fc8 sc0 ls0 ws4">&lt;memory at 0x100681390&gt;</div><div class="t m0 x5 hf y112c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws15f">m2[:] <span class="fc6 ls33">=</span><span class="ws13a">b<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">WORLD<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y112d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">buf</span></div><div class="t m0 x5 hf y112e ff8 fs5 fc8 sc0 ls0 ws13a">bytearray(b<span class="ff9 ls34">&apos;</span><span class="ws13b">Hello WORLD<span class="ff9">&apos;</span>)</span></div><div class="t m0 x5 hf y112f ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1130 ff1 fs3 fc0 sc0 ls0 ws699">使用 <span class="ff6 ws69a">f.readinto() </span><span class="ls18 ws110">时需要注意的是，你必须检查它的返回值，也就是实际读取的<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.9.<span class="_ _5"> </span>5.9 <span class="ff1 ws658">读取二进制数据到可变缓冲区中 </span>147</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
