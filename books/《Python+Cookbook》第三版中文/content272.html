<div id="pf110" class="pf w0 h0" data-page-no="110"><div class="pc pc110 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg110.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y1ab ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">len<span class="fc0 ws155">(value) <span class="fc6 ws23d">&gt;= </span></span>self<span class="fc6 ls34">.</span><span class="fc0">size:</span></span></div><div class="t m0 x17 hf y1ac ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">ValueError<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws4">size must be &lt; <span class="ff9 ls32">&apos;</span><span class="fc6 ls33">+</span></span>str<span class="fc0 ls34">(</span>self<span class="fc6 ls34">.</span><span class="fc0">size))</span></span></div><div class="t m0 x16 hf y1ad ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__set__(instance, value)</span></span></div><div class="t m0 x0 h9 y1d52 ff1 fs3 fc0 sc0 ls3a ws153">这些类就是你要创建的数据模型或类型系统的基础构建模块。下面就是我们实际定</div><div class="t m0 x5 h9 y1d53 ff1 fs3 fc0 sc0 ls0">义的各种不同的数据类型：</div><div class="t m0 x5 hf y1d54 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Integer<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y1d55 ff8 fs5 fc0 sc0 ls0 ws147">expected_type <span class="fc6 ls33">=</span><span class="fca">int</span></div><div class="t m0 x5 hf y1d56 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UnsignedInteger<span class="ff8 fc0 ws4">(Integer, Unsigned):</span></span></div><div class="t m0 x15 h10 y1d57 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y1d58 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Float<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y1d59 ff8 fs5 fc0 sc0 ls0 ws147">expected_type <span class="fc6 ls33">=</span><span class="fca">float</span></div><div class="t m0 x5 hf y1d5a ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">UnsignedFloat<span class="ff8 fc0 ws13b">(Float, Unsigned):</span></span></div><div class="t m0 x15 h10 y1d5b ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y1d5c ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">String<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y1d5d ff8 fs5 fc0 sc0 ls0 ws147">expected_type <span class="fc6 ls33">=</span><span class="fca">str</span></div><div class="t m0 x5 hf y1d5e ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SizedString<span class="ff8 fc0 ws4">(String, MaxSized):</span></span></div><div class="t m0 x15 h10 y1d5f ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y1d60 ff1 fs3 fc0 sc0 ls0">然后使用这些自定义数据类型，我们定义一个类：</div><div class="t m0 x5 hf y1d61 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h11 y1d62 ffa fs5 fcd sc0 ls0 ws13b"># Specify constraints</div><div class="t m0 x15 hf y1d63 ff8 fs5 fc0 sc0 ls0 ws13c">name <span class="fc6 ls32">=</span><span class="ws13a">SizedString(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">name<span class="ff9 ls34">&apos;</span></span><span class="ws4">, size<span class="fc6 ls34">=<span class="fc7">8</span></span>)</span></span></div><div class="t m0 x15 hf ycee ff8 fs5 fc0 sc0 ls0 ws145">shares <span class="fc6 ls32">=</span><span class="ws13a">UnsignedInteger(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">shares<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x15 hf y1d64 ff8 fs5 fc0 sc0 ls0 ws15f">price <span class="fc6 ls33">=</span><span class="ws13a">UnsignedFloat(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">price<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x15 hf y1d65 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, shares, price):</span></span></span></div><div class="t m0 x16 hf y1d66 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y1d67 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">shares </span><span class="ls32">=</span><span class="fc0">shares</span></span></div><div class="t m0 x16 hf y1d68 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">price </span><span class="ls32">=</span><span class="fc0">price</span></span></div><div class="t m0 x0 h9 y1d69 ff1 fs3 fc0 sc0 ls63 ws21f">然后测试这个类的属性赋值约束<span class="_ _c"></span>，可发现对某些属性的赋值违法了约束是不合法<span class="_ _1"></span></div><div class="t m0 x5 h9 ycd3 ff1 fs3 fc0 sc0 ls0">的：</div><div class="t m0 x5 hf y1d6a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y1d6b ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">ACME<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1d6c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0 ws145">shares </span><span class="ls33">=</span><span class="fc7">75</span></span></span></div><div class="t m0 x5 hf y1d6d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0 ws145">shares </span><span class="ws1a1">= -<span class="fc7">10</span></span></span></span></div><div class="t m0 x5 hf y1d6e ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1d6f ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y1d70 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;example.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">17</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>__set__</span></div><div class="t m0 x16 hf y1d71 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__set__(instance, value)</span></span></div><div class="t m0 x15 hf y1d72 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;example.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">23</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>__set__</span></div><div class="t m0 x16 hf y1d73 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">ValueError<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13b">Expected &gt;= 0<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x5 hf y1d74 ff8 fs5 fc2 sc0 ls0 ws13a">ValueError<span class="fc0 ws4">: Expected &gt;= 0</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.13.<span class="_ _5"> </span>8.13 <span class="ff1 wsb03">实现数据模型的类型约束 </span>263</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
