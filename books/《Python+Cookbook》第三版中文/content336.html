<div id="pf150" class="pf w0 h0" data-page-no="150"><div class="pc pc150 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg150.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 ws9d6">如果你想自定义这个步骤，你可以定义一个元类并自己实现 <span class="ff6 ws308">call<span class="_ _e"> </span>() </span>方法。</div><div class="t m0 x0 h9 y76 ff1 fs3 fc0 sc0 ls0">为了演示，假设你不想任何人创建这个类的实例：</div><div class="t m0 x5 hf y2335 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">NoInstances<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y2336 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__call__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y2337 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="fc9">&quot;Can<span class="ff9 ls34">&apos;</span><span class="ws4">t instantiate directly&quot;</span></span>)</span></span></div><div class="t m0 x5 h11 y2338 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y2339 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0 ws13a">(metaclass<span class="fc6">=</span>NoInstances):</span></span></div><div class="t m0 x15 h10 y1ab1 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y233a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">grok<span class="fc0">(x):</span></span></div><div class="t m0 x16 hf y12c1 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Spam.grok</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x0 h9 y233b ff1 fs3 fc0 sc0 ls3a ws153">这样的话，用户只能调用这个类的静态方法，而不能使用通常的方法来创建它的实</div><div class="t m0 x5 h9 y233c ff1 fs3 fc0 sc0 ls0">例。例如：</div><div class="t m0 x5 hf y233d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">Spam<span class="fc6 ls34">.</span>grok(<span class="fc7">42</span>)</span></div><div class="t m0 x5 hf yfdd ff8 fs5 fc8 sc0 ls0">Spam.grok</div><div class="t m0 x5 hf y233e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0">Spam()</span></span></div><div class="t m0 x5 hf y233f ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y2340 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y2341 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;example1.py&quot;</span><span class="ws13b">, line <span class="fc7 ls34">7</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>__call__</span></div><div class="t m0 x16 hf y2342 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="fc9">&quot;Can<span class="ff9 ls34">&apos;</span><span class="ws4">t instantiate directly&quot;</span></span>)</span></span></div><div class="t m0 x5 hf y2343 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws13b">: Can<span class="ff9 ls34">&apos;</span>t instantiate directly</span></div><div class="t m0 x5 hf y2344 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2345 ff1 fs3 fc0 sc0 ls0 wsa0">现在，假如你想实现单例模式（只能创建唯一实例的类）<span class="_ _f"></span>，实现起来也很简单：</div><div class="t m0 x5 hf y2346 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Singleton<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">type<span class="fc0">):</span></span></div><div class="t m0 x15 hf y2347 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y2348 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws2a3">__instance </span><span class="ls33">=</span></span>None</div><div class="t m0 x16 hf y2349 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__init__(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x15 hf y234a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__call__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y234b ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws2a3">__instance </span></span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y234c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws2a3">__instance </span><span class="ls33">=</span></span>super<span class="fc0">()<span class="fc6 ls34">.</span>__call__(<span class="fc6 ls34">*</span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></span></div><div class="t m0 x17 hf y234d ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">__instance</span></span></span></div><div class="t m0 x16 hf y234e ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y234f ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">__instance</span></span></span></div><div class="t m0 x5 h11 y2350 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y2351 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0 ws13a">(metaclass<span class="fc6">=</span>Singleton):</span></span></div><div class="t m0 x15 hf y129d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y129e ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Creating Spam</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x0 h16 y1717 ff1 fs3 fc0 sc0 ls0 wsc">那么 <span class="ff4 wsbb9 v0">Spam </span>类就只能创建唯一的实例了，演示如下：</div><div class="t m0 x5 hf y2352 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0">Spam()</span></span></div><div class="t m0 x5 hf y2353 ff8 fs5 fc8 sc0 ls0 ws4">Creating Spam</div><div class="t m0 x5 hf y2354 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0">Spam()</span></span></div><div class="t m0 x5 hf y2355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a</span><span class="fca ws160">is <span class="ff8 fc0">b</span></span></div><div class="t m0 x5 hf y2356 ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.13.<span class="_ _5"> </span>9.13 <span class="ff1 wsb03">使用元类控制实例的创建 </span>327</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
