<div id="pfa7" class="pf w0 h0" data-page-no="a7"><div class="pc pca7 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bga7.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">io<span class="fc6 ls34">.</span><span class="ws4">TextIOWrapper(u, encoding<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ls34">f<span class="fc6">.</span></span>read()</div><div class="t m0 x0 h9 y4ac ff1 fs3 fc0 sc0 ls2d ws6e8">如果你想修改一个已经打开的文本模式的文件的编码方式<span class="_ _1"></span>，可以先使用 <span class="ff6 ls0">detach()</span></div><div class="t m0 x5 h9 y122b ff1 fs3 fc0 sc0 ls11d ws6e9">方法移除掉已存在的文本编码层<span class="_ _1d"></span>，并使用新的编码方式代替<span class="_ _1f"></span>。<span class="_ _6"></span>下面是一个在<span class="_ _1d"></span></div><div class="t m0 x5 h9 y122c ff6 fs3 fc0 sc0 ls0 ws17c">sys.stdout <span class="ff1">上修改编码方式的例子：</span></div><div class="t m0 x5 h10 y122d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sys</span></span></div><div class="t m0 x5 hf y122e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>stdout<span class="fc6 ls34">.</span>encoding</span></div><div class="t m0 x5 hf y122f ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">UTF-8<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1230 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span><span class="ws145">stdout <span class="fc6 ls32">=</span></span>io<span class="fc6 ls34">.</span>TextIOWrapper(sys<span class="fc6 ls34">.</span>stdout<span class="fc6 ls34">.</span><span class="ws13b">detach(), encoding<span class="fc6 ls34">=</span><span class="ff9 fc9">&apos;</span></span><span class="fc9">latin-1<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1231 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>stdout<span class="fc6 ls34">.</span>encoding</span></div><div class="t m0 x5 hf y1232 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">latin-1<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1233 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1234 ff1 fs3 fc0 sc0 ls0">这样做可能会中断你的终端，这里仅仅是为了演示而已。</div><div class="t m0 x5 he y1235 ff2 fs2 fc4 sc0 ls0 ws212">7.16.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y1236 ff4 fs3 fc0 sc0 ls0 ws6ea">I/O <span class="ff1 ls82 ws2f9">系统由一系列的层次构建而成。你可以试着运行下面这个操作一个文本文件的</span></div><div class="t m0 x5 h9 y1237 ff1 fs3 fc0 sc0 ls0">例子来查看这种层次：</div><div class="t m0 x5 hf y1238 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sample.txt<span class="ff9 ls34">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">w<span class="ff9 ls34">&apos;</span></span>)</span></span></span></span></div><div class="t m0 x5 hf y1239 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">f</span></div><div class="t m0 x5 hf y123a ff8 fs5 fc8 sc0 ls0 ws4">&lt;_io.TextIOWrapper name=<span class="ff9 ls34">&apos;</span><span class="ws13a">sample.txt<span class="ff9 ls33">&apos;</span>mode=<span class="ff9 ws13b">&apos;</span><span class="ls34">w<span class="ff9 ls32">&apos;</span></span>encoding=<span class="ff9 ls34">&apos;</span>UTF-8<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y123b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">buffer</span></span></span></div><div class="t m0 x5 hf y123c ff8 fs5 fc8 sc0 ls0 ws4">&lt;_io.BufferedWriter name=<span class="ff9 ls34">&apos;</span><span class="ws13a">sample.txt<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y123d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">buffer</span>.<span class="fc0">raw</span></span></span></div><div class="t m0 x5 hf y123e ff8 fs5 fc8 sc0 ls0 ws4">&lt;_io.FileIO name=<span class="ff9 ls34">&apos;</span><span class="ws13a">sample.txt<span class="ff9 ls33">&apos;</span>mode=<span class="ff9 ls34">&apos;</span>wb<span class="ff9 ws13b">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y123f ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1240 ff1 fs3 fc0 sc0 ls0 wsa0">在<span class="_ _0"></span>这<span class="_ _12"></span>个<span class="_ _12"></span>例<span class="_ _0"></span>子<span class="_ _12"></span>中，<span class="_ _12"></span><span class="ff6 ws6eb">io.TextIOWrapper </span><span class="ls7b ws6ec">是一个编码和解码 </span><span class="ff4 ws6ed">Unicode </span>的<span class="_ _12"></span>文<span class="_ _12"></span>本<span class="_ _0"></span>处<span class="_ _12"></span>理<span class="_ _12"></span>层，</div><div class="t m0 x5 h7 y1241 ff6 fs3 fc0 sc0 ls0 ws6ee">io.BufferedWriter <span class="ff1 ls82 ws6ef">是一个处理二进制数据的带缓冲的 </span><span class="ff4 ws6f0">I/O <span class="ff1 ws6f1">层， </span></span><span class="ws6f2">io.FileIO <span class="ff1 wsa0">是一个<span class="_ _6"></span>表</span></span></div><div class="t m0 x5 h9 y1242 ff1 fs3 fc0 sc0 ls2d ws132">示操作系统底层文件描述符的原始文件。增加或改变文本编码会涉及增加或改变最上<span class="_ _1"></span></div><div class="t m0 x5 h9 y1243 ff1 fs3 fc0 sc0 ls0 ws14">面的 <span class="ff6 ws2fb">io.TextIOWrapper </span>层。</div><div class="t m0 x0 h9 y1244 ff1 fs3 fc0 sc0 ls3a ws153">一般来讲，像上面例子这样通过访问属性值来直接操作不同的层是很不安全的。例</div><div class="t m0 x5 h9 yc22 ff1 fs3 fc0 sc0 ls0">如，如果你试着使用下面这样的技术改变编码看看会发生什么：</div><div class="t m0 x5 hf y1245 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">f</span></div><div class="t m0 x5 hf y1246 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_io.TextIOWrapper name=<span class="ff9 ls34">&apos;</span><span class="ws13a">sample.txt<span class="ff9 ls33">&apos;</span>mode=<span class="ff9 ws13b">&apos;</span><span class="ls34">w<span class="ff9 ls32">&apos;</span></span>encoding=<span class="ff9 ls34">&apos;</span>UTF-8<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y1247 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">io<span class="fc6 ls34">.</span>TextIOWrapper(f<span class="fc6 ls34">.</span><span class="ws13b">buffer, encoding<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">latin-1<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y1248 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">f</span></div><div class="t m0 x5 hf y1249 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_io.TextIOWrapper name=<span class="ff9 ls34">&apos;</span><span class="ws13a">sample.txt<span class="ff9 ls33">&apos;</span>encoding=<span class="ff9 ls34">&apos;</span>latin-1<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y124a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Hello<span class="ff9 ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y124b ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y124c ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y124d ff8 fs5 fc2 sc0 ls0 ws13a">ValueError<span class="fc0 ws4">: I/O operation on closed file.</span></div><div class="t m0 x5 hf y124e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y124f ff1 fs3 fc0 sc0 ls0 wsc">结果出错了，因为 <span class="ff4 ls11e">f</span>的原始值已经被破坏了并关闭了底层的文件。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.16.<span class="_ _5"> </span>5.16 <span class="ff1 ws6e7">增加或改变已打开文件的编码 </span>158</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
