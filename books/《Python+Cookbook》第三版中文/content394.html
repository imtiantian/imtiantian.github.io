<div id="pf18a" class="pf w0 h0" data-page-no="18a"><div class="pc pc18a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg18a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y432 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Add an entry to sys.path and watch it work</span></div><div class="t m0 x5 h10 y433 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sys</span></span></div><div class="t m0 x5 hf y434 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6">.</span>append(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://localhost:15000<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h10 yde6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fib</span></span></div><div class="t m0 x5 hf y1d08 ff8 fs5 fc8 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m fib</span></div><div class="t m0 x5 h10 y1d09 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">grok.blah</span></span></div><div class="t m0 x5 hf y2843 ff8 fs5 fc8 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m grok.__init__</span></div><div class="t m0 x5 hf y1d0a ff8 fs5 fc8 sc0 ls34">I<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">m grok.blah</span></div><div class="t m0 x5 hf y1d0b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">grok<span class="fc6 ls34">.</span>blah<span class="fc6 ls34">.</span>__file__</span></div><div class="t m0 x5 hf y1d0c ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">http://localhost:15000/grok/blah.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y2844 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2845 ff1 fs3 fc0 sc0 ls1c2 wsdb3">关键点就是 <span class="ff6 ls0 ws3cd">handle url()<span class="_ _23"> </span><span class="ff1 wsdb4">函<span class="_ _24"></span>数，<span class="_ _24"></span>它<span class="_ _24"> </span>被<span class="_ _25"> </span>添<span class="_ _24"></span>加<span class="_ _24"> </span>到<span class="_ _25"> </span>了 </span><span class="ws3a9">sys.path hooks<span class="_ _11"> </span><span class="ff1 wsa0">变<span class="_ _25"> </span>量<span class="_ _24"></span>中。<span class="_ _25"> </span>当</span></span></span></div><div class="t m0 x5 h9 y2846 ff6 fs3 fc0 sc0 ls0 wsdb5">sys.path <span class="ff1 wsdb6">的<span class="_ _0"></span>实<span class="_ _0"></span>体<span class="_ _0"></span>被<span class="_ _0"></span>处<span class="_ _0"></span>理<span class="_ _0"></span>时，<span class="_ _0"></span>会<span class="_ _0"></span>调<span class="_ _0"></span>用 </span><span class="ws3a9">sys.path hooks<span class="_ _b"> </span><span class="ff1 wsa0">中<span class="_ _0"></span>的<span class="_ _0"></span>函<span class="_ _0"></span>数。<span class="_ _0"></span>如<span class="_ _0"></span>果<span class="_ _0"></span>任<span class="_ _0"></span>何<span class="_ _0"></span>一<span class="_ _0"></span>个<span class="_ _0"></span>函<span class="_ _0"></span>数</span></span></div><div class="t m0 x5 h9 y2847 ff1 fs3 fc0 sc0 ls0 ws14">返回了一个查找器对象，那么这个对象就被用来为 <span class="ff6 ws1f3">sys.path </span>实体加载模块。</div><div class="t m0 x0 h9 y2848 ff1 fs3 fc0 sc0 ls0">远程模块加载跟其他的加载使用方法几乎是一样的。例如：</div><div class="t m0 x5 hf y2849 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">fib</span></div><div class="t m0 x5 hf y284a ff8 fs5 fc8 sc0 ls0 ws2a3">&lt;urlmodule <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9 ls32">&apos;</span><span class="ws13c">from <span class="ff9 ls34">&apos;</span></span>http://localhost:15000/fib.py<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf yfb3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">fib<span class="fc6 ls34">.</span>__name__</span></div><div class="t m0 x5 hf y284b ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">fib<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1636 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">fib<span class="fc6 ls34">.</span>__file__</span></div><div class="t m0 x5 hf y1637 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">http://localhost:15000/fib.py<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h10 y1638 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">inspect</span></span></div><div class="t m0 x5 hf y1639 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(inspect<span class="fc6 ls34">.</span>getsource(fib))</span></span></div><div class="t m0 x5 hf y2098 ff8 fs5 fc8 sc0 ls0 ws4"># fib.py</div><div class="t m0 x5 hf y284c ff8 fs5 fc8 sc0 ls0 ws13a">print(&quot;I<span class="ff9 ls34">&apos;</span><span class="ws13b">m fib&quot;)</span></div><div class="t m0 x5 hf y209a ff8 fs5 fc8 sc0 ls0 ws4">def fib(n):</div><div class="t m0 x15 hf y209b ff8 fs5 fc8 sc0 ls0 ws4">if n &lt; 2:</div><div class="t m0 x16 hf y284d ff8 fs5 fc8 sc0 ls0 ws13b">return 1</div><div class="t m0 x15 hf y209d ff8 fs5 fc8 sc0 ls0">else:</div><div class="t m0 x16 hf y209e ff8 fs5 fc8 sc0 ls0 ws4">return fib(n-1) + fib(n-2)</div><div class="t m0 x5 hf y209f ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y284e ff2 fs2 fc4 sc0 ls0 wsadf">12.11.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y284f ff1 fs3 fc0 sc0 ls0 wsa0">在详<span class="_ _6"></span>细<span class="_ _6"></span>讨<span class="_ _6"></span>论<span class="_ _6"></span>之前，<span class="_ _6"></span>有<span class="_ _6"></span>点<span class="_ _6"></span>要强<span class="_ _6"></span>调<span class="_ _6"></span>的<span class="_ _6"></span>是，<span class="ff4 ws131">Python </span>的<span class="_ _6"></span>模<span class="_ _6"></span>块、<span class="_ _6"></span>包<span class="_ _6"></span>和导<span class="_ _6"></span>入<span class="_ _6"></span>机<span class="_ _6"></span>制是<span class="_ _6"></span>整<span class="_ _6"></span>个<span class="_ _6"></span>语言<span class="_ _6"></span>中</div><div class="t m0 x5 h7 y2850 ff1 fs3 fc0 sc0 ls0 ws12a">最复杂的部分，即使经验丰富的 <span class="ff4 ws12b">Python </span><span class="wsa0">程序员也很少能精通它们。<span class="_ _1"></span>我在这里推荐一些</span></div><div class="t m0 x5 h7 y2851 ff1 fs3 fc0 sc0 ls0 wsdb7">值的去读的文档和书籍，<span class="_ _1"></span>包括 <span class="ff4 fc3 wsdb8">imp<span class="_ _6"></span>ortlib mo<span class="_ _6"></span>dule </span><span class="ls18b">和</span><span class="ff4 fc3 wsdb9">PEP 302<span class="fc0 ls1c3">.</span></span>文档内容在这里不会被重</div><div class="t m0 x5 h9 y1c10 ff1 fs3 fc0 sc0 ls0">复提到，不过我在这里会讨论一些最重要的部分。</div><div class="t m0 x0 h9 y2852 ff1 fs3 fc0 sc0 ls0 ws14">首先，如果你想创建一个新的模块对象，使用 <span class="ff6 ws1f3">imp.new<span class="_ _7"> </span>module() </span>函数：</div><div class="t m0 x5 h10 yabc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">imp</span></span></div><div class="t m0 x5 hf yabd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">m<span class="fc6 ls33">=</span><span class="ls0 ws13a">imp<span class="fc6 ls34">.</span>new_module(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">spam<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2853 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">m</span></div><div class="t m0 x5 hf y2854 ff8 fs5 fc8 sc0 ls0 ws155">&lt;module <span class="ff9 ls34">&apos;</span><span class="ws13a">spam<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y2855 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">__name__</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>385</div><a class="l" href="https://docs.python.org/3/library/importlib.html"><div class="d m1" style="border-style:none;position:absolute;left:345.957000px;bottom:293.439000px;width:88.749000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="http://www.python.org/dev/peps/pep-0302"><div class="d m1" style="border-style:none;position:absolute;left:507.649500px;bottom:293.439000px;width:45.005000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
