<div id="pf226" class="pf w0 h0" data-page-no="226"><div class="pc pc226 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg226.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls232 ws1315">在我们机器上面测试的时候<span class="_ _1d"></span>，这个程序花费了大概 <span class="ff4 ls0 ws1316">40 <span class="ff1 ws1317">秒。 现 在 我 们 修 改</span></span></div><div class="t m0 x5 h9 y2b ff6 fs3 fc0 sc0 ls0 ws23a">compute<span class="_ _7"> </span>roots() <span class="ff1">函数如下：</span></div><div class="t m0 x5 hf yd14 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws218">math </span><span class="ws146">import <span class="ff8 fc0">sqrt</span></span></div><div class="t m0 x5 hf yd16 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">compute_roots<span class="fc0">(nums):</span></span></div><div class="t m0 x15 hf yd18 ff8 fs5 fc0 sc0 ls0 ws145">result <span class="fc6 ls32">=</span>[]</div><div class="t m0 x15 hf yd19 ff8 fs5 fc0 sc0 ls0 ws147">result_append <span class="fc6 ls33">=</span><span class="ws13a">result<span class="fc6 ls34">.</span>append</span></div><div class="t m0 x15 hf y297f ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">n</span><span class="ws157">in <span class="ff8 fc0">nums:</span></span></div><div class="t m0 x16 hf yd1a ff8 fs5 fc0 sc0 ls0">result_append(sqrt(n))</div><div class="t m0 x15 hf yd1b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">result</span></div><div class="t m0 x0 h7 y3560 ff1 fs3 fc0 sc0 ls233 ws1318">修改后的版本运行时间大概是 <span class="ff4 ls0 ws1319">29 </span><span class="ws131a">秒<span class="_ _8"></span>。唯一不同之处就是消除了属性访问<span class="_ _d"></span>。用<span class="_ _d"></span></span></div><div class="t m0 x5 h9 y3561 ff6 fs3 fc0 sc0 ls0 ws131b">sqrt() <span class="ff1 ws131c">代<span class="_ _12"></span>替<span class="_ _24"></span>了 </span><span class="ws131d">math.sqrt() <span class="ff1 ls234">。</span><span class="ws131e">The<span class="_ _32"> </span>result.append() <span class="ff1 ls235 ws131f">方法被赋给一个局部变量<span class="_ _19"></span></span></span></span></div><div class="t m0 x5 h9 y2939 ff6 fs3 fc0 sc0 ls0 ws3ce">result<span class="_ _7"> </span>append <span class="ff1">，然后在内部循环中使用它。</span></div><div class="t m0 x0 h9 y3562 ff1 fs3 fc0 sc0 ls0 wsa0">不过，这些改变只有在<span class="_ _6"></span>大量重复代码中才有意<span class="_ _6"></span>义，比如循环。因此，这些优<span class="_ _6"></span>化也只</div><div class="t m0 x5 h9 y3563 ff1 fs3 fc0 sc0 ls0">是在某些特定地方才应该被使用。</div><div class="t m0 x0 h9 y11e2 ff1 fs3 fc0 sc0 ls0">理解局部变量</div><div class="t m0 x0 h9 y3564 ff1 fs3 fc0 sc0 ls0 wsa0">之前提过，局部变量会<span class="_ _6"></span>比全局变量运行速度快。对<span class="_ _6"></span>于频繁访问的名称，通过<span class="_ _6"></span>将这些</div><div class="t m0 x5 h9 y1973 ff1 fs3 fc0 sc0 ls0 ws1320">名称<span class="_ _6"></span>变<span class="_ _6"></span>成局<span class="_ _6"></span>部<span class="_ _6"></span>变<span class="_ _6"></span>量可<span class="_ _6"></span>以<span class="_ _6"></span>加速<span class="_ _6"></span>程<span class="_ _6"></span>序运<span class="_ _6"></span>行。<span class="_ _6"></span>例如，<span class="_ _6"></span>看<span class="_ _6"></span>下之<span class="_ _6"></span>前<span class="_ _6"></span>对<span class="_ _6"></span>于 <span class="ff6 ws9b2">compute roots() </span><span class="ls22 ws119">函数进<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y3565 ff1 fs3 fc0 sc0 ls0">行修改后的版本：</div><div class="t m0 x5 h10 y3566 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">math</span></div><div class="t m0 x5 hf y3567 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">compute_roots<span class="fc0">(nums):</span></span></div><div class="t m0 x15 hf y3568 ff8 fs5 fc0 sc0 ls0 ws13c">sqrt <span class="fc6 ls32">=</span><span class="ws13a">math<span class="fc6 ls34">.</span>sqrt</span></div><div class="t m0 x15 hf y3569 ff8 fs5 fc0 sc0 ls0 ws145">result <span class="fc6 ls32">=</span>[]</div><div class="t m0 x15 hf y356a ff8 fs5 fc0 sc0 ls0 ws147">result_append <span class="fc6 ls33">=</span><span class="ws13a">result<span class="fc6 ls34">.</span>append</span></div><div class="t m0 x15 hf y356b ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">n</span><span class="ws157">in <span class="ff8 fc0">nums:</span></span></div><div class="t m0 x16 hf y1391 ff8 fs5 fc0 sc0 ls0">result_append(sqrt(n))</div><div class="t m0 x15 hf y1392 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">result</span></div><div class="t m0 x0 h9 y1519 ff1 fs3 fc0 sc0 lsa8 ws3de">在这个版本中，<span class="ff6 ls0 ws4dd">sqrt </span><span class="ls134">从<span class="ff6 ls0 wse15">match </span></span>模块被拿出并放入了一个局部变量中<span class="_ _1"></span>。如果你运行</div><div class="t m0 x5 h7 y356c ff1 fs3 fc0 sc0 ls2d ws1321">这个代码<span class="_ _1"></span>，大概花费 <span class="ff4 ls0 ws1322">25 </span><span class="ws1323">秒（对于之前 <span class="ff4 ls0 ws1322">29 </span><span class="ws132">秒又是一个改进<span class="_ _c"></span>）<span class="_ _f"></span>。这个额外的加速原因是<span class="_ _1"></span></span></span></div><div class="t m0 x5 h9 y151a ff1 fs3 fc0 sc0 ls0 ws14">因为对于局部变量 <span class="ff6 ws17a">sqrt </span>的查找要快于全局变量 <span class="ff6">sqrt</span></div><div class="t m0 x0 h9 y356d ff1 fs3 fc0 sc0 ls0 ws389">对 于 类 中 的 属 性 访 问 也 同 样 适 用 于 这 个 原 理。 通 常 来 讲， 查 找 某 个 值 比 如</div><div class="t m0 x5 h9 y356e ff6 fs3 fc0 sc0 ls0 ws1324">self.name <span class="ff1 ls236 ws1325">会比访问一个局部变量要慢一些<span class="_ _d"></span>。在内部循环中<span class="_ _c"></span>，可以将某个需要频繁<span class="_ _d"></span></span></div><div class="t m0 x5 h9 y1d36 ff1 fs3 fc0 sc0 ls0">访问的属性放入到一个局部变量中。例如：</div><div class="t m0 x5 h11 y356f ffa fs5 fcd sc0 ls0 ws4"># Slower</div><div class="t m0 x5 hf y3570 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SomeClass<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y3571 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x15 hf y3572 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">method<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x2b hf y3573 ff7 fs5 fca sc0 ls0 ws38d">for <span class="ff8 fc0 ls33">x</span><span class="ws157">in <span class="ff8 fc0">s:</span></span></div><div class="t m0 x3d hf y3574 ff8 fs5 fc0 sc0 ls0 ws13a">op(<span class="fca">self<span class="fc6">.</span></span>value)</div><div class="t m0 x5 h11 y3575 ffa fs5 fcd sc0 ls0 ws4"># Faster</div><div class="t m0 x5 hf y3576 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SomeClass<span class="ff8 fc0">:</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.14.<span class="_ _36"> </span>14.14 <span class="ff1 wse4d">加速程序运行 </span>541</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
