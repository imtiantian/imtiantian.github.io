<div id="pf207" class="pf w0 h0" data-page-no="207"><div class="pc pc207 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg207.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 wsd91">15.12<span class="_ _e"> </span>13.12 <span class="ff1">给函数库增加日志功能</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">15.12.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y658 ff1 fs3 fc0 sc0 ls0">你想给某个函数库增加日志功能，但是又不能影响到那些不使用日志功能的程序。</div><div class="t m0 x5 he y6ee ff2 fs2 fc4 sc0 ls0 wsadf">15.12.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y32aa ff1 fs3 fc0 sc0 lse ws1251">对于想要执行日志操作的函数库而已，你应该创建一个专属的 <span class="ff6 ls0 ws6aa">logger <span class="ff1 wsa0">对象，并且</span></span></div><div class="t m0 x5 h9 y117 ff1 fs3 fc0 sc0 ls0">像下面这样初始化配置：</div><div class="t m0 x5 h11 y32ab ffa fs5 fcd sc0 ls0 ws4"># somelib.py</div><div class="t m0 x5 h10 y32ac ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">logging</span></div><div class="t m0 x5 hf y32ad ff8 fs5 fc0 sc0 ls0 ws158">log <span class="fc6 ls32">=</span><span class="ws13a">logging<span class="fc6 ls34">.</span>getLogger(__name__)</span></div><div class="t m0 x5 hf y32ae ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>addHandler(logging<span class="fc6 ls34">.</span>NullHandler())</div><div class="t m0 x5 h11 y32af ffa fs5 fcd sc0 ls0 ws4"># Example function (for testing)</div><div class="t m0 x5 hf y32b0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">func<span class="fc0">():</span></span></div><div class="t m0 x15 hf y32b1 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>critical(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">A Critical Error!<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x15 hf y32b2 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">A debug message<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x0 h9 y32b3 ff1 fs3 fc0 sc0 ls0">使用这个配置，默认情况下不会打印日志。例如：</div><div class="t m0 x5 h10 y32b4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">somelib</span></span></div><div class="t m0 x5 hf y32b5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">somelib<span class="fc6 ls34">.</span>func()</span></div><div class="t m0 x5 hf y32b6 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y32b7 ff1 fs3 fc0 sc0 ls0">不过，如果配置过日志系统，那么日志消息打印就开始生效，例如：</div><div class="t m0 x5 h10 y32b8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">logging</span></span></div><div class="t m0 x5 hf y32b9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">logging<span class="fc6 ls34">.</span>basicConfig()</span></div><div class="t m0 x5 hf y32ba ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">somelib<span class="fc6 ls34">.</span>func()</span></div><div class="t m0 x5 hf y1ac1 ff8 fs5 fc8 sc0 ls0 ws4">CRITICAL:somelib:A Critical Error!</div><div class="t m0 x5 hf y32bb ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y32bc ff2 fs2 fc4 sc0 ls0 wsadf">15.12.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y32bd ff1 fs3 fc0 sc0 ls3a ws153">通常来讲，你不应该在函数库代码中自己配置日志系统，或者是已经假定有个已经</div><div class="t m0 x5 h9 y32be ff1 fs3 fc0 sc0 ls0">存在的日志配置了。</div><div class="t m0 x0 h7 y32bf ff1 fs3 fc0 sc0 ls0 ws1252">调用 <span class="ff6 ws1253">getLogger(<span class="_ _e"> </span>name<span class="_ _e"> </span>) </span><span class="ls3a ws1254">创建一个和调用模块同名的 </span><span class="ff4 ws1255">logger </span><span class="ls3a ws153">模块。由于模块都是</span></div><div class="t m0 x5 h7 y32c0 ff1 fs3 fc0 sc0 ls0 ws38">唯一的，因此创建的 <span class="ff4 ws1256">logger </span>也将是唯一的。</div><div class="t m0 x0 h9 y32c1 ff6 fs3 fc0 sc0 ls0 ws1257">log.addHandler(logging.NullHandler()) <span class="ff1 ls21 ws116">操作将一个空处理器绑定到刚刚已经<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y32c2 ff1 fs3 fc0 sc0 ls0 ws6c0">创建<span class="_ _6"></span>好<span class="_ _6"></span>的 <span class="ff4 ws1258">logger </span><span class="wsa0">对象<span class="_ _6"></span>上。一<span class="_ _6"></span>个<span class="_ _6"></span>空处<span class="_ _6"></span>理器<span class="_ _6"></span>默<span class="_ _6"></span>认会<span class="_ _6"></span>忽<span class="_ _6"></span>略调<span class="_ _6"></span>用所<span class="_ _6"></span>有<span class="_ _6"></span>的日<span class="_ _6"></span>志消<span class="_ _6"></span>息。<span class="_ _6"></span>因此，<span class="_ _6"></span>如<span class="_ _6"></span>果</span></div><div class="t m0 x5 h9 y32c3 ff1 fs3 fc0 sc0 ls0">使用该函数库的时候还没有配置日志，那么将不会有消息或警告出现。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">15.12.<span class="_ _36"> </span>13.12 <span class="ff1 wsd98">给函数库增加日志功能 </span>510</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
