<div id="pfc1" class="pf w0 h0" data-page-no="c1"><div class="pc pcc1 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgc1.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 h15 y765 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y766 ff8 fs5 fc0 sc0 ls0 ws15f">parts <span class="fc6 ls33">=</span><span class="ws13a">[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">&lt;{}&gt;<span class="ff9 ls34">&apos;<span class="ff8 fc6">.</span></span></span>format(tag)]</span></div><div class="t m0 x15 hf y767 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">key, val </span><span class="ws160">in <span class="ff8 fc0 ws13a">d<span class="fc6 ls34">.</span>items():</span></span></div><div class="t m0 x16 hf y768 ff8 fs5 fc0 sc0 ls0 ws13a">parts<span class="fc6 ls34">.</span>append(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">&lt;{0}&gt;{1}&lt;/{0}&gt;<span class="ff9 ls34">&apos;<span class="ff8 fc6">.</span></span></span>format(key,val))</div><div class="t m0 x15 hf y769 ff8 fs5 fc0 sc0 ls0 ws13a">parts<span class="fc6">.</span>append(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">&lt;/{}&gt;<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span></span>format(tag))</div><div class="t m0 x15 hf y76a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff9 fc9 ws13b">&apos;&apos;<span class="ff8 fc6 ls34">.<span class="fc0 ls0">join(parts)</span></span></span></div><div class="t m0 x0 h9 y1504 ff1 fs3 fc0 sc0 ls3a ws153">问题是如果你手动的去构造的时候可能会碰到一些麻烦。例如，当字典的值中包含</div><div class="t m0 x5 h9 y1505 ff1 fs3 fc0 sc0 ls0">一些特殊字符的时候会怎样呢？</div><div class="t m0 x5 hf y1506 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">d<span class="fc6 ls33">=</span>{<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">name</span><span class="ls32">&apos;</span></span><span class="ls33">:<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">&lt;spam&gt;</span><span class="ls32">&apos;</span></span><span class="ls0">}</span></span></span></div><div class="t m0 x5 h11 y1507 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws13b"># String creation</span></div><div class="t m0 x5 hf y1508 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">dict_to_xml_str(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">item<span class="ff9 ls34">&apos;</span></span>,d)</span></div><div class="t m0 x5 hf y1509 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">&lt;item&gt;&lt;name&gt;&lt;spam&gt;&lt;/name&gt;&lt;/item&gt;<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h11 y150a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Proper XML creation</span></div><div class="t m0 x5 hf y150b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">e<span class="fc6 ls33">=</span><span class="ls0 ws13a">dict_to_xml(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">item<span class="ff9 ls34">&apos;</span></span>,d)</span></span></div><div class="t m0 x5 hf y150c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">tostring(e)</span></div><div class="t m0 x5 hf y150d ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">&lt;item&gt;&lt;name&gt;&amp;lt;spam&amp;gt;&lt;/name&gt;&lt;/item&gt;<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y150e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y150f ff1 fs3 fc0 sc0 ls0 ws14">注意到程序的后面那个例子中，字符 <span class="ff4 wsa5">‘<span class="ff12 ws305">&lt;</span><span class="ls83">’</span></span><span class="ls4">和<span class="ff4 ls138">‘</span></span><span class="ff12 ws305">&gt;<span class="ff4 ls83">’</span></span><span class="ws38">被替换成了 <span class="ff6 ws27b">&amp;lt; </span><span class="ls4">和</span><span class="ff6">&amp;gt;</span></span></div><div class="t m0 x0 h9 y1510 ff1 fs3 fc0 sc0 ls2b ws834">下面仅供参考，如果你需要手动去转换这些字符，可以使用 <span class="ff6 ls0 ws835">xml.sax.saxutils <span class="ff1">中</span></span></div><div class="t m0 x5 h9 y1511 ff1 fs3 fc0 sc0 ls4">的<span class="ff6 ls0 ws26f">escape() </span>和<span class="ff6 ls0 ws2d1">unescape() <span class="ff1">函数。例如：</span></span></div><div class="t m0 x5 hf y1512 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws40c">xml.sax.saxutils </span><span class="ws146">import <span class="ff8 fc0 ws4">escape, unescape</span></span></span></div><div class="t m0 x5 hf y1513 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">escape(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">&lt;spam&gt;<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1514 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">&amp;lt;spam&amp;gt;<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1515 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">unescape(_)</span></div><div class="t m0 x5 hf y1516 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">&lt;spam&gt;<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1517 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1518 ff1 fs3 fc0 sc0 ls14 ws836">除了能创建正确的输出外<span class="_ _1"></span>，还有另外一个原因推荐你创建 <span class="ff6 ls0 ws183">Element <span class="ff1 wsa0">实<span class="_ _6"></span>例<span class="_ _6"></span>而<span class="_ _6"></span>不<span class="_ _6"></span>是<span class="_ _6"></span>字</span></span></div><div class="t m0 x5 h9 y1519 ff1 fs3 fc0 sc0 lsa8 ws837">符串，那就是使用字符串组合构造一个更大的文档并不是那么容易<span class="_ _1"></span>。而 <span class="ff6 ls0 ws3dd">Element <span class="ff1 wsa0">实例</span></span></div><div class="t m0 x5 h7 ydb9 ff1 fs3 fc0 sc0 ls0 ws838">可<span class="_ _6"></span>以<span class="_ _6"></span>不<span class="_ _6"></span>用考<span class="_ _6"></span>虑<span class="_ _6"></span>解<span class="_ _6"></span>析 <span class="ff4 ws817">XML </span><span class="wsa0">文<span class="_ _6"></span>本<span class="_ _6"></span>的<span class="_ _6"></span>情<span class="_ _6"></span>况<span class="_ _6"></span>下<span class="_ _6"></span>通<span class="_ _6"></span>过<span class="_ _6"></span>多<span class="_ _6"></span>种<span class="_ _6"></span>方<span class="_ _6"></span>式<span class="_ _6"></span>被<span class="_ _6"></span>处<span class="_ _6"></span>理。<span class="_ _6"></span>也就<span class="_ _6"></span>是<span class="_ _6"></span>说，<span class="_ _6"></span>你<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>在<span class="_ _6"></span>一</span></div><div class="t m0 x5 h9 y151a ff1 fs3 fc0 sc0 ls0">个高级数据结构上完成你所有的操作，并在最后以字符串的形式将其输出。</div><div class="t m0 x5 hd y151b ff2 fs4 fc4 sc0 ls0 ws134">8.6<span class="_ _e"> </span>6.6 <span class="ff1 ws7d2">解析和修改 </span>XML</div><div class="t m0 x5 he y66e ff2 fs2 fc4 sc0 ls0 ws135">8.6.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y151c ff1 fs3 fc0 sc0 ls0 wsc">你想读取一个 <span class="ff4 ws61">XML </span><span class="ws14">文档，对它最一些修改，然后将结果写回 <span class="ff4 ws64">XML </span>文档。</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.6.<span class="_ _5"> </span>6.6 <span class="ff1 ws7da">解析和修改 </span><span class="ws839">XML 184</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
