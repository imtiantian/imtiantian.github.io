<div id="pf7c" class="pf w0 h0" data-page-no="7c"><div class="pc pc7c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg7c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y181 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">c</span><span class="ws157">in <span class="ff8 ws13a">self<span class="fc0">:</span></span></span></div><div class="t m0 x17 hf y182 ff7 fs5 fca sc0 ls0 ws583">yield from <span class="ff8 fc0 ws13a">c<span class="fc6 ls34">.</span>depth_first()</span></div><div class="t m0 x5 h11 y184 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y185 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y186 ff8 fs5 fc0 sc0 ls0 ws13c">root <span class="fc6 ls32">=</span><span class="ws13a">Node(<span class="fc7">0</span>)</span></div><div class="t m0 x15 hf y187 ff8 fs5 fc0 sc0 ls0 ws145">child1 <span class="fc6 ls32">=</span><span class="ws13a">Node(<span class="fc7 ls34">1</span>)</span></div><div class="t m0 x15 hf y188 ff8 fs5 fc0 sc0 ls0 ws145">child2 <span class="fc6 ls32">=</span><span class="ws13a">Node(<span class="fc7 ls34">2</span>)</span></div><div class="t m0 x15 hf y98e ff8 fs5 fc0 sc0 ls0 ws13a">root<span class="fc6 ls34">.</span>add_child(child1)</div><div class="t m0 x15 hf y98f ff8 fs5 fc0 sc0 ls0 ws13a">root<span class="fc6 ls34">.</span>add_child(child2)</div><div class="t m0 x15 hf y990 ff8 fs5 fc0 sc0 ls0 ws13a">child1<span class="fc6 ls34">.</span>add_child(Node(<span class="fc7 ls34">3</span>))</div><div class="t m0 x15 hf y991 ff8 fs5 fc0 sc0 ls0 ws13a">child1<span class="fc6 ls34">.</span>add_child(Node(<span class="fc7 ls34">4</span>))</div><div class="t m0 x15 hf y992 ff8 fs5 fc0 sc0 ls0 ws13a">child2<span class="fc6 ls34">.</span>add_child(Node(<span class="fc7 ls34">5</span>))</div><div class="t m0 x15 hf ya70 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws159">ch </span><span class="ws157">in <span class="ff8 fc0 ws13a">root<span class="fc6 ls34">.</span>depth_first():</span></span></div><div class="t m0 x16 hf y994 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(ch)</span></div><div class="t m0 x15 h11 y995 ffa fs5 fcd sc0 ls0 ws4"># Outputs Node(0), Node(1), Node(3), Node(4), Node(2), Node(5)</div><div class="t m0 x0 h9 ydc5 ff1 fs3 fc0 sc0 ls0 wsa0">在这段<span class="_ _6"></span>代码中，<span class="ff6 ws41a">depth<span class="_ _7"> </span>first() </span><span class="ls2c ws12f">方法简单直观。它首先返回自己本身并迭代每一个</span></div><div class="t m0 x5 h7 ydc6 ff1 fs3 fc0 sc0 lse ws584">子节点并通过调用子节点的 <span class="ff6 ls0 ws505">depth first() <span class="ff1 ws585">方<span class="_ _6"></span>法 <span class="ff4 wsa5">(</span><span class="ws405">使用 </span></span><span class="ws586">yield<span class="_ _23"> </span>from <span class="ff1 wsa0">语句<span class="ff4 lsea">)</span></span></span></span><span class="wsd8">返回对应元</span></div><div class="t m0 x5 h9 ydc7 ff1 fs3 fc0 sc0 ls0">素。</div><div class="t m0 x5 he ydc8 ff2 fs2 fc4 sc0 ls0 ws135">6.4.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 ydc9 ff4 fs3 fc0 sc0 ls0 ws587">Python <span class="ff1 lsa8 ws588">的迭代协议要求一个 </span><span class="ff6 ws589">iter<span class="_ _e"> </span>() <span class="ff1 lsa8 ws3de">方法返回一个特殊的迭代器对象，这个迭<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 ydca ff1 fs3 fc0 sc0 ls0 ws58a">代<span class="_ _6"></span>器<span class="_ _6"></span>对<span class="_ _6"></span>象<span class="_ _6"></span>实<span class="_ _6"></span>现<span class="_ _6"></span>了 <span class="ff6 ws58b">next<span class="_ _e"> </span>() </span><span class="ws58c">方<span class="_ _6"></span>法<span class="_ _6"></span>并<span class="_ _6"></span>通<span class="_ _6"></span>过 <span class="ff6 ws58d">StopIteration </span><span class="wsa0">异<span class="_ _6"></span>常<span class="_ _6"></span>标<span class="_ _6"></span>识<span class="_ _6"></span>迭<span class="_ _6"></span>代<span class="_ _6"></span>的<span class="_ _6"></span>完<span class="_ _6"></span>成。<span class="_ _6"></span>但<span class="_ _6"></span>是，</span></span></div><div class="t m0 x5 h9 ydcb ff1 fs3 fc0 sc0 ls13 wse5">实现这些通常会比较繁琐<span class="_ _1"></span>。下面我们演示下这种方式，如何使用一个关联迭代器类重<span class="_ _c"></span></div><div class="t m0 x5 h9 ydcc ff1 fs3 fc0 sc0 ls0 ws38">新实现 <span class="ff6 ws23a">depth<span class="_ _7"> </span>first() </span>方法：</div><div class="t m0 x5 hf ydcd ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Node2<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf ydce ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, value):</span></span></span></div><div class="t m0 x16 hf ydcf ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_value </span><span class="ls32">=</span><span class="fc0">value</span></span></div><div class="t m0 x16 hf ydd0 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws51e">_children </span><span class="ls32">=</span><span class="fc0">[]</span></span></div><div class="t m0 x15 hf ydd1 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__repr__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf ydd2 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Node({!r})</span>&apos;</span><span class="ff8 fc6 ws13a">.<span class="fc0">format(<span class="fca">self</span></span><span class="ls34">.</span><span class="fc0">_value)</span></span></div><div class="t m0 x15 hf ydd3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add_child<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf ydd4 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_children</span><span class="ls34">.</span><span class="fc0">append(node)</span></span></div><div class="t m0 x15 hf ydd5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__iter__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf ydd6 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">iter<span class="fc0 ls34">(</span>self<span class="fc6 ls34">.</span><span class="fc0">_children)</span></span></div><div class="t m0 x15 hf ydd7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">depth_first<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf ydd8 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">DepthFirstIterator(<span class="fca">self</span>)</span></div><div class="t m0 x5 hf ydd9 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">DepthFirstIterator<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">object<span class="fc0">):</span></span></div><div class="t m0 x15 h15 ydda ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">6.4.<span class="_ _5"> </span>4.4 <span class="ff1 ws582">实现迭代器协议 </span>115</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
