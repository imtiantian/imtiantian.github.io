<div id="pf26" class="pf w0 h0" data-page-no="26"><div class="pc pc26 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg26.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">address</span><span class="ls34">&apos;</span></span><span class="ls33">:<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws4">1039 W GRANVILLE</span><span class="ls34">&apos;</span></span><span class="ls32">,</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/04/2012</span>&apos;</span><span class="ls0">},</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls0">]</div><div class="t m0 x0 h7 y3d1 ff1 fs3 fc0 sc0 ls22 ws282">现在假设你想在按 <span class="ff4 ls0 ws283">date </span><span class="ws119">分组后的数据块上进行迭代<span class="_ _1"></span>。为了这样做，你首先需要按<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y3d2 ff1 fs3 fc0 sc0 ls0 ws14">照指定的字段 <span class="ff4 wsa5">(</span>这里就是 <span class="ff6 ws27b">date <span class="ff4 ls6a">)</span></span><span class="ws38">排序，然后调用 <span class="ff6 ws284">itertools.groupby() </span>函数：</span></div><div class="t m0 x5 hf y3d3 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">operator </span><span class="ws146">import <span class="ff8 fc0">itemgetter</span></span></div><div class="t m0 x5 hf y3d4 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">itertools </span><span class="ws146">import <span class="ff8 fc0">groupby</span></span></div><div class="t m0 x5 h11 y3d5 ffa fs5 fcd sc0 ls0 ws4"># Sort by the desired field first</div><div class="t m0 x5 hf y3d6 ff8 fs5 fc0 sc0 ls0 ws13a">rows<span class="fc6 ls34">.</span>sort(key<span class="fc6 ls34">=</span>itemgetter(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">date<span class="ff9 ls34">&apos;</span></span>))</div><div class="t m0 x5 h11 y3d7 ffa fs5 fcd sc0 ls0 ws4"># Iterate in groups</div><div class="t m0 x5 hf y3d8 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">date, items </span><span class="ws157">in <span class="ff8 fc0 ws13b">groupby(rows, key<span class="fc6 ls34">=</span><span class="ws13a">itemgetter(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">date<span class="ff9 ws13b">&apos;</span></span>)):</span></span></span></div><div class="t m0 x15 hf y3d9 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(date)</span></div><div class="t m0 x15 hf y3da ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">i</span><span class="ws157">in <span class="ff8 fc0">items:</span></span></div><div class="t m0 x16 hf y3db ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(</span><span class="ff9 fc9 ws286">&apos; &apos;<span class="ff8 fc0 ws4">, i)</span></span></div><div class="t m0 x0 h9 y3dc ff1 fs3 fc0 sc0 ls0">运行结果：</div><div class="t m0 x5 hf y3dd ff8 fs5 fc7 sc0 ls0 ws13a">07<span class="fc6 ls34">/</span>01<span class="fc6">/</span>2012</div><div class="t m0 x19 hf y3de ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/01/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">5412 N CLARK<span class="ff9">&apos;</span><span class="fc0">}</span></span></span></div><div class="t m0 x19 hf y3df ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/01/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">4801 N BROADWAY</span>&apos;</span><span class="ls0">}</span></div><div class="t m0 x5 hf y3e0 ff8 fs5 fc7 sc0 ls0 ws13a">07<span class="fc6 ls34">/</span>02<span class="fc6">/</span>2012</div><div class="t m0 x19 hf y3e1 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/02/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">5800 E 58TH</span>&apos;</span><span class="ls0">}</span></div><div class="t m0 x19 hf y3e2 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/02/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">5645 N RAVENSWOOD</span>&apos;</span><span class="ls0">}</span></div><div class="t m0 x19 hf y3e3 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/02/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">1060 W ADDISON</span>&apos;</span><span class="ls0">}</span></div><div class="t m0 x5 hf y3e4 ff8 fs5 fc7 sc0 ls0 ws13a">07<span class="fc6 ls34">/</span>03<span class="fc6">/</span>2012</div><div class="t m0 x19 hf y3e5 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/03/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">2122 N CLARK<span class="ff9">&apos;</span><span class="fc0">}</span></span></span></div><div class="t m0 x5 hf y3e6 ff8 fs5 fc7 sc0 ls0 ws13a">07<span class="fc6 ls34">/</span>04<span class="fc6">/</span>2012</div><div class="t m0 x19 hf y2df ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/04/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">5148 N CLARK<span class="ff9">&apos;</span><span class="fc0">}</span></span></span></div><div class="t m0 x19 hf y2e0 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">date</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">07/04/2012</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">address</span>&apos;</span><span class="ls32">:</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">1039 W GRANVILLE<span class="ff9">&apos;</span><span class="fc0">}</span></span></span></div><div class="t m0 x5 he y3e7 ff2 fs2 fc4 sc0 ls0 ws212">3.15.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y3e8 ff6 fs3 fc0 sc0 ls0 ws287">groupby() <span class="ff1 ls3d ws288">函数扫描整个序列并且查找连续相同值 <span class="ff4 ls1b">(</span><span class="ws289">或者根据指定 </span></span><span class="ff4 ws28a">k<span class="_ _1"></span>ey <span class="ff1 ls3d ws164">函数返回值</span></span></div><div class="t m0 x5 h7 y3e9 ff1 fs3 fc0 sc0 ls0 wsa0">相同<span class="ff4 ls53">)</span><span class="ls1f ws113">的元素序列。在每次迭代的时候，它会返回一个值和一个迭代器对象，这个迭代</span></div><div class="t m0 x5 h9 y3ea ff1 fs3 fc0 sc0 ls0">器对象可以生成元素值全部等于上面那个值的组中所有对象。</div><div class="t m0 x0 h9 y3eb ff1 fs3 fc0 sc0 ls14 ws28b">一个非常重要的准备步骤是要根据指定的字段将数据排序<span class="_ _1"></span>。因为 <span class="ff6 ls0 ws28c">groupby() <span class="ff1 wsa0">仅<span class="_ _6"></span>仅</span></span></div><div class="t m0 x5 h9 y3ec ff1 fs3 fc0 sc0 ls0">检查连续的元素，如果事先并没有排序完成的话，分组函数将得不到想要的结果。</div><div class="t m0 x0 h7 y3ed ff1 fs3 fc0 sc0 ls0 ws28d">如果<span class="_ _6"></span>你<span class="_ _6"></span>仅仅<span class="_ _6"></span>只<span class="_ _6"></span>是想<span class="_ _6"></span>根据 <span class="ff4 ws28e">date </span><span class="ls6b ws28f">字段将<span class="_ _6"></span>数据分组到一个大的数据结构中去，并且允许<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y3ee ff1 fs3 fc0 sc0 ls0 ws290">随机<span class="_ _6"></span>访问，<span class="_ _6"></span>那么<span class="_ _6"></span>你最<span class="_ _6"></span>好使<span class="_ _6"></span>用 <span class="ff6 ws291">defaultdict() </span><span class="wsa0">来构<span class="_ _6"></span>建一<span class="_ _6"></span>个多<span class="_ _6"></span>值字<span class="_ _6"></span>典，关<span class="_ _6"></span>于多<span class="_ _6"></span>值字<span class="_ _6"></span>典已<span class="_ _6"></span>经</span></div><div class="t m0 x5 h7 y3ef ff1 fs3 fc0 sc0 ls4">在<span class="ff4 ls0 ws171">1.6 <span class="ff1">小节有过详细的介绍。比如：</span></span></div><div class="t m0 x5 hf y3f0 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">defaultdict</span></span></div><div class="t m0 x5 hf y3f1 ff8 fs5 fc0 sc0 ls0 ws150">rows_by_date <span class="fc6 ls33">=</span><span class="ws13a">defaultdict(<span class="fca">list</span>)</span></div><div class="t m0 x5 hf y3f2 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws158">row </span><span class="ws157">in <span class="ff8 fc0">rows:</span></span></div><div class="t m0 x15 hf y3f3 ff8 fs5 fc0 sc0 ls0 ws13a">rows_by_date[row[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">date<span class="ff9 ls34">&apos;</span></span>]]<span class="fc6 ls34">.</span>append(row)</div><div class="t m0 x0 h9 y3f4 ff1 fs3 fc0 sc0 ls0">这样的话你可以很轻松的就能对每个指定日期访问对应的记录：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">3.15.<span class="_ _5"> </span>1.15 <span class="ff1 ws281">通过某个字段将记录分组 </span>29</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
