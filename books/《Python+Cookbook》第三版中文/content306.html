<div id="pf132" class="pf w0 h0" data-page-no="132"><div class="pc pc132 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg132.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 h10 y2039 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x15 h11 y203a ffa fs5 fcd sc0 ls0 ws4"># Methods created by @total_ordering</div><div class="t m0 x15 hf y203b ff8 fs5 fc0 sc0 ls0 ws145">__le__ <span class="fc6 ls32">=</span><span class="ff7 fca ws1ff">lambda <span class="ff8 ws13a">self</span></span><span class="ws4">, other: <span class="fca ws13c">self <span class="fc6 ls32">&lt;</span></span><span class="ws15f">other <span class="ff7 fca ws160">or <span class="ff8 ws161">self <span class="fc6 ws159">== </span></span></span>other</span></span></div><div class="t m0 x15 hf y203c ff8 fs5 fc0 sc0 ls0 ws145">__gt__ <span class="fc6 ls32">=</span><span class="ff7 fca ws1ff">lambda <span class="ff8 ws13a">self</span></span><span class="ws4">, other: <span class="ff7 fca ws139">not </span><span class="ls34">(</span><span class="fca ws161">self <span class="fc6 ls33">&lt;</span></span><span class="ws15f">other <span class="ff7 fca ws157">or <span class="ff8 ws13c">self <span class="fc6 ws159">== </span></span></span>other)</span></span></div><div class="t m0 x15 hf y203d ff8 fs5 fc0 sc0 ls0 ws145">__ge__ <span class="fc6 ls32">=</span><span class="ff7 fca ws1ff">lambda <span class="ff8 ws13a">self</span></span><span class="ws4">, other: <span class="ff7 fca ws139">not </span><span class="ls34">(</span><span class="fca ws161">self <span class="fc6 ls33">&lt;</span></span>other)</span></div><div class="t m0 x15 hf y203e ff8 fs5 fc0 sc0 ls0 ws145">__ne__ <span class="fc6 ls32">=</span><span class="ff7 fca ws1ff">lambda <span class="ff8 ws13a">self</span></span><span class="ws4">, other: <span class="ff7 fca ws139">not <span class="ff8 ws13c">self <span class="fc6 ws159">== </span></span></span>other</span></div><div class="t m0 x0 h9 y1ae9 ff1 fs3 fc0 sc0 ls0 wsb81">当然，<span class="_ _1"></span>你自己去写也很容易，<span class="_ _1"></span>但是使用 <span class="ff6 wsb82">@total<span class="_ _7"> </span>ordering </span><span class="wsa0">可以简化代码，<span class="_ _1"></span>何乐而不</span></div><div class="t m0 x5 h9 y1aea ff1 fs3 fc0 sc0 ls0">为呢。</div><div class="t m0 x5 hd y203f ff2 fs4 fc4 sc0 ls0 ws211">10.25<span class="_ _e"> </span>8.25 <span class="ff1">创建缓存实例</span></div><div class="t m0 x5 he y2040 ff2 fs2 fc4 sc0 ls0 wsadf">10.25.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2041 ff1 fs3 fc0 sc0 ls3a ws153">在创建一个类的对象时，如果之前使用同样参数创建过这个对象，你想返回它的缓</div><div class="t m0 x5 h9 y2042 ff1 fs3 fc0 sc0 ls0">存引用。</div><div class="t m0 x5 he y2043 ff2 fs2 fc4 sc0 ls0 wsadf">10.25.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2044 ff1 fs3 fc0 sc0 ls63 ws21f">这种通常是因为你希望相同参数创建的对象时单例的<span class="_ _c"></span>。在很多库中都有实际的例<span class="_ _1"></span></div><div class="t m0 x5 h9 y2045 ff1 fs3 fc0 sc0 ls0 ws14">子，比如 <span class="ff6 ws472">logging </span><span class="ws63">模块，使用相同的名称创建的 <span class="ff6 ws25d">logger </span>实例永远只有一个。例如：</span></div><div class="t m0 x5 h10 y2046 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">logging</span></span></div><div class="t m0 x5 hf y2047 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">logging<span class="fc6 ls34">.</span>getLogger(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">foo<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2048 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">logging<span class="fc6 ls34">.</span>getLogger(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">bar<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y2049 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a</span><span class="fca ws160">is <span class="ff8 fc0">b</span></span></div><div class="t m0 x5 hf y204a ff8 fs5 fc8 sc0 ls0">False</div><div class="t m0 x5 hf y204b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">logging<span class="fc6 ls34">.</span>getLogger(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">foo<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y204c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a</span><span class="fca ws160">is <span class="ff8 fc0">c</span></span></div><div class="t m0 x5 hf y204d ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf y204e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y204f ff1 fs3 fc0 sc0 ls0">为了达到这样的效果，你需要使用一个和类本身分开的工厂函数，例如：</div><div class="t m0 x5 h11 y2050 ffa fs5 fcd sc0 ls0 ws4"># The class in question</div><div class="t m0 x5 hf y2051 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2052 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name):</span></span></span></div><div class="t m0 x16 hf y2053 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x5 h11 y2054 ffa fs5 fcd sc0 ls0 ws4"># Caching support</div><div class="t m0 x5 h10 y2055 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">weakref</span></div><div class="t m0 x5 hf y2056 ff8 fs5 fc0 sc0 ls0 ws208">_spam_cache <span class="fc6 ls32">=</span><span class="ws13a">weakref<span class="fc6 ls34">.</span>WeakValueDictionary()</span></div><div class="t m0 x5 hf y2057 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get_spam<span class="fc0">(name):</span></span></div><div class="t m0 x15 hf y2058 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">name </span>not in <span class="ff8 fc0">_spam_cache:</span></div><div class="t m0 x16 hf y2059 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0">Spam(name)</span></div><div class="t m0 x16 hf y20f ff8 fs5 fc0 sc0 ls0 ws23c">_spam_cache[name] <span class="fc6 ls32">=</span>s</div><div class="t m0 x15 hf y205a ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.25.<span class="_ _5"> </span>8.25 <span class="ff1 wsb83">创建缓存实例 </span>297</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
