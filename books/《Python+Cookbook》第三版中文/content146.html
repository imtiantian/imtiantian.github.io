<div id="pf92" class="pf w0 h0" data-page-no="92"><div class="pc pc92 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg92.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">wt<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y1ac ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws1f4">(line1, <span class="fca ws13a">file<span class="fc6 ls34">=</span></span>f)</span></div><div class="t m0 x15 hf y1ad ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws1f4">(line2, <span class="fca ws13a">file<span class="fc6 ls34">=</span></span>f)</span></div><div class="t m0 x15 hf y1ae ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 yffa ff1 fs3 fc0 sc0 ls0 ws14">如果是在已存在文件中添加内容，使用模式为 <span class="ff6 ws308">at </span><span class="ls4">的</span><span class="ff6 ws25d">open() </span>函数。</div><div class="t m0 x0 h9 y4af ff1 fs3 fc0 sc0 ls35 ws624">文件的读写操作默认使用系统编码，可以通过调用 <span class="ff6 ls0 ws625">sys.getdefaultencoding() <span class="ff1">来</span></span></div><div class="t m0 x5 h7 yffb ff1 fs3 fc0 sc0 ls0 ws626">得到。在大多数机器上面都是 <span class="ff4 ws627">utf-8 </span><span class="wsa0">编码。如<span class="_ _6"></span>果你已经知道你要读写的文本是其他编<span class="_ _6"></span>码</span></div><div class="t m0 x5 h7 y4d5 ff1 fs3 fc0 sc0 ls0 ws14">方式，那么可以通过传递一个可选的 <span class="ff6 ws1f3">encoding </span><span class="ws63">参数给 <span class="ff4 ws628">op<span class="_ _6"></span>en() </span>函数。如下所示：</span></div><div class="t m0 x5 hf yffc ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, encoding<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">latin-1<span class="ff9 ws13b">&apos;</span></span><span class="ls33">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf yffd ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h7 yffe ff4 fs3 fc0 sc0 ls0 ws629">Python <span class="ff1 ls6f ws62a">支持非常多的文本编码<span class="_ _1"></span>。几个常见的编码是 <span class="ff4 ls0 ws62b">ascii, latin-1,<span class="_ _18"> </span>utf-8 </span><span class="lsfd">和<span class="ff4 ls0 wsa5">utf-16<span class="ff1">。</span></span></span></span></div><div class="t m0 x5 h7 yfff ff1 fs3 fc0 sc0 lsfe">在<span class="ff4 ls0 ws62c">w<span class="_ _1"></span>eb <span class="ff1 ls2d ws62d">应用程序中通常都使用的是 </span><span class="wsa5">UTF-8<span class="ff1 lsff">。</span><span class="ws62e">ascii <span class="ff1 ls2d ws623">对应从 </span><span class="ws62f">U<span class="_ _6"></span>+0000 <span class="ff1 lsfe">到</span><span class="ws630">U+007F <span class="ff1 ls2d ws132">范围内</span></span></span></span></span></span></div><div class="t m0 x5 h7 y1000 ff1 fs3 fc0 sc0 ls100">的<span class="ff4 ls101">7</span><span class="ls0 wsa0">位<span class="_ _6"></span>字<span class="_ _6"></span>符。<span class="_ _6"></span><span class="ff4 ws631">latin-1 </span></span><span class="ls6c ws632">是字节 </span><span class="ff4 ls0 ws633">0-255 </span>到<span class="ff4 ls0 ws634">U<span class="_ _6"></span>+0000 </span>至<span class="ff4 ls0 ws635">U<span class="_ _6"></span>+00FF </span><span class="ls6c ws632">范围内 </span><span class="ff4 ls0 ws636">Unico<span class="_ _6"></span>de </span><span class="ls6c ws29d">字符的直<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y1001 ff1 fs3 fc0 sc0 ls3d ws637">接映射。当读取一个未知编码的文本时使用 <span class="ff4 ls0 ws638">latin-1 <span class="ff1 wsa0">编码永远不<span class="_ _6"></span>会产<span class="_ _6"></span>生解码<span class="_ _6"></span>错误。使<span class="_ _6"></span>用</span></span></div><div class="t m0 x5 h7 y1002 ff4 fs3 fc0 sc0 ls0 ws639">latin-1 <span class="ff1 ls30 ws138">编码读取一个文件的时候也许不能产生完全正确的文本解码数据，但是它也能<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y244 ff1 fs3 fc0 sc0 ls0 wsa0">从<span class="_ _6"></span>中提<span class="_ _6"></span>取<span class="_ _6"></span>出<span class="_ _6"></span>足<span class="_ _6"></span>够<span class="_ _6"></span>多的<span class="_ _6"></span>有<span class="_ _6"></span>用<span class="_ _6"></span>数<span class="_ _6"></span>据。<span class="_ _6"></span>同时，<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _6"></span>你<span class="_ _6"></span>之<span class="_ _6"></span>后<span class="_ _6"></span>将数<span class="_ _6"></span>据<span class="_ _6"></span>回<span class="_ _6"></span>写<span class="_ _6"></span>回<span class="_ _6"></span>去，原<span class="_ _6"></span>先<span class="_ _6"></span>的<span class="_ _6"></span>数<span class="_ _6"></span>据<span class="_ _6"></span>还是</div><div class="t m0 x5 h9 y1003 ff1 fs3 fc0 sc0 ls0">会保留的。</div><div class="t m0 x5 he y1004 ff2 fs2 fc4 sc0 ls0 ws135">7.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1005 ff1 fs3 fc0 sc0 ls0 wsa0">读写文本文件一般来<span class="_ _6"></span>讲是比较简单的。但是也几<span class="_ _6"></span>点是需要注意的。首先，在<span class="_ _6"></span>例子程</div><div class="t m0 x5 h7 y1006 ff1 fs3 fc0 sc0 ls0 ws63a">序<span class="_ _6"></span>中<span class="_ _6"></span>的 <span class="ff4 ws63b">with </span><span class="ls6c ws63c">语句给被使用到的文件创建了一个上下文环境<span class="_ _c"></span>，但 <span class="ff6 ls0 ws63d">with <span class="ff1 wsa0">控<span class="_ _6"></span>制<span class="_ _0"></span>块结<span class="_ _6"></span>束<span class="_ _6"></span>时，</span></span></span></div><div class="t m0 x5 h9 y1007 ff1 fs3 fc0 sc0 ls36 ws63e">文件会自动关闭<span class="_ _c"></span>。你也可以不使用 <span class="ff6 ls0 ws524">with </span><span class="ws14a">语句，但是这时候你就必须记得手动关闭文<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y1008 ff1 fs3 fc0 sc0 ls0">件：</div><div class="t m0 x5 hf y1009 ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open</span></span><span class="ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">somefile.txt</span><span class="ls34">&apos;</span></span></span>,<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">rt</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y100a ff8 fs5 fc0 sc0 ls0 ws13c">data <span class="fc6 ls32">=</span><span class="ls34">f<span class="fc6">.</span></span>read()</div><div class="t m0 x5 hf y100b ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x0 h7 y100c ff1 fs3 fc0 sc0 ls0 ws63f">另外一个问题是关于<span class="_ _6"></span>换行符的识别问题，在 <span class="ff4 ws640">Unix </span><span class="ls102">和</span><span class="ff4 ws641">Windows </span><span class="ws642">中是不一样的 <span class="ff4 wsa5">(</span><span class="wsa0">分别</span></span></div><div class="t m0 x5 h7 y100d ff1 fs3 fc0 sc0 ls103">是<span class="ff4 ls104">n</span>和<span class="ff4 ls0 wsa5">rn)</span><span class="ls17 wsf6">。默认情况下，</span><span class="ff4 ls0 ws643">Python </span><span class="ls17 wsf6">会以统一模式处理换行符<span class="_ _1"></span>。这种模式下，在读取文</span></div><div class="t m0 x5 h7 y100e ff1 fs3 fc0 sc0 ls24 ws11d">本的时候<span class="_ _c"></span>，<span class="ff4 ls0 ws644">Python </span><span class="ws645">可以识别所有的普通换行符并将<span class="_ _6"></span>其转换为单个 <span class="ffd ls84">\<span class="ff6 ls105">n</span></span><span class="ls0 wsa0">字<span class="_ _6"></span>符。<span class="_ _6"></span>类<span class="_ _6"></span>似<span class="_ _0"></span>的，</span></span></div><div class="t m0 x5 h9 y100f ff1 fs3 fc0 sc0 ls0 ws646">在<span class="_ _6"></span>输<span class="_ _6"></span>出<span class="_ _6"></span>时<span class="_ _6"></span>会<span class="_ _6"></span>将<span class="_ _0"></span>换行<span class="_ _6"></span>符 <span class="ffd ws305">\<span class="ff6 ls106">n</span></span><span class="wsa0">转<span class="_ _6"></span>换<span class="_ _0"></span>为系<span class="_ _0"></span>统默<span class="_ _6"></span>认<span class="_ _0"></span>的换<span class="_ _6"></span>行<span class="_ _0"></span>符。如<span class="_ _0"></span>果你<span class="_ _6"></span>不<span class="_ _0"></span>希望<span class="_ _6"></span>这<span class="_ _0"></span>种默<span class="_ _6"></span>认<span class="_ _0"></span>的处<span class="_ _0"></span>理方</span></div><div class="t m0 x5 h9 y1010 ff1 fs3 fc0 sc0 ls0 ws38">式，可以给 <span class="ff6 ws25d">open() </span><span class="ws14">函数传入参数 <span class="ff6 ws17c">newline=&apos;&apos; </span>，就像下面这样：</span></div><div class="t m0 x5 h11 y1011 ffa fs5 fcd sc0 ls0 ws4"># Read with disabled newline translation</div><div class="t m0 x5 hf ye1a ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, newline<span class="fc6 ls34">=<span class="ff9 fc9">&apos;&apos;</span></span><span class="ls32">)</span></span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y1012 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h7 y1013 ff1 fs3 fc0 sc0 ls0 ws647">为<span class="_ _6"></span>了<span class="_ _6"></span>说<span class="_ _6"></span>明两<span class="_ _6"></span>者<span class="_ _6"></span>之<span class="_ _6"></span>间<span class="_ _6"></span>的<span class="_ _6"></span>差<span class="_ _6"></span>异，<span class="_ _6"></span>下<span class="_ _6"></span>面<span class="_ _6"></span>我<span class="_ _6"></span>在 <span class="ff4 ws648">Unix </span><span class="ws649">机<span class="_ _6"></span>器<span class="_ _6"></span>上<span class="_ _6"></span>面<span class="_ _6"></span>读<span class="_ _6"></span>取<span class="_ _6"></span>一<span class="_ _6"></span>个 <span class="ff4 ws64a">Windo<span class="_ _1"></span>ws <span class="ff1 wsa0">上<span class="_ _6"></span>面<span class="_ _6"></span>的<span class="_ _6"></span>文</span></span></span></div><div class="t m0 x5 h9 y1014 ff1 fs3 fc0 sc0 ls0 ws14">本文件，里面的内容是 <span class="ff6 ws305">hello world!<span class="ffd ls84">\</span><span class="ls9d">r</span><span class="ffd">\</span><span class="ls73">n</span></span>：</div><div class="t m0 x5 h11 y32f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Newline translation enabled (the default)</span></div><div class="t m0 x5 hf y330 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">hello.txt<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">rt<span class="ff9 ls34">&apos;</span></span>)</span></span></span></span></div><div class="t m0 x5 hf y331 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y332 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">hello world!\n<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.1.<span class="_ _5"> </span>5.1 <span class="ff1 ws64b">读写文本数据 </span>137</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
