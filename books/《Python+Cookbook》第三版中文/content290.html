<div id="pf122" class="pf w0 h0" data-page-no="122"><div class="pc pc122 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg122.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">new_state<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, newstate):</span></span></span></div><div class="t m0 x16 hf y1ac ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_state </span><span class="ls32">=</span><span class="fc0">newstate</span></span></div><div class="t m0 x16 h11 y1ad ffa fs5 fcd sc0 ls0 ws4"># Delegate to the state class</div><div class="t m0 x15 hf y1af ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">read<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1b0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_state<span class="fc6 ls34">.</span>read(</span>self<span class="fc0">)</span></span></div><div class="t m0 x15 hf y410 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">write<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, data):</span></span></span></div><div class="t m0 x16 hf y411 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_state<span class="fc6 ls34">.</span>write(</span>self<span class="fc0 ws13b">, data)</span></span></div><div class="t m0 x15 hf y8c6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">open<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf ybed ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_state<span class="fc6 ls34">.</span>open(</span>self<span class="fc0">)</span></span></div><div class="t m0 x15 hf ybef ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">close<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf ybf0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_state<span class="fc6 ls34">.</span>close(</span>self<span class="fc0">)</span></span></div><div class="t m0 x5 h11 ybf2 ffa fs5 fcd sc0 ls0 ws4"># Connection state base class</div><div class="t m0 x5 hf ybf3 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ConnectionState<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h10 ybf4 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf ybf5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">read<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf ybf6 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">NotImplementedError<span class="fc0">()</span></span></div><div class="t m0 x15 h10 ybf8 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf ybf9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">write<span class="fc0 ws4">(conn, data):</span></span></div><div class="t m0 x16 hf ybfa ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">NotImplementedError<span class="fc0">()</span></span></div><div class="t m0 x15 h10 y1ed6 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y1ed7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">open<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y1ed8 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">NotImplementedError<span class="fc0">()</span></span></div><div class="t m0 x15 h10 y1ed9 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y1eda ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">close<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y1edb ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">NotImplementedError<span class="fc0">()</span></span></div><div class="t m0 x5 h11 y1edc ffa fs5 fcd sc0 ls0 ws4"># Implementation of different states</div><div class="t m0 x5 hf y1edd ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ClosedConnectionState<span class="ff8 fc0">(ConnectionState):</span></span></div><div class="t m0 x15 h10 y1ede ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y1edf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">read<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y1ee0 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Not open</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></div><div class="t m0 x15 h10 y1ee1 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y1ee2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">write<span class="fc0 ws4">(conn, data):</span></span></div><div class="t m0 x16 hf y1ee3 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Not open</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></div><div class="t m0 x15 h10 y1ee4 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y1ee5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">open<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y1ee6 ff8 fs5 fc0 sc0 ls0 ws13a">conn<span class="fc6">.</span>new_state(OpenConnectionState)</div><div class="t m0 x15 h10 y1543 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.19.<span class="_ _5"> </span>8.19 <span class="ff1 wsb03">实现状态对象或者状态机 </span>281</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
