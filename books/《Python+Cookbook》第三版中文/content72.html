<div id="pf48" class="pf w0 h0" data-page-no="48"><div class="pc pc48 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg48.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">4.15<span class="_ _e"> </span>2.15 <span class="ff1">字符串中插入变量</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws212">4.15.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2b2 ff1 fs3 fc0 sc0 ls0">你想创建一个内嵌变量的字符串，变量被它的值所表示的字符串替换掉。</div><div class="t m0 x5 he y2b3 ff2 fs2 fc4 sc0 ls0 ws212">4.15.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y2b4 ff4 fs3 fc0 sc0 ls0 ws3cb">Python <span class="ff1 ls30 ws138">并没有对在字符串中简单替换变量值提供直接的支持。但是通过使用字符<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y6d2 ff1 fs3 fc0 sc0 ls0 ws14">串的 <span class="ff6 ws1f3">format() </span>方法来解决这个问题。比如：</div><div class="t m0 x5 hf y7ee ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">{name} has {n} messages.<span class="ff9">&apos;</span></span></span></span></span></div><div class="t m0 x5 hf y7ef ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">format(name</span><span class="ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">Guido<span class="ff9 ls34">&apos;</span><span class="fc0 ws4">, n</span></span><span class="ls34">=</span><span class="fc7">37<span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y7f0 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has 37 messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y7f1 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y7f2 ff1 fs3 fc0 sc0 ls0 ws3cc">或者，<span class="_ _8"></span>如果要被替换的变量能在变量域中找到，<span class="_ _8"></span>那么你可以结合使用 <span class="ff6 ws3cd">format map()</span></div><div class="t m0 x5 h9 y7f3 ff1 fs3 fc0 sc0 ls4">和<span class="ff6 ls0 ws25d">vars() <span class="ff1">。就像下面这样：</span></span></div><div class="t m0 x5 hf y7f4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">name <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">Guido<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y7f5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">37</span></span></span></div><div class="t m0 x5 hf y7f6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">format_map(<span class="fca">vars</span>())</span></span></span></div><div class="t m0 x5 hf y7f7 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has 37 messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y7f8 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y7f9 ff6 fs3 fc0 sc0 ls0 ws3ce">vars() <span class="ff1">还有一个有意思的特性就是它也适用于对象实例。比如：</span></div><div class="t m0 x5 hf y7fa ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws16a">class <span class="fcc ws156">Info<span class="ff8 fc0">:</span></span></span></div><div class="t m0 x5 hf y7fb ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, n):</span></span></span></span></div><div class="t m0 x5 hf y7fc ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fca ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls32">=</span><span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y7fd ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fca ws13a">self<span class="fc6">.<span class="fc0 ls33">n</span><span class="ls32">=</span><span class="fc0">n</span></span></span></div><div class="t m0 x5 h10 y7fe ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y7ff ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">Info(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Guido<span class="ff9 ls34">&apos;</span></span>,<span class="fc7">37</span>)</span></span></div><div class="t m0 x5 hf y800 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">format_map(<span class="fca">vars</span>(a))</span></span></span></div><div class="t m0 x5 hf y801 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Guido has 37 messages.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y802 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y803 ff6 fs3 fc0 sc0 ls0 ws3cf">format <span class="ff1 ls61">和</span><span class="ws3d0">format map() <span class="ff1 ls22 ws119">的一个缺陷就是它们并不能很好的处理变量缺失的情况，<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y804 ff1 fs3 fc0 sc0 ls0">比如：</div><div class="t m0 x5 hf y805 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">format(name</span><span class="ls34">=<span class="ff9 fc9">&apos;</span></span><span class="fc9">Guido<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y806 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y807 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x5 hf y808 ff8 fs5 fc2 sc0 ls0 ws13a">KeyError<span class="fc0 ls32">:<span class="ff9 ls34">&apos;<span class="ff8">n</span><span class="ls0">&apos;</span></span></span></div><div class="t m0 x5 hf y809 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y80a ff1 fs3 fc0 sc0 ls19 ws3d1">一种避免这种错误的方法是另外定义一个含有 <span class="ff6 ls0 ws3d2">missing<span class="_ _e"> </span>() </span><span class="ws22a">方法的字典对象，就<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y80b ff1 fs3 fc0 sc0 ls0">像下面这样：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.15.<span class="_ _5"> </span>2.15 <span class="ff1 ws2a4">字符串中插入变量 </span>63</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
