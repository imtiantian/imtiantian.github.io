<div id="pf225" class="pf w0 h0" data-page-no="225"><div class="pc pc225 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg225.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 ls18 ws1310">很多程序员刚开始会使用 <span class="ff4 ls0 wsf8">Python </span><span class="ws110">语言写一些简单脚本。当编写脚本的时候，通常<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">习惯了写毫无结构的代码，比如：</div><div class="t m0 x5 h11 yd14 ffa fs5 fcd sc0 ls0 ws4"># somescript.py</div><div class="t m0 x5 h10 yd16 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 h10 yd17 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">csv</span></div><div class="t m0 x5 hf yd19 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0">(sys<span class="fc6 ls34">.</span>argv[<span class="fc7 ls34">1</span><span class="ws159">]) </span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x31 hf y297f ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws15b">row </span><span class="ws160">in <span class="ff8 fc0 ws13a">csv<span class="fc6 ls34">.</span>reader(f):</span></span></div><div class="t m0 x2b h11 yd1b ffa fs5 fcd sc0 ls0 ws4"># Some kind of processing</div><div class="t m0 x2b h10 yd1c ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x0 h9 y3545 ff1 fs3 fc0 sc0 ls3a ws153">很少有人知道，像这样定义在全局范围的代码运行起来要比定义在函数中运行慢的</div><div class="t m0 x5 h9 y3546 ff1 fs3 fc0 sc0 ls12 wse4">多。这种速度差异是由于局部变量和全局变量的实现方式（<span class="_ _c"></span>使用局部变量要更快些）<span class="_ _f"></span>。<span class="_ _1"></span></div><div class="t m0 x5 h9 y1746 ff1 fs3 fc0 sc0 ls0">因此，如果你想让程序运行更快些，只需要将脚本语句放入函数中即可：</div><div class="t m0 x5 h11 y3547 ffa fs5 fcd sc0 ls0 ws4"># somescript.py</div><div class="t m0 x5 h10 y3548 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 h10 y3549 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">csv</span></div><div class="t m0 x5 hf y354a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">main<span class="fc0">(filename):</span></span></div><div class="t m0 x15 hf y354b ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 ws13a">open<span class="fc0 ws2a3">(filename) </span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x2b hf y354c ff7 fs5 fca sc0 ls0 ws38d">for <span class="ff8 fc0 ws158">row </span><span class="ws160">in <span class="ff8 fc0 ws13a">csv<span class="fc6">.</span>reader(f):</span></span></div><div class="t m0 x3d h11 y354d ffa fs5 fcd sc0 ls0 ws4"># Some kind of processing</div><div class="t m0 x3d h10 y354e ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y354f ff8 fs5 fc0 sc0 ls0 ws13a">main(sys<span class="fc6 ls34">.</span>argv[<span class="fc7 ls34">1</span>])</div><div class="t m0 x0 h7 y3550 ff1 fs3 fc0 sc0 ls0 ws1311">速度的<span class="_ _6"></span>差异<span class="_ _6"></span>取决于<span class="_ _6"></span>实际<span class="_ _6"></span>运行的<span class="_ _6"></span>程序，不<span class="_ _6"></span>过根<span class="_ _6"></span>据经验，<span class="_ _6"></span>使用<span class="_ _6"></span>函数带<span class="_ _6"></span>来 <span class="ff4 ws1312">15-30% </span><span class="ls3d ws164">的性能</span></div><div class="t m0 x5 h9 y3551 ff1 fs3 fc0 sc0 ls0">提升是很常见的。</div><div class="t m0 x0 h9 y3552 ff1 fs3 fc0 sc0 ls0">尽可能去掉属性访问</div><div class="t m0 x0 h7 y1dd7 ff1 fs3 fc0 sc0 lse ws1313">每一次使用点 <span class="ff4 ls0 ws327">(.) <span class="ff1 wsa0">操作<span class="_ _6"></span>符来访<span class="_ _6"></span>问属<span class="_ _6"></span>性的<span class="_ _6"></span>时候会<span class="_ _6"></span>带来<span class="_ _6"></span>额外<span class="_ _6"></span>的开销。<span class="_ _6"></span>它会<span class="_ _6"></span>触发<span class="_ _6"></span>特定的<span class="_ _6"></span>方</span></span></div><div class="t m0 x5 h9 y3553 ff1 fs3 fc0 sc0 ls0 ws592">法，比如 <span class="ff6 ws308">getattribute<span class="_ _e"> </span>() </span><span class="ls17a">和</span><span class="ff6 ws255">getattr<span class="_ _e"> </span>() </span>，这些方法会进行字典操作操作。</div><div class="t m0 x0 h9 y3554 ff1 fs3 fc0 sc0 ls0 ws94f">通常<span class="_ _6"></span>你<span class="_ _6"></span>可以<span class="_ _6"></span>使<span class="_ _6"></span>用 <span class="ff6 ws1314">from module import name<span class="_ _7"> </span></span><span class="wsa0">这样<span class="_ _6"></span>的<span class="_ _6"></span>导入<span class="_ _6"></span>形<span class="_ _6"></span>式，以<span class="_ _6"></span>及<span class="_ _6"></span>使用<span class="_ _6"></span>绑<span class="_ _6"></span>定的<span class="_ _6"></span>方</span></div><div class="t m0 x5 h9 y3555 ff1 fs3 fc0 sc0 ls0">法。假设你有如下的代码片段：</div><div class="t m0 x5 h10 y3556 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">math</span></div><div class="t m0 x5 hf y3557 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">compute_roots<span class="fc0">(nums):</span></span></div><div class="t m0 x15 hf y3558 ff8 fs5 fc0 sc0 ls0 ws145">result <span class="fc6 ls32">=</span>[]</div><div class="t m0 x15 hf y3559 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">n</span><span class="ws157">in <span class="ff8 fc0">nums:</span></span></div><div class="t m0 x16 hf y355a ff8 fs5 fc0 sc0 ls0 ws13a">result<span class="fc6 ls34">.</span>append(math<span class="fc6 ls34">.</span>sqrt(n))</div><div class="t m0 x15 hf y355b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">result</span></div><div class="t m0 x5 h11 y355c ffa fs5 fcd sc0 ls0 ws4"># Test</div><div class="t m0 x5 hf y355d ff8 fs5 fc0 sc0 ls0 ws13c">nums <span class="fc6 ls32">=</span><span class="fca ws13a">range<span class="fc0">(<span class="fc7">1000000</span>)</span></span></div><div class="t m0 x5 hf y355e ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">n</span><span class="ws160">in <span class="ff8 ws13a">range<span class="fc0 ls34">(</span><span class="fc7">100<span class="fc0">):</span></span></span></span></div><div class="t m0 x15 hf y355f ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0">compute_roots(nums)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">16.14.<span class="_ _36"> </span>14.14 <span class="ff1 wse4d">加速程序运行 </span>540</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
