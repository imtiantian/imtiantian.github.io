<div id="pf112" class="pf w0 h0" data-page-no="112"><div class="pc pc112 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg112.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y334 ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y335 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock2<span class="ff8 fc0 ws13a">(metaclass<span class="fc6 ls34">=</span>checkedmeta):</span></span></div><div class="t m0 x15 hf y336 ff8 fs5 fc0 sc0 ls0 ws13c">name <span class="fc6 ls32">=</span><span class="ws13a">SizedString(size<span class="fc6">=<span class="fc7 ls34">8</span></span>)</span></div><div class="t m0 x15 hf y337 ff8 fs5 fc0 sc0 ls0 ws145">shares <span class="fc6 ls32">=</span>UnsignedInteger()</div><div class="t m0 x15 hf yadd ff8 fs5 fc0 sc0 ls0 ws15f">price <span class="fc6 ls33">=</span>UnsignedFloat()</div><div class="t m0 x15 hf yadf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, shares, price):</span></span></span></div><div class="t m0 x16 hf yc64 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y1555 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">shares </span><span class="ls32">=</span><span class="fc0">shares</span></span></div><div class="t m0 x16 hf y177c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">price </span><span class="ls32">=</span><span class="fc0">price</span></span></div><div class="t m0 x5 he y1d86 ff2 fs2 fc4 sc0 ls0 wsadf">10.13.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1d87 ff1 fs3 fc0 sc0 ls68 ws23f">本节使用了很多高级技术，包括描述器、混入类、<span class="ff6 ls0 wsb04">super() <span class="ff1 wsa0">的使用、类装饰器<span class="_ _6"></span>和元</span></span></div><div class="t m0 x5 h7 y1d88 ff1 fs3 fc0 sc0 ls0 ws529">类。不可能在这里一一详细展开来讲，<span class="_ _1"></span>但是可以在 <span class="ff4 wsa5">8.9</span><span class="wsa0">、<span class="ff4 wsa5">8.18</span>、<span class="_ _1"></span><span class="ff4 wsb05">9.19 <span class="ff1">小节找到更多例子。</span></span></span></div><div class="t m0 x5 h9 y1d89 ff1 fs3 fc0 sc0 ls0">但是，我在这里还是要提一下几个需要注意的点。</div><div class="t m0 x0 h9 y1d8a ff1 fs3 fc0 sc0 ls0 wsb06">首先，<span class="_ _19"></span>在 <span class="ff6 wsb07">Descriptor </span><span class="wsb08">基类中你会看到有个 <span class="ff6 wsb09">set<span class="_ _e"> </span>() </span><span class="wsb0a">方法，<span class="_ _8"></span>却没有相应的 <span class="ff6 ws9c3">get ()</span></span></span></div><div class="t m0 x5 h9 y1d8b ff1 fs3 fc0 sc0 ls13 wse5">方法<span class="_ _1"></span>。如果一个描述仅仅是从底层实例字典中获取某个属性值的话，那么没必要去定<span class="_ _c"></span></div><div class="t m0 x5 h9 y1d8c ff1 fs3 fc0 sc0 ls17a">义<span class="ff6 ls0 ws308">get<span class="_ _e"> </span>() <span class="ff1">方法。</span></span></div><div class="t m0 x0 h9 y1d8d ff1 fs3 fc0 sc0 ls0 wsb0b">所有<span class="_ _6"></span>描<span class="_ _6"></span>述器<span class="_ _6"></span>类<span class="_ _6"></span>都<span class="_ _6"></span>是基<span class="_ _6"></span>于<span class="_ _6"></span>混入<span class="_ _6"></span>类<span class="_ _6"></span>来实<span class="_ _6"></span>现<span class="_ _6"></span>的。比<span class="_ _6"></span>如 <span class="ff6 ws2a1">Unsigned </span><span class="ls6e">和</span><span class="ff6 ws2a1">MaxSized </span><span class="wsa0">要<span class="_ _6"></span>跟<span class="_ _6"></span>其他<span class="_ _6"></span>继</span></div><div class="t m0 x5 h9 y1d8e ff1 fs3 fc0 sc0 ls0 ws14">承自 <span class="ff6 ws17d">Typed </span>类混入。这里利用多继承来实现相应的功能。</div><div class="t m0 x0 h9 y1d8f ff1 fs3 fc0 sc0 ls49 ws6b0">混入类的一个比较难理解的地方是<span class="_ _1"></span>，调用 <span class="ff6 ls0 ws6b1">super() </span><span class="ws1a6">函数时<span class="_ _1"></span>，你并不知道究竟要调</span></div><div class="t m0 x5 h9 y1d90 ff1 fs3 fc0 sc0 ls13 wse5">用哪个具体类<span class="_ _1"></span>。你需要跟其他类结合后才能正确的使用，也就是必须合作才能产生效<span class="_ _c"></span></div><div class="t m0 x5 h9 y1d91 ff1 fs3 fc0 sc0 ls0">果。</div><div class="t m0 x0 h9 y1531 ff1 fs3 fc0 sc0 ls3a ws153">使用类装饰器和元类通常可以简化代码。上面两个例子中你会发现你只需要输入一</div><div class="t m0 x5 h9 y1d92 ff1 fs3 fc0 sc0 ls0">次属性名即可了。</div><div class="t m0 x5 h11 y1d93 ffa fs5 fcd sc0 ls0 ws4"># Normal</div><div class="t m0 x5 hf y1d94 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1d95 ff8 fs5 fc0 sc0 ls32">x<span class="fc6 ls33">=</span><span class="ls0 ws13a">Integer(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">x<span class="ff9">&apos;</span></span></span>)</span></div><div class="t m0 x15 hf y1d96 ff8 fs5 fc0 sc0 ls32">y<span class="fc6 ls33">=</span><span class="ls0 ws13a">Integer(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">y<span class="ff9">&apos;</span></span></span>)</span></div><div class="t m0 x5 h11 y1d97 ffa fs5 fcd sc0 ls0 ws4"># Metaclass</div><div class="t m0 x5 hf y1d98 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0 ws13a">(metaclass<span class="fc6 ls34">=</span>checkedmeta):</span></span></div><div class="t m0 x15 hf y1d99 ff8 fs5 fc0 sc0 ls32">x<span class="fc6 ls33">=</span><span class="ls0">Integer()</span></div><div class="t m0 x15 hf y1d9a ff8 fs5 fc0 sc0 ls32">y<span class="fc6 ls33">=</span><span class="ls0">Integer()</span></div><div class="t m0 x0 h9 y1d9b ff1 fs3 fc0 sc0 ls0 wsa0">所有方法中，类装饰器<span class="_ _6"></span>方案应该是最灵活和最高<span class="_ _6"></span>明的。首先，它并不依赖任<span class="_ _6"></span>何其他</div><div class="t m0 x5 h9 y1d9c ff1 fs3 fc0 sc0 ls0">新的技术，比如元类。其次，装饰器可以很容易的添加或删除。</div><div class="t m0 x0 h7 yb3c ff1 fs3 fc0 sc0 ls0 wsa0">最后，装饰器还能作为混入类的替代技术来实现同样的效果<span class="ff4">;</span></div><div class="t m0 x5 h11 y1d9d ffa fs5 fcd sc0 ls0 ws4"># Decorator for applying type checking</div><div class="t m0 x5 hf y1d9e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">Typed<span class="fc0 ws13b">(expected_type, cls<span class="fc6 ls34">=</span></span><span class="fca">None<span class="fc0">):</span></span></span></div><div class="t m0 x15 hf y1d9f ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws158">cls </span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x16 hf y1da0 ff7 fs5 fca sc0 ls0 ws146">return lambda <span class="ff8 fc0 ws4">cls: Typed(expected_type, cls)</span></div><div class="t m0 x15 hf y1da1 ff8 fs5 fc0 sc0 ls0 ws16e">super_set <span class="fc6 ls33">=</span><span class="ws13a">cls<span class="fc6 ls34">.</span>__set__</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.13.<span class="_ _5"> </span>8.13 <span class="ff1 wsb03">实现数据模型的类型约束 </span>265</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
