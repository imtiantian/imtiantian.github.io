<div id="pf4c" class="pf w0 h0" data-page-no="4c"><div class="pc pc4c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg4c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc8 sc0 ls0 ws4">Elements are written as &quot;&amp;lt;tag&amp;gt;text&amp;lt;/tag&amp;gt;&quot;.</div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y85b ff1 fs3 fc0 sc0 lse ws14b">如果你正在处理的是 <span class="ff4 ls0 ws3fd">ASCI<span class="_ _6"></span>I <span class="ff1 ws3fe">文本，并<span class="_ _6"></span>且想<span class="_ _6"></span>将非 </span><span class="ws3ff">ASCI<span class="_ _6"></span>I </span></span><span class="wsd8">文本对应的编码实体嵌入进</span></div><div class="t m0 x5 h7 y85c ff1 fs3 fc0 sc0 ls30 ws400">去，可以给某些 <span class="ff4 ls0 ws401">I/O </span><span class="ws402">函数传递参数 <span class="ff6 ls0 ws403">errors=&apos;xmlcharrefreplace&apos; <span class="ff1 wsa0">来达<span class="_ _6"></span>到<span class="_ _6"></span>这个<span class="_ _6"></span>目。<span class="_ _6"></span>比</span></span></span></div><div class="t m0 x5 h9 y85d ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 hf y85e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13b">Spicy Jalapeño<span class="ff9">&apos;</span></span></span></span></span></div><div class="t m0 x5 hf y85f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">encode(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">ascii</span>&apos;</span><span class="ls0 ws13b">, errors</span><span class="fc6">=<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">xmlcharrefreplace</span>&apos;</span></span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y860 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws4">Spicy Jalape&amp;#241;o<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y861 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y862 ff1 fs3 fc0 sc0 ls14 ws404">为了替换文本中的编码实体<span class="_ _1"></span>，你需要使用另外一种方法。如果你正在处理 <span class="ff4 ls0">HTML</span></div><div class="t m0 x5 h7 y863 ff1 fs3 fc0 sc0 ls0 ws405">或者 <span class="ff4 ws406">XML </span><span class="ws407">文<span class="_ _6"></span>本，试着<span class="_ _6"></span>先使<span class="_ _6"></span>用一<span class="_ _6"></span>个合适<span class="_ _6"></span>的 <span class="ff4 ws408">HTML </span><span class="ws409">或者 <span class="ff4 ws40a">XML </span><span class="wsa0">解<span class="_ _6"></span>析器。通<span class="_ _6"></span>常情<span class="_ _6"></span>况下，<span class="_ _6"></span>这</span></span></span></div><div class="t m0 x5 h9 y864 ff1 fs3 fc0 sc0 ls0">些工具会自动替换这些编码值，你无需担心。</div><div class="t m0 x0 h9 y865 ff1 fs3 fc0 sc0 ls0 wsa0">有时候，如果你接收到<span class="_ _6"></span>了一些含有编码值的原始<span class="_ _6"></span>文本，需要手动去做替换，<span class="_ _6"></span>通常你</div><div class="t m0 x5 h7 y866 ff1 fs3 fc0 sc0 ls0 ws38">只需要使用 <span class="ff4 ws40b">HTML </span><span class="ws14">或者 <span class="ff4 ws64">XML </span><span class="wsa0">解析器的一些相关工具函数<span class="ff4 ls6">/</span>方法即可。比如：</span></span></div><div class="t m0 x5 hf y867 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13b">Spicy &amp;quot;Jalape&amp;#241;o&amp;quot.<span class="ff9">&apos;</span></span></span></span></span></div><div class="t m0 x5 hf y868 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws168">html.parser </span><span class="ws146">import <span class="ff8 fc0">HTMLParser</span></span></span></div><div class="t m0 x5 hf y869 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0">HTMLParser()</span></span></div><div class="t m0 x5 hf y86a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">unescape(s)</span></span></span></div><div class="t m0 x5 hf y86b ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13b">Spicy &quot;Jalapeño&quot;.<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y86c ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hf y86d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">t<span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws4">The prompt is &amp;gt;&amp;gt;&amp;gt;<span class="ff9">&apos;</span></span></span></span></span></div><div class="t m0 x5 hf y86e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws40c">xml.sax.saxutils </span><span class="ws146">import <span class="ff8 fc0">unescape</span></span></span></div><div class="t m0 x5 hf y86f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">unescape(t)</span></div><div class="t m0 x5 hf y870 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">The prompt is &gt;&gt;&gt;<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y871 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y872 ff2 fs2 fc4 sc0 ls0 ws212">4.17.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y873 ff1 fs3 fc0 sc0 ls0 ws40d">在生<span class="_ _6"></span>成 <span class="ff4 ws40e">HTML </span><span class="ws216">或<span class="_ _6"></span>者 <span class="ff4 ws40f">XML </span><span class="ls22 ws119">文本的时候，如果正确的转换特殊标记字符是一个很容<span class="_ _1"></span></span></span></div><div class="t m0 x5 h9 y874 ff1 fs3 fc0 sc0 lsa8 ws410">易被忽视的细节。特别是当你使用 <span class="ff6 ls0 ws411">print() </span><span class="ws3de">函数或<span class="_ _1"></span>者其他字符串格式化来产生输出的</span></div><div class="t m0 x5 h9 y875 ff1 fs3 fc0 sc0 ls0 ws14">时候。使用像 <span class="ff6 ws317">html.escape() </span>的工具函数可以很容易的解决这类问题。</div><div class="t m0 x0 h9 y876 ff1 fs3 fc0 sc0 lsb1 ws412">如果你想以其他方式处理文本<span class="_ _20"></span>，还有一些其他的工具函数比如<span class="_ _20"></span></div><div class="t m0 x5 h9 y877 ff6 fs3 fc0 sc0 ls0 ws413">xml.sax.saxutils.unescapge() <span class="ff1 wsa0">可以帮助你。然而，你应该先调研清楚怎样使用一个</span></div><div class="t m0 x5 h7 y878 ff1 fs3 fc0 sc0 ls0 ws414">合<span class="_ _6"></span>适<span class="_ _0"></span>的<span class="_ _6"></span>解<span class="_ _6"></span>析<span class="_ _0"></span>器。<span class="_ _6"></span>比<span class="_ _0"></span>如，<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _0"></span>你<span class="_ _6"></span>在<span class="_ _6"></span>处<span class="_ _0"></span>理 <span class="ff4 ws415">HTML </span><span class="lsb2">或</span><span class="ff4 ws416">XML </span><span class="wsa0">文<span class="_ _6"></span>本，<span class="_ _0"></span>使<span class="_ _6"></span>用<span class="_ _6"></span>某<span class="_ _0"></span>个<span class="_ _6"></span>解<span class="_ _6"></span>析<span class="_ _0"></span>模<span class="_ _6"></span>块<span class="_ _6"></span>比<span class="_ _0"></span>如</span></div><div class="t m0 x5 h9 y879 ff6 fs3 fc0 sc0 ls0 ws17c">html.parse <span class="ff1 ls4">或</span><span class="ws270">xml.etree.ElementTree <span class="ff1">已经帮你自动处理了相关的替换细节。</span></span></div><div class="t m0 x5 hd y87a ff2 fs4 fc4 sc0 ls0 ws211">4.18<span class="_ _e"> </span>2.18 <span class="ff1">字符串令牌解析</span></div><div class="t m0 x5 he y87b ff2 fs2 fc4 sc0 ls0 ws212">4.18.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y87c ff1 fs3 fc0 sc0 ls0">你有一个字符串，想从左至右将其解析为一个令牌流。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.18.<span class="_ _5"> </span>2.18 <span class="ff1 ws3ba">字符串令牌解析 </span>67</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
