<div id="pf1e0" class="pf w0 h0" data-page-no="1e0"><div class="pc pc1e0 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1e0.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h7 y2a ff1 fs3 fc0 sc0 ls11b">他<span class="ff4 ls0 ws1161">actor </span><span class="ls42 ws186">发送更进一步的消息。</span><span class="ff4 ls0 ws1161">actor </span><span class="ls42 ws186">之间的通信是单向和异步的<span class="_ _1"></span>。因此，消息发送者<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">不知道消息是什么时候被发送，也不会接收到一个消息已被处理的回应或通知。</div><div class="t m0 x0 h7 y8dd ff1 fs3 fc0 sc0 ls0 ws38">结合使用一个线程和一个队列可以很容易的定义 <span class="ff4 wsa5">actor</span>，例如：</div><div class="t m0 x5 hf y2fdd ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws16a">queue </span><span class="ws146">import <span class="ff8 fc0">Queue</span></span></div><div class="t m0 x5 hf y2fde ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">threading </span><span class="ws146">import <span class="ff8 fc0 ws4">Thread, Event</span></span></div><div class="t m0 x5 h11 y2fdf ffa fs5 fcd sc0 ls0 ws4"># Sentinel used for shutdown</div><div class="t m0 x5 hf y2fe0 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ActorExit<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">Exception<span class="fc0">):</span></span></div><div class="t m0 x15 h10 y2fe1 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y2fe2 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Actor<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1383 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y2fe3 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">_mailbox </span><span class="ls32">=</span><span class="fc0">Queue()</span></span></div><div class="t m0 x15 hf y2fe4 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">send<span class="fc0">(<span class="fca">self</span><span class="ws4">, msg):</span></span></span></div><div class="t m0 x16 h15 y2fe5 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y2fe6 ffa fs5 fc9 sc0 ls0 ws4">Send a message to the actor</div><div class="t m0 x16 h15 y2fe7 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y2fe8 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_mailbox</span><span class="ls34">.</span><span class="fc0">put(msg)</span></span></div><div class="t m0 x15 hf y2fe9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">recv<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 h15 y2fea ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y2feb ffa fs5 fc9 sc0 ls0 ws4">Receive an incoming message</div><div class="t m0 x16 h15 y2fec ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y2fed ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_mailbox<span class="fc6">.</span>get()</span></span></div><div class="t m0 x16 hf y2fee ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws158">msg </span>is <span class="ff8 fc0">ActorExit:</span></div><div class="t m0 x17 hf y2fef ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 fc0">ActorExit()</span></div><div class="t m0 x16 hf y2ff0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">msg</span></div><div class="t m0 x15 hf y41f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">close<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y420 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y421 ffa fs5 fc9 sc0 ls0 ws4">Close the actor, thus shutting it down</div><div class="t m0 x16 h15 y422 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y423 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">send(ActorExit)</span></span></div><div class="t m0 x15 hf y425 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">start<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y2ff1 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y2ff2 ffa fs5 fc9 sc0 ls0 ws13b">Start concurrent execution</div><div class="t m0 x16 h15 y2f05 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y2ff3 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">_terminated </span><span class="ls33">=</span><span class="fc0">Event()</span></span></div><div class="t m0 x16 hf y2ff4 ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">Thread(target<span class="fc6 ls34">=</span><span class="fca">self<span class="fc6 ls34">.</span></span>_bootstrap)</span></div><div class="t m0 x16 hf y2ff5 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws145">daemon <span class="fc6 ls33">=</span><span class="fca">True</span></span></div><div class="t m0 x16 hf y2ff6 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x15 hf y2ff7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">_bootstrap<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y2ff8 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y2ff9 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">run()</span></span></div><div class="t m0 x16 hf y2ffa ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0">ActorExit:</span></div><div class="t m0 x17 h10 y2ffb ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">14.10.<span class="_ _36"> </span>12.10 <span class="ff1 ws16b">定义一个 </span><span class="ws115f">Acto<span class="_ _c"></span>r <span class="ff1 ws1160">任务 </span>471</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
