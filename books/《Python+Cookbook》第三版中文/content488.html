<div id="pf1e8" class="pf w0 h0" data-page-no="1e8"><div class="pc pc1e8 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1e8.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y15f ff8 fs5 fc0 sc0 ls0 ws4">T-minus 9</div><div class="t m0 x5 hf y160 ff8 fs5 fc0 sc0 ls0 ws4">T-minus 4</div><div class="t m0 x5 hf y956 ff8 fs5 fc0 sc0 ls0 ws4">Counting up 1</div><div class="t m0 x5 hf y957 ff8 fs5 fc0 sc0 ls0 ws4">T-minus 8</div><div class="t m0 x5 hf y958 ff8 fs5 fc0 sc0 ls0 ws4">T-minus 3</div><div class="t m0 x5 hf y959 ff8 fs5 fc0 sc0 ls0 ws4">Counting up 2</div><div class="t m0 x5 hf y95a ff8 fs5 fc0 sc0 ls0 ws4">T-minus 7</div><div class="t m0 x5 hf y95b ff8 fs5 fc0 sc0 ls0 ws4">T-minus 2</div><div class="t m0 x5 hf y95c ff8 fs5 fc0 sc0 ls0">...</div><div class="t m0 x0 h9 y3068 ff1 fs3 fc0 sc0 ls0 wsa0">到此为止，我们实际上<span class="_ _6"></span>已经实现了一个“操作系<span class="_ _6"></span>统”的最小核心部分。生成<span class="_ _6"></span>器函数</div><div class="t m0 x5 h7 y3085 ff1 fs3 fc0 sc0 ls0 ws1187">就是认为，而 <span class="ff4 ws627">yield </span><span class="ls3a ws153">语句是任务挂起的信号。调度器循环检查任务列表直到没有任务要</span></div><div class="t m0 x5 h9 y3086 ff1 fs3 fc0 sc0 ls0">执行为止。</div><div class="t m0 x0 h7 y3087 ff1 fs3 fc0 sc0 ls2c ws1188">实际上，你可能想要使用生成器来实现简单的并发。那么<span class="_ _1"></span>，在实现 <span class="ff4 ls0 ws1189">actor <span class="ff1 wsa0">或网<span class="_ _6"></span>络服</span></span></div><div class="t m0 x5 h9 y3088 ff1 fs3 fc0 sc0 ls0">务器的时候你可以使用生成器来替代线程的使用。</div><div class="t m0 x0 h7 y3089 ff1 fs3 fc0 sc0 ls0 ws14">下面的代码演示了使用生成器来实现一个不依赖线程的 <span class="ff4 wsa5">actor</span>：</div><div class="t m0 x5 hf y308a ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">deque</span></span></div><div class="t m0 x5 hf y308b ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">ActorScheduler<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y308c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y308d ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">_actors </span><span class="ls33">=</span><span class="fc0 ws13b">{ }<span class="_ _3c"> </span><span class="ffa fcd ws4"># Mapping of names to actors</span></span></span></div><div class="t m0 x16 hf y308e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws2a3">_msg_queue </span><span class="ls33">=</span><span class="fc0 ws118a">deque() <span class="ffa fcd ws4"># Message queue</span></span></span></div><div class="t m0 x15 hf y308f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">new_actor<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name, actor):</span></span></span></div><div class="t m0 x16 h15 y2da4 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y3090 ffa fs5 fc9 sc0 ls0 ws4">Admit a newly started actor to the scheduler and give it a name</div><div class="t m0 x16 h15 y3091 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y3092 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_msg_queue</span>.<span class="fc0">append((actor,</span></span>None<span class="fc0">))</span></div><div class="t m0 x16 hf y3093 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws5a4">_actors[name] </span><span class="ls32">=</span><span class="fc0">actor</span></span></div><div class="t m0 x15 hf y14c6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">send<span class="fc0">(<span class="fca">self</span><span class="ws4">, name, msg):</span></span></span></div><div class="t m0 x16 h15 y3094 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y3095 ffa fs5 fc9 sc0 ls0 ws4">Send a message to a named actor</div><div class="t m0 x16 h15 ydb9 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf ydba ff8 fs5 fc0 sc0 ls0 ws15f">actor <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6">.<span class="fc0">_actors</span><span class="ls34">.</span></span></span>get(name)</div><div class="t m0 x16 hf y3096 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">actor:</span></div><div class="t m0 x17 hf y3097 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_msg_queue</span>.<span class="fc0">append((actor,msg))</span></span></div><div class="t m0 x15 hf ydbd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 ydbe ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y3098 ffa fs5 fc9 sc0 ls0 ws4">Run as long as there are pending messages.</div><div class="t m0 x16 h15 ydbf ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf ydc0 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_msg_queue:</span></span></div><div class="t m0 x17 hf y3099 ff8 fs5 fc0 sc0 ls0 ws13b">actor, msg <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_msg_queue<span class="fc6 ls34">.</span>popleft()</span></span></div><div class="t m0 x17 hf ydc1 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x41 hf ydc2 ff8 fs5 fc0 sc0 ls0 ws13a">actor<span class="fc6 ls34">.</span>send(msg)</div><div class="t m0 x17 hf y309a ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">StopIteration<span class="fc0">:</span></span></div><div class="t m0 x41 h10 ydc3 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">14.12.<span class="_ _36"> </span>12.12 <span class="ff1 ws104c">使用生成器代替线程 </span>479</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
