<div id="pf158" class="pf w0 h0" data-page-no="158"><div class="pc pc158 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg158.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y334 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: too many positional arguments</span></div><div class="t m0 x5 hf y335 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">func(y<span class="fc6 ls34">=<span class="fc7">2</span></span>)</span></div><div class="t m0 x5 hf y336 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 h11 y337 ffa fs5 fcd sc0 ls0">...</div><div class="t m0 x15 hf yadd ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;/usr/local/lib/python3.3/inspect.py&quot;</span><span class="ws4">, line <span class="fc7 ws13a">1961</span><span class="ls33">,</span><span class="ff7 fca ws157">in </span>_bind</span></div><div class="t m0 x16 hf yade ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0 ws15f">(msg) </span></span><span class="ws15a">from <span class="ff8">None</span></span></div><div class="t m0 x5 hf yadf ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ls32">:<span class="ff9 ls34">&apos;</span><span class="ls0">x<span class="ff9 ls33">&apos;</span><span class="ws4">parameter lacking default value</span></span></span></div><div class="t m0 x5 hf yc64 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">func(<span class="fc7">1</span><span class="ws4">, y<span class="fc6 ls34">=<span class="fc7">2</span></span><span class="ws13b">, x<span class="fc6 ls34">=<span class="fc7">3</span></span>)</span></span></span></div><div class="t m0 x5 hf y1555 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 h11 y177c ffa fs5 fcd sc0 ls0">...</div><div class="t m0 x15 hf y177d ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;/usr/local/lib/python3.3/inspect.py&quot;</span><span class="ws4">, line <span class="fc7 ws13a">1985</span><span class="ls33">,</span><span class="ff7 fca ws157">in </span>_bind</span></div><div class="t m0 x16 hf y177e ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">{arg!r}</span><span class="ls0 ws13b">&apos;</span><span class="ff8 fc6">.<span class="fc0 ls0 ws13a">format(arg</span>=<span class="fc0 ls0 ws13a">param<span class="fc6">.</span>name))</span></span></div><div class="t m0 x5 hf y177f ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ws4">: multiple values for argument <span class="ff9 ls34">&apos;<span class="ff8">x</span><span class="ls0">&apos;</span></span></span></div><div class="t m0 x5 hf y1780 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y240d ff1 fs3 fc0 sc0 ls3a ws153">可以看出来，通过将签名和传递的参数绑定起来，可以强制函数调用遵循特定的规</div><div class="t m0 x5 h9 y240e ff1 fs3 fc0 sc0 ls0">则，比如必填、默认、重复等等。</div><div class="t m0 x0 h9 y240f ff1 fs3 fc0 sc0 ls3a ws153">下面是一个强制函数签名更具体的例子。在代码中，我们在基类中先定义了一个非</div><div class="t m0 x5 h9 y2410 ff1 fs3 fc0 sc0 ls0 ws592">常通用的 <span class="ff6 ws308">init<span class="_ _e"> </span>() </span>方法，然后我们强制所有的子类必须提供一个特定的参数签名。</div><div class="t m0 x5 hf y2411 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2f0">inspect </span><span class="ws1ff">import <span class="ff8 fc0 ws13b">Signature, Parameter</span></span></div><div class="t m0 x5 hf y1c80 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">make_sig<span class="fc0">(<span class="fc6 ls34">*</span>names):</span></span></div><div class="t m0 x15 hf y1c81 ff8 fs5 fc0 sc0 ls0 ws15f">parms <span class="fc6 ls33">=</span><span class="ws13b">[Parameter(name, Parameter<span class="fc6 ws13a">.</span>POSITIONAL_OR_KEYWORD)</span></div><div class="t m0 x17 hf y2412 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws157">in <span class="ff8 fc0">names]</span></span></div><div class="t m0 x15 hf y2413 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">Signature(parms)</span></div><div class="t m0 x5 hf y2414 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Structure<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2415 ff8 fs5 fc0 sc0 ls0 ws147">__signature__ <span class="fc6 ls33">=</span>make_sig()</div><div class="t m0 x15 hf y2416 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span><span class="ws458">args, </span><span class="fc6">**</span>kwargs):</span></span></div><div class="t m0 x16 hf y2417 ff8 fs5 fc0 sc0 ls0 ws150">bound_values <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6">.<span class="fc0">__signature__</span><span class="ls34">.</span><span class="fc0">bind(</span><span class="ls34">*</span></span></span><span class="ws15f">args, <span class="fc6 ls34">**</span>kwargs)</span></div><div class="t m0 x16 hf y2418 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, value </span><span class="ws160">in <span class="ff8 fc0 ws13a">bound_values<span class="fc6 ls34">.</span>arguments<span class="fc6">.</span>items():</span></span></div><div class="t m0 x17 hf y2419 ff8 fs5 fca sc0 ls0 ws13a">setattr<span class="fc0 ls34">(</span>self<span class="fc0 ws4">, name, value)</span></div><div class="t m0 x5 h11 y241a ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y241b ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Stock<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y241c ff8 fs5 fc0 sc0 ls0 ws147">__signature__ <span class="fc6 ls33">=</span><span class="ws13a">make_sig(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">name<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">shares<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">price<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y241d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">(Structure):</span></span></div><div class="t m0 x15 hf y241e ff8 fs5 fc0 sc0 ls0 ws147">__signature__ <span class="fc6 ls33">=</span><span class="ws13a">make_sig(<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span><span class="ls0 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">y<span class="ff9">&apos;</span></span></span>)</span></div><div class="t m0 x0 h9 y241f ff1 fs3 fc0 sc0 ls0 ws38">下面是使用这个 <span class="ff6 ws17d">Stock </span>类的示例：</div><div class="t m0 x5 h10 y2420 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">inspect</span></span></div><div class="t m0 x5 hf y2421 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(inspect<span class="fc6 ls34">.</span>signature(Stock))</span></span></div><div class="t m0 x5 hf y2422 ff8 fs5 fc8 sc0 ls0 ws4">(name, shares, price)</div><div class="t m0 x5 hf y2423 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">s1 <span class="fc6 ls33">=</span><span class="ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">100</span><span class="ls32">,</span><span class="fc7">490.1</span>)</span></span></div><div class="t m0 x5 hf y2424 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">s2 <span class="fc6 ls33">=</span><span class="ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">100</span>)</span></span></div><div class="t m0 x5 hf y2425 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 h11 y2426 ffa fs5 fcd sc0 ls0">...</div><div class="t m0 x5 hf y2427 ff8 fs5 fc2 sc0 ls0 ws13a">TypeError<span class="fc0 ls32">:<span class="ff9 ls34">&apos;</span><span class="ls0">price<span class="ff9 ls33">&apos;</span><span class="ws4">parameter lacking default value</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.16.<span class="_ _5"> </span>9.16 <span class="fc2 wsc41">*</span><span class="wsc42">a<span class="_ _c"></span>rgs <span class="ff1 ls7f">和</span><span class="wsc43">**kwa<span class="_ _c"></span>rgs <span class="ff1 wsc44">的强制参数签名 </span>335</span></span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
