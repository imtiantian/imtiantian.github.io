<div id="pf162" class="pf w0 h0" data-page-no="162"><div class="pc pc162 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg162.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">11.20<span class="_ _e"> </span>9.20 <span class="ff1">利用函数注解实现方法重载</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">11.20.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2b2 ff1 fs3 fc0 sc0 ls3a ws153">你已经学过怎样使用函数参数注解，那么你可能会想利用它来实现基于类型的方法</div><div class="t m0 x5 h9 y23ec ff1 fs3 fc0 sc0 ls0 wsa0">重载。但是你不确定应该怎样去实现（或者到底行得通不）<span class="_ _f"></span>。</div><div class="t m0 x5 he y23ed ff2 fs2 fc4 sc0 ls0 wsadf">11.20.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y6d2 ff1 fs3 fc0 sc0 ls18 wsa7f">本小节的技术是基于一个简单的技术，那就是 <span class="ff4 ls0 ws453">Python </span><span class="ws110">允许参数注解，代码可以像<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y24fa ff1 fs3 fc0 sc0 ls0">下面这样写：</div><div class="t m0 x5 hf y6f2 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Spam<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y63b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, x:</span>int<span class="fc0 ws13b">, y:</span>int<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y6f3 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Bar 1:</span>&apos;</span><span class="ls0 ws13b">, x, y)</span></span></div><div class="t m0 x15 hf y24fb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">bar<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, s:</span>str<span class="fc0 ws13b">, n:</span><span class="ws158">int <span class="fc6 ls32">=<span class="fc7 ls34">0</span></span><span class="fc0">):</span></span></span></span></div><div class="t m0 x16 hf y24fc ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Bar 2:</span>&apos;</span><span class="ls0 ws13b">, s, n)</span></span></div><div class="t m0 x5 hf y24fd ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0">Spam()</span></div><div class="t m0 x5 hf y24fe ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">bar(</span></span><span class="fc7">2</span><span class="ls33">,<span class="fc7 ls0 ws13a">3</span>)<span class="ffa fcd ls0 ws4"># Prints Bar 1: 2 3</span></span></div><div class="t m0 x5 hf y24ff ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">bar(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">hello</span><span class="ls0 ws13b">&apos;</span></span><span class="ls33">)<span class="ffa fcd ls0 ws4"># Prints Bar 2: hello 0</span></span></div><div class="t m0 x0 h9 y2500 ff1 fs3 fc0 sc0 ls0">下面是我们第一步的尝试，使用到了一个元类和描述器：</div><div class="t m0 x5 h11 y2501 ffa fs5 fcd sc0 ls0 ws4"># multiple.py</div><div class="t m0 x5 h10 y2502 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">inspect</span></div><div class="t m0 x5 h10 y2503 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">types</span></div><div class="t m0 x5 hf y2504 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">MultiMethod<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h15 y2505 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y2506 ffa fs5 fc9 sc0 ls0 ws4">Represents a single multimethod.</div><div class="t m0 x15 h15 y2507 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y2508 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name):</span></span></span></div><div class="t m0 x16 hf y2509 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">_methods </span><span class="ls32">=</span><span class="fc0">{}</span></span></div><div class="t m0 x16 hf y250a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">__name__ </span><span class="ls32">=</span><span class="fc0">name</span></span></div><div class="t m0 x15 hf y250b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">register<span class="fc0">(<span class="fca">self</span><span class="ws4">, meth):</span></span></span></div><div class="t m0 x16 h15 y21a2 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y250c ffa fs5 fc9 sc0 ls0 ws4">Register a new method as a multimethod</div><div class="t m0 x16 h15 y250d ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y250e ff8 fs5 fc0 sc0 ls0 ws158">sig <span class="fc6 ls32">=</span><span class="ws13a">inspect<span class="fc6 ls34">.</span>signature(meth)</span></div><div class="t m0 x16 h11 y250f ffa fs5 fcd sc0 ls0 ws4"># Build a type signature from the method<span class="ffb ls34">&apos;</span><span class="ws13b">s annotations</span></div><div class="t m0 x16 hf y2510 ff8 fs5 fc0 sc0 ls0 ws15f">types <span class="fc6 ls33">=</span>[]</div><div class="t m0 x16 hf y2511 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, parm </span><span class="ws157">in <span class="ff8 fc0 ws13a">sig<span class="fc6 ls34">.</span>parameters<span class="fc6 ls34">.</span>items():</span></span></div><div class="t m0 x17 hf y2512 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">name <span class="fc6 ws159">== <span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">self</span><span class="ls34">&apos;</span></span></span>:</span></div><div class="t m0 x18 h10 y2513 ff7 fs5 fca sc0 ls0">continue</div><div class="t m0 x17 hf y2514 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">parm<span class="fc6 ls34">.</span><span class="ws2a3">annotation </span></span>is <span class="ff8 fc0 ws13a">inspect<span class="fc6 ls34">.</span>Parameter<span class="fc6 ls34">.</span>empty:</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.20.<span class="_ _5"> </span>9.20 <span class="ff1 wsc0a">利用函数注解实现方法重载 </span>345</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
