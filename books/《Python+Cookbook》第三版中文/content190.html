<div id="pfbe" class="pf w0 h0" data-page-no="be"><div class="pc pcbe w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgbe.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x17 hf y1ab ff8 fs5 fc0 sc0 ls0 ws13b">&lt;current_activity&gt;Final Outcome&lt;/current_activity&gt;</div><div class="t m0 x17 hf y1ac ff8 fs5 fc0 sc0 ls0 ws4">&lt;most_recent_action&gt;CDOT Street Cut ... Outcome&lt;/most_recent_action&gt;</div><div class="t m0 x17 hf y1ad ff8 fs5 fc0 sc0 ls0 ws4">&lt;street_address&gt;3510 W NORTH AVE&lt;/street_address&gt;</div><div class="t m0 x17 hf y1ae ff8 fs5 fc0 sc0 ls0">&lt;zip&gt;60647&lt;/zip&gt;</div><div class="t m0 x17 hf y1af ff8 fs5 fc0 sc0 ls0">&lt;x_coordinate&gt;1152732.14127696&lt;/x_coordinate&gt;</div><div class="t m0 x17 hf y1b0 ff8 fs5 fc0 sc0 ls0">&lt;y_coordinate&gt;1910409.38979075&lt;/y_coordinate&gt;</div><div class="t m0 x17 hf y355 ff8 fs5 fc0 sc0 ls0">&lt;ward&gt;26&lt;/ward&gt;</div><div class="t m0 x17 hf y410 ff8 fs5 fc0 sc0 ls0">&lt;police_district&gt;14&lt;/police_district&gt;</div><div class="t m0 x17 hf y411 ff8 fs5 fc0 sc0 ls0">&lt;community_area&gt;23&lt;/community_area&gt;</div><div class="t m0 x17 hf yba ff8 fs5 fc0 sc0 ls0">&lt;latitude&gt;41.91002084292946&lt;/latitude&gt;</div><div class="t m0 x17 hf y8c6 ff8 fs5 fc0 sc0 ls0">&lt;longitude&gt;-87.71435952353961&lt;/longitude&gt;</div><div class="t m0 x17 hf ybed ff8 fs5 fc0 sc0 ls0 ws13b">&lt;location latitude=&quot;41.91002084292946&quot;</div><div class="t m0 x17 hf ybee ff8 fs5 fc0 sc0 ls0 ws13b">longitude=&quot;-87.71435952353961&quot; /&gt;</div><div class="t m0 x16 hf ybef ff8 fs5 fc0 sc0 ls0">&lt;/row&gt;</div><div class="t m0 x15 hf ybf0 ff8 fs5 fc0 sc0 ls0">&lt;/row&gt;</div><div class="t m0 x5 hf yd7d ff8 fs5 fc0 sc0 ls0">&lt;/response&gt;</div><div class="t m0 x0 h9 y14bc ff1 fs3 fc0 sc0 ls0">假设你想写一个脚本来按照坑洼报告数量排列邮编号码。你可以像这样做：</div><div class="t m0 x5 hf y14bd ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws7d9">xml.etree.ElementTree </span><span class="ws146">import <span class="ff8 fc0">parse</span></span></div><div class="t m0 x5 hf y14be ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">Counter</span></span></div><div class="t m0 x5 hf y14bf ff8 fs5 fc0 sc0 ls0 ws151">potholes_by_zip <span class="fc6 ls32">=</span>Counter()</div><div class="t m0 x5 hf y14c0 ff8 fs5 fc0 sc0 ls0 ws158">doc <span class="fc6 ls32">=</span><span class="ws13a">parse(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">potholes.xml<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y14c1 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws155">pothole </span><span class="ws157">in <span class="ff8 fc0 ws13a">doc<span class="fc6 ls34">.</span>iterfind(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">row/row<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x15 hf y14c2 ff8 fs5 fc0 sc0 ls0 ws13a">potholes_by_zip[pothole<span class="fc6">.</span>findtext(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">zip<span class="ff9 ls34">&apos;</span></span><span class="ws159">)] <span class="fc6 ws1a1">+= <span class="fc7">1</span></span></span></div><div class="t m0 x5 hf y14c3 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">zipcode, num </span><span class="ws160">in <span class="ff8 fc0 ws13a">potholes_by_zip<span class="fc6 ls34">.</span>most_common():</span></span></div><div class="t m0 x15 hf y14c4 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13b">(zipcode, num)</span></div><div class="t m0 x0 h7 y14c5 ff1 fs3 fc0 sc0 ls0 ws811">这个脚本<span class="_ _6"></span>唯一的问题<span class="_ _6"></span>是它会先将<span class="_ _6"></span>整个 <span class="ff4 ws7e5">XML </span><span class="wsa0">文件加载<span class="_ _6"></span>到内存中然<span class="_ _6"></span>后解析。在我<span class="_ _6"></span>的机</span></div><div class="t m0 x5 h7 y627 ff1 fs3 fc0 sc0 ls1f ws812">器上，为了运行这个程序需要用到 <span class="ff4 ls0 ws813">450MB </span><span class="ws113">左右的内存空间。如果使用如下代码，程序</span></div><div class="t m0 x5 h9 y14c6 ff1 fs3 fc0 sc0 ls0">只需要修改一点点：</div><div class="t m0 x5 hf y14c7 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">Counter</span></span></div><div class="t m0 x5 hf y14c8 ff8 fs5 fc0 sc0 ls0 ws151">potholes_by_zip <span class="fc6 ls32">=</span>Counter()</div><div class="t m0 x5 hf y1396 ff8 fs5 fc0 sc0 ls0 ws13c">data <span class="fc6 ls32">=</span><span class="ws13a">parse_and_remove(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">potholes.xml<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">row/row<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y14c9 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws155">pothole </span><span class="ws157">in <span class="ff8 fc0">data:</span></span></div><div class="t m0 x15 hf y14ca ff8 fs5 fc0 sc0 ls0 ws13a">potholes_by_zip[pothole<span class="fc6">.</span>findtext(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">zip<span class="ff9 ls34">&apos;</span></span><span class="ws159">)] <span class="fc6 ws1a1">+= <span class="fc7">1</span></span></span></div><div class="t m0 x5 hf y14cb ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">zipcode, num </span><span class="ws160">in <span class="ff8 fc0 ws13a">potholes_by_zip<span class="fc6 ls34">.</span>most_common():</span></span></div><div class="t m0 x15 hf y14cc ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13b">(zipcode, num)</span></div><div class="t m0 x0 h7 y14cd ff1 fs3 fc0 sc0 ls0 ws38">结果是：这个版本的代码运行时只需要 <span class="ff4 ws88">7MB </span><span class="ws63">的内存 <span class="ff4 ls6">–</span>大大节约了内存资源。</span></div><div class="t m0 x5 he y14ce ff2 fs2 fc4 sc0 ls0 ws135">8.4.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y14cf ff1 fs3 fc0 sc0 ls0 ws814">这一节的技术会依赖 <span class="ff6 ws815">ElementTree </span><span class="wsa0">模块中的两个核心功能。<span class="_ _c"></span>第一，<span class="_ _c"></span><span class="ff6 ws815">iterparse() <span class="ff1">方</span></span></span></div><div class="t m0 x5 h7 y14d0 ff1 fs3 fc0 sc0 ls0 ws816">法<span class="_ _6"></span>允<span class="_ _6"></span>许<span class="_ _6"></span>对 <span class="ff4 ws817">XML </span><span class="wsa0">文档<span class="_ _6"></span>进<span class="_ _6"></span>行<span class="_ _6"></span>增<span class="_ _6"></span>量<span class="_ _6"></span>操<span class="_ _6"></span>作。<span class="_ _6"></span>使<span class="_ _6"></span>用<span class="_ _6"></span>时，<span class="_ _6"></span>你<span class="_ _6"></span>需<span class="_ _6"></span>要<span class="_ _6"></span>提<span class="_ _6"></span>供<span class="_ _6"></span>文<span class="_ _6"></span>件<span class="_ _6"></span>名<span class="_ _6"></span>和一<span class="_ _6"></span>个<span class="_ _6"></span>包<span class="_ _6"></span>含<span class="_ _6"></span>下<span class="_ _6"></span>面<span class="_ _6"></span>一<span class="_ _6"></span>种</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">8.4.<span class="_ _5"> </span>6.4 <span class="ff1 ws36c">增量式解析大型 </span><span class="ws80a">XML <span class="ff1 ws80b">文件 </span>181</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
