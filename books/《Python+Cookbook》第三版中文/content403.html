<div id="pf193" class="pf w0 h0" data-page-no="193"><div class="pc pc193 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg193.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h9 y2a ff6 fs3 fc0 sc0 ls0 wse3b">PostImportLoader <span class="ff1 wse3c">类中的 </span><span class="wse3d">imp.import<span class="_ _7"> </span>module() <span class="ff1 wsa0">函数被递归的调用。<span class="_ _c"></span>为了避免陷入无</span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0 wsa0">线循环，<span class="ff6 wse3e">PostImportFinder </span>保<span class="_ _6"></span>持了一个<span class="_ _6"></span>所有被加<span class="_ _6"></span>载过的模<span class="_ _6"></span>块集合。如<span class="_ _6"></span>果一个模<span class="_ _6"></span>块名存</div><div class="t m0 x5 h9 y2c ff1 fs3 fc0 sc0 ls0">在就会直接被忽略掉。</div><div class="t m0 x0 h7 y99 ff1 fs3 fc0 sc0 lse wse3f">当一个模块被 <span class="ff6 ls0 ws507">imp.import module() </span><span class="wse40">加载后，所有在 <span class="ff4 ls0 wse41">p<span class="_ _6"></span>ost imp<span class="_ _6"></span>ort<span class="_ _7"> </span>ho<span class="_ _6"></span>oks <span class="ff1 wsa0">被注<span class="_ _6"></span>册的</span></span></span></div><div class="t m0 x5 h9 y9a ff1 fs3 fc0 sc0 ls0">处理器被调用，使用新加载模块作为一个参数。</div><div class="t m0 x0 h9 y30 ff1 fs3 fc0 sc0 ls2c wse42">有一点需要注意的是本机不适用于那些通过 <span class="ff6 ls0 ws1de">imp.reload() <span class="ff1 wsa0">被显<span class="_ _6"></span>式加载<span class="_ _6"></span>的模块。<span class="_ _6"></span>也</span></span></div><div class="t m0 x5 h9 y31 ff1 fs3 fc0 sc0 ls16 wsf3">就是说<span class="_ _c"></span>，如果你加载一个之前已被加载过的模块<span class="_ _1"></span>，那么导入处理器将不会再被触发<span class="_ _1"></span>。<span class="_ _c"></span></div><div class="t m0 x5 h7 y32 ff1 fs3 fc0 sc0 ls0 ws38">另外，要是你从 <span class="ff4 wse43">sys.mo<span class="_ _6"></span>dules </span>中删除模块然后再重新导入，处理器又会再一次触发。</div><div class="t m0 x0 h7 y278c ff1 fs3 fc0 sc0 ls0 ws14">更多关于导入后钩子信息请参考 <span class="ff4 fc3 wsd0">PEP 369<span class="fc0">.</span></span></div><div class="t m0 x5 hd y292b ff2 fs4 fc4 sc0 ls0 wsd91">12.13<span class="_ _e"> </span>10.13 <span class="ff1">安装私有的包</span></div><div class="t m0 x5 he y292c ff2 fs2 fc4 sc0 ls0 wsadf">12.13.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y181e ff1 fs3 fc0 sc0 ls0 wse44">你<span class="_ _6"></span>想<span class="_ _6"></span>要<span class="_ _6"></span>安<span class="_ _6"></span>装<span class="_ _6"></span>一<span class="_ _6"></span>个<span class="_ _6"></span>第<span class="_ _6"></span>三<span class="_ _6"></span>方<span class="_ _6"></span>包，<span class="_ _6"></span>但<span class="_ _6"></span>是<span class="_ _6"></span>没有<span class="_ _6"></span>权<span class="_ _6"></span>限<span class="_ _6"></span>将<span class="_ _6"></span>它<span class="_ _6"></span>安<span class="_ _6"></span>装<span class="_ _6"></span>到<span class="_ _6"></span>系<span class="_ _6"></span>统 <span class="ff4 wse45">Python </span><span class="wsa0">库<span class="_ _6"></span>中<span class="_ _6"></span>去。<span class="_ _6"></span>或<span class="_ _6"></span>者，</span></div><div class="t m0 x5 h9 y292d ff1 fs3 fc0 sc0 ls0">你可能想要安装一个供自己使用的包，而不是系统上面所有用户。</div><div class="t m0 x5 he ydf3 ff2 fs2 fc4 sc0 ls0 wsadf">12.13.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y292e ff4 fs3 fc0 sc0 ls0 ws886">Python <span class="ff1 ls68 ws23f">有一个用户安装目录，通常类似</span><span class="wsa5">”<span class="fff ls1c0">˜</span>/.local/<span class="_ _6"></span>lib/p<span class="_ _1"></span>ython3.3/site-packages”<span class="ff1 wsa0">。要</span></span></div><div class="t m0 x5 h7 y292f ff1 fs3 fc0 sc0 ls0 wsa0">强制在这个目录中安装包，可使用安装选项“<span class="ff4 wsa5">–user</span>”<span class="_ _31"></span>。例如：</div><div class="t m0 x5 hf y2930 ff8 fs5 fc0 sc0 ls0 ws4">python3 setup<span class="fc6 ls34">.</span>py install <span class="fc6 ls34">--</span>user</div><div class="t m0 x0 h9 y2931 ff1 fs3 fc0 sc0 ls0">或者</div><div class="t m0 x5 hf y2932 ff8 fs5 fc0 sc0 ls0 ws4">pip install <span class="fc6 ws13a">--</span>user packagename</div><div class="t m0 x0 h7 y2933 ff1 fs3 fc0 sc0 ls124">在<span class="ff4 ls0 wse46">sys.path </span><span class="ls6b ws28f">中用户的“</span><span class="ff4 ls0 wsa5">site-pac<span class="_ _c"></span>kages<span class="ff1 wsa0">”<span class="_ _6"></span>目录<span class="_ _6"></span>位<span class="_ _6"></span>于系<span class="_ _6"></span>统<span class="_ _6"></span>的“</span>site-packages<span class="ff1 wsa0">”目<span class="_ _6"></span>录之<span class="_ _6"></span>前。</span></span></div><div class="t m0 x5 h9 y2139 ff1 fs3 fc0 sc0 ls1e ws111">因此<span class="_ _1"></span>，你安装在里面的包就比系统已安装的包优先级高（<span class="_ _1"></span>尽管并不总是这样<span class="_ _1"></span>，要取决</div><div class="t m0 x5 h7 y2934 ff1 fs3 fc0 sc0 ls0 ws38">于第三方包管理器，比如 <span class="ff4 wse47">distribute </span><span class="ls4">或</span><span class="ff4 wsa5">pip</span><span class="wsa0">）<span class="_ _f"></span>。</span></div><div class="t m0 x5 he y986 ff2 fs2 fc4 sc0 ls0 wsadf">12.13.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y2935 ff1 fs3 fc0 sc0 ls1ce wse48">通常包会被安装到系统的 <span class="ff4 ls0 wse49">site-pac<span class="_ _1"></span>kages <span class="ff1 wsa0">目<span class="_ _24"></span>录<span class="_ _12"></span>中<span class="_ _24"></span>去，<span class="_ _24"></span>路<span class="_ _24"></span>径<span class="_ _12"></span>类<span class="_ _24"></span>似<span class="_ _24"></span>“/<span class="_ _12"></span>usr/<span class="_ _12"></span>local/<span class="_ _12"></span>lib/</span></span></div><div class="t m0 x5 h7 y1e10 ff1 fs3 fc0 sc0 ls0 wse4a">python3.3/<span class="_ _6"></span>site-packages”<span class="_ _31"></span>。<span class="_ _6"></span>不<span class="_ _6"></span>过，<span class="_ _6"></span>这<span class="_ _6"></span>样<span class="_ _6"></span>做<span class="_ _6"></span>需<span class="_ _6"></span>要<span class="_ _6"></span>有<span class="_ _6"></span>管<span class="_ _6"></span>理<span class="_ _6"></span>员<span class="_ _6"></span>权<span class="_ _6"></span>限<span class="_ _6"></span>并<span class="_ _6"></span>且<span class="_ _6"></span>使<span class="_ _6"></span>用 <span class="ff4 wse4b">sudo </span><span class="wsa0">命<span class="_ _6"></span>令。<span class="_ _6"></span>就</span></div><div class="t m0 x5 h7 y2936 ff1 fs3 fc0 sc0 ls82 wsa2c">算你有这样的权限去执行命令，使用 <span class="ff4 ls0 wse4c">sudo </span><span class="ws2f9">去安装一个新的，可能没有被验证过的包有</span></div><div class="t m0 x5 h9 y2937 ff1 fs3 fc0 sc0 ls0">时候也不安全。</div><div class="t m0 x0 h9 y95 ff1 fs3 fc0 sc0 ls0">安装包到用户目录中通常是一个有效的方案，它允许你创建一个自定义安装。</div><div class="t m0 x0 h9 y96 ff1 fs3 fc0 sc0 ls0">另外，你还可以创建一个虚拟环境，这个我们在下一节会讲到。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.13.<span class="_ _5"> </span>10.13 <span class="ff1 wse4d">安装私有的包 </span>394</div><a class="l" href="https://www.python.org/dev/peps/pep-0369"><div class="d m1" style="border-style:none;position:absolute;left:394.792500px;bottom:926.028000px;width:45.358000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
