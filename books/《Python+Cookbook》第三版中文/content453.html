<div id="pf1c5" class="pf w0 h0" data-page-no="1c5"><div class="pc pc1c5 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1c5.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y15f ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">IOTask<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y160 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">terminate<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y956 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws16d">_running </span><span class="ls32">=</span></span>False</div><div class="t m0 x15 hf y958 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, sock):</span></span></span></div><div class="t m0 x16 h11 y959 ffa fs5 fcd sc0 ls0 ws4"># sock is a socket</div><div class="t m0 x16 hf y95a ff8 fs5 fc0 sc0 ls0 ws13a">sock<span class="fc6">.</span>settimeout(<span class="fc7 ls34">5</span><span class="ls1fd">)</span><span class="ffa fcd ws4"># Set timeout period</span></div><div class="t m0 x16 hf y95b ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_running:</span></span></div><div class="t m0 x17 h11 y95c ffa fs5 fcd sc0 ls0 ws4"># Perform a blocking I/O operation w/ timeout</div><div class="t m0 x17 hf y9f3 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x18 hf y9f4 ff8 fs5 fc0 sc0 ls0 ws161">data <span class="fc6 ls33">=</span><span class="ws13a">sock<span class="fc6">.</span>recv(<span class="fc7">8192</span>)</span></div><div class="t m0 x18 h10 y95d ff7 fs5 fca sc0 ls0">break</div><div class="t m0 x17 hf y95e ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0 ws13a">socket<span class="fc6 ls34">.</span>timeout:</span></div><div class="t m0 x18 h10 ybb7 ff7 fs5 fca sc0 ls0">continue</div><div class="t m0 x17 h11 ybb8 ffa fs5 fcd sc0 ls0 ws13b"># Continued processing</div><div class="t m0 x17 hf ybb9 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x16 h11 ybba ffa fs5 fcd sc0 ls0 ws13b"># Terminated</div><div class="t m0 x16 h10 ybbb ff7 fs5 fca sc0 ls0">return</div><div class="t m0 x5 he y2da0 ff2 fs2 fc4 sc0 ls0 ws212">14.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y2da1 ff1 fs3 fc0 sc0 ls0 wsa0">由于全局解释锁<span class="_ _1"></span>（<span class="ff4 wsa5">GIL</span>）<span class="_ _1"></span>的原因，<span class="_ _1"></span><span class="ff4 ws1061">Python <span class="ff1">的线程被限制到同一时刻只允许一个线程</span></span></div><div class="t m0 x5 h7 y2da2 ff1 fs3 fc0 sc0 ls0 wsa0">执行这样一个执行模型。所以，<span class="ff4 ws1062">Python </span><span class="ls1f ws1063">的线程更适用于处理 </span><span class="ff4 ws72d">I/O </span>和其他需要并发执行</div><div class="t m0 x5 h7 y2da3 ff1 fs3 fc0 sc0 ls0 ws1064">的阻塞操作（比如等待 <span class="ff4 wsa5">I/O</span><span class="ls1f ws113">、等待从数据库获取数据等等）<span class="_ _f"></span>，而不是需要多处理器并行</span></div><div class="t m0 x5 h9 y2da4 ff1 fs3 fc0 sc0 ls0">的计算密集型任务。</div><div class="t m0 x0 h9 y2da5 ff1 fs3 fc0 sc0 ls0 ws14">有时你会看到下边这种通过继承 <span class="ff6 ws3ce">Thread </span>类来实现的线程：</div><div class="t m0 x5 hf y2da6 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">threading </span><span class="ws146">import <span class="ff8 fc0">Thread</span></span></div><div class="t m0 x5 hf y203 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">CountdownThread<span class="ff8 fc0">(Thread):</span></span></div><div class="t m0 x15 hf y1323 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, n):</span></span></span></div><div class="t m0 x16 hf y1324 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__init__()</span></div><div class="t m0 x16 hf y1325 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">n</span><span class="ls32">=</span><span class="fc7">0</span></span></div><div class="t m0 x15 hf y2da7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1327 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.<span class="fc0 ls32">n</span><span class="ls33">&gt;</span></span><span class="fc7">0<span class="fc0">:</span></span></span></div><div class="t m0 x17 hf y2da8 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls32">,</span></span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">n)</span></span></div><div class="t m0 x17 hf y2da9 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">n</span><span class="ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x17 hf y2daa ff8 fs5 fc0 sc0 ls0 ws13a">time<span class="fc6">.</span>sleep(<span class="fc7">5</span>)</div><div class="t m0 x5 hf y2dab ff8 fs5 fc0 sc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">CountdownThread(<span class="fc7">5</span>)</span></div><div class="t m0 x5 hf y2dac ff8 fs5 fc0 sc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x0 h9 y2dad ff1 fs3 fc0 sc0 ls49 ws1065">尽管这样也可以工作<span class="_ _1"></span>，但这使得你的代码依赖于 <span class="ff6 ls0 ws374">threading </span><span class="ws1a6">库<span class="_ _1"></span>，所以你的这些代<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2dae ff1 fs3 fc0 sc0 ls0 ws1066">码只能在线程上下文中使用。上文所写的那些代码、函数都是与 <span class="ff6 ws1067">threading </span>库无关的，</div><div class="t m0 x5 h9 y2daf ff1 fs3 fc0 sc0 ls13 wse5">这样就使得这些代码可以被用在其他的上下文中<span class="_ _1"></span>，可能与线程有关，也可能与线程无<span class="_ _c"></span></div><div class="t m0 x5 h9 y2db0 ff1 fs3 fc0 sc0 ls0 ws14">关。比如，你可以通过 <span class="ff6 ws4f7">multiprocessing </span>模块在一个单独的进程中执行你的代码：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">14.1.<span class="_ _36"> </span>12.1 <span class="ff1 ws600">启动与停止线程 </span>444</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
