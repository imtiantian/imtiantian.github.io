<div id="pf231" class="pf w0 h0" data-page-no="231"><div class="pc pc231 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg231.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y334 ff8 fs5 fc0 sc0 ls0 ws13b">double x,y;</div><div class="t m0 x5 hf y335 ff8 fs5 fc0 sc0 ls0 ws4">} Point;</div><div class="t m0 x5 hf y337 ff8 fs5 fc0 sc0 ls0 ws4">extern double distance(Point *p1, Point *p2);</div><div class="t m0 x0 h9 y2db1 ff1 fs3 fc0 sc0 ls0 wsa0">通常来讲，这个头文件<span class="_ _6"></span>要对应一个已经被单独编<span class="_ _6"></span>译过的库。有了这些，下面<span class="_ _6"></span>我们演</div><div class="t m0 x5 h9 y22a5 ff1 fs3 fc0 sc0 ls0">示下编写扩展函数的一个简单例子：</div><div class="t m0 x5 hf y10b1 ff8 fs5 fc0 sc0 ls0 ws4">#include &quot;Python.h&quot;</div><div class="t m0 x5 hf y10b2 ff8 fs5 fc0 sc0 ls0 ws4">#include &quot;sample.h&quot;</div><div class="t m0 x5 hf y3637 ff8 fs5 fc0 sc0 ls0 ws4">/* int gcd(int, int) */</div><div class="t m0 x5 hf y3638 ff8 fs5 fc0 sc0 ls0 ws4">static PyObject *py_gcd(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y3639 ff8 fs5 fc0 sc0 ls0 ws4">int x, y, result;</div><div class="t m0 x19 hf y363a ff8 fs5 fc0 sc0 ls0 ws4">if (!PyArg_ParseTuple(args,&quot;ii&quot;, &amp;x, &amp;y)) {</div><div class="t m0 x15 hf y82 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y223b ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y223c ff8 fs5 fc0 sc0 ls0 ws4">result = gcd(x,y);</div><div class="t m0 x19 hf y223d ff8 fs5 fc0 sc0 ls0 ws4">return Py_BuildValue(&quot;i&quot;, result);</div><div class="t m0 x5 hf y223e ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y363b ff8 fs5 fc0 sc0 ls0 ws4">/* int in_mandel(double, double, int) */</div><div class="t m0 x5 hf y363c ff8 fs5 fc0 sc0 ls0 ws4">static PyObject *py_in_mandel(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y363d ff8 fs5 fc0 sc0 ls0 ws4">double x0, y0;</div><div class="t m0 x19 hf y363e ff8 fs5 fc0 sc0 ls0 ws4">int n;</div><div class="t m0 x19 hf y363f ff8 fs5 fc0 sc0 ls0 ws4">int result;</div><div class="t m0 x19 hf y3640 ff8 fs5 fc0 sc0 ls0 ws4">if (!PyArg_ParseTuple(args, &quot;ddi&quot;, &amp;x0, &amp;y0, &amp;n)) {</div><div class="t m0 x15 hf y346 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y347 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3641 ff8 fs5 fc0 sc0 ls0 ws4">result = in_mandel(x0,y0,n);</div><div class="t m0 x19 hf y3642 ff8 fs5 fc0 sc0 ls0 ws4">return Py_BuildValue(&quot;i&quot;, result);</div><div class="t m0 x5 hf y232c ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y3643 ff8 fs5 fc0 sc0 ls0 ws4">/* int divide(int, int, int *) */</div><div class="t m0 x5 hf y3644 ff8 fs5 fc0 sc0 ls0 ws4">static PyObject *py_divide(PyObject *self, PyObject *args) {</div><div class="t m0 x19 hf y3645 ff8 fs5 fc0 sc0 ls0 ws4">int a, b, quotient, remainder;</div><div class="t m0 x19 hf y3646 ff8 fs5 fc0 sc0 ls0 ws4">if (!PyArg_ParseTuple(args, &quot;ii&quot;, &amp;a, &amp;b)) {</div><div class="t m0 x15 hf y3647 ff8 fs5 fc0 sc0 ls0 ws13b">return NULL;</div><div class="t m0 x19 hf y3648 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x19 hf y3649 ff8 fs5 fc0 sc0 ls0 ws4">quotient = divide(a,b, &amp;remainder);</div><div class="t m0 x19 hf y364a ff8 fs5 fc0 sc0 ls0 ws4">return Py_BuildValue(&quot;(ii)&quot;, quotient, remainder);</div><div class="t m0 x5 hf y364b ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y364c ff8 fs5 fc0 sc0 ls0 ws4">/* Module method table */</div><div class="t m0 x5 hf y364d ff8 fs5 fc0 sc0 ls0 ws4">static PyMethodDef SampleMethods[] = {</div><div class="t m0 x19 hf y364e ff8 fs5 fc0 sc0 ls0 ws4">{&quot;gcd&quot;,<span class="_ _29"> </span>py_gcd, METH_VARARGS, &quot;Greatest common divisor&quot;},</div><div class="t m0 x19 hf y364f ff8 fs5 fc0 sc0 ls0 ws4">{&quot;in_mandel&quot;, py_in_mandel, METH_VARARGS, &quot;Mandelbrot test&quot;},</div><div class="t m0 x19 hf y3650 ff8 fs5 fc0 sc0 ls0 ws4">{&quot;divide&quot;, py_divide, METH_VARARGS, &quot;Integer division&quot;},</div><div class="t m0 x19 hf y3651 ff8 fs5 fc0 sc0 ls0 ws4">{ NULL, NULL, 0, NULL}</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.2.<span class="_ _36"> </span>15.2 <span class="ff1 ws36c">简单的 </span><span class="ls246">C</span><span class="ff1 ws13a5">扩展模块 </span>552</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
