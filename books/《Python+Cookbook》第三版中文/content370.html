<div id="pf172" class="pf w0 h0" data-page-no="172"><div class="pc pc172 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg172.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 wsa0">现在，你是不是想为你<span class="_ _6"></span>所有的函数都加上这个<span class="_ _6"></span>装饰器呢？或许不会。但是，<span class="_ _6"></span>这却是</div><div class="t m0 x5 h7 y2b ff1 fs3 fc0 sc0 ls0 ws14">对于一些高级技术比如 <span class="ff4 ws5d">AST </span>操作、源码操作等等的一个很好的演示说明</div><div class="t m0 x0 h7 y8dd ff1 fs3 fc0 sc0 ls40 wsce4">本节受另外一个在 <span class="ff6 ls0 wsce5">ActiveState </span><span class="wsce6">中处理 <span class="ff4 ls0 wsb5c">Python </span><span class="wsce7">字节码的章节的启示<span class="_ _1"></span>。使用 <span class="ff4 ls0">AST</span></span></span></div><div class="t m0 x5 h9 y99 ff1 fs3 fc0 sc0 ls0">是一个更加高级点的技术，并且也更简单些。参考下面一节获得字节码的更多信息。</div><div class="t m0 x5 hd y264e ff2 fs4 fc4 sc0 ls0 ws211">11.25<span class="_ _e"> </span>9.25 <span class="ff1 ws165">拆解 </span><span class="wsce8">Python <span class="ff1">字节码</span></span></div><div class="t m0 x5 he y264f ff2 fs2 fc4 sc0 ls0 wsadf">11.25.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2650 ff1 fs3 fc0 sc0 ls0">你想通过将你的代码反编译成低级的字节码来查看它底层的工作机制。</div><div class="t m0 x5 he y2651 ff2 fs2 fc4 sc0 ls0 wsadf">11.25.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y12a6 ff6 fs3 fc0 sc0 ls0 ws603">dis <span class="ff1 ws63">模块可以被用来输出任何 <span class="ff4 ws5c">Python </span>函数的反编译结果。例如：</span></div><div class="t m0 x5 hf y2652 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></span></div><div class="t m0 x5 hf y2653 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></span></div><div class="t m0 x5 hf y2654 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls0 ws13b">, n)</span></span></span></div><div class="t m0 x5 hf y13c9 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="ff8 fc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></span></div><div class="t m0 x5 hf y13ca ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Blastoff!<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 h10 y13cb ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 h10 y2655 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">dis</span></span></div><div class="t m0 x5 hf y13cc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">dis<span class="fc6 ls34">.</span>dis(countdown)</span></div><div class="t m0 x5 h10 y13cd ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y2656 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y2657 ff2 fs2 fc4 sc0 ls0 wsadf">11.25.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2286 ff1 fs3 fc0 sc0 ls51 ws1c8">当你想要知道你的程序底层的运行机制的时候，<span class="ff6 ls0 wsce9">dis </span>模块是很有用的。比如如果你</div><div class="t m0 x5 h9 y2658 ff1 fs3 fc0 sc0 ls0 ws38">想试着理解性能特征。被 <span class="ff6 ws19e">dis() </span>函数解析的原始字节码如下所示：</div><div class="t m0 x5 hf y2659 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">countdown<span class="fc6 ls34">.</span>__code__<span class="fc6 ls34">.</span>co_code</span></div><div class="t m0 x5 hf ydde ff8 fs5 fc8 sc0 ls0 ws13a">b&quot;x<span class="ff9 ls34">&apos;</span>\x00<span class="ffd ws13b">|</span>\x00\x00d\x01\x00k\x04\x00r)\x00t\x00\x00d\x02\x00<span class="ffd ws13b">|</span>\x00\x00\x83</div><div class="t m0 x5 hf y1f24 ff8 fs5 fc8 sc0 ls0 ws13a">\x02\x00\x01<span class="ffd ws13b">|</span>\x00\x00d\x03\x008}\x00\x00q\x03\x00Wt\x00\x00d\x04\x00\x83</div><div class="t m0 x5 hf y265a ff8 fs5 fc8 sc0 ls0">\x01\x00\x01d\x00\x00S&quot;</div><div class="t m0 x5 hf y265b ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y265c ff1 fs3 fc0 sc0 ls0 wscea">如果你想自己解释这段代码，<span class="_ _c"></span>你需要使用一些在 <span class="ff6 wsceb">opcode </span><span class="wsa0">模块中定义的常量。<span class="_ _1"></span>例如：</span></div><div class="t m0 x5 hf y2610 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">countdown<span class="fc6 ls34">.</span>__code__<span class="fc6 ls34">.</span>co_code</span></span></div><div class="t m0 x5 h10 y265d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">opcode</span></span></div><div class="t m0 x5 hf y265e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">opcode<span class="fc6 ls34">.</span>opname[c[<span class="fc7">0</span>]]</span></div><div class="t m0 x5 hf y265f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">opcode<span class="fc6 ls34">.</span>opname[c[<span class="fc7">0</span>]]</span></div><div class="t m0 x5 hf y2660 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">SETUP_LOOP<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y2661 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">opcode<span class="fc6 ls34">.</span>opname[c[<span class="fc7">3</span>]]</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.25.<span class="_ _5"> </span>9.25 <span class="ff1 ws16b">拆解 </span><span class="ws747">Python <span class="ff1 wscec">字节码 </span>361</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
