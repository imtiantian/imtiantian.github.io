<div id="pf152" class="pf w0 h0" data-page-no="152"><div class="pc pc152 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg152.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1e8 ff8 fs5 fc0 sc0 ls0 ws169">_spam_instance <span class="fc6 ls32">=</span><span class="fca">None</span></div><div class="t m0 x5 hf y1ea ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">Spam<span class="fc0">():</span></span></div><div class="t m0 x15 hf y903 ff7 fs5 fca sc0 ls0 ws146">global <span class="ff8 fc0">_spam_instance</span></div><div class="t m0 x15 hf y1ec ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws169">_spam_instance </span>is not <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x16 hf y904 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">_spam_instance</span></div><div class="t m0 x15 hf y905 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf y906 ff8 fs5 fc0 sc0 ls0 ws169">_spam_instance <span class="fc6 ls32">=</span>_Spam()</div><div class="t m0 x16 hf y907 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">_spam_instance</span></div><div class="t m0 x0 h9 y2372 ff1 fs3 fc0 sc0 ls3a ws153">尽管使用元类可能会涉及到比较高级点的技术，但是它的代码看起来会更加简洁舒</div><div class="t m0 x5 h9 y2373 ff1 fs3 fc0 sc0 ls0">服，而且也更加直观。</div><div class="t m0 x0 h7 y2374 ff1 fs3 fc0 sc0 ls0 ws38">更多关于创建缓存实例、弱引用等内容，请参考 <span class="ff4 ws1d0">8.25 </span>小节。</div><div class="t m0 x5 hd y2375 ff2 fs4 fc4 sc0 ls0 ws211">11.14<span class="_ _e"> </span>9.14 <span class="ff1">捕获类的属性定义顺序</span></div><div class="t m0 x5 he y2376 ff2 fs2 fc4 sc0 ls0 wsadf">11.14.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2377 ff1 fs3 fc0 sc0 ls3a ws153">你想自动记录一个类中属性和方法定义的顺序，然后可以利用它来做很多操作（比</div><div class="t m0 x5 h9 y2378 ff1 fs3 fc0 sc0 ls0 wsa0">如序列化、映射到数据库等等）<span class="_ _f"></span>。</div><div class="t m0 x5 he y2379 ff2 fs2 fc4 sc0 ls0 wsadf">11.14.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y237a ff1 fs3 fc0 sc0 ls0 wsc1b">利用元类可以很容易的捕获类的定义信息。下面是一个例子，<span class="_ _c"></span>使用了一个 <span class="ff4">Ordered-</span></div><div class="t m0 x5 h7 y237b ff4 fs3 fc0 sc0 ls0 wsc1c">Dict <span class="ff1">来记录描述器的定义顺序：</span></div><div class="t m0 x5 hf y237c ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">OrderedDict</span></span></div><div class="t m0 x5 h11 y237d ffa fs5 fcd sc0 ls0 ws4"># A set of descriptors for various types</div><div class="t m0 x5 hf y232d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Typed<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y237e ff8 fs5 fc0 sc0 ls0 ws169">_expected_type <span class="fc6 ls32">=</span><span class="fca ws13a">type</span><span class="ls34">(</span><span class="fca ws13a">None</span>)</div><div class="t m0 x15 hf y237f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name</span><span class="fc6">=<span class="fca">None</span></span>):</span></span></div><div class="t m0 x16 hf y2380 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_name </span><span class="ls32">=</span><span class="fc0">name</span></span></div><div class="t m0 x15 hf y2381 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__set__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, value):</span></span></span></div><div class="t m0 x16 hf y2382 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws155">(value, </span>self<span class="fc6 ls34">.</span><span class="fc0">_expected_type):</span></span></div><div class="t m0 x17 hf y2383 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws16d">Expected <span class="ff9 ls32">&apos;</span><span class="fc6 ls33">+</span></span></span>str<span class="fc0">(</span>self<span class="fc6 ls34">.</span><span class="fc0">_expected_type))</span></span></div><div class="t m0 x16 hf y2384 ff8 fs5 fc0 sc0 ls0 ws13a">instance<span class="fc6">.</span>__dict__[<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws145">_name] <span class="fc6 ls32">=</span>value</span></div><div class="t m0 x5 hf y2385 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Integer<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y2386 ff8 fs5 fc0 sc0 ls0 ws169">_expected_type <span class="fc6 ls32">=</span><span class="fca">int</span></div><div class="t m0 x5 hf y46c ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Float<span class="ff8 fc0">(Typed):</span></span></div><div class="t m0 x15 hf y2387 ff8 fs5 fc0 sc0 ls0 ws169">_expected_type <span class="fc6 ls32">=</span><span class="fca">float</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.14.<span class="_ _5"> </span>9.14 <span class="ff1 wsaf4">捕获类的属性定义顺序 </span>329</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
