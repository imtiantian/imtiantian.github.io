<div id="pf18e" class="pf w0 h0" data-page-no="18e"><div class="pc pc18e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg18e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Looking for</span>&apos;</span><span class="ls0 ws13b">, name)</span></span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws146">return <span class="ff8 fc0 ls34">(</span><span class="ff8 ws13a">None<span class="fc0 ws13b">, [])</span></span></span></div><div class="t m0 x5 h10 y1ad ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 h10 y1ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sys</span></span></div><div class="t m0 x5 h11 y1af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Add a &quot;debug&quot; entry to the importer cache</span></div><div class="t m0 x5 hf y1b0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path_importer_cache[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">debug<span class="ff9 ws13b">&apos;</span></span><span class="ls33">]<span class="fc6 ls32">=</span></span>Finder()</span></div><div class="t m0 x5 h11 y355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Add a &quot;debug&quot; directory to sys.path</span></div><div class="t m0 x5 hf y410 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6">.</span>insert(<span class="fc7">0</span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">debug<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h10 y411 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">threading</span></span></div><div class="t m0 x5 hf yba ff8 fs5 fc8 sc0 ls0 ws4">Looking for threading</div><div class="t m0 x5 hf y8c6 ff8 fs5 fc8 sc0 ls0 ws4">Looking for time</div><div class="t m0 x5 hf ybed ff8 fs5 fc8 sc0 ls0 ws4">Looking for traceback</div><div class="t m0 x5 hf ybee ff8 fs5 fc8 sc0 ls0 ws4">Looking for linecache</div><div class="t m0 x5 hf ybef ff8 fs5 fc8 sc0 ls0 ws4">Looking for tokenize</div><div class="t m0 x5 hf ybf0 ff8 fs5 fc8 sc0 ls0 ws4">Looking for token</div><div class="t m0 x5 hf yd7d ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y28ac ff1 fs3 fc0 sc0 ls0 wsa0">在<span class="_ _6"></span>这<span class="_ _0"></span>里，<span class="_ _6"></span>你<span class="_ _6"></span>可<span class="_ _0"></span>以<span class="_ _6"></span>为<span class="_ _6"></span>名<span class="_ _0"></span>字<span class="_ _6"></span>“<span class="ff4 wsa5">debug</span><span class="lsc8 wsde3">”创建一个新的缓存实体并将它设置成 </span><span class="ff6">sys.path</span></div><div class="t m0 x5 h9 y28ad ff1 fs3 fc0 sc0 ls1e ws111">上的第一个<span class="_ _1"></span>。在所有接下来的导入中，你会看到你的查找器被触发了<span class="_ _c"></span>。<span class="_ _6"></span>不过<span class="_ _1"></span>，由于它</div><div class="t m0 x5 h7 y28ae ff1 fs3 fc0 sc0 ls0 ws14">返回 <span class="ff4 wsd0">(None, [])</span>，那么处理进程会继续处理下一个实体。</div><div class="t m0 x0 h9 y28af ff6 fs3 fc0 sc0 ls0 ws5ed">sys.path importer cache <span class="ff1 ls49 wsde4">的使用被一个存储在 </span><span class="ws3a9">sys.path hooks<span class="_ _7"> </span><span class="ff1 ls49 ws1a6">中的函数列表控</span></span></div><div class="t m0 x5 h9 y28b0 ff1 fs3 fc0 sc0 ls0 ws14">制。试试下面的例子，它会清除缓存并给 <span class="ff6 ws17d">sys.path<span class="_ _7"> </span>hooks </span>添加一个新的路径检查函数</div><div class="t m0 x5 hf y28b1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path_importer_cache<span class="fc6">.</span>clear()</span></div><div class="t m0 x5 hf y28b2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">def <span class="ff8 fcb ws13a">check_path<span class="fc0">(path):</span></span></span></div><div class="t m0 x5 hf y28b3 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Checking<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, path)</span></span></span></span></span></div><div class="t m0 x5 hf y28b4 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws16a">raise <span class="ff8 ws13a">ImportError<span class="fc0">()</span></span></span></div><div class="t m0 x5 h10 y1221 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y28b5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sys<span class="fc6 ls34">.</span>path_hooks<span class="fc6 ls34">.</span>insert(<span class="fc7 ls34">0</span><span class="ws13b">, check_path)</span></span></div><div class="t m0 x5 h10 y45 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fib</span></span></div><div class="t m0 x5 hf y28b6 ff8 fs5 fc8 sc0 ls0 ws4">Checked debug</div><div class="t m0 x5 hf y28b7 ff8 fs5 fc8 sc0 ls0 ws4">Checking .</div><div class="t m0 x5 hf y28b8 ff8 fs5 fc8 sc0 ls0 ws4">Checking /usr/local/lib/python33.zip</div><div class="t m0 x5 hf y28b9 ff8 fs5 fc8 sc0 ls0 ws4">Checking /usr/local/lib/python3.3</div><div class="t m0 x5 hf y28ba ff8 fs5 fc8 sc0 ls0 ws4">Checking /usr/local/lib/python3.3/plat-darwin</div><div class="t m0 x5 hf y28bb ff8 fs5 fc8 sc0 ls0 ws4">Checking /usr/local/lib/python3.3/lib-dynload</div><div class="t m0 x5 hf y28bc ff8 fs5 fc8 sc0 ls0 ws4">Checking /Users/beazley/.local/lib/python3.3/site-packages</div><div class="t m0 x5 hf y28bd ff8 fs5 fc8 sc0 ls0 ws4">Checking /usr/local/lib/python3.3/site-packages</div><div class="t m0 x5 hf y28be ff8 fs5 fc8 sc0 ls0 ws4">Looking for fib</div><div class="t m0 x5 hf y28bf ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y28c0 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y28c1 ff8 fs5 fc2 sc0 ls0 ws13a">ImportError<span class="fc0 ws4">: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 hf y28c2 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y153f ff1 fs3 fc0 sc0 ls0 wsa0">正如你所见，<span class="ff6 ws2cb">check<span class="_ _16"> </span>path() </span><span class="wsde5">函数被每个 <span class="ff6 ws2c7">sys.path </span></span>中的实体调用。不顾，由于抛出</div><div class="t m0 x5 h7 y28c3 ff1 fs3 fc0 sc0 ls124">了<span class="ff6 ls0 ws37b">ImportError </span><span class="ls6b wsde6">异常，啥都不会发生了（<span class="_ _c"></span>仅仅将检查<span class="_ _6"></span>转移到 <span class="ff4 ls0 wsde7">sys.path ho<span class="_ _6"></span>oks </span><span class="ws28f">的下一个</span></span></div><div class="t m0 x5 h9 y28c4 ff1 fs3 fc0 sc0 ls0 wsa0">函数）<span class="_ _f"></span>。</div><div class="t m0 x0 h7 y28c5 ff1 fs3 fc0 sc0 ls0 ws24d">知道了怎样 <span class="ff4 wsde8">sys.path </span><span class="wsa0">是怎样被处理的，<span class="_ _1"></span>你就能构建一个自定义路径检查函数来查找</span></div><div class="t m0 x5 h7 y28c6 ff1 fs3 fc0 sc0 ls0 ws14">文件名，不然 <span class="ff4 wsa5">URL</span>。例如：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>389</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
