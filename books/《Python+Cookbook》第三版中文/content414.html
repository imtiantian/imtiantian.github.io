<div id="pf19e" class="pf w0 h0" data-page-no="19e"><div class="pc pc19e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg19e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y20bf ff1 fs3 fc0 sc0 ls0 wsecd">最<span class="_ _0"></span>后，<span class="_ _0"></span>还<span class="_ _0"></span>需<span class="_ _0"></span>要<span class="_ _0"></span>注<span class="_ _6"></span>意<span class="_ _0"></span>的<span class="_ _0"></span>是<span class="_ _0"></span>巨<span class="_ _0"></span>大<span class="_ _0"></span>部<span class="_ _0"></span>分 <span class="ff4 wsece">Python </span><span class="wsecf">的<span class="_ _0"></span>高<span class="_ _0"></span>层<span class="_ _0"></span>网<span class="_ _6"></span>络<span class="_ _0"></span>模<span class="_ _0"></span>块<span class="_ _0"></span>（比<span class="_ _0"></span>如 <span class="ff4 wsa5">HTTP</span><span class="ls1db">、</span><span class="ff4">XML-</span></span></div><div class="t m0 x5 h7 y2a19 ff4 fs3 fc0 sc0 ls0 wsed0">RPC <span class="ff1 wsed1">等）<span class="_ _1"></span>都是建立在 <span class="ff6 wsed2">socketserver </span><span class="wsed3">功能之上。<span class="_ _1"></span>也就是说，<span class="_ _1"></span>直接使用 <span class="ff6 wsed4">socket </span>库来实现</span></span></div><div class="t m0 x5 h9 y2a1a ff1 fs3 fc0 sc0 ls0 ws63">服务器也并不是很难。下面是一个使用 <span class="ff6 ws3ce">socket </span>直接编程实现的一个服务器简单例子：</div><div class="t m0 x5 hf y2a1b ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">socket <span class="fca">import <span class="ff8 fc0 ws13b">socket, AF_INET, SOCK_STREAM</span></span></span></div><div class="t m0 x5 hf y2a1c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">echo_handler<span class="fc0 ws13b">(address, client_sock):</span></span></div><div class="t m0 x15 hf y2a1d ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Got connection from {}<span class="ff9 ls34">&apos;</span></span><span class="fc6">.</span>format(address))</span></div><div class="t m0 x15 hf y2a1e ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2a1f ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="ws13a">client_sock<span class="fc6 ls34">.</span>recv(<span class="fc7">8192</span>)</span></div><div class="t m0 x16 hf y2a20 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 fc0">msg:</span></div><div class="t m0 x17 h10 y2a21 ff7 fs5 fca sc0 ls0">break</div><div class="t m0 x16 hf y292b ff8 fs5 fc0 sc0 ls0 ws13a">client_sock<span class="fc6 ls34">.</span>sendall(msg)</div><div class="t m0 x15 hf y2a22 ff8 fs5 fc0 sc0 ls0 ws13a">client_sock<span class="fc6 ls34">.</span>close()</div><div class="t m0 x5 hf y2a23 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">echo_server<span class="fc0 ws13b">(address, backlog<span class="fc6 ls34">=<span class="fc7">5</span></span>):</span></span></div><div class="t m0 x15 hf y2a24 ff8 fs5 fc0 sc0 ls0 ws13c">sock <span class="fc6 ls32">=</span><span class="ws4">socket(AF_INET, SOCK_STREAM)</span></div><div class="t m0 x15 hf y2a25 ff8 fs5 fc0 sc0 ls0 ws13a">sock<span class="fc6 ls34">.</span>bind(address)</div><div class="t m0 x15 hf y2a26 ff8 fs5 fc0 sc0 ls0 ws13a">sock<span class="fc6 ls34">.</span>listen(backlog)</div><div class="t m0 x15 hf y2a27 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2a28 ff8 fs5 fc0 sc0 ls0 ws13b">client_sock, client_addr <span class="fc6 ls32">=</span><span class="ws13a">sock<span class="fc6 ls34">.</span>accept()</span></div><div class="t m0 x16 hf y2a29 ff8 fs5 fc0 sc0 ls0 ws13b">echo_handler(client_addr, client_sock)</div><div class="t m0 x5 hf y25c0 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y2a2a ff8 fs5 fc0 sc0 ls0 ws13a">echo_server((<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls32">,</span><span class="fc7">20000</span>))</div><div class="t m0 x5 hd y2a2b ff2 fs4 fc4 sc0 ls0 ws211">13.3<span class="_ _e"> </span>11.3 <span class="ff1 ws165">创建 </span><span class="wsed5">UDP <span class="ff1">服务器</span></span></div><div class="t m0 x5 he y2a2c ff2 fs2 fc4 sc0 ls0 ws212">13.3.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y2a2d ff1 fs3 fc0 sc0 ls0 wsc">你想实现一个基于 <span class="ff4 ws54c">UDP </span>协议的服务器来与客户端通信。</div><div class="t m0 x5 he y2a2e ff2 fs2 fc4 sc0 ls0 ws212">13.3.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y2a2f ff1 fs3 fc0 sc0 ls10e">跟<span class="ff4 ls0 wsed6">TCP </span><span class="ls0 wsa0">一样，<span class="ff4 wsed7">UDP </span><span class="wsed8">服务器也可以通过使用 <span class="ff6 wsed9">socketserver </span></span>库很容<span class="_ _6"></span>易的被创建。例</span></div><div class="t m0 x5 h9 y2a30 ff1 fs3 fc0 sc0 ls0">如，下面是一个简单的时间服务器：</div><div class="t m0 x5 hf y2a31 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws96c">socketserver </span><span class="ws146">import <span class="ff8 fc0 ws4">BaseRequestHandler, UDPServer</span></span></div><div class="t m0 x5 h10 y2a32 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 hf y2a33 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">TimeHandler<span class="ff8 fc0">(BaseRequestHandler):</span></span></div><div class="t m0 x15 hf y2a34 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">handle<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y2a35 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Got connection from<span class="ff9">&apos;</span></span></span><span class="ls33">,</span></span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">client_address)</span></span></div><div class="t m0 x16 h11 y2a36 ffa fs5 fcd sc0 ls0 ws4"># Get message and client socket</div><div class="t m0 x16 hf y2a37 ff8 fs5 fc0 sc0 ls0 ws13b">msg, sock <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>request</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.3.<span class="_ _5"> </span>11.3 <span class="ff1 ws16b">创建 </span><span class="wseda">UDP <span class="ff1 wsedb">服务器 </span>405</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
