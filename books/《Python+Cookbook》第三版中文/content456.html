<div id="pf1c8" class="pf w0 h0" data-page-no="1c8"><div class="pc pc1c8 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1c8.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x17 hf y181 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ws16e">last_flag <span class="fc6 ws15c">== <span class="fca ws13a">self</span><span class="ls34">.</span></span>_flag:</span></div><div class="t m0 x18 hf y182 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_cv</span><span class="ls34">.</span><span class="fc0">wait()</span></span></div><div class="t m0 x5 h11 y184 ffa fs5 fcd sc0 ls0 ws4"># Example use of the timer</div><div class="t m0 x5 hf y185 ff8 fs5 fc0 sc0 ls0 ws145">ptimer <span class="fc6 ls33">=</span><span class="ws13a">PeriodicTimer(<span class="fc7">5</span>)</span></div><div class="t m0 x5 hf y186 ff8 fs5 fc0 sc0 ls0 ws13a">ptimer<span class="fc6 ls34">.</span>start()</div><div class="t m0 x5 h11 y188 ffa fs5 fcd sc0 ls0 ws4"># Two threads that synchronize on the timer</div><div class="t m0 x5 hf y98e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(nticks):</span></span></div><div class="t m0 x15 hf y98f ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ws145">nticks <span class="fc6 ls33">&gt;<span class="fc7 ls34">0</span></span>:</span></div><div class="t m0 x16 hf y990 ff8 fs5 fc0 sc0 ls0 ws13a">ptimer<span class="fc6 ls34">.</span>wait_for_tick()</div><div class="t m0 x16 hf y991 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls0 ws13b">, nticks)</span></span></div><div class="t m0 x16 hf y992 ff8 fs5 fc0 sc0 ls0 ws145">nticks <span class="fc6 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x5 hf ya70 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countup<span class="fc0">(last):</span></span></div><div class="t m0 x15 hf y994 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></div><div class="t m0 x15 hf y995 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&lt;</span><span class="ls0">last:</span></span></div><div class="t m0 x16 hf y996 ff8 fs5 fc0 sc0 ls0 ws13a">ptimer<span class="fc6 ls34">.</span>wait_for_tick()</div><div class="t m0 x16 hf y997 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Counting<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, n)</span></span></span></span></div><div class="t m0 x16 hf y998 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">+= <span class="fc7">1</span></span></div><div class="t m0 x5 hf y999 ff8 fs5 fc0 sc0 ls0 ws13a">threading<span class="fc6">.</span>Thread(target<span class="fc6">=</span><span class="ws4">countdown, args<span class="fc6 ls34">=<span class="fc0">(</span></span></span><span class="fc7">10</span>,))<span class="fc6 ls34">.</span>start()</div><div class="t m0 x5 hf y99a ff8 fs5 fc0 sc0 ls0 ws13a">threading<span class="fc6">.</span>Thread(target<span class="fc6">=</span><span class="ws4">countup, args<span class="fc6 ls34">=</span></span>(<span class="fc7 ls34">5</span>,))<span class="fc6 ls34">.</span>start()</div><div class="t m0 x0 h7 y2dee ff4 fs3 fc0 sc0 ls0 ws1089">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 lsa8 ws3de">对象的一个重要特点是当它被设置为真时会唤醒所有等待它的线程。如果你</span></div><div class="t m0 x5 h9 y2def ff1 fs3 fc0 sc0 lsa8 ws108a">只想唤醒单个线程，最好是使用信号量<span class="_ _1"></span>或者 <span class="ff6 ls0 ws8e5">Condition </span><span class="ws3de">对象来替代。考虑一下这段使<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2df0 ff1 fs3 fc0 sc0 ls0">用信号量实现的代码：</div><div class="t m0 x5 h11 y2df1 ffa fs5 fcd sc0 ls0 ws4"># Worker thread</div><div class="t m0 x5 hf y2df2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">worker<span class="fc0 ws4">(n, sema):</span></span></div><div class="t m0 x15 h11 y2df3 ffa fs5 fcd sc0 ls0 ws4"># Wait to be signaled</div><div class="t m0 x15 hf y2df4 ff8 fs5 fc0 sc0 ls0 ws13a">sema<span class="fc6 ls34">.</span>acquire()</div><div class="t m0 x15 h11 y1267 ffa fs5 fcd sc0 ls0 ws4"># Do some work</div><div class="t m0 x15 hf y2df5 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Working<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, n)</span></span></div><div class="t m0 x5 h11 y158e ffa fs5 fcd sc0 ls0 ws4"># Create some threads</div><div class="t m0 x5 hf y2df6 ff8 fs5 fc0 sc0 ls0 ws13c">sema <span class="fc6 ls32">=</span><span class="ws13a">threading<span class="fc6">.</span>Semaphore(<span class="fc7">0</span>)</span></div><div class="t m0 x5 hf y2df7 ff8 fs5 fc0 sc0 ls0 ws16d">nworkers <span class="fc6 ls32">=</span><span class="fc7">10</span></div><div class="t m0 x5 hf y2df8 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">n</span><span class="ws160">in <span class="ff8 ws13a">range<span class="fc0">(nworkers):</span></span></span></div><div class="t m0 x15 hf y2df9 ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">threading<span class="fc6 ls34">.</span>Thread(target<span class="fc6">=</span><span class="ws4">worker, args<span class="fc6 ls34">=</span><span class="ws13b">(n, sema,))</span></span></span></div><div class="t m0 x15 hf y805 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x0 h9 y2dfa ff1 fs3 fc0 sc0 ls3a ws153">运行上边的代码将会启动一个线程池，但是并没有什么事情发生。这是因为所有的</div><div class="t m0 x5 h9 y1b25 ff1 fs3 fc0 sc0 ls1e ws111">线程都在等待获取信号量<span class="_ _1"></span>。每次信号量被释放<span class="_ _1"></span>，只有一个线程会被唤醒并执行<span class="_ _1"></span>，示例</div><div class="t m0 x5 h9 y2dfb ff1 fs3 fc0 sc0 ls0">如下：</div><div class="t m0 x5 hf y2dfc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sema<span class="fc6 ls34">.</span>release()</span></div><div class="t m0 x5 hf y2dfd ff8 fs5 fc8 sc0 ls0 ws4">Working 0</div><div class="t m0 x5 hf y2dfe ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sema<span class="fc6 ls34">.</span>release()</span></div><div class="t m0 x5 hf y2dff ff8 fs5 fc8 sc0 ls0 ws4">Working 1</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">14.2.<span class="_ _36"> </span>12.2 <span class="ff1 ws509">判断线程是否已经启动 </span>447</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
