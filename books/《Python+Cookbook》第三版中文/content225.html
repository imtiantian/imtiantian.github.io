<div id="pfe1" class="pf w0 h0" data-page-no="e1"><div class="pc pce1 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bge1.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws135">9.6.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y236 ff1 fs3 fc0 sc0 ls0 ws699">尽管 <span class="ff4 ws93d">lambda </span><span class="ls18 ws110">表达式允许你定义简单函数，但是它的使用是有限制的。你只能指定<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y237 ff1 fs3 fc0 sc0 ls1e ws111">单个表达式<span class="_ _1"></span>，它的值就是最后的返回值<span class="_ _1"></span>。也就是说不能包含其他的语言特性了<span class="_ _1"></span>，包括</div><div class="t m0 x5 h9 y238 ff1 fs3 fc0 sc0 ls0">多个语句、条件表达式、迭代以及异常处理等等。</div><div class="t m0 x0 h7 y278 ff1 fs3 fc0 sc0 ls2d ws93e">你可以不使用 <span class="ff4 ls0 ws93f">lam<span class="_ _1"></span>b<span class="_ _6"></span>da <span class="ff1 ls2d ws940">表达式就能编写大部分 </span><span class="ws941">p<span class="_ _1"></span>ython <span class="ff1 ls2d ws132">代码。但是<span class="_ _c"></span>，当有人编写大</span></span></span></div><div class="t m0 x5 h9 y279 ff1 fs3 fc0 sc0 lsb5 ws942">量计算表达式值的短小函数或者需要用户提供回调函数的程序的时候<span class="_ _c"></span>，你就会看到<span class="_ _c"></span></div><div class="t m0 x5 h7 y27a ff4 fs3 fc0 sc0 ls0 ws271">lam<span class="_ _1"></span>b<span class="_ _6"></span>da <span class="ff1">表达式的身影了。</span></div><div class="t m0 x5 hd y187e ff2 fs4 fc4 sc0 ls0 ws134">9.7<span class="_ _e"> </span>7.7 <span class="ff1">匿名函数捕获变量值</span></div><div class="t m0 x5 he y187f ff2 fs2 fc4 sc0 ls0 ws135">9.7.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y1880 ff1 fs3 fc0 sc0 ls0 wsc">你用 <span class="ff4 ws271">lam<span class="_ _1"></span>b<span class="_ _6"></span>da <span class="ff1">定义了一个匿名函数，并想在定义时捕获到某些变量的值。</span></span></div><div class="t m0 x5 he y1881 ff2 fs2 fc4 sc0 ls0 ws135">9.7.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1882 ff1 fs3 fc0 sc0 ls0">先看下下面代码的效果：</div><div class="t m0 x5 hf y1883 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">10</span></span></span></div><div class="t m0 x5 hf y1884 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span></span><span class="fca ws146">lambda <span class="ff8 fc0 ws13b">y: x <span class="fc6 ls32">+</span>y</span></span></div><div class="t m0 x5 hf y1885 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">20</span></span></span></div><div class="t m0 x5 hf y1886 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span></span><span class="fca ws146">lambda <span class="ff8 fc0 ws13b">y: x <span class="fc6 ls32">+</span>y</span></span></div><div class="t m0 x5 hf y1887 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1888 ff1 fs3 fc0 sc0 ls0 wsa0">现在<span class="_ _6"></span>我<span class="_ _6"></span>问<span class="_ _6"></span>你，<span class="_ _6"></span><span class="ff4 ws943">a(10) </span><span class="ls153">和</span><span class="ff4 ws944">b(10) </span><span class="ls2d ws945">返回的结果是什么<span class="_ _1"></span>？如果你认为结果是 <span class="ff4 ls0 ws946">20 </span><span class="ls153">和<span class="ff4 ls0 wsa5">30<span class="ff1 wsa0">，<span class="_ _6"></span>那</span></span></span></span></div><div class="t m0 x5 h9 y1889 ff1 fs3 fc0 sc0 ls0">么你就错了：</div><div class="t m0 x5 hf y188a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a(<span class="fc7">10</span>)</span></div><div class="t m0 x5 hf y188b ff8 fs5 fc8 sc0 ls0">30</div><div class="t m0 x5 hf y8e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">b(<span class="fc7">10</span>)</span></div><div class="t m0 x5 hf y188c ff8 fs5 fc8 sc0 ls0">30</div><div class="t m0 x5 hf y188d ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y188e ff1 fs3 fc0 sc0 ls35 ws947">这其中的奥妙在于 <span class="ff4 ls0 ws948">lam<span class="_ _1"></span>b<span class="_ _6"></span>da <span class="ff1 ls35 ws949">表达式中的 </span><span class="ls154">x<span class="ff1 ls35 ws144">是一个自由变量，在运行时绑定值，而不</span></span></span></div><div class="t m0 x5 h7 y188f ff1 fs3 fc0 sc0 ls0 ws94a">是定义时就绑定，这跟函数的默认值参数定义是不同的。<span class="_ _1"></span>因此，在调用这个 <span class="ff4 ws94b">lam<span class="_ _c"></span>b<span class="_ _6"></span>da <span class="ff1">表</span></span></div><div class="t m0 x5 h7 y1890 ff1 fs3 fc0 sc0 ls0 wsa0">达式的时候，<span class="ff4 ls155">x</span>的值是执行时的值。例如：</div><div class="t m0 x5 hf y1891 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">15</span></span></span></div><div class="t m0 x5 hf y1892 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a(<span class="fc7">10</span>)</span></div><div class="t m0 x5 hf y1893 ff8 fs5 fc8 sc0 ls0">25</div><div class="t m0 x5 hf y1894 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">3</span></span></span></div><div class="t m0 x5 hf y1895 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a(<span class="fc7">10</span>)</span></div><div class="t m0 x5 hf y1896 ff8 fs5 fc8 sc0 ls0">13</div><div class="t m0 x5 hf y1897 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">9.7.<span class="_ _5"> </span>7.7 <span class="ff1 ws666">匿名函数捕获变量值 </span>216</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
