<div id="pf199" class="pf w0 h0" data-page-no="199"><div class="pc pc199 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg199.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x3c hf y15f ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">name2</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">value2<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y160 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 h11 y957 ffa fs5 fcd sc0 ls0 ws4"># Extra headers</div><div class="t m0 x5 hf y958 ff8 fs5 fc0 sc0 ls0 ws155">headers <span class="fc6 ls32">=</span>{</div><div class="t m0 x15 hf y959 ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">User-agent</span><span class="ls32">&apos;<span class="ff8 fc0 ls33">:</span></span>&apos;<span class="ff8 ls0 ws13a">none/ofyourbusiness</span>&apos;<span class="ff8 fc0 ls0">,</span></div><div class="t m0 x15 hf y95a ff9 fs5 fc9 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">Spam</span><span class="ls32">&apos;<span class="ff8 fc0">:</span></span>&apos;<span class="ff8 ls0 ws13a">Eggs<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y95b ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y9f3 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">requests<span class="fc6 ls34">.</span><span class="ws13b">post(url, data<span class="fc6 ls34">=</span>parms, headers</span><span class="fc6">=</span>headers)</span></div><div class="t m0 x5 h11 y95d ffa fs5 fcd sc0 ls0 ws4"># Decoded text returned by the request</div><div class="t m0 x5 hf y95e ff8 fs5 fc0 sc0 ls0 ws13c">text <span class="fc6 ls32">=</span><span class="ws13a">resp<span class="fc6 ls34">.</span>text</span></div><div class="t m0 x0 h7 y2997 ff1 fs3 fc0 sc0 ls0 ws1bc">关于 <span class="ff4 wse88">requests </span><span class="wsa0">库，一个值得一提的特性就是它能以多种方式从请求中返回响应结果</span></div><div class="t m0 x5 h7 y1db2 ff1 fs3 fc0 sc0 ls0 wse89">的<span class="_ _6"></span>内<span class="_ _6"></span>容。<span class="_ _6"></span>从<span class="_ _6"></span>上<span class="_ _6"></span>面<span class="_ _6"></span>的<span class="_ _6"></span>代<span class="_ _6"></span>码<span class="_ _0"></span>来看， <span class="ff6 wse8a">resp.text </span><span class="lsa5 wse8b">带给我们的是以 </span><span class="ff4 wse8c">Unico<span class="_ _6"></span>de </span><span class="wsa0">解<span class="_ _6"></span>码<span class="_ _0"></span>的响<span class="_ _6"></span>应<span class="_ _6"></span>文<span class="_ _0"></span>本。</span></div><div class="t m0 x5 h9 y6d6 ff1 fs3 fc0 sc0 ls0 wse8d">但是，如果去访问 <span class="ff6 ws8d9">resp.content </span><span class="wsa0">，<span class="_ _1"></span>就会得到原始的二进制数据。另一方面，<span class="_ _1"></span>如果访问</span></div><div class="t m0 x5 h7 y2998 ff6 fs3 fc0 sc0 ls0 ws1d1">resp.json <span class="ff1 ws38">，那么就会得到 <span class="ff4 ws5f">JSON </span>格式的响应内容。</span></div><div class="t m0 x0 h7 y2999 ff1 fs3 fc0 sc0 ls0 wse8e">下<span class="_ _0"></span>面<span class="_ _0"></span>这<span class="_ _0"></span>个<span class="_ _0"></span>示<span class="_ _0"></span>例<span class="_ _0"></span>利<span class="_ _0"></span>用 <span class="ff6 wse8f">requests </span><span class="wse90">库<span class="_ _6"></span>发<span class="_ _0"></span>起<span class="_ _0"></span>一<span class="_ _0"></span>个 <span class="ff4 wse91">HEAD </span><span class="wsa0">请<span class="_ _0"></span>求，<span class="_ _0"></span>并<span class="_ _0"></span>从<span class="_ _0"></span>响<span class="_ _0"></span>应<span class="_ _0"></span>中<span class="_ _0"></span>提<span class="_ _0"></span>取<span class="_ _0"></span>出<span class="_ _0"></span>一<span class="_ _0"></span>些</span></span></div><div class="t m0 x5 h7 y299a ff4 fs3 fc0 sc0 ls0 ws86">HTTP <span class="ff1">头数据的字段：</span></div><div class="t m0 x5 h10 y299b ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">requests</span></div><div class="t m0 x5 hf y299c ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">requests<span class="fc6 ls34">.</span>head(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">http://www.python.org/index.html<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y299d ff8 fs5 fc0 sc0 ls0 ws145">status <span class="fc6 ls33">=</span><span class="ws13a">resp<span class="fc6 ls34">.</span>status_code</span></div><div class="t m0 x5 hf y299e ff8 fs5 fc0 sc0 ls0 ws147">last_modified <span class="fc6 ls33">=</span><span class="ws13a">resp<span class="fc6">.</span>headers[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">last-modified<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf y299f ff8 fs5 fc0 sc0 ls0 ws150">content_type <span class="fc6 ls33">=</span><span class="ws13a">resp<span class="fc6 ls34">.</span>headers[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">content-type<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf y29a0 ff8 fs5 fc0 sc0 ls0 ws169">content_length <span class="fc6 ls32">=</span><span class="ws13a">resp<span class="fc6 ls34">.</span>headers[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">content-length<span class="ff9 ws13b">&apos;</span></span>]</span></div><div class="t m0 x0 h7 y255c ff1 fs3 fc0 sc0 ls0 ws38">下面是一个利用 <span class="ff4 wse92">requests </span><span class="ws14">通过基本认证登录 <span class="ff4 wse93">Pypi </span>的例子：</span></div><div class="t m0 x5 h10 y29a1 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">requests</span></div><div class="t m0 x5 hf y29a2 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ws13a">requests<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://pypi.python.org/pypi?:action=login<span class="ff9 ls34">&apos;</span></span>,</span></div><div class="t m0 x29 hf y29a3 ff8 fs5 fc0 sc0 ls0 ws13a">auth<span class="fc6 ls34">=<span class="fc0">(<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">user<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">password<span class="ff9 ws13b">&apos;</span></span>))</div><div class="t m0 x0 h7 y29a4 ff1 fs3 fc0 sc0 ls0 ws38">下面是一个利用 <span class="ff4 wse92">requests </span><span class="ls4">将</span><span class="ff4 ws9c">HTTP co<span class="_ _6"></span>okies </span>从一个请求传递到另一个的例子：</div><div class="t m0 x5 h10 y29a5 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">requests</span></div><div class="t m0 x5 h11 y29a6 ffa fs5 fcd sc0 ls0 ws4"># First request</div><div class="t m0 x5 hf y29a7 ff8 fs5 fc0 sc0 ls0 ws15f">resp1 <span class="fc6 ls33">=</span><span class="ws13a">requests<span class="fc6">.</span>get(url)</span></div><div class="t m0 x5 hf y29a8 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x5 h11 y29a9 ffa fs5 fcd sc0 ls0 ws4"># Second requests with cookies received on first requests</div><div class="t m0 x5 hf y29aa ff8 fs5 fc0 sc0 ls0 ws15f">resp2 <span class="fc6 ls33">=</span><span class="ws13a">requests<span class="fc6">.</span><span class="ws4">get(url, cookies<span class="fc6 ls34">=</span></span>resp1<span class="fc6 ls34">.</span>cookies)</span></div><div class="t m0 x0 h7 y29ab ff1 fs3 fc0 sc0 ls0 ws14">最后但并非最不重要的一个例子是用 <span class="ff4 wse92">requests </span>上传内容：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.1.<span class="_ _5"> </span>11.1 <span class="ff1 ws16b">作为客户端与 </span><span class="wse86">HTTP <span class="ff1 wse87">服务交互 </span>400</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
