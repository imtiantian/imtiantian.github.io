<div id="pf203" class="pf w0 h0" data-page-no="203"><div class="pc pc203 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg203.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 wsadf">15.10.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y11a8 ff1 fs3 fc0 sc0 ls14f ws91d">配置文件作为一种可读性很好的格式<span class="_ _d"></span>，非常适用于存储程序中的配置数据<span class="_ _d"></span>。在<span class="_ _d"></span></div><div class="t m0 x5 h7 y19a8 ff1 fs3 fc0 sc0 ls1bd wsd48">每个配置文件中<span class="_ _8"></span>，<span class="_ _6"></span>配置数据会被分组（<span class="_ _8"></span>比如例子中的“<span class="_ _d"></span><span class="ff4 ls0 wsa5">installation<span class="ff1 ws123b">”<span class="_ _3f"></span>、 “<span class="ff4 wsa5">debug</span><span class="wsa0">”<span class="_ _0"></span>和</span></span></span></div><div class="t m0 x4c h7 y3261 ff1 fs3 fc0 sc0 ls0 wsa0">“<span class="ff4 wsa5">serv<span class="_ _1"></span>er<span class="ff1 wsa0">”<span class="_ _31"></span>）<span class="_ _f"></span>。每个分组在其中指定对应的各个变量值。</span></span></div><div class="t m0 x0 h7 y3199 ff1 fs3 fc0 sc0 ls18 ws123c">对于可实现同样功能的配置文件和 <span class="ff4 ls0 ws453">Python </span><span class="ws110">源文件是有很大的不同的。首先，配置<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y319a ff1 fs3 fc0 sc0 ls0">文件的语法要更自由些，下面的赋值语句是等效的：</div><div class="t m0 x5 hf yec6 ff8 fs5 fc0 sc0 ls0">prefix=/usr/local</div><div class="t m0 x5 hf yec7 ff8 fs5 fc0 sc0 ls0 ws4">prefix: /usr/local</div><div class="t m0 x0 h9 y3262 ff1 fs3 fc0 sc0 ls0">配置文件中的名字是不区分大小写的。例如：</div><div class="t m0 x5 hf y3263 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">cfg<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">installation<span class="ff9 ls34">&apos;</span></span><span class="ls34">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">PREFIX<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3264 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3265 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">cfg<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">installation<span class="ff9 ls34">&apos;</span></span><span class="ls34">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">prefix<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y3266 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y3267 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3268 ff1 fs3 fc0 sc0 ls0 wsa0">在解析值的时候，<span class="ff6 ws1dc">getboolean() </span>方法查找任何可行的值。例如下面都是等价的：</div><div class="t m0 x5 hf y3269 ff8 fs5 fc0 sc0 ls0 ws2a3">log_errors <span class="fc6 ls32">=</span>true</div><div class="t m0 x5 hf y326a ff8 fs5 fc0 sc0 ls0 ws2a3">log_errors <span class="fc6 ls32">=</span>TRUE</div><div class="t m0 x5 hf y326b ff8 fs5 fc0 sc0 ls0 ws2a3">log_errors <span class="fc6 ls32">=</span>Yes</div><div class="t m0 x5 hf y326c ff8 fs5 fc0 sc0 ls0 ws2a3">log_errors <span class="fc6 ls32">=</span><span class="fc7">1</span></div><div class="t m0 x0 h7 y326d ff1 fs3 fc0 sc0 ls18 ws123d">或许配置文件和 <span class="ff4 ls0 ws453">Python </span><span class="ws110">代码最大的不同在于，它并不是从上而下的顺序执行。文<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y326e ff1 fs3 fc0 sc0 ls1e ws111">件是安装一个整体被读取的<span class="_ _1"></span>。如果碰到了变量替换<span class="_ _1"></span>，它实际上已经被替换完成了<span class="_ _1"></span>。例</div><div class="t m0 x5 h9 y3051 ff1 fs3 fc0 sc0 ls0 wsa0">如，在下面这个配置中，<span class="ff6 ws25d">prefix </span>变量在使用它的变量之前后之后定义都是可以的：</div><div class="t m0 x5 hf y326f ff8 fs5 fc0 sc0 ls0">[installation]</div><div class="t m0 x5 hf y29b9 ff8 fs5 fc0 sc0 ls0">library=%(prefix)s/lib</div><div class="t m0 x5 hf y3270 ff8 fs5 fc0 sc0 ls0">include=%(prefix)s/include</div><div class="t m0 x5 hf y3271 ff8 fs5 fc0 sc0 ls0">bin=%(prefix)s/bin</div><div class="t m0 x5 hf y3272 ff8 fs5 fc0 sc0 ls0">prefix=/usr/local</div><div class="t m0 x0 h9 y3273 ff6 fs3 fc0 sc0 ls0 ws7cb">ConfigParser <span class="ff1 ls30 ws138">有个容易被忽视的特性是它能一次读取多个配置文件然后合并成一</span></div><div class="t m0 x5 h9 y3274 ff1 fs3 fc0 sc0 ls0">个配置。例如，假设一个用户像下面这样构造了他们的配置文件：</div><div class="t m0 x5 hf y3275 ff8 fs5 fc0 sc0 ls0 ws4">; ~/.config.ini</div><div class="t m0 x5 hf y3276 ff8 fs5 fc0 sc0 ls0">[installation]</div><div class="t m0 x5 hf y3277 ff8 fs5 fc0 sc0 ls0">prefix=/Users/beazley/test</div><div class="t m0 x5 hf y315e ff8 fs5 fc0 sc0 ls0">[debug]</div><div class="t m0 x5 hf y3278 ff8 fs5 fc0 sc0 ls0">log_errors=False</div><div class="t m0 x0 h9 y3279 ff1 fs3 fc0 sc0 ls0">读取这个文件，它就能跟之前的配置合并起来。如：</div><div class="t m0 x5 h11 y327a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Previously read configuration</span></div><div class="t m0 x5 hf y2cac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">cfg<span class="fc6 ls34">.</span>get(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">installation<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">prefix<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y2cad ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">/usr/local<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">15.10.<span class="_ _36"> </span>13.10 <span class="ff1 wse4d">读取配置文件 </span>506</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
