<div id="pf22f" class="pf w0 h0" data-page-no="22f"><div class="pc pc22f w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg22f.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">nums <span class="fc6 ls32">=</span><span class="ls34">[</span><span class="fc7 ws13a">1</span><span class="ls33">,<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span></span>]</span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">(ctypes<span class="fc6 ls34">.</span><span class="ws1f5">c_double <span class="fc6 ls33">*</span></span><span class="fca">len</span>(nums))(<span class="fc6">*</span>nums)</span></span></div><div class="t m0 x5 hf y1ad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc8 sc0 ls0 ws4">&lt;__main__.c_double_Array_3 object at 0x10069cd40&gt;</div><div class="t m0 x5 hf y1af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a[<span class="fc7 ls34">0</span>]</span></div><div class="t m0 x5 hf y1b0 ff8 fs5 fc8 sc0 ls0">1.0</div><div class="t m0 x5 hf y355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a[<span class="fc7 ls34">1</span>]</span></div><div class="t m0 x5 hf y410 ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf y411 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">a[<span class="fc7 ls34">2</span>]</span></div><div class="t m0 x5 hf yba ff8 fs5 fc8 sc0 ls0">3.0</div><div class="t m0 x5 hf y8c6 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y33a ff1 fs3 fc0 sc0 ls0 wsa0">对于数组对象，<span class="ff6 ws22d">from<span class="_ _7"> </span>array() </span><span class="ws1394">提取底层的内存指针并将其转换为一个 <span class="ff6 ws22e">ctypes </span>指针</span></div><div class="t m0 x5 h9 y171c ff1 fs3 fc0 sc0 ls0">对象。例如：</div><div class="t m0 x5 h10 y3612 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">array</span></span></div><div class="t m0 x5 hf y143 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">array<span class="fc6 ls34">.</span>array(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">d<span class="ff9">&apos;</span></span></span>,[<span class="fc7 ls34">1<span class="fc0">,</span><span class="ls0">2</span><span class="fc0">,</span>3</span>])</span></span></div><div class="t m0 x5 hf y144 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf y3613 ff8 fs5 fc8 sc0 ls0 ws13a">array(<span class="ff9 ls34">&apos;<span class="ff8">d</span>&apos;</span><span class="ws4">, [1.0, 2.0, 3.0])</span></div><div class="t m0 x5 hf y145 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">ptr_ <span class="fc6 ls32">=</span><span class="ls34">a</span><span class="fc6 ws13a">.</span>buffer_info()</span></div><div class="t m0 x5 hf y146 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">ptr</span></div><div class="t m0 x5 hf y3614 ff8 fs5 fc8 sc0 ls0">4298687200</div><div class="t m0 x5 hf y147 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">ctypes<span class="fc6 ls34">.</span><span class="ws4">cast(ptr, ctypes</span><span class="fc6">.</span>POINTER(ctypes<span class="fc6">.</span>c_double))</span></div><div class="t m0 x5 hf y148 ff8 fs5 fc8 sc0 ls0 ws4">&lt;__main__.LP_c_double object at 0x10069cd40&gt;</div><div class="t m0 x5 hf y149 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3615 ff6 fs3 fc0 sc0 ls0 ws3e1">from ndarray() <span class="ff1 ws1395">演示<span class="_ _6"></span>了<span class="_ _6"></span>对<span class="_ _6"></span>于 </span><span class="ws149">numpy <span class="ff1 ls10 ws1396">数组的转换操作。通过定义 </span>DoubleArrayType</span></div><div class="t m0 x5 h9 y12ad ff1 fs3 fc0 sc0 ls0 ws38">类并在 <span class="ff6 ws17d">avg() </span>类型签名中使用它，那么这个函数就能接受多个不同的类数组输入了：</div><div class="t m0 x5 h10 y3616 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">sample</span></span></div><div class="t m0 x5 hf y3617 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>avg([<span class="fc7">1</span><span class="ls34">,<span class="fc7">2</span>,</span><span class="fc7">3</span>])</span></div><div class="t m0 x5 hf y3618 ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf y1939 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>avg((<span class="fc7">1</span><span class="ls34">,<span class="fc7">2</span>,</span><span class="fc7">3</span>))</span></div><div class="t m0 x5 hf y3619 ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 h10 y33b8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">array</span></span></div><div class="t m0 x5 hf y197e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>avg(array<span class="fc6">.</span>array(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls34">d<span class="ff9">&apos;</span></span></span>,[<span class="fc7 ls34">1<span class="fc0">,</span><span class="ls0">2</span><span class="fc0">,</span>3</span>]))</span></div><div class="t m0 x5 hf y361a ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 h10 y361b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">numpy</span></span></div><div class="t m0 x5 hf y361c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>avg(numpy<span class="fc6">.</span>array([<span class="fc7">1.0</span>,<span class="fc7">2.0</span><span class="ls34">,</span><span class="fc7">3.0</span>]))</span></div><div class="t m0 x5 hf y361d ff8 fs5 fc8 sc0 ls0">2.0</div><div class="t m0 x5 hf y361e ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y361f ff1 fs3 fc0 sc0 ls13 ws1397">本节最后一部分向你演示了怎样处理一个简单的 <span class="ff4 ls252">C</span><span class="wse5">结构<span class="_ _c"></span>。对于结构体，你只需要<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2383 ff1 fs3 fc0 sc0 ls0">像下面这样简单的定义一个类，包含相应的字段和类型即可：</div><div class="t m0 x5 hf y3620 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0 ws13a">(ctypes<span class="fc6 ls34">.</span>Structure):</span></span></div><div class="t m0 x15 hf y3621 ff8 fs5 fc0 sc0 ls0 ws1f5">_fields_ <span class="fc6 ls33">=</span><span class="ws13a">[(<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span>&apos;</span><span class="ws13b">, ctypes<span class="fc6 ls34">.</span>c_double),</span></span></div><div class="t m0 x18 hf y3622 ff8 fs5 fc0 sc0 ls0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8">y</span>&apos;</span><span class="ws13b">, ctypes<span class="fc6 ls34">.</span>c_double)]</span></div><div class="t m0 x0 h9 y3623 ff1 fs3 fc0 sc0 ls63 ws21f">一旦类被定义后<span class="_ _c"></span>，你就可以在类型签名中或者是需要实例化结构体的代码中使用<span class="_ _1"></span></div><div class="t m0 x5 h9 y636 ff1 fs3 fc0 sc0 ls0">它。例如：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.1.<span class="_ _36"> </span>15.1 <span class="ff1 ws16b">使用 </span><span class="ws135b">ctypes <span class="ff1 ws16b">访问 </span><span class="ls246">C</span><span class="ff1 ws135c">代码 </span>550</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
