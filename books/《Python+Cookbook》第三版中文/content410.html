<div id="pf19a" class="pf w0 h0" data-page-no="19a"><div class="pc pc19a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg19a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h10 yb1e ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">requests</span></div><div class="t m0 x5 hf yb1f ff8 fs5 fc0 sc0 ls0 ws158">url <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">http://httpbin.org/post<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf yb20 ff8 fs5 fc0 sc0 ls0 ws15f">files <span class="fc6 ls33">=</span><span class="ls32">{<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">file<span class="ff9 ls34">&apos;</span></span><span class="ws13b">: (<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">data.csv<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="fca ws13a">open</span><span class="ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9 ws13a">data.csv<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">rb<span class="ff9 ls34">&apos;</span></span>)) }</span></div><div class="t m0 x5 hf yb22 ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">requests<span class="fc6">.</span><span class="ws4">post(url, files<span class="fc6 ls34">=</span>files)</span></span></div><div class="t m0 x5 he y4b0 ff2 fs2 fc4 sc0 ls0 ws212">13.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y29ac ff1 fs3 fc0 sc0 ls42 wse94">对于真的很简单 <span class="ff4 ls0 wse95">HTTP </span><span class="wse96">客户端代码，用内置的 <span class="ff6 ls0 ws2cf">urllib <span class="ff1 wsa0">模块通<span class="_ _6"></span>常就<span class="_ _6"></span>足够<span class="_ _6"></span>了。但<span class="_ _6"></span>是，</span></span></span></div><div class="t m0 x5 h7 y29ad ff1 fs3 fc0 sc0 ls22 wse97">如果你要做的不仅仅只是简单的 <span class="ff4 ls0 wse98">GET </span><span class="ls6e">或<span class="ff4 ls0 wse99">POST <span class="ff1 wsa0">请<span class="_ _6"></span>求，那<span class="_ _6"></span>就<span class="_ _6"></span>真的<span class="_ _6"></span>不<span class="_ _6"></span>能再<span class="_ _6"></span>依<span class="_ _6"></span>赖它<span class="_ _6"></span>的<span class="_ _6"></span>功能</span></span></span></div><div class="t m0 x5 h9 y29ae ff1 fs3 fc0 sc0 ls0 ws14">了。这时候就是第三方模块比如 <span class="ff6 ws1f3">requests </span>大显身手的时候了。</div><div class="t m0 x0 h9 y29af ff1 fs3 fc0 sc0 ls49 wse9a">例如<span class="_ _1"></span>，如果你决定坚持使用标准的程序库而不考虑像 <span class="ff6 ls0 wse9b">requests <span class="ff1 wsa0">这<span class="_ _6"></span>样<span class="_ _6"></span>的<span class="_ _6"></span>第<span class="_ _6"></span>三<span class="_ _6"></span>方<span class="_ _6"></span>库，</span></span></div><div class="t m0 x5 h9 y29b0 ff1 fs3 fc0 sc0 ls17 wse9c">那么也许就不得不使用底层的 <span class="ff6 ls0 wse9d">http.client </span><span class="wsf6">模块来实现自己的代码。比方说<span class="_ _1"></span>，下面的</span></div><div class="t m0 x5 h7 y29b1 ff1 fs3 fc0 sc0 ls0 ws38">代码展示了如何执行一个 <span class="ff4 wse9e">HEAD </span>请求：</div><div class="t m0 x5 hf y7b2 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">http.client </span><span class="ws146">import <span class="ff8 fc0">HTTPConnection</span></span></div><div class="t m0 x5 hf y29b2 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">urllib <span class="fca">import <span class="ff8 fc0">parse</span></span></span></div><div class="t m0 x5 hf y29b3 ff8 fs5 fc0 sc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">HTTPConnection(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">www.python.org<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">80</span>)</span></div><div class="t m0 x5 hf y29b4 ff8 fs5 fc0 sc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">request(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">HEAD</span>&apos;</span><span class="ls32">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">/index.html</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y29b5 ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">c<span class="fc6">.</span></span>getresponse()</div><div class="t m0 x5 hf y29b6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Status<span class="ff9 ls34">&apos;</span></span><span class="ws4">, resp</span><span class="fc6">.</span>status)</span></div><div class="t m0 x5 hf y138d ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws13b">name, value </span><span class="ws157">in <span class="ff8 fc0 ws13a">resp<span class="fc6">.</span>getheaders():</span></span></div><div class="t m0 x15 hf y29b7 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13b">(name, value)</span></div><div class="t m0 x0 h7 y206b ff1 fs3 fc0 sc0 ls0 wsa0">同<span class="_ _6"></span>样<span class="_ _0"></span>地，<span class="_ _6"></span>如<span class="_ _0"></span>果<span class="_ _6"></span>必<span class="_ _6"></span>须<span class="_ _0"></span>编<span class="_ _6"></span>写<span class="_ _0"></span>涉<span class="_ _6"></span>及<span class="_ _0"></span>代<span class="_ _6"></span>理、<span class="_ _6"></span>认<span class="_ _0"></span>证、<span class="_ _6"></span><span class="ff4 wse9f">co<span class="_ _6"></span>okies </span>以<span class="_ _0"></span>及<span class="_ _6"></span>其<span class="_ _0"></span>他<span class="_ _6"></span>一<span class="_ _6"></span>些<span class="_ _0"></span>细<span class="_ _6"></span>节<span class="_ _0"></span>方<span class="_ _6"></span>面<span class="_ _0"></span>的<span class="_ _6"></span>代<span class="_ _6"></span>码，</div><div class="t m0 x5 h7 y29b8 ff1 fs3 fc0 sc0 ls0 wsea0">那么使用 <span class="ff6 ws4cc">urllib </span><span class="ls2b ws6a8">就显得特别别扭和啰嗦。比方说，下面这个示例实现在 </span><span class="ff4 wsea1">Python </span><span class="wsa0">包索</span></div><div class="t m0 x5 h9 y29b9 ff1 fs3 fc0 sc0 ls0">引上的认证：</div><div class="t m0 x5 h10 y29ba ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">urllib.request</span></div><div class="t m0 x5 hf y29bb ff8 fs5 fc0 sc0 ls0 ws13c">auth <span class="fc6 ls32">=</span><span class="ws13a">urllib<span class="fc6 ls34">.</span>request<span class="fc6 ls34">.</span>HTTPBasicAuthHandler()</span></div><div class="t m0 x5 hf y29bc ff8 fs5 fc0 sc0 ls0 ws13a">auth<span class="fc6 ls34">.</span>add_password(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">pypi<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">http://pypi.python.org<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">username<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">password<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x5 hf y2703 ff8 fs5 fc0 sc0 ls0 ws145">opener <span class="fc6 ls33">=</span><span class="ws13a">urllib<span class="fc6 ls34">.</span>request<span class="fc6">.</span>build_opener(auth)</span></div><div class="t m0 x5 hf y29bd ff8 fs5 fc0 sc0 ls32">r<span class="fc6 ls33">=</span><span class="ls0 ws13a">urllib<span class="fc6 ls34">.</span>request<span class="fc6 ls34">.</span>Request(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://pypi.python.org/pypi?:action=login<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y29be ff8 fs5 fc0 sc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">opener<span class="fc6 ls34">.</span>open(r)</span></div><div class="t m0 x5 hf y29bf ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">u<span class="fc6">.</span></span>read()</div><div class="t m0 x5 h11 y29c0 ffa fs5 fcd sc0 ls0 ws4"># From here. You can access more pages using opener</div><div class="t m0 x5 hf y29c1 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h9 y29c2 ff1 fs3 fc0 sc0 ls0 wsc">坦白说，所有的这些操作在 <span class="ff6 ws26f">requests </span>库中都变得简单的多。</div><div class="t m0 x0 h7 y29c3 ff1 fs3 fc0 sc0 ls30 wsea2">在开发过程中测试 <span class="ff4 ls0 wsea3">HTTP </span><span class="ws138">客户端代码常常是很令人沮丧的，因为所有棘手的细节<span class="_ _c"></span></span></div><div class="t m0 x5 h7 y29c4 ff1 fs3 fc0 sc0 ls1d wsea4">问题都需要考虑（<span class="_ _c"></span>例如 <span class="ff4 ls0 wsa5">co<span class="_ _6"></span>okies<span class="ff1 wsa0">、<span class="_ _0"></span>认<span class="_ _6"></span>证、<span class="_ _6"></span></span><span class="wsea5">HTTP </span></span><span class="ws1c3">头<span class="_ _1"></span>、编码方式等<span class="_ _c"></span>）<span class="_ _2e"></span>。要完成这些任务，<span class="_ _d"></span></span></div><div class="t m0 x5 h7 y29c5 ff1 fs3 fc0 sc0 ls0 wsea6">考<span class="_ _0"></span>虑<span class="_ _6"></span>使<span class="_ _0"></span>用 <span class="ff4 wsea7">h<span class="_ _1"></span>ttpbin <span class="ff1 wsa0">服<span class="_ _0"></span>务<span class="_ _6"></span>（</span><span class="fc3 wsa5">http://<span class="_ _6"></span>httpbin.org</span><span class="ff1 wsa0">）<span class="_ _2e"></span>。<span class="_ _0"></span>这<span class="_ _0"></span>个<span class="_ _0"></span>站<span class="_ _6"></span>点<span class="_ _0"></span>会<span class="_ _0"></span>接<span class="_ _6"></span>收<span class="_ _0"></span>发<span class="_ _6"></span>出<span class="_ _0"></span>的<span class="_ _0"></span>请<span class="_ _6"></span>求，<span class="_ _0"></span>然<span class="_ _0"></span>后<span class="_ _0"></span>以</span></span></div><div class="t m0 x5 h7 y29c6 ff4 fs3 fc0 sc0 ls0 ws5f">JSON <span class="ff1">的形式将相应信息回传回来。下面是一个交互式的例子：</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.1.<span class="_ _5"> </span>11.1 <span class="ff1 ws16b">作为客户端与 </span><span class="wse86">HTTP <span class="ff1 wse87">服务交互 </span>401</span></div><a class="l" href="http://httpbin.org"><div class="d m1" style="border-style:none;position:absolute;left:310.053000px;bottom:138.159000px;width:94.868000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
