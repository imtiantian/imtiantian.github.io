<div id="pf124" class="pf w0 h0" data-page-no="124"><div class="pc pc124 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg124.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls14f ws91d">这里看上去有点奇怪<span class="_ _d"></span>，每个状态对象都只有静态方法<span class="_ _d"></span>，并没有存储任何的实例<span class="_ _d"></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 lsf wsb49">属性数据<span class="_ _c"></span>。实际上，所有状态信息都只存储在 <span class="ff6 ls0 wsb4a">Connection </span><span class="wsdb">实例中<span class="_ _c"></span>。在基类中定义的<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y2c ff6 fs3 fc0 sc0 ls0 wsb4b">NotImplementedError <span class="ff1 wsb4c">是<span class="_ _6"></span>为了<span class="_ _6"></span>确<span class="_ _6"></span>保<span class="_ _6"></span>子<span class="_ _6"></span>类实<span class="_ _6"></span>现<span class="_ _6"></span>了<span class="_ _6"></span>相应<span class="_ _6"></span>的<span class="_ _6"></span>方<span class="_ _6"></span>法。<span class="_ _6"></span>这<span class="_ _6"></span>里你<span class="_ _6"></span>或<span class="_ _6"></span>许<span class="_ _6"></span>还想<span class="_ _6"></span>使<span class="_ _6"></span>用 <span class="ff4">8.12</span></span></div><div class="t m0 x5 h9 y2d ff1 fs3 fc0 sc0 ls0">小节讲解的抽象基类方式。</div><div class="t m0 x0 h9 y9a ff1 fs3 fc0 sc0 ls0">设计模式中有一种模式叫状态模式，这一小节算是一个初步入门！</div><div class="t m0 x5 hd y12f3 ff2 fs4 fc4 sc0 ls0 ws211">10.20<span class="_ _e"> </span>8.20 <span class="ff1">通过字符串调用对象方法</span></div><div class="t m0 x5 he y12f4 ff2 fs2 fc4 sc0 ls0 wsadf">10.20.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y12f5 ff1 fs3 fc0 sc0 ls0">你有一个字符串形式的方法名称，想通过它调用某个对象的对应方法。</div><div class="t m0 x5 he y1efb ff2 fs2 fc4 sc0 ls0 wsadf">10.20.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1efc ff1 fs3 fc0 sc0 ls0 ws38">最简单的情况，可以使用 <span class="ff6 ws1d1">getattr() </span>：</div><div class="t m0 x5 h10 y1efd ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">math</span></div><div class="t m0 x5 hf y1efe ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Point<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y1eff ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></div><div class="t m0 x16 hf y1f00 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">x</span><span class="ls32">=</span><span class="fc0">x</span></span></div><div class="t m0 x16 hf y1f01 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ls33">y</span><span class="ls32">=</span><span class="fc0">y</span></span></div><div class="t m0 x15 hf y1f02 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__repr__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1f03 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff9 fc9 ls34">&apos;<span class="ff8 ls0 ws13a">Point({!r:},{!r:})<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span><span class="fc0">format(<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ws159">x, </span><span class="fca">self<span class="fc6 ls34">.</span></span>y)</span></span></span></div><div class="t m0 x15 hf y1f04 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">distance<span class="fc0">(<span class="fca">self</span><span class="ws4">, x, y):</span></span></span></div><div class="t m0 x16 hf y1f05 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">math<span class="fc6 ls34">.</span>hypot(<span class="fca">self<span class="fc6 ls34">.</span></span><span class="ls32">x<span class="fc6">-</span></span><span class="ws15c">x, </span><span class="fca">self<span class="fc6">.</span></span><span class="ls33">y<span class="fc6 ls32">-</span></span>y)</span></div><div class="t m0 x5 hf y1f06 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">Point(<span class="fc7 ls34">2</span></span>,<span class="fc7 ls34">3</span><span class="ls0">)</span></div><div class="t m0 x5 hf y1f07 ff8 fs5 fc0 sc0 ls32">d<span class="fc6 ls33">=<span class="fca ls0 ws13a">getattr</span></span><span class="ls0 ws158">(p, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">distance<span class="ff9 ls34">&apos;</span><span class="fc0">)(<span class="fc7">0</span><span class="ls33">,<span class="fc7 ls34">0</span><span class="lscf">)</span></span><span class="ffa fcd ws4"># Calls p.distance(0, 0)</span></span></span></span></div><div class="t m0 x0 h9 y1f08 ff1 fs3 fc0 sc0 ls0 ws38">另外一种方法是使用 <span class="ff6 wsb4d">operator.methodcaller() </span>，例如：</div><div class="t m0 x5 h10 y1f09 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">operator</span></div><div class="t m0 x5 hf y1f0a ff8 fs5 fc0 sc0 ls0 ws13a">operator<span class="fc6 ls34">.</span>methodcaller(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">distance<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">0</span><span class="ls33">,<span class="fc7 ls34">0</span></span>)(p)</div><div class="t m0 x0 h9 y1f0b ff1 fs3 fc0 sc0 ls48 wsb4e">当你需要通过相同的参数多次调用某个方法时<span class="_ _1"></span>，使用 <span class="ff6 ls0 ws83a">operator.methodcaller <span class="ff1">就</span></span></div><div class="t m0 x5 h9 y1f0c ff1 fs3 fc0 sc0 ls0">很方便了。比如你需要排序一系列的点，就可以这样做：</div><div class="t m0 x5 hf y1f0d ff8 fs5 fc0 sc0 ls0 ws145">points <span class="fc6 ls33">=</span>[</div><div class="t m0 x15 hf ya82 ff8 fs5 fc0 sc0 ls0 ws13a">Point(<span class="fc7 ls34">1</span><span class="ls32">,<span class="fc7 ls34">2</span></span>),</div><div class="t m0 x15 hf y1f0e ff8 fs5 fc0 sc0 ls0 ws13a">Point(<span class="fc7 ls34">3</span><span class="ls32">,<span class="fc7 ls34">0</span></span>),</div><div class="t m0 x15 hf y1f0f ff8 fs5 fc0 sc0 ls0 ws13a">Point(<span class="fc7">10</span><span class="ls32">,<span class="fc6 ls34">-<span class="fc7">3</span></span></span>),</div><div class="t m0 x15 hf y1f10 ff8 fs5 fc0 sc0 ls0 ws13a">Point(<span class="fc6 ls34">-<span class="fc7">5</span></span><span class="ls32">,<span class="fc6 ls34">-<span class="fc7">7</span></span></span>),</div><div class="t m0 x15 hf y1f11 ff8 fs5 fc0 sc0 ls0 ws13a">Point(<span class="fc6 ls34">-<span class="fc7">1</span></span><span class="ls32">,<span class="fc7 ls34">8</span></span>),</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.20.<span class="_ _5"> </span>8.20 <span class="ff1 wsb03">通过字符串调用对象方法 </span>283</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
