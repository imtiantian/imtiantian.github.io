<div id="pf250" class="pf w0 h0" data-page-no="250"><div class="pc pc250 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg250.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf ye9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf yeb ff8 fs5 fc8 sc0 ls0 ws13a">array(<span class="ff9 ls34">&apos;<span class="ff8">d</span>&apos;</span><span class="ws4">, [1.0, -3.0, 4.0, 7.0, 2.0, 0.0])</span></div><div class="t m0 x5 hf yec ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>clip(a,<span class="fc7 ls34">1<span class="fc0">,</span><span class="ls0">4</span></span>,a)</span></div><div class="t m0 x5 hf yed ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">a</span></div><div class="t m0 x5 hf yee ff8 fs5 fc8 sc0 ls0 ws13a">array(<span class="ff9 ls34">&apos;<span class="ff8">d</span>&apos;</span><span class="ws4">, [1.0, 1.0, 4.0, 4.0, 2.0, 1.0])</span></div><div class="t m0 x5 h11 yf0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws13b"># numpy example</span></div><div class="t m0 x5 h10 yf1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">numpy</span></span></div><div class="t m0 x5 hf y38e8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">numpy<span class="fc6 ls34">.</span>random<span class="fc6">.</span>uniform(<span class="fc6 ls34">-</span><span class="fc7">10</span><span class="ls34">,</span><span class="fc7">10</span>,size<span class="fc6 ls34">=</span><span class="fc7">1000000</span>)</span></span></div><div class="t m0 x5 hf y38e9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">b</span></div><div class="t m0 x5 hf y38ea ff8 fs5 fc8 sc0 ls0 ws1303">array([-9.55546017, 7.45599334, 0.69248932,<span class="_ _1e"> </span>..., 0.69583148,</div><div class="t m0 x2c hf y32fb ff8 fs5 fc8 sc0 ls0 ws1303">-3.86290931, 2.37266888])</div><div class="t m0 x5 hf y38eb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">numpy<span class="fc6 ls34">.</span>zeros_like(b)</span></span></div><div class="t m0 x5 hf y38ec ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">c</span></div><div class="t m0 x5 hf y38ed ff8 fs5 fc8 sc0 ls0 ws1303">array([<span class="_ _1e"> </span>0., 0., 0.,<span class="_ _26"> </span>..., 0., 0., 0.])</div><div class="t m0 x5 hf y38ee ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sample<span class="fc6 ls34">.</span>clip(b,<span class="fc6 ls34">-<span class="fc7">5</span></span>,<span class="fc7 ls34">5</span>,c)</span></div><div class="t m0 x5 hf y38ef ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">c</span></div><div class="t m0 x5 hf y38f0 ff8 fs5 fc8 sc0 ls0 ws1303">array([-5.<span class="_ _49"> </span>, 5.<span class="_ _49"> </span>, 0.69248932,<span class="_ _1e"> </span>..., 0.69583148,</div><div class="t m0 x2c hf y38f1 ff8 fs5 fc8 sc0 ls0 ws1303">-3.86290931, 2.37266888])</div><div class="t m0 x5 hf y72 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">min<span class="fc0">(c)</span></span></div><div class="t m0 x5 hf y38f2 ff8 fs5 fc8 sc0 ls0">-5.0</div><div class="t m0 x5 hf y38f3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">max<span class="fc0">(c)</span></span></div><div class="t m0 x5 hf y38f4 ff8 fs5 fc8 sc0 ls0">5.0</div><div class="t m0 x5 hf y38f5 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y38f6 ff1 fs3 fc0 sc0 ls67 ws150f">你还会发现运行生成结果非常的快<span class="_ _8"></span>。下面我们将本例和 <span class="ff4 ls0 ws1510">nump<span class="_ _c"></span>y <span class="ff1 wsa0">中<span class="_ _12"></span>的<span class="_ _0"></span>已<span class="_ _12"></span>存<span class="_ _0"></span>在<span class="_ _12"></span>的</span></span></div><div class="t m0 x5 h9 y38f7 ff6 fs3 fc0 sc0 ls0 ws25d">clip() <span class="ff1">函数做一个性能对比：</span></div><div class="t m0 x5 hf y38f8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">numpy.clip(b,-5,5,c)<span class="ff9 ls34">&apos;</span></span><span class="ls34">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">from __main__ import b,c,numpy</span><span class="ls34">&apos;</span></span>,number<span class="fc6 ls34">=</span><span class="fc7">1000</span>)</span></div><div class="t m0 x5 hf y38f9 ff8 fs5 fc8 sc0 ls0">8.093049556000551</div><div class="t m0 x5 hf y38fa ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">timeit(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">sample.clip(b,-5,5,c)<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">from __main__ import b,c,sample<span class="ff9 ws13b">&apos;</span></span>,</span></div><div class="t m0 x5 hf y38fb ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fc0 ws13a">number<span class="fc6 ls34">=</span><span class="fc7">1000</span>)</span></div><div class="t m0 x5 hf y38fc ff8 fs5 fc8 sc0 ls0">3.760528204000366</div><div class="t m0 x5 hf y38fd ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y38fe ff1 fs3 fc0 sc0 ls2c ws1511">正如你看到的，它要快很多—<span class="_ _19"></span>—这是一个很有趣的结果，因为 <span class="ff4 ls0 ws1512">NumPy </span><span class="ws12f">版本的核心</span></div><div class="t m0 x5 h7 y38ff ff1 fs3 fc0 sc0 ls0 ws38">代码还是用 <span class="ff4 ls8">C</span>语言写的。</div><div class="t m0 x5 he y2979 ff2 fs2 fc4 sc0 ls0 wsadf">17.11.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 yf8b ff1 fs3 fc0 sc0 ls0 ws1513">本<span class="_ _6"></span>节<span class="_ _6"></span>利用<span class="_ _6"></span>了 <span class="ff4 ws1514">Cython </span><span class="ls48 ws1515">类型的内存视图，极大的简化了数组的操作<span class="_ _c"></span>。 <span class="ff6 ls0 ws1516">cpdef clip()</span></span></div><div class="t m0 x5 h7 yf8c ff1 fs3 fc0 sc0 ls0 ws4ad">声明了 <span class="ff6 ws496">clip() </span><span class="wsd38">同时为 <span class="ff4 ls20a">C</span><span class="ws495">级别函数以及 <span class="ff4 ws1062">Python </span><span class="ws8b0">级别函数。在 <span class="ff4 ws1517">Cython </span><span class="wsa0">中，这个是很重</span></span></span></span></div><div class="t m0 x5 h7 y175c ff1 fs3 fc0 sc0 ls0 ws1518">要的，<span class="_ _1"></span>因为它表示此函数调用要比其他 <span class="ff4 ws1519">Cython </span><span class="wsa0">函数更加高效（比如你想在另外一个不</span></div><div class="t m0 x5 h7 y3544 ff1 fs3 fc0 sc0 ls0 ws14">同的 <span class="ff4 wsba">Cython </span><span class="ws38">函数中调用 <span class="ff4 wsa5">clip()</span><span class="wsa0">）<span class="_ _f"></span>。</span></span></div><div class="t m0 x0 h9 yf8e ff1 fs3 fc0 sc0 ls0 ws151a">类型参数 <span class="ff6 ws151b">double[:]<span class="_ _40"> </span>a </span><span class="ls12f">和</span><span class="ff6 ws151c">double[:]<span class="_ _40"> </span>out </span><span class="ls3a ws153">声明这些参数为一维的双精度数组。作</span></div><div class="t m0 x5 h7 y8c4 ff1 fs3 fc0 sc0 ls0 ws151d">为<span class="_ _6"></span>输<span class="_ _6"></span>入，它<span class="_ _6"></span>们<span class="_ _6"></span>会<span class="_ _6"></span>访<span class="_ _6"></span>问<span class="_ _6"></span>任<span class="_ _6"></span>何<span class="_ _6"></span>实<span class="_ _6"></span>现<span class="_ _6"></span>了<span class="_ _6"></span>内存<span class="_ _6"></span>视<span class="_ _6"></span>图<span class="_ _6"></span>接<span class="_ _6"></span>口<span class="_ _6"></span>的<span class="_ _6"></span>数<span class="_ _6"></span>组<span class="_ _6"></span>对<span class="_ _6"></span>象，<span class="_ _6"></span>这个<span class="_ _6"></span>在 <span class="ff4 ws5fa">PEP 3118 </span><span class="wsa0">有<span class="_ _6"></span>详<span class="_ _6"></span>细</span></div><div class="t m0 x5 h7 y8c5 ff1 fs3 fc0 sc0 ls0 ws14">定义。包括了 <span class="ff4 ws151e">NumPy </span>中的数组和内置的 <span class="ff4 ws151f">arra<span class="_ _1"></span>y <span class="ff1">库。</span></span></div><div class="t m0 x0 h9 y674 ff1 fs3 fc0 sc0 ls184 wsb34">当你编写生成结果为数组的代码时<span class="_ _d"></span>，你应该遵循上面示例那样设置一个输出参<span class="_ _d"></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">17.11.<span class="_ _36"> </span>15.11 <span class="ff1 ls7f">用</span><span class="ws747">Cython <span class="ff1 ws150a">写高性能的数组操作 </span>583</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
