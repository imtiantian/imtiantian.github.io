<div id="pf141" class="pf w0 h0" data-page-no="141"><div class="pc pc141 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg141.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></div><div class="t m0 x15 hf y1ac ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc0 sc0 ls0 ws158">add <span class="fc6 ls32">=</span>logged(add)</div><div class="t m0 x0 h9 y21ba ff1 fs3 fc0 sc0 ls0 wsbcb">这<span class="_ _12"></span>时<span class="_ _12"></span>候，<span class="_ _24"></span>被<span class="_ _12"></span>装<span class="_ _12"></span>饰<span class="_ _12"></span>函<span class="_ _12"></span>数<span class="_ _24"></span>会<span class="_ _12"></span>被<span class="_ _12"></span>当<span class="_ _12"></span>做<span class="_ _24"></span>第<span class="_ _12"></span>一<span class="_ _12"></span>个<span class="_ _12"></span>参<span class="_ _12"></span>数<span class="_ _24"></span>直<span class="_ _12"></span>接<span class="_ _12"></span>传<span class="_ _12"></span>递<span class="_ _24"></span>给 <span class="ff6 wsbcc">logged </span><span class="wsa0">装<span class="_ _12"></span>饰<span class="_ _12"></span>器。<span class="_ _12"></span>因<span class="_ _24"></span>此，</span></div><div class="t m0 x5 h9 y21bb ff6 fs3 fc0 sc0 ls0 ws1f3">logged() <span class="ff1">中的第一个参数就是被包装函数本身。所有其他参数都必须有默认值。</span></div><div class="t m0 x0 h9 y21bc ff1 fs3 fc0 sc0 ls0">而对于一个下面这样有参数的装饰器：</div><div class="t m0 x5 hf y21bd ff7 fs5 fc12 sc0 ls0 ws156">@logged<span class="ff8 fc0 ws13a">(level<span class="fc6 ls34">=</span>logging<span class="fc6 ls34">.</span><span class="ws4">CRITICAL, name<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">example<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y21be ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">():</span></span></div><div class="t m0 x15 hf y21bf ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Spam!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h9 y21c0 ff1 fs3 fc0 sc0 ls0">调用序列跟下面等价：</div><div class="t m0 x5 hf y1db2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">spam<span class="fc0">():</span></span></div><div class="t m0 x15 hf y21c1 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Spam!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y21c2 ff8 fs5 fc0 sc0 ls0 ws13c">spam <span class="fc6 ls32">=</span><span class="ws13a">logged(level<span class="fc6 ls34">=</span>logging<span class="fc6">.</span><span class="ws4">CRITICAL, name</span><span class="fc6">=<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">example<span class="ff9 ls34">&apos;</span></span></span>)(spam)</span></div><div class="t m0 x0 h9 y21c3 ff1 fs3 fc0 sc0 ls0 wsbcd">初始调<span class="_ _6"></span>用 <span class="ff6 ws2c3">logged() </span><span class="wsa0">函数<span class="_ _6"></span>时，被包<span class="_ _6"></span>装函<span class="_ _6"></span>数并没<span class="_ _6"></span>有传<span class="_ _6"></span>递进来。<span class="_ _6"></span>因此<span class="_ _6"></span>在装饰<span class="_ _6"></span>器内，它<span class="_ _6"></span>必</span></div><div class="t m0 x5 h9 y21c4 ff1 fs3 fc0 sc0 ls0 wsa0">须<span class="_ _6"></span>是可<span class="_ _6"></span>选<span class="_ _6"></span>的。<span class="_ _6"></span>这<span class="_ _6"></span>个<span class="_ _6"></span>反过<span class="_ _6"></span>来<span class="_ _6"></span>会<span class="_ _6"></span>迫<span class="_ _6"></span>使<span class="_ _6"></span>其他<span class="_ _6"></span>参<span class="_ _6"></span>数<span class="_ _6"></span>必<span class="_ _6"></span>须<span class="_ _6"></span>使用<span class="_ _6"></span>关<span class="_ _6"></span>键<span class="_ _6"></span>字<span class="_ _6"></span>来<span class="_ _6"></span>指定。<span class="_ _6"></span>并<span class="_ _6"></span>且，<span class="_ _6"></span>但<span class="_ _6"></span>这<span class="_ _6"></span>些<span class="_ _6"></span>参数</div><div class="t m0 x5 h7 y21c5 ff1 fs3 fc0 sc0 ls18 wsbce">被传递进来后，装饰器要返回一个接受一个函数参数并包装它的函数 <span class="ff4 ls1b">(</span><span class="ls0 ws55b">参考 <span class="ff4 wsae4">9.5 </span><span class="wsa0">小节<span class="ff4 ls1b">)</span>。</span></span></div><div class="t m0 x5 h9 y21c6 ff1 fs3 fc0 sc0 ls0 wsbcf">为了<span class="_ _6"></span>这样<span class="_ _6"></span>做，我们<span class="_ _6"></span>使用<span class="_ _6"></span>了一<span class="_ _6"></span>个技<span class="_ _6"></span>巧，就<span class="_ _6"></span>是利<span class="_ _6"></span>用 <span class="ff6 wsbd0">functools.partial </span><span class="wsa0">。它会<span class="_ _6"></span>返回<span class="_ _6"></span>一个<span class="_ _6"></span>未</span></div><div class="t m0 x5 h7 y21c7 ff1 fs3 fc0 sc0 ls0 wsbd1">完<span class="_ _6"></span>全<span class="_ _6"></span>初始<span class="_ _6"></span>化<span class="_ _6"></span>的<span class="_ _6"></span>自<span class="_ _6"></span>身，<span class="_ _6"></span>除<span class="_ _6"></span>了<span class="_ _6"></span>被<span class="_ _6"></span>包<span class="_ _6"></span>装<span class="_ _6"></span>函数<span class="_ _6"></span>外<span class="_ _6"></span>其<span class="_ _6"></span>他<span class="_ _6"></span>参<span class="_ _6"></span>数<span class="_ _6"></span>都<span class="_ _6"></span>已<span class="_ _6"></span>经<span class="_ _6"></span>确<span class="_ _6"></span>定下<span class="_ _6"></span>来<span class="_ _6"></span>了。<span class="_ _6"></span>可<span class="_ _6"></span>以<span class="_ _6"></span>参<span class="_ _6"></span>考 <span class="ff4 ws919">7.8 </span>小</div><div class="t m0 x5 h9 y21c8 ff1 fs3 fc0 sc0 ls0 ws38">节获取更多 <span class="ff6 ws1d1">partial() </span>方法的知识。</div><div class="t m0 x5 hd y21c9 ff2 fs4 fc4 sc0 ls0 ws9c6">11.7<span class="_ _e"> </span>9.7 <span class="ff1">利用装饰器强制函数上的类型检查</span></div><div class="t m0 x5 he y21ca ff2 fs2 fc4 sc0 ls0 ws212">11.7.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1ce7 ff1 fs3 fc0 sc0 ls0">作为某种编程规约，你想在对函数参数进行强制类型检查。</div><div class="t m0 x5 he y21cb ff2 fs2 fc4 sc0 ls0 ws212">11.7.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y21cc ff1 fs3 fc0 sc0 ls0 wsa0">在演示实际代码前，先<span class="_ _6"></span>说明我们的目标：能对函数<span class="_ _6"></span>参数类型进行断言，类似<span class="_ _6"></span>下面这</div><div class="t m0 x5 h9 y21cd ff1 fs3 fc0 sc0 ls0">样：</div><div class="t m0 x5 hf y21ce ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fc12 ws156">@typeassert<span class="ff8 fc0 ls34">(<span class="fca ls0 ws13a">int</span><span class="ls32">,<span class="fca ls0 ws13a">int<span class="fc0">)</span></span></span></span></span></div><div class="t m0 x5 hf y21cf ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></span></div><div class="t m0 x5 hf y21d0 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></span></div><div class="t m0 x5 h10 y21d1 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y1160 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hf y1161 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></div><div class="t m0 x5 hf y1162 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y1163 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">add(<span class="fc7 ls34">2</span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">hello<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1164 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws9da">11.7.<span class="_ _5"> </span>9.7 <span class="ff1 ws243">利用装饰器强制函数上的类型检查 </span>312</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
