<div id="pf2d" class="pf w0 h0" data-page-no="2d"><div class="pc pc2d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg2d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls0 ws13c">nums <span class="fc6 ls32">=</span><span class="ls34">[<span class="fc7">1</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls32">,</span><span class="fc7">3</span><span class="ls32">,</span><span class="fc7">4</span><span class="ls33">,</span></span><span class="fc7 ws13a">5</span>]</div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=<span class="fca ls0 ws13a">sum</span></span><span class="ls0 ws159">(x <span class="fc6 ls33">*</span></span>x<span class="ff7 fca ls0 ws139">for </span><span class="ls33">x<span class="ff7 fca ls0 ws157">in </span><span class="ls0">nums)</span></span></div><div class="t m0 x0 h9 y4ac ff1 fs3 fc0 sc0 ls0">下面是更多的例子：</div><div class="t m0 x5 h11 y4ad ffa fs5 fcd sc0 ls0 ws4"># Determine if any .py files exist in a directory</div><div class="t m0 x5 h10 y4ae ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">os</span></div><div class="t m0 x5 hf y4af ff8 fs5 fc0 sc0 ls0 ws15f">files <span class="fc6 ls33">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>listdir(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">dirname<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y4b0 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">any<span class="fc0">(name<span class="fc6 ls34">.</span>endswith(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">.py<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span></span><span class="ws139">for <span class="ff8 fc0 ws13c">name </span></span>in <span class="ff8 fc0">files):</span></div><div class="t m0 x15 hf y4b1 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">There be python!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y4b2 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y4b3 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Sorry, no python.<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h11 y4b4 ffa fs5 fcd sc0 ls0 ws4"># Output a tuple as CSV</div><div class="t m0 x5 hf y4b5 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls34">(<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">ACME</span><span class="ls34">&apos;</span></span></span>,<span class="fc7 ls0 ws13a">50</span>,<span class="fc7 ls0 ws13a">123.45<span class="fc0">)</span></span></div><div class="t m0 x5 hf y4b6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;<span class="ff8">,</span>&apos;</span><span class="fc6">.</span>join(<span class="fca">str</span><span class="ws158">(x) </span></span><span class="ws139">for <span class="ff8 fc0 ls32">x</span><span class="ws160">in <span class="ff8 fc0">s))</span></span></span></div><div class="t m0 x5 h11 y4b7 ffa fs5 fcd sc0 ls0 ws4"># Data reduction across fields of a data structure</div><div class="t m0 x5 hf y4b8 ff8 fs5 fc0 sc0 ls0 ws16e">portfolio <span class="fc6 ls33">=</span>[</div><div class="t m0 x15 hf y4b9 ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;</span></span>:<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">GOOG</span><span class="ls34">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">shares</span>&apos;</span>:<span class="fc7 ls0 ws13a">50<span class="fc0">},</span></span></span></div><div class="t m0 x15 hf y4ba ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;</span></span>:<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">YHOO</span><span class="ls34">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">shares</span>&apos;</span>:<span class="fc7 ls0 ws13a">75<span class="fc0">},</span></span></span></div><div class="t m0 x15 hf y4bb ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;</span></span>:<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">AOL</span>&apos;</span><span class="ls33">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">shares</span>&apos;</span><span class="ls32">:<span class="fc7 ls0 ws13a">20<span class="fc0">},</span></span></span></div><div class="t m0 x15 hf y4bc ff8 fs5 fc0 sc0 ls34">{<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">name</span><span class="ls34">&apos;</span></span>:<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">SCOX</span><span class="ls34">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls0 ws13b">&apos;<span class="ff8 ws13a">shares</span>&apos;</span>:<span class="fc7 ls0 ws13a">65<span class="fc0">}</span></span></span></div><div class="t m0 x5 hf y4bd ff8 fs5 fc0 sc0 ls0">]</div><div class="t m0 x5 hf y4be ff8 fs5 fc0 sc0 ls0 ws2a3">min_shares <span class="fc6 ls32">=</span><span class="fca ws13a">min<span class="fc0">(s[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">shares<span class="ff9 ls34">&apos;</span></span><span class="ls32">]</span></span><span class="ff7 ws139">for </span></span><span class="ls32">s</span><span class="ff7 fca ws160">in </span>portfolio)</div><div class="t m0 x5 he y4bf ff2 fs2 fc4 sc0 ls0 ws212">3.19.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y4c0 ff1 fs3 fc0 sc0 ls3a ws153">上面的示例向你演示了当生成器表达式作为一个单独参数传递给函数时候的巧妙语</div><div class="t m0 x5 h7 y4c1 ff1 fs3 fc0 sc0 ls4">法<span class="ff4 ls1b">(</span><span class="ls0 wsa0">你并不需要多加一个括号<span class="ff4 ls1b">)</span>。比如，下面这些语句是等效的：</span></div><div class="t m0 x5 hf y4c2 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=<span class="fca ls0 ws13a">sum</span></span><span class="ls0 ws158">((x </span><span class="fc6">*</span><span class="ls33">x<span class="ff7 fca ls0 ws139">for </span></span>x<span class="ff7 fca ls0 ws157">in </span><span class="ls0 ws19f">nums)) </span><span class="ffa fcd">#<span class="ffc fs6 ls0">显示的传递一个生成器表达式对象</span></span></div><div class="t m0 x5 hf y4c3 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=<span class="fca ls0 ws13a">sum</span></span><span class="ls0 ws159">(x <span class="fc6 ls33">*</span></span>x<span class="ff7 fca ls0 ws139">for </span><span class="ls33">x<span class="ff7 fca ls0 ws157">in </span><span class="ls0 ws15f">nums) </span><span class="ffa fcd">#<span class="ffc fs6 ls0">更加优雅的实现方式，省略了括号</span></span></span></div><div class="t m0 x0 h9 y4c4 ff1 fs3 fc0 sc0 ls22 ws119">使用一个生成器表达式作为参数会比先创建一个临时列表更加高效和优雅。比如<span class="_ _1"></span>，</div><div class="t m0 x5 h9 y4c5 ff1 fs3 fc0 sc0 ls0">如果你不使用生成器表达式的话，你可能会考虑使用下面的实现方式：</div><div class="t m0 x5 hf y4c6 ff8 fs5 fc0 sc0 ls0 ws13c">nums <span class="fc6 ls32">=</span><span class="ls34">[<span class="fc7">1</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls32">,</span><span class="fc7">3</span><span class="ls32">,</span><span class="fc7">4</span><span class="ls33">,</span></span><span class="fc7 ws13a">5</span>]</div><div class="t m0 x5 hf y4c7 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=<span class="fca ls0 ws13a">sum</span></span><span class="ls0 ws158">([x </span><span class="fc6">*</span><span class="ls33">x<span class="ff7 fca ls0 ws139">for </span></span>x<span class="ff7 fca ls0 ws157">in </span><span class="ls0">nums])</span></div><div class="t m0 x0 h9 y4c8 ff1 fs3 fc0 sc0 ls56 ws1fa">这种方式同样可以达到想要的效果<span class="_ _c"></span>，但是它会多一个步骤<span class="_ _1"></span>，先创建一个额外的列<span class="_ _1"></span></div><div class="t m0 x5 h9 y4c9 ff1 fs3 fc0 sc0 ls1e ws111">表<span class="_ _1"></span>。对于小型列表可能没什么关系<span class="_ _1"></span>，但是如果元素数量非常大的时候，它会创建<span class="_ _1"></span>一个</div><div class="t m0 x5 h9 y4ca ff1 fs3 fc0 sc0 ls2d ws132">巨大的仅仅被使用一次就被丢弃的临时数据结构。而生成器方案会以迭代的方式转换<span class="_ _1"></span></div><div class="t m0 x5 h9 y4cb ff1 fs3 fc0 sc0 ls0">数据，因此更省内存。</div><div class="t m0 x0 h9 y4cc ff1 fs3 fc0 sc0 ls30 ws2b9">在使用一些聚集函数比如 <span class="ff6 ls0 ws1c4">min() </span><span class="ls71">和<span class="ff6 ls0 ws1c4">max() </span></span><span class="ws138">的时候你可能更加倾向于使用生成器版</span></div><div class="t m0 x5 h7 y4cd ff1 fs3 fc0 sc0 ls68 ws2ba">本，它们接受的一个 <span class="ff4 ls0 ws2bb">k<span class="_ _1"></span>ey <span class="ff1 ls68 ws23f">关键字参数或许对你很有帮助。比如，在上面的证券例子中，</span></span></div><div class="t m0 x5 h9 y4ce ff1 fs3 fc0 sc0 ls0">你可能会考虑下面的实现版本：</div><div class="t m0 x5 h11 y4cf ffa fs5 fcd sc0 ls0 ws4"># Original: Returns 20</div><div class="t m0 x5 hf y4d0 ff8 fs5 fc0 sc0 ls0 ws2a3">min_shares <span class="fc6 ls32">=</span><span class="fca ws13a">min<span class="fc0">(s[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">shares<span class="ff9 ls34">&apos;</span></span><span class="ls32">]</span></span><span class="ff7 ws139">for </span></span><span class="ls32">s</span><span class="ff7 fca ws160">in </span>portfolio)</div><div class="t m0 x5 h11 y4d1 ffa fs5 fcd sc0 ls0 ws4"># Alternative: Returns {<span class="ffb ls34">&apos;</span><span class="ws13a">name<span class="ffb ls34">&apos;</span><span class="ls32">:<span class="ffb ls34">&apos;</span></span>AOL<span class="ffb ls34">&apos;</span><span class="ls32">,<span class="ffb ls34">&apos;</span></span>shares<span class="ffb ls34">&apos;</span></span>: 20}</div><div class="t m0 x5 hf y4d2 ff8 fs5 fc0 sc0 ls0 ws2a3">min_shares <span class="fc6 ls32">=</span><span class="fca ws13a">min</span><span class="ws13b">(portfolio, key<span class="fc6 ws13a">=<span class="ff7 fca ws146">lambda </span></span><span class="ws4">s: s[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">shares<span class="ff9 ls34">&apos;</span></span>])</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">3.19.<span class="_ _5"> </span>1.19 <span class="ff1 ws2ad">转换并同时计算数据 </span>36</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
