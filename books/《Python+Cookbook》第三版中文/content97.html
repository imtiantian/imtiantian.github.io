<div id="pf61" class="pf w0 h0" data-page-no="61"><div class="pc pc61 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg61.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>chmod(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">script.py<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="fc7 ls34">0</span></span>o755)</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hd yac1 ff2 fs4 fc4 sc0 ls0 ws134">5.5<span class="_ _e"> </span>3.5 <span class="ff1">字节到大整数的打包与解包</span></div><div class="t m0 x5 he yac2 ff2 fs2 fc4 sc0 ls0 ws135">5.5.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 yac3 ff1 fs3 fc0 sc0 ls3a ws153">你有一个字节字符串并想将它解压成一个整数。或者，你需要将一个大整数转换为</div><div class="t m0 x5 h9 yac4 ff1 fs3 fc0 sc0 ls0">一个字节字符串。</div><div class="t m0 x5 he yac5 ff2 fs2 fc4 sc0 ls0 ws135">5.5.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 yac6 ff1 fs3 fc0 sc0 ls0 ws14">假设你的程序需要处理一个拥有 <span class="ff4 ws4a0">128 </span><span class="ws38">位长的 <span class="ff4 wsd2">16 </span>个元素的字节字符串。比如：</span></div><div class="t m0 x5 hf y7f2 ff8 fs5 fc0 sc0 ls0 ws13c">data <span class="fc6 ls32">=</span><span class="ls34">b<span class="ff9 fc9">&apos;<span class="ff7 ls0 ws156">\x00\x12<span class="ff8 ws13a">4V</span>\x00<span class="ff8 ws13a">x</span>\x90\xab\x00\xcd\xef\x01\x00</span><span class="ff8">#<span class="ff7 ls0 ws156">\x00</span>4</span><span class="ls0">&apos;</span></span></span></div><div class="t m0 x0 h7 yac7 ff1 fs3 fc0 sc0 ls6b ws4a1">为了将 <span class="ff4 ls0 ws4a2">b<span class="_ _1"></span>ytes <span class="ff1 ws4a3">解析<span class="_ _6"></span>为<span class="_ _6"></span>整数，<span class="_ _6"></span>使<span class="_ _6"></span>用 <span class="ff6 ws4a4">int.from bytes() </span><span class="ls22 ws119">方法，并像下面这样指定字节<span class="_ _c"></span></span></span></span></div><div class="t m0 x5 h9 yac8 ff1 fs3 fc0 sc0 ls0">顺序：</div><div class="t m0 x5 hf yac9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">len<span class="fc0">(data)</span></span></div><div class="t m0 x5 hf yaca ff8 fs5 fc8 sc0 ls0">16</div><div class="t m0 x5 hf yacb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">int<span class="fc6 ls34">.</span><span class="fc0 ws1f8">from_bytes(data, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">little<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x5 hf yacc ff8 fs5 fc8 sc0 ls0">69120565665751139577663547927094891008</div><div class="t m0 x5 hf yacd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">int<span class="fc6 ls34">.</span><span class="fc0 ws1f8">from_bytes(data, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">big<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x5 hf yace ff8 fs5 fc8 sc0 ls0">94522842520747284487117727783387188</div><div class="t m0 x5 hf yacf ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 yad0 ff1 fs3 fc0 sc0 ls17 ws4a5">为了将一个大整数转换为一个字节字符串<span class="_ _1"></span>，使用 <span class="ff6 ls0 ws20d">int.to bytes() <span class="ff1 wsa0">方<span class="_ _6"></span>法，并<span class="_ _6"></span>像下<span class="_ _6"></span>面</span></span></div><div class="t m0 x5 h9 yad1 ff1 fs3 fc0 sc0 ls0">这样指定字节数和字节顺序：</div><div class="t m0 x5 hf yad2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">94522842520747284487117727783387188</span></span></span></div><div class="t m0 x5 hf yad3 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">x<span class="fc6 ls0 ws13a">.<span class="fc0">to_bytes(<span class="fc7">16</span><span class="ls33">,</span></span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">big<span class="ff9 ws13b">&apos;</span><span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf yad4 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x00\x124V\x00x\x90\xab\x00\xcd\xef\x01\x00#\x004<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf yad5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">x<span class="fc6 ls0 ws13a">.<span class="fc0">to_bytes(<span class="fc7">16</span><span class="ls33">,</span></span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">little</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf yad6 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">4\x00#\x00\x01\xef\xcd\x00\xab\x90x\x00V4\x12\x00<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf yad7 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he yad8 ff2 fs2 fc4 sc0 ls0 ws135">5.5.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y9ef ff1 fs3 fc0 sc0 ls3a ws153">大整数和字节字符串之间的转换操作并不常见。然而，在一些应用领域有时候也会</div><div class="t m0 x5 h7 yad9 ff1 fs3 fc0 sc0 ls0 wsa0">出现，比<span class="_ _6"></span>如密码<span class="_ _6"></span>学或者<span class="_ _6"></span>网络。例<span class="_ _6"></span>如，<span class="ff4 ws4a6">IPv6 </span><span class="ws4a7">网络地<span class="_ _6"></span>址使用<span class="_ _6"></span>一个 <span class="ff4 ws4a8">128 </span></span>位的<span class="_ _6"></span>整数表<span class="_ _6"></span>示。如果</div><div class="t m0 x5 h9 yada ff1 fs3 fc0 sc0 ls0">你要从一个数据记录中提取这样的值的时候，你就会面对这样的问题。</div><div class="t m0 x0 h7 yadb ff1 fs3 fc0 sc0 ls0 ws4a9">作为<span class="_ _6"></span>一种<span class="_ _6"></span>替<span class="_ _6"></span>代方<span class="_ _6"></span>案，你<span class="_ _6"></span>可能<span class="_ _6"></span>想<span class="_ _6"></span>使用 <span class="ff4 ws4aa">6.11 </span><span class="ws4ab">小<span class="_ _6"></span>节中<span class="_ _6"></span>所介<span class="_ _6"></span>绍<span class="_ _6"></span>的 <span class="ff6 ws4ac">struct </span><span class="wsa0">模块<span class="_ _6"></span>来解<span class="_ _6"></span>压<span class="_ _6"></span>字节。</span></span></div><div class="t m0 x5 h9 yadc ff1 fs3 fc0 sc0 ls0 ws4ad">这样也行得通，不过利用 <span class="ff6 ws25d">struct </span><span class="wsa0">模块来解压对于整数的大小是有限制的。因此，你可</span></div><div class="t m0 x5 h9 y552 ff1 fs3 fc0 sc0 ls0">能想解压多个字节串并将结果合并为最终的结果，就像下面这样：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">5.5.<span class="_ _5"> </span>3.5 <span class="ff1 ws4ae">字节到大整数的打包与解包 </span>88</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
