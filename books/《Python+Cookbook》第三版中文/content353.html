<div id="pf161" class="pf w0 h0" data-page-no="161"><div class="pc pc161 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg161.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ls34">&apos;</span></span></span>,<span class="fc7 ls0 ws13a">50</span><span class="ls33">,<span class="fc7 ls0 ws13a">91.1<span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">s</span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls34">(<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">ACME</span><span class="ff9">&apos;</span><span class="ls0 ws4">, 50, 91.1)</span></div><div class="t m0 x5 hf y1ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">s[<span class="fc7 ls34">0</span>]</span></div><div class="t m0 x5 hf y1af ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">ACME<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1b0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">name</span></span></span></div><div class="t m0 x5 hf y355 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">ACME<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y410 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0 ws145">shares </span><span class="ls33">*</span></span>s<span class="fc6 ls0 ws13a">.<span class="fc0">price</span></span></span></div><div class="t m0 x5 hf y411 ff8 fs5 fc8 sc0 ls0">4555.0</div><div class="t m0 x5 hf yba ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0 ws145">shares </span><span class="ls33">=</span><span class="fc7">23</span></span></span></div><div class="t m0 x5 hf y8c6 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf ybed ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf ybee ff8 fs5 fc2 sc0 ls0 ws13a">AttributeError<span class="fc0 ws4">: can<span class="ff9 ls34">&apos;</span><span class="ws13b">t set attribute</span></span></div><div class="t m0 x5 hf ybef ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y24e6 ff2 fs2 fc4 sc0 ls0 wsadf">11.19.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y24e7 ff1 fs3 fc0 sc0 ls0 wsc7b">这<span class="_ _6"></span>一<span class="_ _6"></span>小节<span class="_ _6"></span>中，<span class="_ _6"></span>类 <span class="ff6 wsc7c">StructTupleMeta </span><span class="wsc7d">获<span class="_ _6"></span>取<span class="_ _6"></span>到<span class="_ _6"></span>类<span class="_ _6"></span>属<span class="_ _6"></span>性 <span class="ff6 ws680">fields </span><span class="wsa0">中<span class="_ _6"></span>的属<span class="_ _6"></span>性<span class="_ _6"></span>名<span class="_ _6"></span>字<span class="_ _6"></span>列<span class="_ _6"></span>表，<span class="_ _6"></span>然</span></span></div><div class="t m0 x5 h9 y24e8 ff1 fs3 fc0 sc0 lse wsc7e">后将它们转换成相应的可访问特定元组槽的方法。函数 <span class="ff6 ls0 wsc7f">operator.itemgetter() <span class="ff1 wsa0">创建</span></span></div><div class="t m0 x5 h9 y24e9 ff1 fs3 fc0 sc0 ls0 ws14">一个访问器函数，然后 <span class="ff6 ws17c">property() </span>函数将其转换成一个属性。</div><div class="t m0 x0 h9 y1af5 ff1 fs3 fc0 sc0 ls1f wsc80">本节最难懂的部分是知道不同的初始化步骤是什么时候发生的。 <span class="ff6 ls0">StructTupleMeta</span></div><div class="t m0 x5 h9 y24ea ff1 fs3 fc0 sc0 ls0 wsc81">中的 <span class="ff6 wsc82">init<span class="_ _e"> </span>() </span><span class="ws24d">方法只在每个类被定义时被调用一次。 <span class="ff6 wsc83">cls </span>参数就是那个被定义的类。</span></div><div class="t m0 x5 h9 y24eb ff1 fs3 fc0 sc0 ls10 wsc84">实际上<span class="_ _1"></span>，上述代码使用了 <span class="ff6 ls0 ws3cd">fields </span><span class="wsdf">类变量来保存新的被定义的类，然后给它再添加一<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y24ec ff1 fs3 fc0 sc0 ls0">点新的东西。</div><div class="t m0 x0 h9 y24ed ff6 fs3 fc0 sc0 ls0 wsc85">StructTuple <span class="ff1 wsc86">类作为一个普通的基类，<span class="_ _d"></span>供其他使用者来继承。<span class="_ _c"></span>这个类中的 <span class="ff6 ws9c3">new ()</span></span></div><div class="t m0 x5 h9 y24ee ff1 fs3 fc0 sc0 ls0 wsc87">方法用来构造新的实<span class="_ _6"></span>例。这里使用 <span class="ff6 wsc88">new<span class="_ _e"> </span>() </span><span class="wsa0">并不是很常见，主<span class="_ _6"></span>要是因为我们要修改元</span></div><div class="t m0 x5 h9 y24ef ff1 fs3 fc0 sc0 ls0">组的调用签名，使得我们可以像普通的实例调用那样创建实例。就像下面这样：</div><div class="t m0 x5 hf y24f0 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ls34">&apos;</span></span></span>,<span class="fc7 ls0 ws13a">50</span>,<span class="fc7 ls0 ws13a">91.1</span>)<span class="ffa fcd ls0 ws4"># OK</span></div><div class="t m0 x5 hf y24f1 ff8 fs5 fc0 sc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">Stock((<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">ACME<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="fc7">50</span><span class="ls33">,</span><span class="fc7">91.1</span><span class="ws159">)) <span class="ffa fcd ws13b"># Error</span></span></span></div><div class="t m0 x0 h9 y24f2 ff1 fs3 fc0 sc0 ls1a2">跟<span class="ff6 ls0 ws5f7">init<span class="_ _e"> </span>() </span><span class="ls0 wsc89">不同<span class="_ _6"></span>的<span class="_ _6"></span>是， <span class="ff6 wsc8a">new<span class="_ _e"> </span>() </span><span class="wsa0">方<span class="_ _6"></span>法<span class="_ _6"></span>在实<span class="_ _6"></span>例<span class="_ _6"></span>被<span class="_ _6"></span>创建<span class="_ _6"></span>之<span class="_ _6"></span>前<span class="_ _6"></span>被触<span class="_ _6"></span>发。<span class="_ _6"></span>由<span class="_ _6"></span>于元<span class="_ _6"></span>组<span class="_ _6"></span>是<span class="_ _6"></span>不</span></span></div><div class="t m0 x5 h9 y24f3 ff1 fs3 fc0 sc0 ls22 wsc8b">可修改的，所以一旦它们被创建了就不可能对它做任何改变<span class="_ _c"></span>。而 <span class="ff6 ls0 wsc8c">init<span class="_ _e"> </span>() <span class="ff1 wsa0">会<span class="_ _6"></span>在<span class="_ _6"></span>实例</span></span></div><div class="t m0 x5 h9 y24f4 ff1 fs3 fc0 sc0 ls0 wsc8d">创建的最后被触发，这<span class="_ _6"></span>样的话我们就可以做我们<span class="_ _6"></span>想做的了。这也是为什么 <span class="ff6 wsc88">new<span class="_ _e"> </span>() </span>方</div><div class="t m0 x5 h9 y24f5 ff1 fs3 fc0 sc0 ls0">法已经被定义了。</div><div class="t m0 x0 h7 y24f6 ff1 fs3 fc0 sc0 ls18 ws39c">尽管本节很短，还是需要你能仔细研读，深入思考 <span class="ff4 ls0 wsf8">Python <span class="ff1 wsa0">类是如何<span class="_ _6"></span>被定义<span class="_ _6"></span>的，实</span></span></div><div class="t m0 x5 h9 y24f7 ff1 fs3 fc0 sc0 ls0">例是如何被创建的，还有就是元类和类的各个不同的方法究竟在什么时候被调用。</div><div class="t m0 x0 h7 y24f8 ff4 fs3 fc3 sc0 ls0 wsc8e">PEP 422 <span class="ff1 fc0 wsa0">提供了一个解决本节问题的另外一种方法。但是，截止到我写这本书的时</span></div><div class="t m0 x5 h7 yede ff1 fs3 fc0 sc0 ls19 wsc8f">候，它还没被采纳和接受<span class="_ _1"></span>。尽管如此，如果你使用的是 <span class="ff4 ls0 wsfa">Python 3.3 <span class="ff1 wsa0">或更高<span class="_ _6"></span>的版<span class="_ _6"></span>本，那</span></span></div><div class="t m0 x5 h9 y24f9 ff1 fs3 fc0 sc0 ls0">么还是值得去看一下的。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.19.<span class="_ _5"> </span>9.19 <span class="ff1 wsb70">在定义的时候初始化类的成员 </span>344</div><a class="l" href="http://www.python.org/dev/peps/pep-0422"><div class="d m1" style="border-style:none;position:absolute;left:137.887500px;bottom:283.507500px;width:45.236000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
