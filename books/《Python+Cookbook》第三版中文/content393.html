<div id="pf189" class="pf w0 h0" data-page-no="189"><div class="pc pc189 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg189.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x17 hf y1ab ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls34">(</span><span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws4">_loader, [])</span></span></div><div class="t m0 x16 hf y1ac ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1ad ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">find_loader: module <span class="ffa fcf ws159">%r </span><span class="ws4">not found<span class="ff9 ls34">&apos;</span></span><span class="fc0">, fullname)</span></span></div><div class="t m0 x17 hf y1ae ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls34">(</span><span class="ff8 ws13a">None<span class="fc0 ws4">, [])</span></span></div><div class="t m0 x15 hf y1b0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">invalidate_caches<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y355 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">invalidating link cache<span class="ff9">&apos;</span></span>)</div><div class="t m0 x16 hf y410 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_links </span><span class="ls32">=</span></span>None</div><div class="t m0 x5 h11 yba ffa fs5 fcd sc0 ls0 ws4"># Check path to see if it looks like a URL</div><div class="t m0 x5 hf y8c6 ff8 fs5 fc0 sc0 ls0 ws151">_url_path_cache <span class="fc6 ls32">=</span>{}</div><div class="t m0 x5 hf ybed ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">handle_url<span class="fc0">(path):</span></span></div><div class="t m0 x15 hf ybee ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">path<span class="fc6 ls34">.</span>startswith((<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">http://<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">https://<span class="ff9 ls34">&apos;</span></span>)):</span></div><div class="t m0 x16 hf ybef ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Handle path? </span><span class="ffa fcf">%s</span><span class="fc9 ws13b">. [Yes]<span class="ff9 ls34">&apos;</span><span class="fc0">, path)</span></span></div><div class="t m0 x16 hf ybf0 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">path </span>in <span class="ff8 fc0">_url_path_cache:</span></div><div class="t m0 x17 hf yd7d ff8 fs5 fc0 sc0 ls0 ws145">finder <span class="fc6 ls32">=</span>_url_path_cache[path]</div><div class="t m0 x16 hf ybf1 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf ybf2 ff8 fs5 fc0 sc0 ls0 ws145">finder <span class="fc6 ls32">=</span>UrlPathFinder(path)</div><div class="t m0 x17 hf ybf3 ff8 fs5 fc0 sc0 ls0 wsd67">_url_path_cache[path] <span class="fc6 ls32">=</span>finder</div><div class="t m0 x16 hf ybf4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">finder</span></div><div class="t m0 x15 hf ybf5 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x16 hf ybf6 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Handle path? </span><span class="ffa fcf">%s</span><span class="fc9 ws13b">. [No]<span class="ff9 ls34">&apos;</span><span class="fc0">, path)</span></span></div><div class="t m0 x5 hf ybf8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">install_path_hook<span class="fc0">():</span></span></div><div class="t m0 x15 hf ybf9 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path_hooks<span class="fc6 ls34">.</span>append(handle_url)</div><div class="t m0 x15 hf ybfa ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path_importer_cache<span class="fc6">.</span>clear()</div><div class="t m0 x15 hf ybfb ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Installing handle_url<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x5 hf y1ed7 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">remove_path_hook<span class="fc0">():</span></span></div><div class="t m0 x15 hf y1ed8 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path_hooks<span class="fc6 ls34">.</span>remove(handle_url)</div><div class="t m0 x15 hf y1f83 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path_importer_cache<span class="fc6">.</span>clear()</div><div class="t m0 x15 hf y1ed9 ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13b">Removing handle_url<span class="ff9">&apos;</span></span>)</div><div class="t m0 x0 h7 y2839 ff1 fs3 fc0 sc0 ls0 ws14">要使用这个路径查找器，你只需要在 <span class="ff6 ws1f3">sys.path </span><span class="ws38">中加入 <span class="ff4 ws30">URL </span>链接。例如：</span></div><div class="t m0 x5 h11 y283a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Initial import fails</span></div><div class="t m0 x5 h10 y283b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fib</span></span></div><div class="t m0 x5 hf y283c ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y283d ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y283e ff8 fs5 fc2 sc0 ls0 ws13a">ImportError<span class="fc0 ws4">: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h11 yf29 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Install the path hook</span></div><div class="t m0 x5 h10 y1891 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">urlimport</span></span></div><div class="t m0 x5 hf y1892 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">urlimport<span class="fc6 ls34">.</span>install_path_hook()</span></div><div class="t m0 x5 h11 y1894 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Imports still fail (not on path)</span></div><div class="t m0 x5 h10 y283f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fib</span></span></div><div class="t m0 x5 hf y2840 ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y2841 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x5 hf y2842 ff8 fs5 fc2 sc0 ls0 ws13a">ImportError<span class="fc0 ws4">: No module named <span class="ff9 ls34">&apos;</span><span class="ws13a">fib<span class="ff9">&apos;</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.11.<span class="_ _5"> </span>10.11 <span class="ff1 wsd98">通过钩子远程加载模块 </span>384</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
