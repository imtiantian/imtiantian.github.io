<div id="pfcd" class="pf w0 h0" data-page-no="cd"><div class="pc pccd w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgcd.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc8 sc0 ls0 ws13a">dtype=[(<span class="ff9 ls34">&apos;</span>f0<span class="ff9 ls34">&apos;</span><span class="ls32">,<span class="ff9 ls34">&apos;</span></span>&lt;i4<span class="ff9 ls34">&apos;</span><span class="ws13b">), (<span class="ff9">&apos;</span></span>f1<span class="ff9 ls34">&apos;</span><span class="ls32">,<span class="ff9 ls34">&apos;</span></span>&lt;f8<span class="ff9 ls34">&apos;</span><span class="ws13b">), (<span class="ff9">&apos;</span></span>f2<span class="ff9 ls34">&apos;</span><span class="ls32">,<span class="ff9 ls34">&apos;</span></span>&lt;f8<span class="ff9 ls34">&apos;</span>)])</div><div class="t m0 x5 hf y1ac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">records[<span class="fc7">0</span>]</span></div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0 ws4">(1, 2.3, 4.5)</div><div class="t m0 x5 hf y1ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">records[<span class="fc7">1</span>]</span></div><div class="t m0 x5 hf y1af ff8 fs5 fc8 sc0 ls0 ws4">(6, 7.8, 9.0)</div><div class="t m0 x5 hf y1b0 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y1b1 ff1 fs3 fc0 sc0 ls149 ws8c2">最后提一点<span class="_ _c"></span>，如果你需要从已知的文件格式 <span class="ff4 ls0 wsa5">(<span class="ff1 wsa0">如<span class="_ _6"></span>图<span class="_ _0"></span>片<span class="_ _6"></span>格<span class="_ _6"></span>式，<span class="_ _6"></span>图<span class="_ _0"></span>形<span class="_ _6"></span>文<span class="_ _6"></span>件，<span class="_ _6"></span></span><span class="ws8c3">HDF5 <span class="ff1 wsa0">等</span>)</span></span></div><div class="t m0 x5 h7 y1b2 ff1 fs3 fc0 sc0 ls0 ws8c4">中读取二进制数据时，先检查看看 <span class="ff4 ws347">Python </span><span class="wsa0">是不是已经提供了现存的模块。<span class="_ _1"></span>因为不到万</span></div><div class="t m0 x5 h9 y1cc ff1 fs3 fc0 sc0 ls0">不得已没有必要去重复造轮子。</div><div class="t m0 x5 hd y164b ff2 fs4 fc4 sc0 ls0 ws211">8.12<span class="_ _e"> </span>6.12 <span class="ff1">读取嵌套和可变长二进制数据</span></div><div class="t m0 x5 he y164c ff2 fs2 fc4 sc0 ls0 ws212">8.12.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 yecd ff1 fs3 fc0 sc0 ls3a ws153">你需要读取包含嵌套或者可变长记录集合的复杂二进制格式的数据。这些数据可能</div><div class="t m0 x5 h9 y164d ff1 fs3 fc0 sc0 ls0">包含图片、视频、电子地图文件等。</div><div class="t m0 x5 he y164e ff2 fs2 fc4 sc0 ls0 ws212">8.12.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y164f ff6 fs3 fc0 sc0 ls0 ws8c5">struct <span class="ff1 wsa0">模块可被<span class="_ _6"></span>用来编码<span class="ff4 wsa5">/</span><span class="ls51 ws1c8">解码几乎所有类型的二进制的数据结构。为了解释清楚</span></span></div><div class="t m0 x5 h7 y1650 ff1 fs3 fc0 sc0 ls0 ws8c6">这<span class="_ _6"></span>种<span class="_ _6"></span>数<span class="_ _6"></span>据，<span class="_ _6"></span>假<span class="_ _6"></span>设<span class="_ _6"></span>你<span class="_ _6"></span>用<span class="_ _6"></span>下<span class="_ _6"></span>面<span class="_ _6"></span>的 <span class="ff4 ws745">Python </span><span class="lsa5 ws3b5">数据结构来表示一个组成一系列多边形的点的集<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y1651 ff1 fs3 fc0 sc0 ls0">合：</div><div class="t m0 x5 hf y1652 ff8 fs5 fc0 sc0 ls0 ws15f">polys <span class="fc6 ls33">=</span>[</div><div class="t m0 x15 hf y1653 ff8 fs5 fc0 sc0 ls0 ws13b">[ (<span class="fc7 ws13a">1.0</span><span class="ls33">,</span><span class="fc7 ws13a">2.5</span>), (<span class="fc7 ws13a">3.5</span><span class="ls32">,</span><span class="fc7 ws13a">4.0</span>), (<span class="fc7 ws13a">2.5</span><span class="ls32">,</span><span class="fc7 ws13a">1.5</span><span class="ws4">) ],</span></div><div class="t m0 x15 hf y1654 ff8 fs5 fc0 sc0 ls0 ws13b">[ (<span class="fc7 ws13a">7.0</span><span class="ls33">,</span><span class="fc7 ws13a">1.2</span>), (<span class="fc7 ws13a">5.1</span><span class="ls32">,</span><span class="fc7 ws13a">3.0</span>), (<span class="fc7 ws13a">0.5</span><span class="ls32">,</span><span class="fc7 ws13a">7.5</span><span class="ws4">), (<span class="fc7 ws13a">0.8</span><span class="ls33">,</span><span class="fc7 ws13a">9.0</span>) ],</span></div><div class="t m0 x15 hf y1655 ff8 fs5 fc0 sc0 ls0 ws13b">[ (<span class="fc7 ws13a">3.4</span><span class="ls33">,</span><span class="fc7 ws13a">6.3</span>), (<span class="fc7 ws13a">1.2</span><span class="ls32">,</span><span class="fc7 ws13a">0.5</span>), (<span class="fc7 ws13a">4.6</span><span class="ls32">,</span><span class="fc7 ws13a">9.2</span><span class="ws4">) ],</span></div><div class="t m0 x5 hf y1656 ff8 fs5 fc0 sc0 ls0">]</div><div class="t m0 x0 h9 y1657 ff1 fs3 fc0 sc0 ls0">现在假设这个数据被编码到一个以下列头部开始的二进制文件中去了：</div><div class="t m0 x5 hf y1658 ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y1659 ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 ws43e">Byte </span><span class="lsbd">|</span><span class="ff8 ws3ac">Type </span><span class="ls14a">|</span><span class="ff8 ws8c7">Description </span>|</div><div class="t m0 x5 hf y165a ff8 fs5 fc0 sc0 ls0">+======+========+====================================+</div><div class="t m0 x5 hf y165b ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 lsa0">0</span><span class="lsbd">|</span><span class="ff8 ws8c8">int </span><span class="ls14a">|</span><span class="ffc fs6 ws3d4">文件代码（</span><span class="ff8 ws13a">0x1234<span class="ffc fs6 ws8c9">，小端） </span></span>|</div><div class="t m0 x5 hf y151b ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y165c ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 lsa0">4</span><span class="lsbd">|</span><span class="ff8 ws145">double </span><span class="ls14a">|<span class="ff8 ls32">x</span></span><span class="ffc fs6 ws8ca">的最小值（小端） </span>|</div><div class="t m0 x5 hf y165d ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y165e ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 ws8cb">12 </span><span class="lsbd">|</span><span class="ff8 ws145">double </span><span class="ls14a">|<span class="ff8 ls32">y</span></span><span class="ffc fs6 ws8ca">的最小值（小端） </span>|</div><div class="t m0 x5 hf y165f ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y1660 ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 ws8cb">20 </span><span class="lsbd">|</span><span class="ff8 ws145">double </span><span class="ls14a">|<span class="ff8 ls32">x</span></span><span class="ffc fs6 ws8ca">的最大值（小端） </span>|</div><div class="t m0 x5 hf y1661 ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y1662 ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 ws8cb">28 </span><span class="lsbd">|</span><span class="ff8 ws145">double </span><span class="ls14a">|<span class="ff8 ls32">y</span></span><span class="ffc fs6 ws8ca">的最大值（小端） </span>|</div><div class="t m0 x5 hf y1663 ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 hf y1664 ffd fs5 fc0 sc0 ls0 ws13b">|<span class="ff8 ws8cb">36 </span><span class="lsbd">|</span><span class="ff8 ws8c8">int </span><span class="ls14a">|</span><span class="ffc fs6 ws8cc">三角形数量（小端） </span>|</div><div class="t m0 x5 hf y1665 ff8 fs5 fc0 sc0 ls0">+------+--------+------------------------------------+</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">8.12.<span class="_ _5"> </span>6.12 <span class="ff1 ws6e7">读取嵌套和可变长二进制数据 </span>196</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
