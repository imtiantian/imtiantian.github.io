<div id="pf8d" class="pf w0 h0" data-page-no="8d"><div class="pc pc8d w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg8d.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff13 fs3 fc0 sc0 ls0 ws5f8">David<span class="_ _18"> </span>Be<span class="_ _d"></span>azley <span class="ff1 ws5f9">在<span class="_ _6"></span>他<span class="_ _6"></span>的 <span class="ff4 fc3 ws5fa">Generator T<span class="_ _8"></span>ricks for Systems Programmers <span class="ff1 fc0 ls48 ws242">教程中对于这种<span class="_ _c"></span></span></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">技术有非常深入的讲解。可以参考这个教程获取更多的信息。</div><div class="t m0 x5 hd yf90 ff2 fs4 fc4 sc0 ls0 ws211">6.14<span class="_ _e"> </span>4.14 <span class="ff1">展开嵌套的序列</span></div><div class="t m0 x5 he yf91 ff2 fs2 fc4 sc0 ls0 ws212">6.14.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 yf92 ff1 fs3 fc0 sc0 ls0">你想将一个多层嵌套的序列展开成一个单层列表</div><div class="t m0 x5 he yf93 ff2 fs2 fc4 sc0 ls0 ws212">6.14.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 yf94 ff1 fs3 fc0 sc0 ls0 ws38">可以写一个包含 <span class="ff6 ws5fb">yield<span class="_ _11"> </span>from </span>语句的递归生成器来轻松解决这个问题。比如：</div><div class="t m0 x5 hf yf95 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">Iterable</span></span></div><div class="t m0 x5 hf yf96 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">flatten<span class="fc0 ws4">(items, ignore_types</span><span class="fc6">=<span class="fc0 ls34">(</span><span class="fca">str<span class="fc0 ls33">,</span>bytes<span class="fc0">)):</span></span></span></span></div><div class="t m0 x15 hf yf97 ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">x</span><span class="ws157">in <span class="ff8 fc0">items:</span></span></div><div class="t m0 x16 hf yf98 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">isinstance<span class="fc0 ws147">(x, Iterable) </span></span><span class="ws139">and not <span class="ff8 ws13a">isinstance<span class="fc0 ws13b">(x, ignore_types):</span></span></span></div><div class="t m0 x17 hf yf99 ff7 fs5 fca sc0 ls0 ws583">yield from <span class="ff8 fc0">flatten(x)</span></div><div class="t m0 x16 hf yf9a ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf yf9b ff7 fs5 fca sc0 ls0 ws16a">yield <span class="ff8 fc0">x</span></div><div class="t m0 x5 hf yf9c ff8 fs5 fc0 sc0 ls0 ws15f">items <span class="fc6 ls33">=</span><span class="ls34">[</span><span class="fc7 ws13a">1</span><span class="ls33">,</span><span class="fc7 ws13a">2</span><span class="ws4">, [<span class="fc7 ws13a">3</span><span class="ls33">,<span class="fc7 ls34">4</span></span><span class="ws13b">, [<span class="fc7 ws13a">5</span><span class="ls33">,<span class="fc7 ls34">6</span></span><span class="ws159">], <span class="fc7 ls34">7</span>], <span class="fc7 ws13a">8</span>]</span></span></span></div><div class="t m0 x5 h11 yf9d ffa fs5 fcd sc0 ls5e ws209">#P<span class="_ _15"></span>r<span class="_ _15"></span>o<span class="_ _15"></span>d<span class="_ _15"></span>u<span class="_ _15"></span>c<span class="_ _15"></span>e<span class="_ _15"></span>s12345678<span class="_ _15"></span></div><div class="t m0 x5 hf yf9e ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ls32">x</span><span class="ws160">in <span class="ff8 fc0">flatten(items):</span></span></div><div class="t m0 x15 hf yf9f ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0">(x)</span></div><div class="t m0 x0 h9 yfa0 ff1 fs3 fc0 sc0 ls0 ws5fc">在<span class="_ _6"></span>上面<span class="_ _6"></span>代<span class="_ _6"></span>码<span class="_ _6"></span>中， <span class="ff6 ws5fd">isinstance(x,<span class="_ _1c"> </span>Iterable) </span><span class="ls13 wse5">检查某个元素是否是可迭代的。如果<span class="_ _c"></span></span></div><div class="t m0 x5 h9 yfa1 ff1 fs3 fc0 sc0 ls0 ws5fe">是的话， <span class="ff6 ws5ff">yield<span class="_ _26"> </span>from </span><span class="wsa0">就会返回所有子例程的值。最终返回结果就是一个没有嵌套的简</span></div><div class="t m0 x5 h9 yfa2 ff1 fs3 fc0 sc0 ls0">单序列了。</div><div class="t m0 x0 h9 yfa3 ff1 fs3 fc0 sc0 ls0 ws38">额外的参数 <span class="ff6 ws17d">ignore<span class="_ _7"> </span>types </span><span class="ws63">和检测语句 <span class="ff6 ws25d">isinstance(x,<span class="_ _26"> </span>ignore<span class="_ _7"> </span>types) </span>用来将字符</span></div><div class="t m0 x5 h9 yfa4 ff1 fs3 fc0 sc0 ls13 wse5">串和字节排除在可迭代对象外<span class="_ _1"></span>，防止将它们再展开成单个的字符。这样的话字符串数<span class="_ _c"></span></div><div class="t m0 x5 h9 yfa5 ff1 fs3 fc0 sc0 ls0">组就能最终返回我们所期望的结果了。比如：</div><div class="t m0 x5 hf yfa6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws15f">items <span class="fc6 ls33">=</span><span class="ws13a">[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Dave<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">Paula<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, [<span class="ff9 fc9 ws13b">&apos;</span></span><span class="fc9">Thomas<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">Lewis<span class="ff9 ls34">&apos;</span></span>]]</span></span></div><div class="t m0 x5 hf yfa7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ls32">x</span><span class="ws157">in <span class="ff8 fc0">flatten(items):</span></span></span></div><div class="t m0 x5 hf yfa8 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(x)</span></span></div><div class="t m0 x5 h10 yfa9 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf yfaa ff8 fs5 fc8 sc0 ls0">Dave</div><div class="t m0 x5 hf yfab ff8 fs5 fc8 sc0 ls0">Paula</div><div class="t m0 x5 hf yfac ff8 fs5 fc8 sc0 ls0">Thomas</div><div class="t m0 x5 hf y24 ff8 fs5 fc8 sc0 ls0">Lewis</div><div class="t m0 x5 hf yfad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">6.14.<span class="_ _5"> </span>4.14 <span class="ff1 ws600">展开嵌套的序列 </span>132</div><a class="l" href="http://www.dabeaz.com/generators/"><div class="d m1" style="border-style:none;position:absolute;left:314.191500px;bottom:1131.880500px;width:223.949000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
