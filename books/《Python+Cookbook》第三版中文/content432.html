<div id="pf1b0" class="pf w0 h0" data-page-no="1b0"><div class="pc pc1b0 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1b0.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">send(b</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Hello World<span class="ff9">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc0 sc0 ls0 ws13c">resp <span class="fc6 ls32">=</span><span class="ls34">s<span class="fc6">.</span></span><span class="ws13a">recv(<span class="fc7">1024</span>)</span></div><div class="t m0 x5 he y2777 ff2 fs2 fc4 sc0 ls0 ws212">13.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y2778 ff6 fs3 fc0 sc0 ls0 wsfb0">hmac <span class="ff1 ls13 wse5">认证的一个常见使用场景是内部消息通信系统和进程间通信<span class="_ _1"></span>。例如，如果你<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y2779 ff1 fs3 fc0 sc0 ls2d ws132">编写的系统涉及到一个集群中多个处理器之间的通信，你可以使用本节方案来确保只<span class="_ _1"></span></div><div class="t m0 x5 h9 y277a ff1 fs3 fc0 sc0 ls149 wsfb1">有被允许的进程之间才能彼此通信<span class="_ _c"></span>。事实<span class="_ _6"></span>上<span class="_ _c"></span>，基于 <span class="ff6 ls0 wsfb2">hmac </span><span class="wsfb3">的认证被 <span class="ff6 ls0">multiprocessing</span></span></div><div class="t m0 x5 h9 y2c06 ff1 fs3 fc0 sc0 ls0">模块使用来实现子进程直接的通信。</div><div class="t m0 x0 h9 y277c ff1 fs3 fc0 sc0 ls3a ws153">还有一点需要强调的是连接认证和加密是两码事。认证成功之后的通信消息是以明</div><div class="t m0 x5 h9 y277d ff1 fs3 fc0 sc0 ls13 wse5">文形式发送的<span class="_ _1"></span>，任何人只要想监听这个连接线路都能看到消息（尽管双方的密钥不会<span class="_ _c"></span></div><div class="t m0 x5 h9 y2c07 ff1 fs3 fc0 sc0 ls0 wsa0">被传输）<span class="_ _f"></span>。</div><div class="t m0 x0 h7 y2c08 ff4 fs3 fc0 sc0 ls0 wsfb4">hmac <span class="ff1 wsfb5">认证算法基于哈希函数如 </span><span class="wsfb6">MD5 <span class="ff1 ls1ec">和</span><span class="wsa5">SHA-1<span class="ff1 wsfb7">，关于这个在 </span><span class="wsfb8">IETF RF<span class="_ _c"></span>C 2104 <span class="ff1">中有</span></span></span></span></div><div class="t m0 x5 h9 y19fd ff1 fs3 fc0 sc0 ls0">详细介绍。</div><div class="t m0 x5 hd y2c09 ff2 fs4 fc4 sc0 ls0 wsd91">13.10<span class="_ _e"> </span>11.10 <span class="ff1 ws165">在网络服务中加入 </span>SSL</div><div class="t m0 x5 he y31b ff2 fs2 fc4 sc0 ls0 wsadf">13.10.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y1f01 ff1 fs3 fc0 sc0 ls0 wsfb9">你想实现一个基于 <span class="ff4 wsfba">so<span class="_ _6"></span>ck<span class="_ _c"></span>ets <span class="ff1 ls3a wsfbb">的网络服务，客户端和服务器通过 </span><span class="wsfbc">SSL <span class="ff1 ls3a ws153">协议认证并加密</span></span></span></div><div class="t m0 x5 h9 y2c0a ff1 fs3 fc0 sc0 ls0">传输的数据。</div><div class="t m0 x5 he y2c0b ff2 fs2 fc4 sc0 ls0 wsadf">13.10.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y2c0c ff6 fs3 fc0 sc0 ls0 wsfbd">ssl <span class="ff1 wsfbe">模块<span class="_ _6"></span>能为<span class="_ _6"></span>底层 <span class="ff4 wsfbf">so<span class="_ _6"></span>ck<span class="_ _c"></span>et <span class="ff1 wsfc0">连接<span class="_ _6"></span>添加 </span><span class="wsfc1">SSL <span class="ff1 wsfc2">的<span class="_ _6"></span>支持。 <span class="ff6 wsfc3">ssl.wrap<span class="_ _7"> </span>socket() </span><span class="wsa0">函数<span class="_ _6"></span>接受<span class="_ _6"></span>一</span></span></span></span></span></div><div class="t m0 x5 h7 y2c0d ff1 fs3 fc0 sc0 ls0 wsfc4">个已存在的 <span class="ff4 wsfc5">so<span class="_ _6"></span>ck<span class="_ _c"></span>et <span class="ff1 ls82 wsfc6">作为参数并使用 </span><span class="wsfc7">SSL <span class="ff1 ls82 ws2f9">层来包装它。例如，下面是一个简单的应答服</span></span></span></div><div class="t m0 x5 h9 y2c0e ff1 fs3 fc0 sc0 ls0">务器，能在服务器端为所有客户端连接做认证。</div><div class="t m0 x5 hf y2c0f ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws146">socket <span class="fca">import <span class="ff8 fc0 ws13b">socket, AF_INET, SOCK_STREAM</span></span></span></div><div class="t m0 x5 h10 y2c10 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">ssl</span></div><div class="t m0 x5 hf y877 ff8 fs5 fc0 sc0 ls0 ws155">KEYFILE <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">server_key.pem<span class="ff9 lsa1">&apos;</span><span class="ffa fcd ws4"># Private key of the server</span></span></div><div class="t m0 x5 hf y2c11 ff8 fs5 fc0 sc0 ls0 ws16d">CERTFILE <span class="fc6 ls32">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">server_cert.pem<span class="ff9 ls32">&apos;</span><span class="ffa fcd ws4"># Server certificate (given to client)</span></span></div><div class="t m0 x5 hf y2c12 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">echo_client<span class="fc0">(s):</span></span></div><div class="t m0 x15 hf y1b02 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y126b ff8 fs5 fc0 sc0 ls0 ws161">data <span class="fc6 ls33">=</span><span class="ls34">s</span><span class="fc6 ws13a">.<span class="fc0">recv(<span class="fc7">8192</span>)</span></span></div><div class="t m0 x16 hf y2c13 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13c">data <span class="fc6 ws159">== </span><span class="ls34">b</span><span class="ff9 fc9 ws13b">&apos;&apos;</span>:</span></div><div class="t m0 x17 h10 y2c14 ff7 fs5 fca sc0 ls0">break</div><div class="t m0 x16 hf y2c15 ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">send(data)</span></span></div><div class="t m0 x15 hf y2c16 ff8 fs5 fc0 sc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x15 hf y2c17 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Connection closed<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">13.10.<span class="_ _36"> </span>11.10 <span class="ff1 ws16b">在网络服务中加入 </span><span class="wsfc8">SSL 423</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
