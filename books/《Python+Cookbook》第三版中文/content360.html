<div id="pf168" class="pf w0 h0" data-page-no="168"><div class="pc pc168 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg168.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">11.21<span class="_ _e"> </span>9.21 <span class="ff1">避免重复的属性方法</span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 wsadf">11.21.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2b2 ff1 fs3 fc0 sc0 ls3a ws153">你在类中需要重复的定义一些执行相同逻辑的属性方法，比如进行类型检查，怎样</div><div class="t m0 x5 h9 y23ec ff1 fs3 fc0 sc0 ls0">去简化这些重复代码呢？</div><div class="t m0 x5 he y256b ff2 fs2 fc4 sc0 ls0 wsadf">11.21.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y256c ff1 fs3 fc0 sc0 ls0">考虑下一个简单的类，它的属性由属性方法包装：</div><div class="t m0 x5 hf y256d ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Person<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y256e ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, name ,age):</span></span></span></div><div class="t m0 x16 hf y256f ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">name </span><span class="ls33">=</span><span class="fc0">name</span></span></div><div class="t m0 x16 hf y2570 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws158">age </span><span class="ls33">=</span><span class="fc0">age</span></span></div><div class="t m0 x15 h10 y2571 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf y2572 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">name<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y2573 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_name</span></span></div><div class="t m0 x15 h10 y2574 ff7 fs5 fc12 sc0 ls0">@name.setter</div><div class="t m0 x15 hf y2575 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">name<span class="fc0">(<span class="fca">self</span><span class="ws4">, value):</span></span></span></div><div class="t m0 x16 hf y2576 ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws155">(value, </span>str<span class="fc0">):</span></span></div><div class="t m0 x17 hf y2577 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">name must be a string<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x16 hf y2578 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_name </span><span class="ls32">=</span><span class="fc0">value</span></span></div><div class="t m0 x15 h10 y2579 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf y257a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">age<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y257b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_age</span></span></div><div class="t m0 x15 h10 y257c ff7 fs5 fc12 sc0 ls0">@age.setter</div><div class="t m0 x15 hf y257d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">age<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, value):</span></span></span></div><div class="t m0 x16 hf y257e ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws155">(value, </span>int<span class="fc0">):</span></span></div><div class="t m0 x17 hf y257f ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">age must be an int<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x16 hf y2580 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws13c">_age </span><span class="ls33">=</span><span class="fc0">value</span></span></div><div class="t m0 x0 h9 y2581 ff1 fs3 fc0 sc0 ls3a ws153">可以看到，为了实现属性值的类型检查我们写了很多的重复代码。只要你以后看到</div><div class="t m0 x5 h9 y2582 ff1 fs3 fc0 sc0 ls13 wse5">类似这样的代码<span class="_ _1"></span>，你都应该想办法去简化它。一个可行的方法是创建一个函数用来定<span class="_ _c"></span></div><div class="t m0 x5 h9 y2583 ff1 fs3 fc0 sc0 ls0">义属性并返回它。例如：</div><div class="t m0 x5 hf y1a2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">typed_property<span class="fc0 ws4">(name, expected_type):</span></span></div><div class="t m0 x15 hf y1a3 ff8 fs5 fc0 sc0 ls0 ws150">storage_name <span class="fc6 ls33">=<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">_<span class="ff9 ls33">&apos;</span><span class="fc6 ls32">+</span></span>name</div><div class="t m0 x15 h10 y1a5 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf y1a6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">prop<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1a7 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">getattr<span class="fc0 ls34">(</span>self<span class="fc0 ws13b">, storage_name)</span></span></div><div class="t m0 x15 h10 y1a9 ff7 fs5 fc12 sc0 ls0">@prop.setter</div><div class="t m0 x15 hf y1aa ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">prop<span class="fc0">(<span class="fca">self</span><span class="ws4">, value):</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.21.<span class="_ _5"> </span>9.21 <span class="ff1 wsca6">避免重复的属性方法 </span>351</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
