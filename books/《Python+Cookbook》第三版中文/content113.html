<div id="pf71" class="pf w0 h0" data-page-no="71"><div class="pc pc71 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg71.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">get_previous_byday(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Monday<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0 ws4">datetime.datetime(2012, 8, 27, 22, 3, 57, 29045)</div><div class="t m0 x5 hf y1ad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">get_previous_byday(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Tuesday<span class="ff9 ws13b">&apos;</span></span><span class="ls33">)</span><span class="ffa fcd ws4"># Previous week, not today</span></span></div><div class="t m0 x5 hf y1ae ff8 fs5 fc8 sc0 ls0 ws4">datetime.datetime(2012, 8, 21, 22, 4, 12, 629771)</div><div class="t m0 x5 hf y1af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">get_previous_byday(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Friday<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y1b0 ff8 fs5 fc8 sc0 ls0 ws4">datetime.datetime(2012, 8, 24, 22, 5, 9, 911393)</div><div class="t m0 x5 hf y355 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y356 ff1 fs3 fc0 sc0 ls0 ws38">可选的 <span class="ff6 ws17a">start<span class="_ _7"> </span>date </span><span class="ws63">参数可以由另外一个 <span class="ff6 ws1f3">datetime </span>实例来提供。比如：</span></div><div class="t m0 x5 hf y357 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">get_previous_byday(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Sunday<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, datetime(</span><span class="fc7">2012</span><span class="ls33">,</span><span class="fc7">12</span><span class="ls33">,</span><span class="fc7">21</span>))</span></div><div class="t m0 x5 hf y358 ff8 fs5 fc8 sc0 ls0 ws4">datetime.datetime(2012, 12, 16, 0, 0)</div><div class="t m0 x5 hf yca3 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he yca4 ff2 fs2 fc4 sc0 ls0 ws212">5.13.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 yca5 ff1 fs3 fc0 sc0 lse ws513">上面的算法原理是这样的：先将开始日期和目标日期映射到星期数组的位置上 <span class="ff4 ls0 wsa5">(<span class="ff1">星</span></span></div><div class="t m0 x5 h7 yca6 ff1 fs3 fc0 sc0 ls12 ws514">期一索引为 <span class="ff4 ls0 wsa5">0)</span><span class="wse4">，然后通过模运算计算出目标日期要经过多少天才能到达开始日期<span class="_ _1"></span>。然</span></div><div class="t m0 x5 h9 yca7 ff1 fs3 fc0 sc0 ls0">后用开始日期减去那个时间差即得到结果日期。</div><div class="t m0 x0 h9 yca8 ff1 fs3 fc0 sc0 ls1f ws515">如果你要像这样执行大量的日期计算的话，你最好安装第三方包 <span class="ff6 ls0 ws303">python-dateutil</span></div><div class="t m0 x5 h9 yca9 ff1 fs3 fc0 sc0 ls1e ws516">来代替<span class="_ _1"></span>。比如，下面是是使用 <span class="ff6 ls0 ws29a">dateutil </span><span class="ws517">模块中的 <span class="ff6 ls0 ws518">relativedelta() </span><span class="ws111">函数执行同样的<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 ycaa ff1 fs3 fc0 sc0 ls0">计算：</div><div class="t m0 x5 hf ycab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws248">datetime </span><span class="ws146">import <span class="ff8 fc0">datetime</span></span></span></div><div class="t m0 x5 hf ycac ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws519">dateutil.relativedelta </span><span class="ws146">import <span class="ff8 fc0">relativedelta</span></span></span></div><div class="t m0 x5 hf ycad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws51a">dateutil.rrule </span><span class="ws1ff">import <span class="ff8 fc6">*</span></span></span></div><div class="t m0 x5 hf y8ee ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">d<span class="fc6 ls33">=</span><span class="ls0 ws13a">datetime<span class="fc6">.</span>now()</span></span></div><div class="t m0 x5 hf ycae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0">(d)</span></span></div><div class="t m0 x5 hf ycaf ff8 fs5 fc8 sc0 ls0 ws4">2012-12-23 16:31:52.718111</div><div class="t m0 x5 h11 ycb0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws13b"># Next Friday</span></div><div class="t m0 x5 hf ycb1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws159">(d <span class="fc6 ls32">+</span><span class="ws13a">relativedelta(weekday<span class="fc6 ls34">=</span>FR))</span></span></span></div><div class="t m0 x5 hf ycb2 ff8 fs5 fc8 sc0 ls0 ws4">2012-12-28 16:31:52.718111</div><div class="t m0 x5 hf ycb3 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h11 ycb4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws13b"># Last Friday</span></div><div class="t m0 x5 hf ycb5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws159">(d <span class="fc6 ls32">+</span><span class="ws13a">relativedelta(weekday<span class="fc6 ls34">=</span>FR(<span class="fc6 ls34">-<span class="fc7">1</span></span>)))</span></span></span></div><div class="t m0 x5 hf ycb6 ff8 fs5 fc8 sc0 ls0 ws4">2012-12-21 16:31:52.718111</div><div class="t m0 x5 hf ycb7 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hd ycb8 ff2 fs4 fc4 sc0 ls0 ws211">5.14<span class="_ _e"> </span>3.14 <span class="ff1">计算当前月份的日期范围</span></div><div class="t m0 x5 he ycb9 ff2 fs2 fc4 sc0 ls0 ws212">5.14.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 ycba ff1 fs3 fc0 sc0 ls63 ws21f">你的代码需要在当前月份中循环每一天<span class="_ _c"></span>，想找到一个计算这个日期范围的高效方<span class="_ _1"></span></div><div class="t m0 x5 h9 ycbb ff1 fs3 fc0 sc0 ls0">法。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">5.14.<span class="_ _5"> </span>3.14 <span class="ff1 ws512">计算当前月份的日期范围 </span>104</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
