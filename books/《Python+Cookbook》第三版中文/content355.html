<div id="pf163" class="pf w0 h0" data-page-no="163"><div class="pc pc163 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg163.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x18 hf y1ab ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(</span></span></div><div class="t m0 x29 hf y1ac ff9 fs5 fc9 sc0 ls0 ws13b">&apos;<span class="ff8 ws4">Argument {} must be annotated with a type</span><span class="ls34">&apos;<span class="ff8 fc6">.<span class="fc0 ls0">format(name)</span></span></span></div><div class="t m0 x18 hf y1ad ff8 fs5 fc0 sc0 ls0">)</div><div class="t m0 x17 hf y1ae ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0">(parm<span class="fc6">.</span><span class="ws208">annotation, </span></span>type<span class="fc0">):</span></span></div><div class="t m0 x18 hf y1af ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(</span></span></div><div class="t m0 x29 hf y1b0 ff9 fs5 fc9 sc0 ls0 ws13b">&apos;<span class="ff8 ws4">Argument {} annotation must be a type</span><span class="ls34">&apos;<span class="ff8 fc6">.<span class="fc0 ls0">format(name)</span></span></span></div><div class="t m0 x18 hf y355 ff8 fs5 fc0 sc0 ls0">)</div><div class="t m0 x17 hf y410 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">parm<span class="fc6 ls34">.</span><span class="ws1f4">default </span></span><span class="ws38d">is not <span class="ff8 fc0 ws13a">inspect<span class="fc6">.</span>Parameter<span class="fc6 ls34">.</span>empty:</span></span></div><div class="t m0 x18 hf y411 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_methods[</span></span>tuple<span class="fc0 ws16d">(types)] <span class="fc6 ls32">=</span>meth</span></div><div class="t m0 x17 hf yba ff8 fs5 fc0 sc0 ls0 ws13a">types<span class="fc6 ls34">.</span>append(parm<span class="fc6 ls34">.</span>annotation)</div><div class="t m0 x16 hf ybed ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_methods[</span></span>tuple<span class="fc0 ws1f5">(types)] <span class="fc6 ls33">=</span>meth</span></div><div class="t m0 x15 hf ybef ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__call__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span>args):</span></span></div><div class="t m0 x16 h15 ybf0 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 yd7d ffa fs5 fc9 sc0 ls0 ws4">Call a method based on type signature of the arguments</div><div class="t m0 x16 h15 ybf1 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf ybf2 ff8 fs5 fc0 sc0 ls0 ws15f">types <span class="fc6 ls33">=</span><span class="fca ws13a">tuple</span><span class="ls34">(</span><span class="fca ws13a">type</span>(arg) <span class="ff7 fca ws139">for </span><span class="ws158">arg <span class="ff7 fca ws157">in </span><span class="ws13a">args[<span class="fc7 ls34">1</span>:])</span></span></div><div class="t m0 x16 hf ybf3 ff8 fs5 fc0 sc0 ls0 ws161">meth <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_methods<span class="fc6 ls34">.</span><span class="ws2a3">get(types, </span></span>None</span>)</div><div class="t m0 x16 hf ybf4 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0">meth:</span></div><div class="t m0 x17 hf ybf5 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">meth(<span class="fc6 ls34">*</span>args)</span></div><div class="t m0 x16 hf ybf6 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf ybf7 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">No matching method for types {}<span class="ff9 ws13b">&apos;</span><span class="fc6 ls34">.</span></span>format(types))</span></span></div><div class="t m0 x15 hf ybf9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__get__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, instance, cls):</span></span></span></div><div class="t m0 x16 h15 ybfa ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 ybfb ffa fs5 fc9 sc0 ls0 ws4">Descriptor method needed to make calls work in a class</div><div class="t m0 x16 h15 y1ed6 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y1ed7 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">instance </span>is not <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1ed8 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">types<span class="fc6 ls34">.</span>MethodType(<span class="fca">self</span><span class="ws4">, instance)</span></span></div><div class="t m0 x16 hf y1f83 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1ed9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">self</span></div><div class="t m0 x5 hf y1edb ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">MultiDict<span class="ff8 fc0 ls34">(</span></span><span class="ff8 ws13a">dict<span class="fc0">):</span></span></div><div class="t m0 x15 h15 y1f84 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y2515 ffa fs5 fc9 sc0 ls0 ws4">Special dictionary to build multimethods in a metaclass</div><div class="t m0 x15 h15 y1edc ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y1edd ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key, value):</span></span></span></div><div class="t m0 x16 hf y1ede ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws158">key </span>in <span class="ff8 ws13a">self<span class="fc0">:</span></span></div><div class="t m0 x17 h11 y1edf ffa fs5 fcd sc0 ls0 ws4"># If key already exists, it must be a multimethod or callable</div><div class="t m0 x17 hf y1ee0 ff8 fs5 fc0 sc0 ls0 ws147">current_value <span class="fc6 ls32">=</span><span class="fca ws13a">self</span>[key]</div><div class="t m0 x17 hf y2516 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">isinstance<span class="fc0 ws4">(current_value, MultiMethod):</span></span></div><div class="t m0 x18 hf y1ee1 ff8 fs5 fc0 sc0 ls0 ws13a">current_value<span class="fc6 ls34">.</span>register(value)</div><div class="t m0 x17 hf y1ee2 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x18 hf y1ee3 ff8 fs5 fc0 sc0 ls0 ws145">mvalue <span class="fc6 ls32">=</span>MultiMethod(key)</div><div class="t m0 x18 hf y1f85 ff8 fs5 fc0 sc0 ls0 ws13a">mvalue<span class="fc6 ls34">.</span>register(current_value)</div><div class="t m0 x18 hf y1ee4 ff8 fs5 fc0 sc0 ls0 ws13a">mvalue<span class="fc6 ls34">.</span>register(value)</div><div class="t m0 x18 hf y1ee5 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6">.</span><span class="ws4">__setitem__(key, mvalue)</span></span></div><div class="t m0 x16 hf y1ee6 ff7 fs5 fca sc0 ls0 ws156">else<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y1f86 ff8 fs5 fca sc0 ls0 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__setitem__(key, value)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.20.<span class="_ _5"> </span>9.20 <span class="ff1 wsc0a">利用函数注解实现方法重载 </span>346</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
