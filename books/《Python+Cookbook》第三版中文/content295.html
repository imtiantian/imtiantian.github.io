<div id="pf127" class="pf w0 h0" data-page-no="127"><div class="pc pc127 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg127.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1e8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Sub<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1e9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">-</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y903 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Mul<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1eb ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">*</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y904 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Div<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y905 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span><span class="ws15f">left) <span class="fc6 ls32">/</span></span></span>self<span class="fc6 ls34">.</span><span class="fc0">visit(node<span class="fc6 ls34">.</span>right)</span></span></div><div class="t m0 x15 hf y907 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Negate<span class="fc0">(<span class="fca">self</span><span class="ws4">, node):</span></span></span></div><div class="t m0 x16 hf y908 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc6 ls34">-<span class="fc0 ls0 ws13a">node<span class="fc6">.</span>operand</span></span></div><div class="t m0 x0 h9 y1f3f ff1 fs3 fc0 sc0 ls0">使用示例：</div><div class="t m0 x5 hf y1bdb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">e<span class="fc6 ls33">=</span><span class="ls0">Evaluator()</span></span></div><div class="t m0 x5 hf y1bdc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">e<span class="fc6 ls0 ws13a">.<span class="fc0">visit(t4)</span></span></span></div><div class="t m0 x5 hf y814 ff8 fs5 fc8 sc0 ls0">0.6</div><div class="t m0 x5 hf y815 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1f40 ff1 fs3 fc0 sc0 ls3a ws153">作为一个不同的例子，下面定义一个类在一个栈上面将一个表达式转换成多个操作</div><div class="t m0 x5 h9 y1f41 ff1 fs3 fc0 sc0 ls0">序列：</div><div class="t m0 x5 hf y1f42 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">StackCode<span class="ff8 fc0">(NodeVisitor):</span></span></div><div class="t m0 x15 hf y1f43 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">generate_code<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1275 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws3c7">instructions </span><span class="ls32">=</span><span class="fc0">[]</span></span></div><div class="t m0 x16 hf y1f44 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">visit(node)</span></span></div><div class="t m0 x16 hf y1f45 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">instructions</span></span></div><div class="t m0 x15 hf y1f46 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Number<span class="fc0">(<span class="fca">self</span><span class="ws4">, node):</span></span></span></div><div class="t m0 x16 hf y1f47 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">instructions</span><span class="ls34">.</span><span class="fc0">append((<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">PUSH<span class="ff9 ls34">&apos;</span></span><span class="ws4">, node</span></span><span class="ls34">.</span><span class="fc0">value))</span></span></div><div class="t m0 x15 hf y1f48 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">binop<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, node, instruction):</span></span></span></div><div class="t m0 x16 hf y1f49 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">visit(node</span>.<span class="fc0">left)</span></span></div><div class="t m0 x16 hf y1f4a ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">visit(node</span>.<span class="fc0">right)</span></span></div><div class="t m0 x16 hf y1f4b ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">instructions</span><span class="ls34">.</span><span class="fc0">append((instruction,))</span></span></div><div class="t m0 x15 hf y1f4c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Add<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf ydb ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">binop(node, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">ADD<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x15 hf y1f4d ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Sub<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1f4e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">binop(node, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">SUB<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x15 hf y1f4f ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Mul<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf y1f50 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">binop(node, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">MUL<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x15 hf y1f51 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">visit_Div<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node):</span></span></span></div><div class="t m0 x16 hf ye4 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">binop(node, <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">DIV<span class="ff9 ls34">&apos;</span><span class="fc0">)</span></span></span></div><div class="t m0 x15 hf ye6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">unaryop<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, node, instruction):</span></span></span></div><div class="t m0 x16 hf ye7 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">visit(node</span>.<span class="fc0">operand)</span></span></div><div class="t m0 x16 hf ye8 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">instructions</span><span class="ls34">.</span><span class="fc0">append((instruction,))</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.21.<span class="_ _5"> </span>8.21 <span class="ff1 wsb0f">实现访问者模式 </span>286</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
