<div id="pf74" class="pf w0 h0" data-page-no="74"><div class="pc pc74 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg74.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y181 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">diff</span></div><div class="t m0 x5 hf y182 ff8 fs5 fc8 sc0 ls0 ws4">datetime.timedelta(3, 77824, 177393)</div><div class="t m0 x5 hf y183 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he ycf6 ff2 fs2 fc4 sc0 ls0 ws212">5.15.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 ycf7 ff6 fs3 fc0 sc0 ls0 ws534">datetime.strptime() <span class="ff1 ws535">方法支持很多的格式化代码，<span class="_ _1"></span>比如 <span class="ff6 ws536">%Y </span><span class="ws3f8">代表 <span class="ff4 lse1">4</span><span class="ws537">位数年份， <span class="ff6">%m</span></span></span></span></div><div class="t m0 x5 h9 ycf8 ff1 fs3 fc0 sc0 ls13 wse5">代表两位数月份<span class="_ _1"></span>。还有一点值得注意的是这些格式化占位符也可以反过来使用，将日<span class="_ _c"></span></div><div class="t m0 x5 h9 ycf9 ff1 fs3 fc0 sc0 ls0">期输出为指定的格式字符串形式。</div><div class="t m0 x0 h9 ycfa ff1 fs3 fc0 sc0 ls3d ws538">比如，假设你的代码中生成了一个 <span class="ff6 ls0 ws2c3">datetime </span><span class="ws164">对象，你想将它格式化为漂亮易读形<span class="_ _1"></span></span></div><div class="t m0 x5 h9 ycfb ff1 fs3 fc0 sc0 ls0">式后放在自动生成的信件或者报告的顶部：</div><div class="t m0 x5 hf ycfc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">z</span></div><div class="t m0 x5 hf ycfd ff8 fs5 fc8 sc0 ls0 ws4">datetime.datetime(2012, 9, 23, 21, 37, 4, 177393)</div><div class="t m0 x5 hf ycfe ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws145">nice_z <span class="fc6 ls32">=</span><span class="ws13a">datetime<span class="fc6 ls34">.</span><span class="ws208">strftime(z, <span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws1a1">%A %B </span></span></span><span class="ffa fcf">%d</span><span class="fc9 ws1a1">, %Y<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ycff ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">nice_z</span></div><div class="t m0 x5 hf yd00 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Sunday September 23, 2012<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf yd01 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 yd02 ff1 fs3 fc0 sc0 ls18 ws539">还有一点需要注意的是， <span class="ff6 ls0 ws141">strptime() </span><span class="ws110">的性能要比你想象中的差很多，因为它是使<span class="_ _1"></span></span></div><div class="t m0 x5 h7 yd03 ff1 fs3 fc0 sc0 ls0 ws348">用纯 <span class="ff4 ws12b">Python </span><span class="wsa0">实现，并且必须处理所有的系统本地设置。<span class="_ _1"></span>如果你要在代码中需要解析大</span></div><div class="t m0 x5 h9 yd04 ff1 fs3 fc0 sc0 ls2d ws132">量的日期并且已经知道了日期字符串的确切格式，可以自己实现一套解析方案来获取<span class="_ _1"></span></div><div class="t m0 x5 h9 yd05 ff1 fs3 fc0 sc0 ls0 ws53a">更好的性能。比如，<span class="_ _1"></span>如果你已经知道所以日期格式是 <span class="ff6 ws53b">YYYY-MM-DD </span><span class="wsa0">，你可以像下面这样</span></div><div class="t m0 x5 h9 yd06 ff1 fs3 fc0 sc0 ls0">实现一个解析函数：</div><div class="t m0 x5 hf yd07 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">datetime </span><span class="ws146">import <span class="ff8 fc0">datetime</span></span></div><div class="t m0 x5 hf yd08 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">parse_ymd<span class="fc0">(s):</span></span></div><div class="t m0 x15 hf yd09 ff8 fs5 fc0 sc0 ls0 ws13b">year_s, mon_s, day_s <span class="fc6 ls33">=</span><span class="ws13a">s<span class="fc6 ls34">.</span>split(<span class="ff9 fc9 ls34">&apos;<span class="ff8">-</span>&apos;</span>)</span></div><div class="t m0 x15 hf yd0a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">datetime(<span class="fca">int</span><span class="ws16e">(year_s), </span><span class="fca">int</span><span class="ws16d">(mon_s), </span><span class="fca">int</span>(day_s))</span></div><div class="t m0 x0 h7 yd0b ff1 fs3 fc0 sc0 ls0 ws53c">实际<span class="_ _6"></span>测<span class="_ _6"></span>试<span class="_ _6"></span>中，这<span class="_ _6"></span>个<span class="_ _6"></span>函数<span class="_ _6"></span>比 <span class="ff6 ws53d">datetime.strptime() </span><span class="ls47">快<span class="ff4 lse2">7</span></span><span class="wsa0">倍<span class="_ _6"></span>多。<span class="_ _6"></span>如果<span class="_ _6"></span>你<span class="_ _6"></span>要<span class="_ _6"></span>处理<span class="_ _6"></span>大<span class="_ _6"></span>量的</span></div><div class="t m0 x5 h9 yd0c ff1 fs3 fc0 sc0 ls0">涉及到日期的数据的话，那么最好考虑下这个方案！</div><div class="t m0 x5 hd yd0d ff2 fs4 fc4 sc0 ls0 ws211">5.16<span class="_ _e"> </span>3.16 <span class="ff1">结合时区的日期操作</span></div><div class="t m0 x5 he yd0e ff2 fs2 fc4 sc0 ls0 ws212">5.16.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 yd0f ff1 fs3 fc0 sc0 ls0 ws1f0">你有一个安排在 <span class="ff4 ws53e">2012 </span><span class="lse3">年</span><span class="ff4 ws53f">12 </span><span class="lse4">月</span><span class="ff4 ws53f">21 </span>日早上 <span class="ff4 ws540">9:30 </span><span class="wsa0">的电话会议，地点在芝加哥。<span class="_ _c"></span>而你的</span></div><div class="t m0 x5 h9 yd10 ff1 fs3 fc0 sc0 ls0">朋友在印度的班加罗尔，那么他应该在当地时间几点参加这个会议呢？</div><div class="t m0 x5 he yd11 ff2 fs2 fc4 sc0 ls0 ws212">5.16.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 yd12 ff1 fs3 fc0 sc0 ls2c ws3c2">对几乎所有涉及到时区的问题，你都应该使用 <span class="ff6 ls0 ws541">pytz </span><span class="ws542">模块。这个包提供了 <span class="ff4 ls0 ws543">Olson <span class="ff1">时</span></span></span></div><div class="t m0 x5 h9 yd13 ff1 fs3 fc0 sc0 ls0">区数据库，它是时区信息的事实上的标准，在很多语言和操作系统里面都可以找到。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">5.16.<span class="_ _5"> </span>3.16 <span class="ff1 ws544">结合时区的日期操作 </span>107</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
