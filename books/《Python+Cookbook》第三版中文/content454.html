<div id="pf1c6" class="pf w0 h0" data-page-no="1c6"><div class="pc pc1c6 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1c6.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h10 y334 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">multiprocessing</span></div><div class="t m0 x5 hf y335 ff8 fs5 fc0 sc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0 ws13a">CountdownTask(<span class="fc7 ls34">5</span>)</span></div><div class="t m0 x5 hf y336 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0 ws13a">multiprocessing<span class="fc6 ls34">.</span>Process(target<span class="fc6">=</span><span class="ls34">c<span class="fc6">.</span></span>run)</span></div><div class="t m0 x5 hf y337 ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x0 h7 y2db1 ff1 fs3 fc0 sc0 ls0 ws1068">再次<span class="_ _6"></span>重<span class="_ _6"></span>申，<span class="_ _6"></span>这段<span class="_ _6"></span>代<span class="_ _6"></span>码仅<span class="_ _6"></span>适<span class="_ _6"></span>用于 <span class="ff4 ws1069">Countdo<span class="_ _c"></span>wnT<span class="_ _d"></span>ask <span class="ff1 ls30 ws138">类是以独立于实际的并发手段（多<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y22a5 ff1 fs3 fc0 sc0 ls0">线程、多进程等等）实现的情况。</div><div class="t m0 x5 hd y2db2 ff2 fs4 fc4 sc0 ls0 ws211">14.2<span class="_ _e"> </span>12.2 <span class="ff1">判断线程是否已经启动</span></div><div class="t m0 x5 he y2829 ff2 fs2 fc4 sc0 ls0 ws212">14.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y2db3 ff1 fs3 fc0 sc0 ls0">你已经启动了一个线程，但是你想知道它是不是真的已经开始运行了。</div><div class="t m0 x5 he y2db4 ff2 fs2 fc4 sc0 ls0 ws212">14.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y2db5 ff1 fs3 fc0 sc0 ls63 ws21f">线程的一个关键特性是每个线程都是独立运行且状态不可预测<span class="_ _c"></span>。如果程序中的其<span class="_ _1"></span></div><div class="t m0 x5 h9 y2db6 ff1 fs3 fc0 sc0 ls2d ws132">他线程需要通过判断某个线程的状态来确定自己下一步的操作，这时线程同步问题就<span class="_ _1"></span></div><div class="t m0 x5 h9 y2db7 ff1 fs3 fc0 sc0 ls14 ws106a">会变得非常棘手<span class="_ _1"></span>。为了解决这些问题，我们需要使用 <span class="ff6 ls0 ws33a">threading </span><span class="ws106b">库中的 <span class="ff6 ls0 ws177">Event <span class="ff1 wsa0">对象。</span></span></span></div><div class="t m0 x5 h9 y2db8 ff6 fs3 fc0 sc0 ls0 ws106c">Event <span class="ff1 ls14 ws174">对象包含一个可由线程设置的信号标志<span class="_ _1"></span>，它允许线程等待某些事件的发生<span class="_ _1"></span>。在<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y2db9 ff1 fs3 fc0 sc0 ls40 ws180">初始情况下<span class="_ _1"></span>，<span class="ff4 ls0 ws106d">even<span class="_ _c"></span>t <span class="ff1 ls40 ws106e">对象中的信号标志被设置为假。如果有线程等待一个 </span><span class="ws106f">ev<span class="_ _c"></span>ent <span class="ff1 wsa0">对象，</span></span></span></div><div class="t m0 x5 h7 y2dba ff1 fs3 fc0 sc0 ls48 ws1070">而这个 <span class="ff4 ls0 ws1071">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 ls48 ws242">对象的标志为假，那么这个线程将会被一直阻塞直至该标志为真<span class="_ _c"></span>。一个</span></span></div><div class="t m0 x5 h7 y15d8 ff1 fs3 fc0 sc0 ls0 ws1072">线程如果将一个 <span class="ff4 ws1073">ev<span class="_ _1"></span>en<span class="_ _1"></span>t <span class="ff1 wse8d">对象的信号标志设置为真，它将唤醒所有等待这个 </span><span class="ws1074">ev<span class="_ _c"></span>ent <span class="ff1">对象的</span></span></span></div><div class="t m0 x5 h7 y2dbb ff1 fs3 fc0 sc0 lse ws1075">线程。如果一个线程等待一个已经被设置为真的 <span class="ff4 ls0 ws1076">ev<span class="_ _c"></span>ent <span class="ff1 wsa0">对象，那么<span class="_ _6"></span>它将忽<span class="_ _6"></span>略这<span class="_ _6"></span>个事件，</span></span></div><div class="t m0 x5 h9 y2dbc ff1 fs3 fc0 sc0 ls0 ws63">继续执行。下边的代码展示了如何使用 <span class="ff6 ws17d">Event </span>来协调线程的启动：</div><div class="t m0 x5 hf y2dbd ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">threading </span><span class="ws146">import <span class="ff8 fc0 ws4">Thread, Event</span></span></div><div class="t m0 x5 h10 y2dbe ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">time</span></div><div class="t m0 x5 h11 y2dbf ffa fs5 fcd sc0 ls0 ws4"># Code to execute in an independent thread</div><div class="t m0 x5 hf y2dc0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0 ws4">(n, started_evt):</span></span></div><div class="t m0 x15 hf y2dc1 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">countdown starting<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x15 hf y2dc2 ff8 fs5 fc0 sc0 ls0 ws13a">started_evt<span class="fc6 ls34">.</span>set()</div><div class="t m0 x15 hf y2dc3 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></div><div class="t m0 x16 hf y2dc4 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">T-minus</span>&apos;</span><span class="ls0 ws13b">, n)</span></span></div><div class="t m0 x16 hf y2dc5 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x16 hf y2dc6 ff8 fs5 fc0 sc0 ls0 ws13a">time<span class="fc6">.</span>sleep(<span class="fc7 ls34">5</span>)</div><div class="t m0 x5 h11 y2dc7 ffa fs5 fcd sc0 ls0 ws4"># Create the event object that will be used to signal startup</div><div class="t m0 x5 hf y2dc8 ff8 fs5 fc0 sc0 ls0 ws208">started_evt <span class="fc6 ls32">=</span>Event()</div><div class="t m0 x5 h11 y2dc9 ffa fs5 fcd sc0 ls0 ws4"># Launch the thread and pass the startup event</div><div class="t m0 x5 hf y2dca ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Launching countdown<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 hf y2dcb ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0 ws13a">Thread(target<span class="fc6 ls34">=</span><span class="ws4">countdown, args<span class="fc6 ls34">=</span></span>(<span class="fc7">10</span>,started_evt))</span></div><div class="t m0 x5 hf y2dcc ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">14.2.<span class="_ _36"> </span>12.2 <span class="ff1 ws509">判断线程是否已经启动 </span>445</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
