<div id="pfe4" class="pf w0 h0" data-page-no="e4"><div class="pc pce4 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bge4.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h7 y2a ff1 fs3 fc0 sc0 lse ws95c">第一个例子是，假设你有一个点的列表来表示 <span class="ff4 ls0 ws95d">(x,y) </span><span class="wsd8">坐标元组。你可以使用下面的<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y2b ff1 fs3 fc0 sc0 ls0">函数来计算两点之间的距离：</div><div class="t m0 x5 hf y48d ff8 fs5 fc0 sc0 ls0 ws145">points <span class="fc6 ls33">=</span><span class="ws13b">[ (<span class="fc7 ws13a">1</span><span class="ls33">,<span class="fc7 ls34">2</span></span>), (<span class="fc7 ws13a">3</span><span class="ls33">,</span><span class="fc7 ws13a">4</span><span class="ws4">), (<span class="fc7 ls34">5</span><span class="ls33">,</span><span class="fc7 ws13a">6</span>), (<span class="fc7 ls34">7</span><span class="ls32">,<span class="fc7 ls34">8</span></span>) ]</span></span></div><div class="t m0 x5 h10 y48f ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">math</span></div><div class="t m0 x5 hf y490 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">distance<span class="fc0 ws13b">(p1, p2):</span></span></div><div class="t m0 x15 hf y7ab ff8 fs5 fc0 sc0 ls0 ws13b">x1, y1 <span class="fc6 ls32">=</span>p1</div><div class="t m0 x15 hf y1760 ff8 fs5 fc0 sc0 ls0 ws13b">x2, y2 <span class="fc6 ls32">=</span>p2</div><div class="t m0 x15 hf y1761 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13a">math<span class="fc6 ls34">.</span><span class="ws1f5">hypot(x2 <span class="fc6 ls33">-</span><span class="ws13b">x1, y2 <span class="fc6 ls32">-</span>y1)</span></span></span></div><div class="t m0 x0 h9 y18da ff1 fs3 fc0 sc0 ls3a ws153">现在假设你想以某个点为基点，根据点和基点之间的距离来排序所有的这些点。列</div><div class="t m0 x5 h9 y18db ff1 fs3 fc0 sc0 ls0 ws14">表的 <span class="ff6 ws25d">sort() </span><span class="wsa0">方法接受一个关键字参数来自定义排序逻辑，但是它只能接受一个单个参</span></div><div class="t m0 x5 h7 y18dc ff1 fs3 fc0 sc0 ls0 ws95e">数<span class="_ _6"></span>的<span class="_ _6"></span>函<span class="_ _6"></span>数 <span class="ff4 ws95f">(distance() </span><span class="ls6f ws2a7">很明显是不符合条件的<span class="_ _1"></span><span class="ff4 ls1b">)<span class="ff1 ls6f ws960">。现在我们可以通过使用 <span class="ff6 ls0 ws418">partial() <span class="ff1">来</span></span></span></span></span></div><div class="t m0 x5 h9 y1526 ff1 fs3 fc0 sc0 ls0">解决这个问题：</div><div class="t m0 x5 hf y18dd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">pt <span class="fc6 ls33">=</span><span class="ws13a">(<span class="fc7 ls34">4</span><span class="ls32">,<span class="fc7 ls34">3</span></span>)</span></span></div><div class="t m0 x5 hf y18de ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">points<span class="fc6 ls34">.</span>sort(key<span class="fc6 ls34">=</span>partial(distance,pt))</span></div><div class="t m0 x5 hf y18df ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">points</span></div><div class="t m0 x5 hf y18e0 ff8 fs5 fc8 sc0 ls0 ws4">[(3, 4), (1, 2), (5, 6), (7, 8)]</div><div class="t m0 x5 hf y18e1 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y18e2 ff1 fs3 fc0 sc0 ls0 wsa0">更<span class="_ _6"></span>进<span class="_ _0"></span>一<span class="_ _6"></span>步，<span class="_ _6"></span><span class="ff6 ws8d7">partial() </span><span class="ls16 wsf3">通常被用来微调其他库函数所使用的回调函数的参数<span class="_ _1"></span>。例<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y18e3 ff1 fs3 fc0 sc0 ls0 ws961">如，下<span class="_ _6"></span>面是<span class="_ _6"></span>一段<span class="_ _6"></span>代码，<span class="_ _6"></span>使用 <span class="ff6 ws962">multiprocessing </span><span class="wsa0">来<span class="_ _6"></span>异步<span class="_ _6"></span>计算<span class="_ _6"></span>一个<span class="_ _6"></span>结果<span class="_ _6"></span>值，然<span class="_ _6"></span>后这<span class="_ _6"></span>个值<span class="_ _6"></span>被</span></div><div class="t m0 x5 h7 y18e4 ff1 fs3 fc0 sc0 ls0 ws38">传递给一个接受一个 <span class="ff4 ws963">result </span><span class="ws14">值和一个可选 <span class="ff4 ws964">logging </span>参数的回调函数：</span></div><div class="t m0 x5 hf y18e5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">output_result<span class="fc0 ws4">(result, log<span class="fc6 ls34">=</span></span><span class="fca">None<span class="fc0">):</span></span></span></div><div class="t m0 x15 hf y18e6 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws158">log </span>is not <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x16 hf y7da ff8 fs5 fc0 sc0 ls0 ws13a">log<span class="fc6 ls34">.</span>debug(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws161">Got: </span><span class="ffa fcf">%r<span class="ff9 fc9 ls34">&apos;</span></span><span class="ws13b">, result)</span></div><div class="t m0 x5 h11 y18e7 ffa fs5 fcd sc0 ls0 ws4"># A sample function</div><div class="t m0 x5 hf y18e8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">add<span class="fc0 ws4">(x, y):</span></span></div><div class="t m0 x15 hf y18e9 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ls32">x<span class="fc6 ls33">+</span><span class="ls0">y</span></span></div><div class="t m0 x5 hf y18ea ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 h10 y18eb ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">logging</span></div><div class="t m0 x15 hf y18ec ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws965">multiprocessing </span><span class="ws146">import <span class="ff8 fc0">Pool</span></span></div><div class="t m0 x15 hf y18ed ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws285">functools </span><span class="ws146">import <span class="ff8 fc0">partial</span></span></div><div class="t m0 x15 hf y18ee ff8 fs5 fc0 sc0 ls0 ws13a">logging<span class="fc6 ls34">.</span>basicConfig(level<span class="fc6 ls34">=</span>logging<span class="fc6 ls34">.</span>DEBUG)</div><div class="t m0 x15 hf y18ef ff8 fs5 fc0 sc0 ls0 ws158">log <span class="fc6 ls32">=</span><span class="ws13a">logging<span class="fc6 ls34">.</span>getLogger(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">test<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x15 hf y18f0 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0">Pool()</span></div><div class="t m0 x15 hf y18f1 ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws4">apply_async(add, (</span><span class="fc7">3</span><span class="ls33">,<span class="fc7 ls0 ws13a">4</span><span class="ls0 ws4">), callback</span></span><span class="fc6">=</span><span class="ls0 ws4">partial(output_result, log</span><span class="fc6">=</span><span class="ls0">log))</span></div><div class="t m0 x15 hf y18f2 ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x15 hf y18f3 ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">join()</span></span></div><div class="t m0 x0 h9 y18f4 ff1 fs3 fc0 sc0 ls0 ws966">当<span class="_ _6"></span>给 <span class="ff6 ws149">apply async() </span><span class="ws967">提<span class="_ _6"></span>供<span class="_ _6"></span>回<span class="_ _6"></span>调<span class="_ _0"></span>函数<span class="_ _6"></span>时，<span class="_ _6"></span>通<span class="_ _6"></span>过<span class="_ _6"></span>使<span class="_ _0"></span>用 <span class="ff6 ws968">partial() </span><span class="ws969">传递<span class="_ _6"></span>额<span class="_ _6"></span>外<span class="_ _6"></span>的 <span class="ff6">logging</span></span></span></div><div class="t m0 x5 h9 y18f5 ff1 fs3 fc0 sc0 ls0 ws96a">参数。<span class="_ _6"></span>而 <span class="ff6 ws96b">multiprocessing </span><span class="ls12 wse4">对这些一无所知—<span class="_ _19"></span>—它仅仅只是使用单个值来调用回调函</span></div><div class="t m0 x5 h9 y18f6 ff1 fs3 fc0 sc0 ls0">数。</div><div class="t m0 x0 h9 y18f7 ff1 fs3 fc0 sc0 ls2d ws132">作为一个类似的例子<span class="_ _1"></span>，考虑下编写网络服务器的问题，<span class="ff6 ls0 ws8f0">socketserver <span class="ff1 wsa0">模块<span class="_ _6"></span>让它<span class="_ _6"></span>变</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">9.8.<span class="_ _5"> </span>7.8 <span class="ff1 ws599">减少可调用对象的参数个数 </span>219</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
