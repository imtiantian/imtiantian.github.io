<div id="pf181" class="pf w0 h0" data-page-no="181"><div class="pc pc181 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg181.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">12.9.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y236 ff1 fs3 fc0 sc0 ls0 ws38">比起费力地找文件，你可能会倾向于写一个代码手动调节 <span class="ff4 wsd86">sys.path </span><span class="wsa0">的值。例如<span class="ff4">:</span></span></div><div class="t m0 x5 h10 y27a2 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf y27a3 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>insert(<span class="fc7">0</span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">/some/dir<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x5 hf y27a4 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>insert(<span class="fc7">0</span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">/other/dir<span class="ff9 ls34">&apos;</span></span>)</div><div class="t m0 x0 h9 y27a5 ff1 fs3 fc0 sc0 ls1f ws113">虽然这能“工作”<span class="_ _31"></span>，它是在实践中极为脆弱，应尽量避免使用。这种方法的问题是，</div><div class="t m0 x5 h9 y27a6 ff1 fs3 fc0 sc0 ls13 wse5">它将目录名硬编码到了你的源代码<span class="_ _1"></span>。如果你的代码被移到一个新的位置，这会导致维<span class="_ _c"></span></div><div class="t m0 x5 h7 y27a7 ff1 fs3 fc0 sc0 ls82 wsd87">护问题。更好的做法是在不修改源代码的情况下，将 <span class="ff4 ls0 wsd88">path </span><span class="ws2f9">配置到其他地方。如果您使</span></div><div class="t m0 x5 h9 y27a8 ff1 fs3 fc0 sc0 ls2c ws12f">用模块级的变量来精心构造一个适当的绝对路径，有时你可以解决硬编码目录的<span class="_ _1"></span>问题，</div><div class="t m0 x5 h7 y27a9 ff1 fs3 fc0 sc0 ls0 wsd32">比如 <span class="ff4 wsd89">ﬁle </span>。举个例子：</div><div class="t m0 x5 h10 y27aa ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf y27ab ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2f0">os.path </span><span class="ws1ff">import <span class="ff8 fc0 ws13b">abspath, join, dirname</span></span></div><div class="t m0 x5 hf y27ac ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>insert(<span class="fc7">0</span><span class="ws4">, join(abspath(dirname(<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">__file__<span class="ff9 ws13b">&apos;</span></span><span class="ws158">)), <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">src<span class="ff9 ls34">&apos;</span></span>))</div><div class="t m0 x0 h7 y27ad ff1 fs3 fc0 sc0 ls0 wsc">这将 <span class="ff4 wsa48">src </span><span class="ws38">目录添加到 <span class="ff4 wsd8a">path </span>里，和执行插入步骤的代码在同一个目录里。</span></div><div class="t m0 x0 h7 y27ae ff4 fs3 fc0 sc0 ls0 wsd8b">site-pac<span class="_ _1"></span>kages <span class="ff1 ls2b ws12e">目录是第三方包和模块安装的目录。如果你手动安装你的代码，它将<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y142e ff1 fs3 fc0 sc0 ls0 wsd8c">被安装到 <span class="ff4 wsd8d">site-pac<span class="_ _1"></span>kages <span class="ff1 wsd8e">目录。虽然用于配置 </span><span class="wsd8f">path <span class="ff1 lsb">的</span><span class="wsd90">.pth <span class="ff1 ws9d7">文件必须放置在 </span><span class="wsa5">site-pac<span class="_ _1"></span>kages</span></span></span></span></div><div class="t m0 x5 h9 y27af ff1 fs3 fc0 sc0 ls0 wsa0">里，<span class="_ _6"></span>但它<span class="_ _6"></span>配<span class="_ _6"></span>置<span class="_ _6"></span>的<span class="_ _6"></span>路<span class="_ _6"></span>径可<span class="_ _6"></span>以<span class="_ _6"></span>是<span class="_ _6"></span>系<span class="_ _6"></span>统<span class="_ _6"></span>上任<span class="_ _6"></span>何<span class="_ _6"></span>你<span class="_ _6"></span>希<span class="_ _6"></span>望<span class="_ _6"></span>的目<span class="_ _6"></span>录。<span class="_ _6"></span>因<span class="_ _6"></span>此，<span class="_ _6"></span>你<span class="_ _6"></span>可<span class="_ _6"></span>以把<span class="_ _6"></span>你<span class="_ _6"></span>的<span class="_ _6"></span>代<span class="_ _6"></span>码<span class="_ _6"></span>放在</div><div class="t m0 x5 h7 y27b0 ff1 fs3 fc0 sc0 ls0 wsa0">一系列不同的目录，只要那些目录包含在<span class="ff4 wsd7c">.pth </span>文件里。</div><div class="t m0 x5 hd y27b1 ff2 fs4 fc4 sc0 ls0 wsd91">12.10<span class="_ _e"> </span>10.10 <span class="ff1">通过字符串名导入模块</span></div><div class="t m0 x5 he y27b2 ff2 fs2 fc4 sc0 ls0 wsadf">12.10.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y27b3 ff1 fs3 fc0 sc0 ls0">你想导入一个模块，但是模块的名字在字符串里。你想对字符串调用导入命令。</div><div class="t m0 x5 he y27b4 ff2 fs2 fc4 sc0 ls0 wsadf">12.10.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y243a ff1 fs3 fc0 sc0 ls0 ws5ac">使用 <span class="ff4 wsd92">imp<span class="_ _6"></span>ortlib.imp<span class="_ _6"></span>ort<span class="_ _7"> </span>module() </span>函数来手动导入名字为字符串给出的一个模块或者</div><div class="t m0 x5 h9 y34c ff1 fs3 fc0 sc0 ls0">包的一部分。举个例子：</div><div class="t m0 x5 h10 y27b5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">importlib</span></span></div><div class="t m0 x5 hf y27b6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13c">math <span class="fc6 ls32">=</span><span class="ws13a">importlib<span class="fc6">.</span>import_module(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">math<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y27b7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">math<span class="fc6 ls34">.</span>sin(<span class="fc7 ls34">2</span>)</span></div><div class="t m0 x5 hf y27b8 ff8 fs5 fc8 sc0 ls0">0.9092974268256817</div><div class="t m0 x5 hf y27b9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws158">mod <span class="fc6 ls32">=</span><span class="ws13a">importlib<span class="fc6 ls34">.</span>import_module(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">urllib.request<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y27ba ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">u<span class="fc6 ls33">=</span><span class="ls0 ws13a">mod<span class="fc6 ls34">.</span>urlopen(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://www.python.org<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y27bb ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 yf8e ff4 fs3 fc0 sc0 ls0 wsd93">imp<span class="_ _6"></span>ort mo<span class="_ _6"></span>dule <span class="ff1 wsd94">只<span class="_ _6"></span>是简<span class="_ _6"></span>单地<span class="_ _6"></span>执行和 </span><span class="wsd95">imp<span class="_ _6"></span>ort <span class="ff1 wsa0">相<span class="_ _6"></span>同的<span class="_ _6"></span>步骤，<span class="_ _6"></span>但是<span class="_ _6"></span>返回<span class="_ _6"></span>生成<span class="_ _6"></span>的模<span class="_ _6"></span>块对象。</span></span></div><div class="t m0 x5 h9 y8c4 ff1 fs3 fc0 sc0 ls0">你只需要将其存储在一个变量，然后像正常的模块一样使用。</div><div class="t m0 x0 h7 y6e ff1 fs3 fc0 sc0 ls1e ws111">如果你正在使用的包<span class="_ _1"></span>，<span class="ff4 ls0 wsd96">imp<span class="_ _6"></span>ort mo<span class="_ _6"></span>dule() </span>也可用于相对导入。但是<span class="_ _c"></span>，你需要给它一</div><div class="t m0 x5 h9 y674 ff1 fs3 fc0 sc0 ls0">个额外的参数。例如：</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">12.10.<span class="_ _5"> </span>10.10 <span class="ff1 wsd98">通过字符串名导入模块 </span>376</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
