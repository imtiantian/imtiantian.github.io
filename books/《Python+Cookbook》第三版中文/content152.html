<div id="pf98" class="pf w0 h0" data-page-no="98"><div class="pc pc98 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg98.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws135">7.5.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y675 ff1 fs3 fc0 sc0 lse ws667">这一小节演示了在写文件时通常会遇到的一个问题的完美解决方案 <span class="ff4 ls0 wsa5">(<span class="ff1 wsa0">不小心<span class="_ _6"></span>覆盖一</span></span></div><div class="t m0 x5 h7 y676 ff1 fs3 fc0 sc0 ls0 wsa0">个已存在的文件<span class="ff4 wsa5">)</span>。一个替代方案是先测试这个文件是否存在，像下面这样：</div><div class="t m0 x5 h10 y10ae ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">os</span></span></div><div class="t m0 x5 hf y10af ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws157">if not <span class="ff8 fc0 ws13a">os<span class="fc6 ls34">.</span>path<span class="fc6 ls34">.</span>exists(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x5 hf y10b0 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws218">with <span class="ff8 ws13a">open<span class="fc0 ls34">(<span class="ff9 fc9">&apos;</span></span><span class="fc9">somefile<span class="ff9 ws13b">&apos;</span><span class="fc0 ls33">,</span><span class="ff9 ls34">&apos;</span>wt<span class="ff9 ls34">&apos;</span><span class="fc0 ls32">)</span></span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y10b1 ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="ff8 fc0 ws13a">f<span class="fc6 ls34">.</span>write(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Hello<span class="ff7 ws156">\n<span class="ff9 ls34">&apos;</span></span></span>)</span></div><div class="t m0 x5 hf y10b2 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws156">else<span class="ff8 fc0">:</span></span></div><div class="t m0 x5 hf y10b3 ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">File already exists!</span>&apos;</span><span class="ls0">)</span></span></span></div><div class="t m0 x5 h10 y10b4 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y10b5 ff8 fs5 fc8 sc0 ls0 ws4">File already exists!</div><div class="t m0 x5 hf y10b6 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y10b7 ff1 fs3 fc0 sc0 ls0 ws668">显<span class="_ _0"></span>而<span class="_ _12"></span>易<span class="_ _0"></span>见，<span class="_ _12"></span>使<span class="_ _0"></span>用 <span class="ff4 ls10b">x</span><span class="ls10c ws669">文件模式更加简单<span class="_ _d"></span>。要注意的是 <span class="ff4 ls10b">x</span><span class="ws66a">模式是一个 <span class="ff4 ls0 ws66b">Python3 <span class="ff1">对</span></span></span></span></div><div class="t m0 x5 h7 y10b8 ff6 fs3 fc0 sc0 ls0 ws66c">open() <span class="ff1 ls19 ws66d">函数特有的扩展。在 </span><span class="ff4 ws4b8">Python <span class="ff1 ls19 ws604">的旧版本或者是 </span>Python <span class="ff1 ls19 ws66e">实现的底层 </span><span class="ls10d">C<span class="ff1 ls19 ws22a">函数库中<span class="_ _1"></span></span></span></span></div><div class="t m0 x5 h9 y10b9 ff1 fs3 fc0 sc0 ls0">都是没有这个模式的。</div><div class="t m0 x5 hd yb6f ff2 fs4 fc4 sc0 ls0 ws134">7.6<span class="_ _e"> </span>5.6 <span class="ff1 ws165">字符串的 </span><span class="ws66f">I/O <span class="ff1">操作</span></span></div><div class="t m0 x5 he y10ba ff2 fs2 fc4 sc0 ls0 ws135">7.6.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y10bb ff1 fs3 fc0 sc0 ls0">你想使用操作类文件对象的程序来操作文本或二进制字符串。</div><div class="t m0 x5 he y10bc ff2 fs2 fc4 sc0 ls0 ws135">7.6.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y10bd ff1 fs3 fc0 sc0 ls0 ws670">使<span class="_ _6"></span>用 <span class="ff6 ws671">io.StringIO() </span><span class="lsd4">和</span><span class="ff6 ws672">io.BytesIO() </span><span class="lsd3 ws4b2">类来创建类文件对象操作字符串数据<span class="_ _1"></span>。比<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y10be ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 hf y10bf ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">io<span class="fc6 ls34">.</span>StringIO()</span></span></div><div class="t m0 x5 hf y10c0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">write(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Hello World<span class="ff7 ws156">\n</span></span><span class="ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y10c1 ff8 fs5 fc8 sc0 ls0">12</div><div class="t m0 x5 hf yf07 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">This is a test<span class="ff9 ls34">&apos;</span></span><span class="ls32">,</span><span class="fca">file<span class="fc6 ls34">=</span></span>s)</span></span></div><div class="t m0 x5 hf yf08 ff8 fs5 fc8 sc0 ls0">15</div><div class="t m0 x5 h11 y10c2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Get all of the data written so far</span></div><div class="t m0 x5 hf y853 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">getvalue()</span></span></span></div><div class="t m0 x5 hf y10c3 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws4">Hello World\nThis is a test\n<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y10c4 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h11 y10c5 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ffa fcd ws4"># Wrap a file interface around an existing string</span></div><div class="t m0 x5 hf y10c6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">io<span class="fc6 ls34">.</span>StringIO(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Hello<span class="ff7 ws156">\n</span>World<span class="ff7 ws156">\n<span class="ff9 ls34">&apos;</span></span></span>)</span></span></div><div class="t m0 x5 hf y10c7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">read(</span></span><span class="fc7">4</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y10c8 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">Hell<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y10c9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">s<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y10ca ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">o\nWorld\n<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y10cb ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">7.6.<span class="_ _5"> </span>5.6 <span class="ff1 ws16b">字符串的 </span><span class="ws673">I/O <span class="ff1 ws674">操作 </span>143</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
