<div id="pf1e1" class="pf w0 h0" data-page-no="1e1"><div class="pc pc1e1 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1e1.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y181 ff7 fs5 fca sc0 ls0 ws156">finally<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y182 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_terminated</span><span class="ls34">.</span><span class="fc0">set()</span></span></div><div class="t m0 x15 hf y184 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">join<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y185 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_terminated</span><span class="ls34">.</span><span class="fc0">wait()</span></span></div><div class="t m0 x15 hf y187 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y188 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y98e ffa fs5 fc9 sc0 ls0 ws4">Run method to be implemented by the user</div><div class="t m0 x16 h15 y98f ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y990 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x17 hf y991 ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>recv()</div><div class="t m0 x5 h11 y993 ffa fs5 fcd sc0 ls0 ws4"># Sample ActorTask</div><div class="t m0 x5 hf ya70 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">PrintActor<span class="ff8 fc0">(Actor):</span></span></div><div class="t m0 x15 hf y994 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y995 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x17 hf y996 ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>recv()</div><div class="t m0 x17 hf y997 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Got:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, msg)</span></span></span></span></div><div class="t m0 x5 h11 ya71 ffa fs5 fcd sc0 ls0 ws4"># Sample use</div><div class="t m0 x5 hf y999 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0">PrintActor()</span></div><div class="t m0 x5 hf y99a ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x5 hf y99b ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">send(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Hello</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y99c ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">send(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">World</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf yddb ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x5 hf y99d ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">join()</span></span></div><div class="t m0 x0 h7 y2ffc ff1 fs3 fc0 sc0 ls0 ws1162">这<span class="_ _0"></span>个<span class="_ _6"></span>例<span class="_ _0"></span>子<span class="_ _0"></span>中，<span class="_ _6"></span>你<span class="_ _0"></span>使<span class="_ _0"></span>用 <span class="ff4 ws1163">actor </span><span class="lsf5 ws1164">实例的 </span><span class="ff6 ws1165">send() </span><span class="wsa0">方<span class="_ _6"></span>法<span class="_ _0"></span>发<span class="_ _0"></span>送<span class="_ _0"></span>消<span class="_ _6"></span>息<span class="_ _0"></span>给<span class="_ _0"></span>它<span class="_ _6"></span>们。<span class="_ _0"></span>其<span class="_ _0"></span>机<span class="_ _6"></span>制<span class="_ _0"></span>是，<span class="_ _0"></span>这</span></div><div class="t m0 x5 h9 y2ffd ff1 fs3 fc0 sc0 lsd3 ws4b2">个方法会将消息放入一个队里中<span class="_ _c"></span>，然后将其转交给处理被接受消息的一个内部线程。<span class="_ _d"></span></div><div class="t m0 x5 h7 y2ffe ff6 fs3 fc0 sc0 ls0 ws1166">close() <span class="ff1 ls20c ws1167">方法通过在队列中放入一个特殊的哨兵值（<span class="_ _d"></span><span class="ff4 ls0 wsa5">ActorExit<span class="ff1 ws1168">）<span class="_ _6"></span>来<span class="_ _0"></span>关<span class="_ _0"></span>闭<span class="_ _0"></span>这<span class="_ _0"></span>个 </span>actor<span class="ff1">。</span></span></span></div><div class="t m0 x5 h7 y2fff ff1 fs3 fc0 sc0 ls20d ws1169">用户可以通过继承 <span class="ff4 ls0 ws116a">A<span class="_ _1"></span>ctor <span class="ff1 ls20d ws116b">并定义实现自己处理逻辑 </span><span class="ws116c">run() <span class="ff1 ls20d ws116d">方法来定义新的 </span><span class="wsa5">actor<span class="ff1">。</span></span></span></span></div><div class="t m0 x5 h9 y3000 ff6 fs3 fc0 sc0 ls0 ws2b0">ActorExit <span class="ff1 ls48 ws242">异常的使用就是用户自定义代码可以在需要的时候来捕获终止请求（<span class="_ _c"></span>异常</span></div><div class="t m0 x5 h7 y3001 ff1 fs3 fc0 sc0 ls4">被<span class="ff4 ls0 ws116e">get() </span><span class="ls0 wsa0">方法抛出并传播出去）<span class="_ _f"></span>。</span></div><div class="t m0 x0 h7 y3002 ff1 fs3 fc0 sc0 ls0 ws116f">如果你<span class="_ _6"></span>放宽对于<span class="_ _6"></span>同步和异<span class="_ _6"></span>步消息<span class="_ _6"></span>发送的要<span class="_ _6"></span>求，类 <span class="ff4 ws1170">actor </span><span class="wsa0">对象<span class="_ _6"></span>还可以通<span class="_ _6"></span>过生成<span class="_ _6"></span>器来简</span></div><div class="t m0 x5 h9 y3003 ff1 fs3 fc0 sc0 ls0">化定义。例如：</div><div class="t m0 x5 hf y3004 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">print_actor<span class="fc0">():</span></span></div><div class="t m0 x15 hf y3005 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">True<span class="fc0">:</span></span></div><div class="t m0 x16 hf y2cd1 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x17 hf y2cd2 ff8 fs5 fc0 sc0 ls0 ws158">msg <span class="fc6 ls32">=</span><span class="ff7 fca ws1171">yield <span class="ffa fcd ws4"># Get a message</span></span></div><div class="t m0 x17 hf y3006 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Got:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, msg)</span></span></span></span></div><div class="t m0 x16 hf y21b5 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">GeneratorExit<span class="fc0">:</span></span></div><div class="t m0 x17 hf y21b6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Actor terminating</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x5 h11 y3007 ffa fs5 fcd sc0 ls0 ws4"># Sample use</div><div class="t m0 x5 hf y3008 ff8 fs5 fc0 sc0 ls32">p<span class="fc6 ls33">=</span><span class="ls0">print_actor()</span></div><div class="t m0 x5 hf y3009 ff8 fs5 fca sc0 ls0 ws13a">next<span class="fc0 ws1172">(p) <span class="ffa fcd ws4"># Advance to the yield (ready to receive)</span></span></div><div class="t m0 x5 hf y300a ff8 fs5 fc0 sc0 ls34">p<span class="fc6 ls0 ws13a">.<span class="fc0">send(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Hello</span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">14.10.<span class="_ _36"> </span>12.10 <span class="ff1 ws16b">定义一个 </span><span class="ws115f">Acto<span class="_ _c"></span>r <span class="ff1 ws1160">任务 </span>472</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
