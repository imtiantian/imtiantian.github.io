<div id="pfcb" class="pf w0 h0" data-page-no="cb"><div class="pc pccb w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgcb.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h11 y15f ffa fs5 fcd sc0 ls0 ws4"># Little endian 32-bit integer, two double precision floats</div><div class="t m0 x5 hf y160 ff8 fs5 fc0 sc0 ls0 ws147">record_struct <span class="fc6 ls33">=</span><span class="ws13a">Struct(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">&lt;idd<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x0 h7 y160d ff1 fs3 fc0 sc0 ls35 ws7f1">结构体通常会使用一些结构码值 <span class="ff4 ls0 ws8a3">i, d, f </span><span class="ls13e">等<span class="ff4 ls0 wsa5">[<span class="ff1 ws8a4">参考 </span><span class="fc3 ws8a5">Python <span class="ff1 ws8a4">文档 </span></span>]</span></span><span class="ws144">。这些代码分别代表</span></div><div class="t m0 x5 h7 y160e ff1 fs3 fc0 sc0 ls17 ws8a6">某个特定的二进制数据类型如 <span class="ff4 ls0 ws8a7">32 <span class="ff1 wsa0">位整<span class="_ _6"></span>数，<span class="_ _6"></span></span>64 <span class="ff1 wsa0">位浮<span class="_ _6"></span>点数，<span class="_ _6"></span></span><span class="ws8a8">32 <span class="ff1 wsa0">位浮<span class="_ _6"></span>点数<span class="_ _6"></span>等。第<span class="_ _6"></span>一个<span class="_ _6"></span>字<span class="_ _6"></span>符</span></span></span></div><div class="t m0 x5 h7 y160f ff10 fs3 fc0 sc0 lse0">&lt;<span class="ff1 ls0 wsa0">指定了字节顺序。在这个例子中，它表示<span class="ff4 ls13f">”</span>低位在前<span class="ff4 wsa5">”</span><span class="wsc">。更改这个字符为 </span></span><span class="ls140">&gt;<span class="ff1 ls0">表示高位</span></span></div><div class="t m0 x5 h9 y1610 ff1 fs3 fc0 sc0 ls0 ws14">在前，或者是 <span class="ff6 ls141">!</span>表示网络字节顺序。</div><div class="t m0 x0 h9 y1611 ff1 fs3 fc0 sc0 ls0 ws8a9">产生<span class="_ _6"></span>的 <span class="ff6 ws8aa">Struct </span><span class="ls30 ws8ab">实例有很多属性和方法用来操作相应类型的结构。 </span><span class="ff6 ws24a">size </span><span class="ls30 ws138">属性包含<span class="_ _1"></span></span></div><div class="t m0 x5 h7 y1612 ff1 fs3 fc0 sc0 ls0 ws5c6">了结构的字节数，这在 <span class="ff4 ws8ac">I/O </span><span class="ws8ad">操作时非常有用。 <span class="ff6 ws8ae">pack() </span><span class="ls142">和</span><span class="ff6 ws73a">unpack() </span>方法被用来打包和</span></div><div class="t m0 x5 h9 y3b7 ff1 fs3 fc0 sc0 ls0">解包数据。比如：</div><div class="t m0 x5 hf y1613 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws146">struct <span class="fca">import <span class="ff8 fc0">Struct</span></span></span></span></div><div class="t m0 x5 hf y1614 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws147">record_struct <span class="fc6 ls33">=</span><span class="ws13a">Struct(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">&lt;idd<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf y1615 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">record_struct<span class="fc6 ls34">.</span>size</span></div><div class="t m0 x5 hf yecb ff8 fs5 fc8 sc0 ls0">20</div><div class="t m0 x5 hf y1616 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">record_struct<span class="fc6 ls34">.</span>pack(<span class="fc7">1</span><span class="ls33">,</span><span class="fc7">2.0</span><span class="ls33">,</span><span class="fc7">3.0</span>)</span></div><div class="t m0 x5 hf y1218 ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x08@<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y1219 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">record_struct<span class="fc6 ls34">.</span>unpack(_)</span></div><div class="t m0 x5 hf y1617 ff8 fs5 fc8 sc0 ls0 ws4">(1, 2.0, 3.0)</div><div class="t m0 x5 hf y1618 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1619 ff1 fs3 fc0 sc0 ls30 ws8af">有时候你还会看到 <span class="ff6 ls0 ws8aa">pack() </span><span class="ls71">和<span class="ff6 ls0 ws2a1">unpack() </span></span><span class="ws138">操作以模块级别函数被调用，类似下面这<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y161a ff1 fs3 fc0 sc0 ls0">样：</div><div class="t m0 x5 h10 y161b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">struct</span></span></div><div class="t m0 x5 hf y161c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">struct<span class="fc6 ls34">.</span>pack(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">&lt;idd<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="fc7 ls34">1</span><span class="ls33">,</span></span><span class="fc7">2.0</span><span class="ls32">,</span><span class="fc7">3.0</span>)</span></div><div class="t m0 x5 hf y161d ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00@\x00\x00\x00\x00\x00\x00\x08@<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y161e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">struct<span class="fc6 ls34">.</span>unpack(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">&lt;idd<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, _)</span></span></div><div class="t m0 x5 hf y161f ff8 fs5 fc8 sc0 ls0 ws4">(1, 2.0, 3.0)</div><div class="t m0 x5 hf y1620 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1621 ff1 fs3 fc0 sc0 ls3a ws153">这样可以工作，但是感觉没有实例方法那么优雅，特别是在你代码中同样的结构出</div><div class="t m0 x5 h9 y11a0 ff1 fs3 fc0 sc0 ls0 ws8b0">现在多个地方的时候。通过创建一个 <span class="ff6 ws25d">Struct </span><span class="wsa0">实例，格式代码只会指定一次并且所有的</span></div><div class="t m0 x5 h7 y10dc ff1 fs3 fc0 sc0 ls1f ws6dc">操作被集中处理。这样一来代码维护就变得更加简单了 <span class="ff4 ls1b">(</span><span class="ws113">因为你只需要改变一处代码即</span></div><div class="t m0 x5 h7 y1622 ff1 fs3 fc0 sc0 lsb">可<span class="ff4 ls0 wsa5">)<span class="ff1">。</span></span></div><div class="t m0 x0 h9 y1623 ff1 fs3 fc0 sc0 ls143 ws8b1">读取二进制结构的代码要用到一些非常有趣而优美的编程技巧<span class="_ _1d"></span>。在函数　<span class="_ _19"></span></div><div class="t m0 x5 h9 y305 ff6 fs3 fc0 sc0 ls0 ws3e1">read records<span class="_ _11"> </span><span class="ff1 wsa0">中，<span class="_ _24"></span></span><span class="ws8b2">iter() <span class="ff1 ls144 ws8b3">被用来创建一个返回固定大小数据块的迭代器<span class="_ _19"></span>，参考<span class="_ _19"></span></span></span></div><div class="t m0 x5 h7 y1624 ff4 fs3 fc0 sc0 ls0 ws8b4">5.8 <span class="ff1 ls144 ws8b5">小节<span class="_ _19"></span>。这个迭代器会不断的调用一个用户提供的可调用对象 <span class="ff4 ls0 wsa5">(<span class="ff1 ws8b6">比<span class="_ _24"></span>如 <span class="ff6">lambda:</span></span></span></span></div><div class="t m0 x5 h7 y1625 ff6 fs3 fc0 sc0 ls0 ws5d3">f.read(record struct.size)<span class="_ _18"> </span><span class="ff4 ls1b">)<span class="ff1 ls145 ws8b7">，直到它返回一个特殊的值 </span>(<span class="ff1 ls146">如</span><span class="ls0 wsa5">b’‘)<span class="ff1 ls145 ws8b8">，这时候迭代停<span class="_ _c"></span></span></span></span></div><div class="t m0 x5 h9 y1626 ff1 fs3 fc0 sc0 ls0">止。例如：</div><div class="t m0 x5 hf y1627 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">data.b<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">rb<span class="ff9 ls34">&apos;</span></span>)</span></span></span></span></div><div class="t m0 x5 hf y1628 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws145">chunks <span class="fc6 ls32">=</span><span class="fca ws13a">iter</span><span class="ls34">(</span></span><span class="fca ws156">lambda<span class="ff8 fc0 ws4">: f<span class="fc6 ws13a">.<span class="fc0">read(<span class="fc7">20</span></span></span>), b<span class="ff9 fc9 ls34">&apos;&apos;</span>)</span></span></div><div class="t m0 x5 hf y1629 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">chunks</span></div><div class="t m0 x5 hf y162a ff8 fs5 fc8 sc0 ls0 ws4">&lt;callable_iterator object at 0x10069e6d0&gt;</div><div class="t m0 x5 hf y162b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca">for <span class="ff8 fc0 ws158">chk </span><span class="ws157">in <span class="ff8 fc0">chunks:</span></span></span></div><div class="t m0 x5 hf y162c ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws156">print<span class="ff8 fc0">(chk)</span></span></div><div class="t m0 x5 h10 y162d ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf ycba ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x01\x00\x00\x00ffffff\x02@\x00\x00\x00\x00\x00\x00\x12@<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y162e ff8 fs5 fc8 sc0 ls34">b<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\x06\x00\x00\x00333333\x1f@\x00\x00\x00\x00\x00\x00&quot;@<span class="ff9">&apos;</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">8.11.<span class="_ _5"> </span>6.11 <span class="ff1 ws544">读写二进制数组数据 </span>194</div><a class="l" href="https://docs.python.org/3/library/struct.html"><div class="d m1" style="border-style:none;position:absolute;left:513.978000px;bottom:1064.947500px;width:65.481000px;height:16.821000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
