<div id="pf11e" class="pf w0 h0" data-page-no="11e"><div class="pc pc11e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg11e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls0 ws13c">data <span class="fc6 ls32">=</span><span class="ls33">{</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">year</span><span class="ls34">&apos;</span></span><span class="ls32">:</span><span class="fc7 ws13a">2012</span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">month</span><span class="ls34">&apos;</span></span><span class="ls32">:<span class="fc7 ls34">8</span>,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">day<span class="ff9 ls34">&apos;</span></span><span class="ls33">:</span><span class="fc7 ws159">29 </span>}</div><div class="t m0 x0 h7 y1e76 ff1 fs3 fc0 sc0 ls0 ws38">如果你想将它转换成一个 <span class="ff4 wsb30">Date </span>类型实例，可以使用上面的技术。</div><div class="t m0 x0 h9 y1e77 ff1 fs3 fc0 sc0 ls184 wsb34">当你通过这种非常规方式来创建实例的时候<span class="_ _d"></span>，最好不要直接去访问底层实例字<span class="_ _d"></span></div><div class="t m0 x5 h7 y1e78 ff1 fs3 fc0 sc0 ls1f wsb35">典，除非你真的清楚所有细节。否则的话，如果这个类使用了 <span class="ff6 ls0 wsb36">slots </span><span class="ls171">、<span class="ff4 ls0 wsb37">prop<span class="_ _6"></span>erties <span class="ff1">、</span></span></span></div><div class="t m0 x5 h7 y1e79 ff4 fs3 fc0 sc0 ls0 wsb38">descriptors <span class="ff1 ls6b wsb39">或其他高级技术的时候代码就会失效。而这时候使用 </span><span class="ff6 wsb3a">setattr() <span class="ff1 ls6b ws28f">方法会让<span class="_ _c"></span></span></span></div><div class="t m0 x5 h9 y1e7a ff1 fs3 fc0 sc0 ls0">你的代码变得更加通用。</div><div class="t m0 x5 hd y1e7b ff2 fs4 fc4 sc0 ls0 ws211">10.18<span class="_ _e"> </span>8.18 <span class="ff1 ws165">利用 </span><span class="wsb3b">Mixins <span class="ff1">扩展类功能</span></span></div><div class="t m0 x5 he y1e7c ff2 fs2 fc4 sc0 ls0 wsadf">10.18.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y1e7d ff1 fs3 fc0 sc0 ls3a ws153">你有很多有用的方法，想使用它们来扩展其他类的功能。但是这些类并没有任何继</div><div class="t m0 x5 h9 y1e7e ff1 fs3 fc0 sc0 ls0">承的关系。因此你不能简单的将这些方法放入一个基类，然后被其他类继承。</div><div class="t m0 x5 he y1e7f ff2 fs2 fc4 sc0 ls0 wsadf">10.18.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1e80 ff1 fs3 fc0 sc0 ls3a ws153">通常当你想自定义类的时候会碰上这些问题。可能是某个库提供了一些基础类，你</div><div class="t m0 x5 h9 y1e81 ff1 fs3 fc0 sc0 ls0">可以利用它们来构造你自己的类。</div><div class="t m0 x0 h9 y3f9 ff1 fs3 fc0 sc0 ls0 wsa0">假设你想扩展映射对<span class="_ _6"></span>象，给它们添加日志、唯一<span class="_ _6"></span>性设置、类型检查等等功<span class="_ _6"></span>能。下面</div><div class="t m0 x5 h9 y1e82 ff1 fs3 fc0 sc0 ls0">是一些混入类：</div><div class="t m0 x5 hf y8b7 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">LoggedMappingMixin<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h11 y1e83 ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x15 h11 y1e84 ffa fs5 fc9 sc0 ls0 ws4">Add logging to get/set/delete operations for debugging.</div><div class="t m0 x15 h11 y197b ffa fs5 fc9 sc0 ls0">&quot;&quot;&quot;</div><div class="t m0 x15 hf y1e85 ff8 fs5 fc0 sc0 ls0 ws16e">__slots__ <span class="fc6 ls33">=</span><span class="wsb1e">() <span class="ffa fcd ls32">#<span class="ffc fs6 ls0">混入类都没有实例变量，因为直接实例化混入类没有任何意义</span></span></span></div><div class="t m0 x15 hf y1e86 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key):</span></span></span></div><div class="t m0 x16 hf y1e87 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws155">Getting </span><span class="ls32">&apos;</span></span><span class="fc6 ls33">+</span></span><span class="ff8 ws13a">str<span class="fc0">(key))</span></span></div><div class="t m0 x16 hf y1e88 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__getitem__(key)</span></span></div><div class="t m0 x15 hf y1e89 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key, value):</span></span></span></div><div class="t m0 x16 hf y1e8a ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws4">Setting {} = {!r}</span>&apos;</span><span class="fc6">.</span><span class="ls0 ws13b">format(key, value))</span></span></div><div class="t m0 x16 hf y1e8b ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__setitem__(key, value)</span></span></span></div><div class="t m0 x15 hf y1e8c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__delitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key):</span></span></span></div><div class="t m0 x16 hf y1e8d ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws1f5">Deleting </span><span class="ls33">&apos;</span></span><span class="fc6 ls32">+</span></span><span class="ff8 ws13a">str<span class="fc0">(key))</span></span></div><div class="t m0 x16 hf yfd5 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span>__delitem__(key)</span></span></div><div class="t m0 x5 hf y1e8e ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SetOnceMappingMixin<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h15 y1e8f ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y1e90 ffa fs5 fc9 sc0 ls0 ws4">Only allow a key to be set once.</div><div class="t m0 x15 h15 y1e91 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.18.<span class="_ _5"> </span>8.18 <span class="ff1 ws16b">利用 </span><span class="wsb3c">Mixins <span class="ff1 wsb3d">扩展类功能 </span>277</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
