<div id="pf55" class="pf w0 h0" data-page-no="55"><div class="pc pc55 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg55.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y181 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2f0">ply.lex </span><span class="ws1ff">import <span class="ff8 fc0">lex</span></span></div><div class="t m0 x5 hf y182 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">ply.yacc </span><span class="ws146">import <span class="ff8 fc0">yacc</span></span></div><div class="t m0 x5 h11 y184 ffa fs5 fcd sc0 ls0 ws4"># Token list</div><div class="t m0 x5 hf y185 ff8 fs5 fc0 sc0 ls0 ws145">tokens <span class="fc6 ls33">=</span><span class="ls32">[<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">NUM<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">PLUS<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">MINUS<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">TIMES<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">DIVIDE<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9 ws13a">LPAREN<span class="ff9 ls34">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws13a">RPAREN</span><span class="ls32">&apos;</span></span>]</div><div class="t m0 x5 h11 y186 ffa fs5 fcd sc0 ls0 ws4"># Ignored characters</div><div class="t m0 x5 hf y187 ff8 fs5 fc0 sc0 ls0 ws16d">t_ignore <span class="fc6 ls32">=<span class="ff9 fc9">&apos;<span class="ff7 ls0 ws156">\t\n<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 h11 y188 ffa fs5 fcd sc0 ls0 ws4"># Token specifications (as regexs)</div><div class="t m0 x5 hf y98e ff8 fs5 fc0 sc0 ls0 ws145">t_PLUS <span class="fc6 ls33">=</span><span class="fc9 ws13a">r<span class="ff9 ls34">&apos;</span>\+<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y98f ff8 fs5 fc0 sc0 ls0 ws155">t_MINUS <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">-<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y990 ff8 fs5 fc0 sc0 ls0 ws155">t_TIMES <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9">&apos;</span><span class="ls0 ws13a">\*<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y991 ff8 fs5 fc0 sc0 ls0 ws16d">t_DIVIDE <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;</span>/<span class="ff9 ls0">&apos;</span></span></span></div><div class="t m0 x5 hf y992 ff8 fs5 fc0 sc0 ls0 ws16d">t_LPAREN <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;</span>\(<span class="ff9 ls0">&apos;</span></span></span></div><div class="t m0 x5 hf y993 ff8 fs5 fc0 sc0 ls0 ws16d">t_RPAREN <span class="fc6 ls32">=<span class="fc9 ls34">r<span class="ff9 ls0 ws13b">&apos;</span>\)<span class="ff9 ls0">&apos;</span></span></span></div><div class="t m0 x5 h11 y994 ffa fs5 fcd sc0 ls0 ws4"># Token processing functions</div><div class="t m0 x5 hf y995 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">t_NUM<span class="fc0">(t):</span></span></div><div class="t m0 x15 hf y996 ff8 fs5 fc9 sc0 ls34">r<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">\d+<span class="ff9">&apos;</span></span></div><div class="t m0 x15 hf y997 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.</span><span class="ls0 ws458">value <span class="fc6 ls32">=</span><span class="fca ws13a">int<span class="fc0">(t</span></span></span><span class="fc6">.</span><span class="ls0">value)</span></div><div class="t m0 x15 hf y998 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0">t</span></div><div class="t m0 x5 h11 y999 ffa fs5 fcd sc0 ls0 ws4"># Error handler</div><div class="t m0 x5 hf y99a ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">t_error<span class="fc0">(t):</span></span></div><div class="t m0 x15 hf y99b ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">Bad character: {!r}<span class="ff9 ls34">&apos;</span></span><span class="fc6">.</span>format(t<span class="fc6 ls34">.</span>value[<span class="fc7 ls34">0</span>]))</span></div><div class="t m0 x15 hf y99c ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">skip(</span></span><span class="fc7">1</span><span class="ls0">)</span></div><div class="t m0 x5 h11 y99d ffa fs5 fcd sc0 ls0 ws4"># Build the lexer</div><div class="t m0 x5 hf y99e ff8 fs5 fc0 sc0 ls0 ws15f">lexer <span class="fc6 ls33">=</span>lex()</div><div class="t m0 x5 h11 y99f ffa fs5 fcd sc0 ls0 ws4"># Grammar rules and handler functions</div><div class="t m0 x5 hf y9a0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">p_expr<span class="fc0">(p):</span></span></div><div class="t m0 x15 h15 y9a1 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y9a2 ffa fs5 fc9 sc0 ls0 ws4">expr : expr PLUS term</div><div class="t m0 x16 h14 y9a3 ffd fs5 fc9 sc0 lsbd">|<span class="ffa ls0 ws13b">expr MINUS term</span></div><div class="t m0 x15 h15 y9a4 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y9a5 ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws13a">p[<span class="fc7">2</span><span class="ls33">]</span><span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">+<span class="ff9 ls34">&apos;</span></span>:</span></div><div class="t m0 x16 hf y9a6 ff8 fs5 fc0 sc0 ls0 ws13a">p[<span class="fc7 ls34">0</span><span class="ls32">]<span class="fc6 ls33">=</span></span>p[<span class="fc7 ls34">1</span><span class="ls33">]<span class="fc6 ls32">+</span></span>p[<span class="fc7 ls34">3</span>]</div><div class="t m0 x15 hf y9a7 ff7 fs5 fca sc0 ls0 ws15a">elif <span class="ff8 fc0 ws13a">p[<span class="fc7 ls34">2</span><span class="ls32">]</span><span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;<span class="ff8">-</span>&apos;</span></span>:</span></div><div class="t m0 x16 hf y9a8 ff8 fs5 fc0 sc0 ls0 ws13a">p[<span class="fc7 ls34">0</span><span class="ls32">]<span class="fc6 ls33">=</span></span>p[<span class="fc7 ls34">1</span><span class="ls33">]<span class="fc6 ls32">-</span></span>p[<span class="fc7 ls34">3</span>]</div><div class="t m0 x5 hf y9a9 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">p_expr_term<span class="fc0">(p):</span></span></div><div class="t m0 x15 h15 y9aa ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y9ab ffa fs5 fc9 sc0 ls0 ws13b">expr : term</div><div class="t m0 x15 h15 y9ac ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf y9ad ff8 fs5 fc0 sc0 ls0 ws13a">p[<span class="fc7 ls34">0</span><span class="ls33">]<span class="fc6 ls32">=</span></span>p[<span class="fc7 ls34">1</span>]</div><div class="t m0 x5 hf y9ae ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">p_term<span class="fc0">(p):</span></span></div><div class="t m0 x15 h15 y9af ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y9b0 ffa fs5 fc9 sc0 ls0 ws4">term : term TIMES factor</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">4.19.<span class="_ _5"> </span>2.19 <span class="ff1 ws42c">实现一个简单的递归下降分析器 </span>76</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
