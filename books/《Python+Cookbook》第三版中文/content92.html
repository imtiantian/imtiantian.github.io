<div id="pf5c" class="pf w0 h0" data-page-no="5c"><div class="pc pc5c w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg5c.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws135">5.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y675 ff1 fs3 fc0 sc0 ls3a ws153">浮点数的一个普遍问题是它们并不能精确的表示十进制数。并且，即使是最简单的</div><div class="t m0 x5 h9 y676 ff1 fs3 fc0 sc0 ls0">数学运算也会产生小的误差，比如：</div><div class="t m0 x5 hf ya2f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=<span class="fc7 ls0">4.2</span></span></span></div><div class="t m0 x5 hf ya30 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=<span class="fc7 ls0">2.1</span></span></span></div><div class="t m0 x5 hf ya31 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">+</span><span class="ls0">b</span></span></div><div class="t m0 x5 hf ya32 ff8 fs5 fc8 sc0 ls0">6.300000000000001</div><div class="t m0 x5 hf ya33 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">(a <span class="fc6 ls33">+</span>b) <span class="fc6">== <span class="fc7">6.3</span></span></span></div><div class="t m0 x5 hf ya34 ff8 fs5 fc8 sc0 ls0">False</div><div class="t m0 x5 hf ya35 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 ya36 ff1 fs3 fc0 sc0 ls0 ws475">这些<span class="_ _6"></span>错误<span class="_ _6"></span>是<span class="_ _6"></span>由底<span class="_ _6"></span>层 <span class="ff4 ws476">CPU </span><span class="ls65">和</span><span class="ff4 ws477">IEEE 754 </span><span class="ls12 wse4">标准通过自己的浮点单位去执行算术时的特<span class="_ _1"></span></span></div><div class="t m0 x5 h7 ya37 ff1 fs3 fc0 sc0 ls0 ws12a">征。由于 <span class="ff4 ws347">Python </span><span class="wsa0">的浮点数据类型使用底层表示存储数据，<span class="_ _1"></span>因此你没办法去避免这样的</span></div><div class="t m0 x5 h9 ya38 ff1 fs3 fc0 sc0 ls0">误差。</div><div class="t m0 x0 h7 ya39 ff1 fs3 fc0 sc0 ls0 wsc">如果你想更加精确 <span class="ff4 ls1b">(</span><span class="wsa0">并能容忍一定的性能损耗<span class="ff4 wsa5">)</span><span class="ws14">，你可以使用 <span class="ff6 ws472">decimal </span>模块：</span></span></div><div class="t m0 x5 hf ya3a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws2f0">decimal </span><span class="ws146">import <span class="ff8 fc0">Decimal</span></span></span></div><div class="t m0 x5 hf ya3b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">Decimal(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">4.2<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya3c ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">Decimal(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">2.1<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya3d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">+</span><span class="ls0">b</span></span></div><div class="t m0 x5 hf ya3e ff8 fs5 fc8 sc0 ls0 ws13a">Decimal(<span class="ff9 ls34">&apos;</span>6.3<span class="ff9 ws13b">&apos;</span>)</div><div class="t m0 x5 hf ya3f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">+</span>b)</span></span></div><div class="t m0 x5 hf ya40 ff8 fs5 fc8 sc0 ls0">6.3</div><div class="t m0 x5 hf ya41 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">(a <span class="fc6 ls33">+</span>b) <span class="fc6">== </span><span class="ws13a">Decimal(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">6.3<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya42 ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x0 h9 ya43 ff1 fs3 fc0 sc0 ls0 wsa0">初<span class="_ _12"></span>看<span class="_ _0"></span>起<span class="_ _12"></span>来，<span class="_ _12"></span>上<span class="_ _12"></span>面<span class="_ _12"></span>的<span class="_ _12"></span>代<span class="_ _12"></span>码<span class="_ _0"></span>好<span class="_ _12"></span>像<span class="_ _12"></span>有<span class="_ _12"></span>点<span class="_ _12"></span>奇<span class="_ _12"></span>怪，<span class="_ _12"></span>比<span class="_ _0"></span>如<span class="_ _12"></span>我<span class="_ _12"></span>们<span class="_ _12"></span>用<span class="_ _12"></span>字<span class="_ _12"></span>符<span class="_ _0"></span>串<span class="_ _12"></span>来<span class="_ _12"></span>表<span class="_ _12"></span>示<span class="_ _12"></span>数<span class="_ _12"></span>字。<span class="_ _12"></span>然<span class="_ _0"></span>而，</div><div class="t m0 x5 h7 ya44 ff6 fs3 fc0 sc0 ls0 ws478">Decimal <span class="ff1 ws479">对<span class="_ _6"></span>象会<span class="_ _6"></span>像<span class="_ _6"></span>普<span class="_ _6"></span>通<span class="_ _6"></span>浮<span class="_ _6"></span>点数<span class="_ _6"></span>一<span class="_ _6"></span>样<span class="_ _6"></span>的<span class="_ _6"></span>工<span class="_ _6"></span>作 <span class="ff4 ls1b">(</span><span class="ls13 wse5">支持所有的常用数学运算<span class="_ _1"></span><span class="ff4 ls1b">)<span class="ff1 ls0 wsa0">。<span class="_ _6"></span>如<span class="_ _6"></span>果<span class="_ _6"></span>你打<span class="_ _6"></span>印<span class="_ _6"></span>它</span></span></span></span></div><div class="t m0 x5 h9 ya45 ff1 fs3 fc0 sc0 ls0">们或者在字符串格式化函数中使用它们，看起来跟普通数字没什么两样。</div><div class="t m0 x0 h9 ya46 ff6 fs3 fc0 sc0 ls0 ws23e">decimal <span class="ff1 ls68 ws23f">模块的一个主要特征是允许你控制计算的每一方面，包括数字位数和四舍</span></div><div class="t m0 x5 h9 ya47 ff1 fs3 fc0 sc0 ls0">五入运算。为了这样做，你先得创建一个本地上下文并更改它的设置，比如：</div><div class="t m0 x5 hf ya48 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc ws2f0">decimal </span><span class="ws146">import <span class="ff8 fc0">localcontext</span></span></span></div><div class="t m0 x5 hf ya49 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">a<span class="fc6 ls33">=</span><span class="ls0 ws13a">Decimal(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">1.3<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya4a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">b<span class="fc6 ls33">=</span><span class="ls0 ws13a">Decimal(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">1.7<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x5 hf ya4b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">/</span>b)</span></span></div><div class="t m0 x5 hf ya4c ff8 fs5 fc8 sc0 ls0">0.7647058823529411764705882353</div><div class="t m0 x5 hf ya4d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 fc0 ws47a">localcontext() </span><span class="ws160">as <span class="ff8 fc0">ctx:</span></span></span></div><div class="t m0 x5 hf ya4e ff7 fs5 fc5 sc0 ls0 ws139">... <span class="ff8 fc0 ws13a">ctx<span class="fc6 ls34">.</span><span class="ws161">prec <span class="fc6 ls33">=</span><span class="fc7">3</span></span></span></div><div class="t m0 x5 hf ya4f ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">/</span>b)</span></span></div><div class="t m0 x5 h10 ya50 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf ya51 ff8 fs5 fc8 sc0 ls0">0.765</div><div class="t m0 x5 hf ya52 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 fc0 ws47a">localcontext() </span><span class="ws160">as <span class="ff8 fc0">ctx:</span></span></span></div><div class="t m0 x5 hf ya53 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="ff8 fc0 ws13a">ctx<span class="fc6 ls34">.</span><span class="ws161">prec <span class="fc6 ls33">=</span><span class="fc7">50</span></span></span></div><div class="t m0 x5 hf ya54 ff7 fs5 fc5 sc0 ls0 ws139">... <span class="fca ws156">print<span class="ff8 fc0 ws159">(a <span class="fc6 ls32">/</span>b)</span></span></div><div class="t m0 x5 h10 ya55 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf ya56 ff8 fs5 fc8 sc0 ls0">0.76470588235294117647058823529411764705882352941176</div><div class="t m0 x5 hf ya57 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws13e">5.2.<span class="_ _5"> </span>3.2 <span class="ff1 ws1d2">执行精确的浮点数运算 </span>83</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
