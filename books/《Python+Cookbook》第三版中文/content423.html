<div id="pf1a7" class="pf w0 h0" data-page-no="1a7"><div class="pc pc1a7 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1a7.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hd y112 ff2 fs4 fc4 sc0 ls0 ws211">13.6<span class="_ _e"> </span>11.6 <span class="ff1 ws165">通过 </span><span class="wsf42">XML-RPC <span class="ff1">实现简单的远程调用</span></span></div><div class="t m0 x5 he y113 ff2 fs2 fc4 sc0 ls0 ws212">13.6.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y2b2 ff1 fs3 fc0 sc0 ls18 wsf43">你想找到一个简单的方式去执行运行在远程机器上面的 <span class="ff4 ls0 ws453">Python <span class="ff1 wsa0">程序中的<span class="_ _6"></span>函数或<span class="_ _6"></span>方</span></span></div><div class="t m0 x5 h9 y23ec ff1 fs3 fc0 sc0 ls0">法。</div><div class="t m0 x5 he y23ed ff2 fs2 fc4 sc0 ls0 ws212">13.6.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y6d2 ff1 fs3 fc0 sc0 ls35 wsf44">实现一个远程方法调用的最简单方式是使用 <span class="ff4 ls0 wsa5">XML-RPC</span><span class="ws144">。下面我们演示一下一个实</span></div><div class="t m0 x5 h7 y24fa ff1 fs3 fc0 sc0 ls0 ws38">现了键 <span class="ff4 lsce">-</span>值存储功能的简单服务器：</div><div class="t m0 x5 hf y6f2 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc wsb44">xmlrpc.server </span><span class="ws146">import <span class="ff8 fc0">SimpleXMLRPCServer</span></span></div><div class="t m0 x5 hf y6f3 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">KeyValueServer<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y2b11 ff8 fs5 fc0 sc0 ls0 ws147">_rpc_methods_ <span class="fc6 ls33">=</span><span class="ws13a">[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">get<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">set<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">delete<span class="ff9 ws13b">&apos;</span></span><span class="ls33">,</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">exists<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">keys<span class="ff9 ws13b">&apos;</span></span>]</span></div><div class="t m0 x15 hf y24fb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, address):</span></span></span></div><div class="t m0 x16 hf y24fc ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_data </span><span class="ls32">=</span><span class="fc0">{}</span></span></div><div class="t m0 x16 hf y2b12 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws458">_serv </span><span class="ls32">=</span><span class="fc0 ws4">SimpleXMLRPCServer(address, allow_none</span><span class="ls34">=</span></span>True<span class="fc0">)</span></div><div class="t m0 x16 hf y24fd ff7 fs5 fca sc0 ls0 ws139">for <span class="ff8 fc0 ws161">name </span><span class="ws160">in <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_rpc_methods_:</span></span></span></div><div class="t m0 x17 hf y24fe ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_serv</span><span class="ls34">.</span><span class="fc0">register_function(</span></span>getattr<span class="fc0 ls34">(</span>self<span class="fc0 ws13b">, name))</span></div><div class="t m0 x15 hf y2b13 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">get<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name):</span></span></span></div><div class="t m0 x16 hf y2b14 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_data[name]</span></span></div><div class="t m0 x15 hf y6fe ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">set<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name, value):</span></span></span></div><div class="t m0 x16 hf y41e ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">_data[name] </span><span class="ls33">=</span><span class="fc0">value</span></span></div><div class="t m0 x15 hf y2b15 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">delete<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name):</span></span></span></div><div class="t m0 x16 hf y2b16 ff7 fs5 fca sc0 ls0 ws139">del <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">_data[name]</span></span></span></div><div class="t m0 x15 hf y2b17 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">exists<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, name):</span></span></span></div><div class="t m0 x16 hf y2b18 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 fc0 ws13c">name </span><span class="ws157">in <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">_data</span></span></span></span></div><div class="t m0 x15 hf y2b19 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">keys<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y2b1a ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">list<span class="fc0 ls34">(</span>self<span class="fc6 ls34">.</span><span class="fc0">_data)</span></span></div><div class="t m0 x15 hf y2b1b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">serve_forever<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y2b1c ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_serv</span><span class="ls34">.</span><span class="fc0">serve_forever()</span></span></div><div class="t m0 x5 h11 y2b1d ffa fs5 fcd sc0 ls0 ws4"># Example</div><div class="t m0 x5 hf y2b1e ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws16d">__name__ <span class="fc6 ws159">== <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">__main__<span class="ff9 ls34">&apos;</span></span></span>:</span></div><div class="t m0 x15 hf y2b1f ff8 fs5 fc0 sc0 ls0 ws145">kvserv <span class="fc6 ls32">=</span><span class="ws13a">KeyValueServer((<span class="ff9 fc9 ls34">&apos;&apos;</span><span class="ls32">,</span><span class="fc7">15000</span>))</span></div><div class="t m0 x15 hf y2b20 ff8 fs5 fc0 sc0 ls0 ws13a">kvserv<span class="fc6 ls34">.</span>serve_forever()</div><div class="t m0 x0 h9 y2b21 ff1 fs3 fc0 sc0 ls0">下面我们从一个客户端机器上面来访问服务器：</div><div class="t m0 x5 hf y2b22 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc wsb44">xmlrpc.client </span><span class="ws146">import <span class="ff8 fc0">ServerProxy</span></span></span></div><div class="t m0 x5 hf y2b23 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">s<span class="fc6 ls33">=</span><span class="ls0 ws13a">ServerProxy(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">http://localhost:15000<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, allow_none</span><span class="fc6">=<span class="fca">True</span></span>)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">13.6.<span class="_ _5"> </span>11.6 <span class="ff1 ws16b">通过 </span><span class="wsf45">XML-RPC <span class="ff1 wsf46">实现简单的远程调用 </span>414</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
