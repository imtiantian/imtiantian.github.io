<div id="pf116" class="pf w0 h0" data-page-no="116"><div class="pc pc116 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg116.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 wsadf">10.14.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y138 ff1 fs3 fc0 sc0 ls0 ws2c2">使用 <span class="ff6 wsb13">collections </span><span class="ls3d ws164">中的抽象基类可以确保你自定义的容器实现了所有必要的方法。</span></div><div class="t m0 x5 h9 y139 ff1 fs3 fc0 sc0 ls0">并且还能简化类型检查。你的自定义容器会满足大部分类型检查需要，如下所示：</div><div class="t m0 x5 hf y1dc6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws15f">items <span class="fc6 ls33">=</span>SortedItems()</span></div><div class="t m0 x5 h10 y1dc7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">collections</span></span></div><div class="t m0 x5 hf y1dc8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">isinstance<span class="fc0 ws4">(items, collections<span class="fc6 ls34">.</span>Iterable)</span></span></div><div class="t m0 x5 hf y1dc9 ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf ycdc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">isinstance<span class="fc0 ws4">(items, collections<span class="fc6 ls34">.</span>Sequence)</span></span></div><div class="t m0 x5 hf ycdd ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf ycde ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">isinstance<span class="fc0 ws4">(items, collections<span class="fc6 ls34">.</span>Container)</span></span></div><div class="t m0 x5 hf ycdf ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf y1dca ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">isinstance<span class="fc0 ws4">(items, collections<span class="fc6 ls34">.</span>Sized)</span></span></div><div class="t m0 x5 hf y1dcb ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf y19e7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">isinstance<span class="fc0 ws4">(items, collections<span class="fc6 ls34">.</span>Mapping)</span></span></div><div class="t m0 x5 hf y1bfb ff8 fs5 fc8 sc0 ls0">False</div><div class="t m0 x5 hf y1bfc ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y1dcc ff6 fs3 fc0 sc0 ls0 wsb14">collections <span class="ff1 ls180 wsb15">中很多抽象类会为一些常见容器操作提供默认的实现<span class="_ _f"></span>，<span class="_ _6"></span>这<span class="_ _2d"></span></span></div><div class="t m0 x5 h9 y61e ff1 fs3 fc0 sc0 ls181 wsb16">样一来你只需要实现那些你最感兴趣的方法即可<span class="_ _2e"></span>。假设你的类继承自<span class="_ _2e"></span></div><div class="t m0 x5 h9 y1dcd ff6 fs3 fc0 sc0 ls0 wsb17">collections.MutableSequence <span class="ff1">，如下：</span></div><div class="t m0 x5 hf y1dce ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">Items<span class="ff8 fc0 ws13a">(collections<span class="fc6">.</span>MutableSequence):</span></span></div><div class="t m0 x15 hf y1dcf ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span><span class="ws4">, initial<span class="fc6 ls34">=</span></span><span class="fca">None</span>):</span></span></div><div class="t m0 x16 hf y1dd0 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_items </span><span class="ls32">=</span></span>list<span class="fc0 ws16e">(initial) </span><span class="ff7 ws157">if </span><span class="fc0 ws155">initial </span><span class="ff7 ws157">is not </span><span class="ws13c">None <span class="ff7 ws15a">else </span><span class="fc0">[]</span></span></div><div class="t m0 x15 h11 y1dd1 ffa fs5 fcd sc0 ls0 ws4"># Required sequence methods</div><div class="t m0 x15 hf y1dd2 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__getitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, index):</span></span></span></div><div class="t m0 x16 hf y1dd3 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Getting:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, index)</span></span></span></span></div><div class="t m0 x16 hf y1dd4 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_items[index]</span></span></div><div class="t m0 x15 hf y1dd5 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, index, value):</span></span></span></div><div class="t m0 x16 hf y1dd6 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Setting:<span class="ff9 ws13b">&apos;</span><span class="fc0 ws4">, index, value)</span></span></span></span></div><div class="t m0 x16 hf y1dd7 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws5a4">_items[index] </span><span class="ls32">=</span><span class="fc0">value</span></span></div><div class="t m0 x15 hf y1dd8 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__delitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, index):</span></span></span></div><div class="t m0 x16 hf y1dd9 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Deleting:</span>&apos;</span><span class="ls0 ws4">, index)</span></span></div><div class="t m0 x16 hf y1dda ff7 fs5 fca sc0 ls0 ws139">del <span class="ff8 ws13a">self<span class="fc6">.<span class="fc0">_items[index]</span></span></span></div><div class="t m0 x15 hf y1ddb ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">insert<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws13b">, index, value):</span></span></span></div><div class="t m0 x16 hf y1ddc ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Inserting:</span>&apos;</span><span class="ls0 ws13b">, index, value)</span></span></div><div class="t m0 x16 hf y1ddd ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_items</span><span class="ls34">.</span><span class="fc0 ws13b">insert(index, value)</span></span></div><div class="t m0 x15 hf y1dde ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__len__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y1ddf ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">Len</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x16 hf y1de0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">len<span class="fc0 ls34">(</span>self<span class="fc6">.<span class="fc0">_items)</span></span></span></div><div class="t m0 x0 h7 y1de1 ff1 fs3 fc0 sc0 ls0 wsb18">如果你创建 <span class="ff6 wsb19">Items </span><span class="wsb1a">的实例，<span class="_ _8"></span>你会发现它支持几乎所有的核心列表方法 <span class="ff4 wsa5">(</span><span class="ls182">如</span><span class="ff4 wsa5">app<span class="_ _6"></span>end()</span>、</span></div><div class="t m0 x5 h7 y1de2 ff4 fs3 fc0 sc0 ls0 wsa5">remo<span class="_ _1"></span>v<span class="_ _1"></span>e()<span class="ff1 lsb">、</span><span class="wsb1b">coun<span class="_ _1"></span>t() <span class="ff1 lsb">等</span><span class="wsa5">)<span class="ff1">。下面是使用演示：</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.14.<span class="_ _5"> </span>8.14 <span class="ff1 wsb0f">实现自定义容器 </span>269</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
