<div id="pf1e7" class="pf w0 h0" data-page-no="1e7"><div class="pc pc1e7 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1e7.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x16 hf y15f ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x15 hf y160 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">Blastoff!<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y957 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countup<span class="fc0">(n):</span></span></div><div class="t m0 x15 hf y958 ff8 fs5 fc0 sc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">0</span></span></div><div class="t m0 x15 hf y959 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">x<span class="fc6 ls32">&lt;</span><span class="ls0">n:</span></span></div><div class="t m0 x16 hf y95a ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">Counting up</span>&apos;</span><span class="ls0 ws13b">, x)</span></span></div><div class="t m0 x16 h10 y95b ff7 fs5 fca sc0 ls0">yield</div><div class="t m0 x16 hf y95c ff8 fs5 fc0 sc0 ls32">x<span class="fc6 ls0 ws23d">+= <span class="fc7">1</span></span></div><div class="t m0 x0 h7 y3068 ff1 fs3 fc0 sc0 ls0 ws38">这些函数在内部使用 <span class="ff4 ws3ca">yield </span>语句，下面是一个实现了简单任务调度器的代码：</div><div class="t m0 x5 hf y3069 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">deque</span></span></div><div class="t m0 x5 hf y306a ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">TaskScheduler<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 hf y306b ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__init__<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y714 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws208">_task_queue </span><span class="ls33">=</span><span class="fc0">deque()</span></span></div><div class="t m0 x15 hf y306c ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">new_task<span class="fc0">(<span class="fca">self</span><span class="ws4">, task):</span></span></span></div><div class="t m0 x16 h15 y306d ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y306e ffa fs5 fc9 sc0 ls0 ws4">Admit a newly started task to the scheduler</div><div class="t m0 x16 h15 y306f ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y3070 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_task_queue</span><span class="ls34">.</span><span class="fc0">append(task)</span></span></div><div class="t m0 x15 hf y3071 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">run<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 h15 y1d15 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 h11 y3072 ffa fs5 fc9 sc0 ls0 ws4">Run until there are no more tasks</div><div class="t m0 x16 h15 y3073 ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x16 hf y1108 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_task_queue:</span></span></div><div class="t m0 x17 hf y3074 ff8 fs5 fc0 sc0 ls0 ws161">task <span class="fc6 ls33">=</span><span class="fca ws13a">self<span class="fc6">.<span class="fc0">_task_queue</span><span class="ls34">.</span></span></span>popleft()</div><div class="t m0 x17 hf y3075 ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x18 h11 y3076 ffa fs5 fcd sc0 ls0 ws4"># Run until the next yield statement</div><div class="t m0 x18 hf y3077 ff8 fs5 fca sc0 ls0 ws13a">next<span class="fc0">(task)</span></div><div class="t m0 x18 hf y3078 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">_task_queue</span><span class="ls34">.</span><span class="fc0">append(task)</span></span></div><div class="t m0 x17 hf y3079 ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 ws13a">StopIteration<span class="fc0">:</span></span></div><div class="t m0 x18 h11 y307a ffa fs5 fcd sc0 ls0 ws4"># Generator is no longer executing</div><div class="t m0 x18 h10 y307b ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 h11 y307c ffa fs5 fcd sc0 ls0 ws4"># Example use</div><div class="t m0 x5 hf y307d ff8 fs5 fc0 sc0 ls0 ws15f">sched <span class="fc6 ls33">=</span>TaskScheduler()</div><div class="t m0 x5 hf y307e ff8 fs5 fc0 sc0 ls0 ws13a">sched<span class="fc6">.</span>new_task(countdown(<span class="fc7">10</span>))</div><div class="t m0 x5 hf y2772 ff8 fs5 fc0 sc0 ls0 ws13a">sched<span class="fc6">.</span>new_task(countdown(<span class="fc7 ls34">5</span>))</div><div class="t m0 x5 hf y307f ff8 fs5 fc0 sc0 ls0 ws13a">sched<span class="fc6">.</span>new_task(countup(<span class="fc7">15</span>))</div><div class="t m0 x5 hf y2f47 ff8 fs5 fc0 sc0 ls0 ws13a">sched<span class="fc6">.</span>run()</div><div class="t m0 x0 h7 y3080 ff6 fs3 fc0 sc0 ls0 ws1184">TaskScheduler <span class="ff1 ls12 ws1185">类在一个循环中运行生成器集合—<span class="_ _19"></span>—每个都运行到碰到 <span class="ff4 ls0 ws1186">yield <span class="ff1 wsa0">语<span class="_ _6"></span>句</span></span></span></div><div class="t m0 x5 h9 y3081 ff1 fs3 fc0 sc0 ls0">为止。运行这个例子，输出如下：</div><div class="t m0 x5 hf y3082 ff8 fs5 fc0 sc0 ls0 ws4">T-minus 10</div><div class="t m0 x5 hf y3083 ff8 fs5 fc0 sc0 ls0 ws4">T-minus 5</div><div class="t m0 x5 hf y3084 ff8 fs5 fc0 sc0 ls0 ws4">Counting up 0</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">14.12.<span class="_ _36"> </span>12.12 <span class="ff1 ws104c">使用生成器代替线程 </span>478</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
