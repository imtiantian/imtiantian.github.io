<div id="pfab" class="pf w0 h0" data-page-no="ab"><div class="pc pcab w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bgab.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 h9 y2a ff1 fs3 fc0 sc0 ls0">充分测试自己的实现代码，确保它能按照期望工作。</div><div class="t m0 x5 hd y12a2 ff2 fs4 fc4 sc0 ls0 ws211">7.19<span class="_ _e"> </span>5.19 <span class="ff1">创建临时文件和文件夹</span></div><div class="t m0 x5 he y12a3 ff2 fs2 fc4 sc0 ls0 ws212">7.19.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y12a4 ff1 fs3 fc0 sc0 ls63 ws21f">你需要在程序执行时创建一个临时文件或目录<span class="_ _c"></span>，并希望使用完之后可以自动销毁<span class="_ _1"></span></div><div class="t m0 x5 h9 yf92 ff1 fs3 fc0 sc0 ls0">掉。</div><div class="t m0 x5 he yf93 ff2 fs2 fc4 sc0 ls0 ws212">7.19.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 yf94 ff6 fs3 fc0 sc0 ls0 ws70f">tempfile <span class="ff1 ls16 wsf3">模块中有很多的函数可以完成这任务<span class="_ _c"></span>。为了创建一个匿名的临时文件<span class="_ _1"></span>，<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y12a5 ff1 fs3 fc0 sc0 ls0 ws14">可以使用 <span class="ff6 ws710">tempfile.TemporaryFile </span>：</div><div class="t m0 x5 hf y12a6 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">tempfile </span><span class="ws146">import <span class="ff8 fc0">TemporaryFile</span></span></div><div class="t m0 x5 hf y12a7 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">TemporaryFile(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">w+t<span class="ff9 ws13b">&apos;</span></span><span class="ls33">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 h11 y12a8 ffa fs5 fcd sc0 ls0 ws4"># Read/write to the file</div><div class="t m0 x15 hf y12a9 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Hello World<span class="ff7 ws156">\n</span></span><span class="ls34">&apos;</span></span>)</span></span></div><div class="t m0 x15 hf y12aa ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">Testing<span class="ff7 ws156">\n<span class="ff9 ls34">&apos;</span></span></span>)</span></span></div><div class="t m0 x15 h11 y12ab ffa fs5 fcd sc0 ls0 ws4"># Seek back to beginning and read the data</div><div class="t m0 x15 hf y12ac ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">seek(</span></span><span class="fc7">0</span><span class="ls0">)</span></div><div class="t m0 x15 hf y12ad ff8 fs5 fc0 sc0 ls0 ws13c">data <span class="fc6 ls32">=</span><span class="ls34">f</span><span class="fc6 ws13a">.</span>read()</div><div class="t m0 x5 h11 y12ae ffa fs5 fcd sc0 ls0 ws4"># Temporary file is destroyed</div><div class="t m0 x0 h9 y12af ff1 fs3 fc0 sc0 ls0">或者，如果你喜欢，你还可以像这样使用临时文件：</div><div class="t m0 x5 hf y12b0 ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=</span><span class="ls0 ws13a">TemporaryFile(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">w+t<span class="ff9 ls34">&apos;</span></span>)</span></div><div class="t m0 x5 h11 y12b1 ffa fs5 fcd sc0 ls0 ws4"># Use the temporary file</div><div class="t m0 x5 hf y12b2 ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x5 hf y12b3 ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x5 h11 y12b4 ffa fs5 fcd sc0 ls0 ws4"># File is destroyed</div><div class="t m0 x0 h9 y12b5 ff6 fs3 fc0 sc0 ls0 ws711">TemporaryFile() <span class="ff1 ws712">的第一个参数是文件模式，<span class="_ _c"></span>通常来讲文本模式使用 <span class="ff6 ws713">w+t </span><span class="wsa0">，二进制</span></span></div><div class="t m0 x5 h9 y12b6 ff1 fs3 fc0 sc0 ls0 ws714">模式<span class="_ _6"></span>使用 <span class="ff6 ws715">w<span class="_ _6"></span>+b </span><span class="ls12 wse4">。这个模式同时支持读和写操作，在这里是很有用的<span class="_ _c"></span>，因为当你关闭文</span></div><div class="t m0 x5 h9 y12b7 ff1 fs3 fc0 sc0 ls0 ws716">件去<span class="_ _6"></span>改变<span class="_ _6"></span>模式<span class="_ _6"></span>的时候，<span class="_ _6"></span>文件<span class="_ _6"></span>实际<span class="_ _6"></span>上已<span class="_ _6"></span>经不<span class="_ _6"></span>存在<span class="_ _6"></span>了。 <span class="ff6 ws185">TemporaryFile() </span><span class="wsa0">另外还<span class="_ _6"></span>支持<span class="_ _6"></span>跟内</span></div><div class="t m0 x5 h9 y12b8 ff1 fs3 fc0 sc0 ls0 ws14">置的 <span class="ff6 ws25d">open() </span>函数一样的参数。比如：</div><div class="t m0 x5 hf y12b9 ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws13a">TemporaryFile(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">w+t<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, encoding</span><span class="fc6">=<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ls34">&apos;</span></span></span><span class="ws13b">, errors<span class="fc6 ls34">=<span class="ff9 fc9">&apos;</span></span></span><span class="fc9">ignore<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws160">as <span class="ff8 fc0">f:</span></span></div><div class="t m0 x15 hf y12ba ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x0 h7 y12bb ff1 fs3 fc0 sc0 ls0 ws22b">在大多数 <span class="ff4 ws717">Unix </span><span class="ws22c">系统上，通过 <span class="ff6 ws718">TemporaryFile() </span><span class="wsa0">创建的文件都是匿名的，甚至连目</span></span></div><div class="t m0 x5 h9 y12bc ff1 fs3 fc0 sc0 ls0 ws14">录都没有。如果你想打破这个限制，可以使用 <span class="ff6 ws4fa">NamedTemporaryFile() </span>来代替。比如：</div><div class="t m0 x5 hf y12bd ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws248">tempfile </span><span class="ws146">import <span class="ff8 fc0">NamedTemporaryFile</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.19.<span class="_ _5"> </span>5.19 <span class="ff1 ws509">创建临时文件和文件夹 </span>162</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
