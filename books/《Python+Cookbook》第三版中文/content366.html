<div id="pf16e" class="pf w0 h0" data-page-no="16e"><div class="pc pc16e w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg16e.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">test4()</span></div><div class="t m0 x5 hf y1ac ff8 fs5 fc8 sc0 ls0">14</div><div class="t m0 x5 hf y1ad ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y2f1 ff1 fs3 fc0 sc0 lse wscd3">大部分情况下，这种方式是使用 <span class="ff6 ls0 ws6aa">exec() </span><span class="wsd8">的最佳实践<span class="_ _1"></span>。你只需要保证全局和局部字</span></div><div class="t m0 x5 h9 y2f2 ff1 fs3 fc0 sc0 ls0">典在后面代码访问时已经被初始化。</div><div class="t m0 x0 h9 y25f8 ff1 fs3 fc0 sc0 ls0 wscd4">还有一点，<span class="_ _1"></span>在使用 <span class="ff6 wscd5">exec() </span><span class="wsa0">之前，<span class="_ _1"></span>你可能需要问下自己是否有其他更好的替代方案。</span></div><div class="t m0 x5 h9 y25f9 ff1 fs3 fc0 sc0 ls36 wscd6">大多数情况下当你要考虑使用 <span class="ff6 ls0 ws619">exec() </span><span class="ws14a">的时候<span class="_ _c"></span>，还有另外更好的解决方案，比如装饰<span class="_ _c"></span></span></div><div class="t m0 x5 h9 y25fa ff1 fs3 fc0 sc0 ls0">器、闭包、元类，或其他一些元编程特性。</div><div class="t m0 x5 hd y25fb ff2 fs4 fc4 sc0 ls0 ws211">11.24<span class="_ _e"> </span>9.24 <span class="ff1 ws357">解析与分析 </span><span class="ws73e">Python <span class="ff1">源码</span></span></div><div class="t m0 x5 he y25fc ff2 fs2 fc4 sc0 ls0 wsadf">11.24.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y25fd ff1 fs3 fc0 sc0 ls0 wsc">你想写解析并分析 <span class="ff4 ws5c">Python </span>源代码的程序。</div><div class="t m0 x5 he y25fe ff2 fs2 fc4 sc0 ls0 wsadf">11.24.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h7 y25ff ff1 fs3 fc0 sc0 ls0 wsc">大部分程序员知道 <span class="ff4 ws5c">Python </span>能够计算或执行字符串形式的源代码。例如：</div><div class="t m0 x5 hf y2600 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">x<span class="fc6 ls33">=<span class="fc7 ls0">42</span></span></span></div><div class="t m0 x5 hf y2601 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fca ws13a">eval<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ls5e ws209">2+3<span class="_ _15"></span>*<span class="_ _15"></span>4+x<span class="_ _15"></span><span class="ff9 ls34">&apos;<span class="ff8 fc0 ls0">)</span></span></span></span></span></div><div class="t m0 x5 hf y2602 ff8 fs5 fc8 sc0 ls0">56</div><div class="t m0 x5 hf y2603 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws156">exec<span class="ff8 fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">for i in range(10): print(i)</span>&apos;<span class="ff8 fc0">)</span></span></span></div><div class="t m0 x5 hf y2604 ff8 fs5 fc8 sc0 ls0">0</div><div class="t m0 x5 hf y2605 ff8 fs5 fc8 sc0 ls0">1</div><div class="t m0 x5 hf y2606 ff8 fs5 fc8 sc0 ls0">2</div><div class="t m0 x5 hf y13b7 ff8 fs5 fc8 sc0 ls0">3</div><div class="t m0 x5 hf y2607 ff8 fs5 fc8 sc0 ls0">4</div><div class="t m0 x5 hf y2608 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y2609 ff8 fs5 fc8 sc0 ls0">6</div><div class="t m0 x5 hf y260a ff8 fs5 fc8 sc0 ls0">7</div><div class="t m0 x5 hf y260b ff8 fs5 fc8 sc0 ls0">8</div><div class="t m0 x5 hf y260c ff8 fs5 fc8 sc0 ls0">9</div><div class="t m0 x5 hf y260d ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h7 y260e ff1 fs3 fc0 sc0 ls0 wsa0">尽<span class="_ _6"></span>管<span class="_ _0"></span>如<span class="_ _6"></span>此，<span class="_ _0"></span><span class="ff6 wscd7">ast </span><span class="wscd8">模<span class="_ _6"></span>块<span class="_ _0"></span>能<span class="_ _6"></span>被<span class="_ _0"></span>用<span class="_ _6"></span>来<span class="_ _0"></span>将 <span class="ff4 wscd9">Python </span></span>源<span class="_ _0"></span>码<span class="_ _6"></span>编<span class="_ _0"></span>译<span class="_ _6"></span>成<span class="_ _0"></span>一<span class="_ _6"></span>个<span class="_ _0"></span>可<span class="_ _6"></span>被<span class="_ _0"></span>分<span class="_ _6"></span>析<span class="_ _0"></span>的<span class="_ _6"></span>抽<span class="_ _0"></span>象<span class="_ _6"></span>语<span class="_ _0"></span>法<span class="_ _6"></span>树</div><div class="t m0 x38 h7 y260f ff1 fs3 fc0 sc0 lsb">（<span class="ff4 ls0 wsa5">AST</span><span class="ls0 wsa0">）<span class="_ _f"></span>。例如：</span></div><div class="t m0 x5 h10 y175b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">ast</span></span></div><div class="t m0 x5 hf y2610 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">ex <span class="fc6 ls33">=</span><span class="ws13a">ast<span class="fc6">.</span>parse(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">2 + 3*4 + x<span class="ff9 ws13b">&apos;</span><span class="fc0">, mode</span></span><span class="fc6">=<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">eval<span class="ff9 ls34">&apos;</span></span></span>)</span></span></div><div class="t m0 x5 hf y2611 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">ex</span></div><div class="t m0 x5 hf y2612 ff8 fs5 fc8 sc0 ls0 ws4">&lt;_ast.Expression object at 0x1007473d0&gt;</div><div class="t m0 x5 hf y2613 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">ast<span class="fc6 ls34">.</span>dump(ex)</span></div><div class="t m0 x5 hf y9f2 ff8 fs5 fc8 sc0 ls0 ws4">&quot;Expression(body=BinOp(left=BinOp(left=Num(n=2), op=Add(),</div><div class="t m0 x5 hf y2614 ff8 fs5 fc8 sc0 ls0 ws4">right=BinOp(left=Num(n=3), op=Mult(), right=Num(n=4))), op=Add(),</div><div class="t m0 x5 hf y2615 ff8 fs5 fc8 sc0 ls0 ws13a">right=Name(id=<span class="ff9 ls34">&apos;<span class="ff8">x</span><span class="ls0 ws13b">&apos;</span></span><span class="ws4">, ctx=Load())))&quot;</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">11.24.<span class="_ _5"> </span>9.24 <span class="ff1 ws7da">解析与分析 </span><span class="wscda">Python <span class="ff1 wscdb">源码 </span>357</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
