<div id="pfa9" class="pf w0 h0" data-page-no="a9"><div class="pc pca9 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bga9.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y334 ff8 fs5 fc8 sc0 ls0">Hello</div><div class="t m0 x5 hf y335 ff8 fs5 fc8 sc0 ls0">5</div><div class="t m0 x5 hf y336 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y126c ff1 fs3 fc0 sc0 ls0 ws38">类似的，能够通过读取文本文件的 <span class="ff6 ws25d">buffer </span>属性来读取二进制数据。</div><div class="t m0 x5 he y126d ff2 fs2 fc4 sc0 ls0 ws212">7.17.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h7 y126e ff4 fs3 fc0 sc0 ls0 ws6ea">I/O <span class="ff1 ls82 ws2f9">系统以层级结构的形式构建而成。文本文件是通过在一个拥有缓冲的二进制模</span></div><div class="t m0 x5 h7 y126f ff1 fs3 fc0 sc0 ls6c ws6f5">式文件上增加一个 <span class="ff4 ls0 ws636">Unico<span class="_ _6"></span>de <span class="ff1 wsa0">编<span class="_ _6"></span>码</span><span class="ls6">/</span></span><span class="ws6f6">解码层来创建<span class="_ _1"></span>。 <span class="ff6 ls0 ws6f7">buffer </span><span class="ws29d">属性指向对应的底层文件<span class="_ _1"></span>。<span class="_ _1"></span></span></span></div><div class="t m0 x5 h7 y1270 ff1 fs3 fc0 sc0 ls0 wsa0">如果你直接访问它的话就会绕过文本编码<span class="ff4 ls6">/</span>解码层。</div><div class="t m0 x0 h9 y1271 ff1 fs3 fc0 sc0 ls0 ws3e5">本小节例子展示的 <span class="ff6 ws6f8">sys.stdout </span><span class="wsa0">可能看起来有点特殊。<span class="_ _c"></span>默认情况下，<span class="_ _1"></span><span class="ff6 ws6f8">sys.stdout <span class="ff1">总</span></span></span></div><div class="t m0 x5 h9 y1272 ff1 fs3 fc0 sc0 ls2d ws132">是以文本模式打开的。但是如果你在写一个需要打印二进制数据到标准输出的脚本的<span class="_ _1"></span></div><div class="t m0 x5 h9 y1273 ff1 fs3 fc0 sc0 ls0">话，你可以使用上面演示的技术来绕过文本编码层。</div><div class="t m0 x5 hd y1197 ff2 fs4 fc4 sc0 ls0 ws211">7.18<span class="_ _e"> </span>5.18 <span class="ff1">将文件描述符包装成文件对象</span></div><div class="t m0 x5 he y1274 ff2 fs2 fc4 sc0 ls0 ws212">7.18.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y1275 ff1 fs3 fc0 sc0 ls13 ws6f9">你有一个对应于操作系统上一个已打开的 <span class="ff4 ls0 ws6fa">I/<span class="_ _6"></span>O <span class="ff1 ws381">通道 </span><span class="wsa5">(<span class="ff1 wsa0">比<span class="_ _6"></span>如<span class="_ _6"></span>文<span class="_ _6"></span>件、<span class="_ _6"></span>管道、<span class="_ _6"></span>套<span class="_ _6"></span>接<span class="_ _6"></span>字<span class="_ _6"></span>等</span>)</span></span></div><div class="t m0 x5 h7 ya21 ff1 fs3 fc0 sc0 ls0 ws14">的整型文件描述符，你想将它包装成一个更高层的 <span class="ff4 ws5c">Python </span>文件对象。</div><div class="t m0 x5 he y1276 ff2 fs2 fc4 sc0 ls0 ws212">7.18.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y1277 ff1 fs3 fc0 sc0 ls3a ws153">一个文件描述符和一个打开的普通文件是不一样的。文件描述符仅仅是一个由操作</div><div class="t m0 x5 h7 y1278 ff1 fs3 fc0 sc0 ls0 ws3b8">系统指定的整数，用来指代某个系统的 <span class="ff4 ws6fb">I/O </span><span class="wsa0">通道。如果你碰巧有这么一个文件描述符，</span></div><div class="t m0 x5 h7 y45e ff1 fs3 fc0 sc0 ls51 ws6fc">你可以通过使用 <span class="ff6 ls0 ws6fd">open() <span class="ff1 ws6fe">函数来<span class="_ _6"></span>将其包装为<span class="_ _6"></span>一个 <span class="ff4 ws4ce">Python </span></span></span><span class="ws1c8">的文件对象。你仅仅只需要使</span></div><div class="t m0 x5 h9 y45f ff1 fs3 fc0 sc0 ls0">用这个整数值的文件描述符作为第一个参数来代替文件名即可。例如：</div><div class="t m0 x5 h11 y1279 ffa fs5 fcd sc0 ls0 ws4"># Open a low-level file descriptor</div><div class="t m0 x5 h10 y127a ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">os</span></div><div class="t m0 x5 hf y127b ff8 fs5 fc0 sc0 ls0 ws159">fd <span class="fc6 ls33">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>open(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">somefile.txt<span class="ff9 ls34">&apos;</span></span><span class="ws13b">, os</span><span class="fc6">.</span><span class="ws16d">O_WRONLY <span class="ffd fc6 lsbd">|</span></span>os<span class="fc6 ls34">.</span>O_CREAT)</span></div><div class="t m0 x5 h11 y127c ffa fs5 fcd sc0 ls0 ws4"># Turn into a proper file</div><div class="t m0 x5 hf y127d ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open</span></span><span class="ls0 ws161">(fd, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">wt<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x5 hf y127e ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">write(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13b">hello world<span class="ff7 ws156">\n</span></span>&apos;</span><span class="ls0">)</span></div><div class="t m0 x5 hf y127f ff8 fs5 fc0 sc0 ls34">f<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></div><div class="t m0 x0 h9 y1280 ff1 fs3 fc0 sc0 ls3a ws153">当高层的文件对象被关闭或者破坏的时候，底层的文件描述符也会被关闭。如果这</div><div class="t m0 x5 h9 y1281 ff1 fs3 fc0 sc0 ls1e ws6ff">个并不是你想要的结果<span class="_ _1"></span>，你可以给 <span class="ff6 ls0 ws700">open() </span><span class="ws701">函数传递一个可选的 <span class="ff6 ls0 ws702">colsefd=False <span class="ff1 wsa0">。<span class="_ _6"></span>比</span></span></span></div><div class="t m0 x5 h9 y10fc ff1 fs3 fc0 sc0 ls0">如：</div><div class="t m0 x5 h11 y1282 ffa fs5 fcd sc0 ls0 ws4"># Create a file object, but don<span class="ffb ws13b">&apos;</span>t close underlying fd when done</div><div class="t m0 x5 hf y1283 ff8 fs5 fc0 sc0 ls32">f<span class="fc6 ls33">=<span class="fca ls0 ws13a">open</span></span><span class="ls0 ws161">(fd, <span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws13a">wt<span class="ff9 ws13b">&apos;</span></span><span class="ws4">, closefd<span class="fc6 ls34">=</span><span class="fca ws13a">False</span>)</span></span></div><div class="t m0 x5 hf ycbb ff8 fs5 fc6 sc0 ls0 ws13a">...</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">7.18.<span class="_ _5"> </span>5.18 <span class="ff1 ws6e7">将文件描述符包装成文件对象 </span>160</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
