<div id="pf1fb" class="pf w0 h0" data-page-no="1fb"><div class="pc pc1fb w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1fb.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">15.5.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y11a8 ff1 fs3 fc0 sc0 ls0 wsc">使用 <span class="ff6 ws25d">os.get<span class="_ _7"> </span>terminal<span class="_ _16"> </span>size() </span>函数来做到这一点。</div><div class="t m0 x0 h9 y31bc ff1 fs3 fc0 sc0 ls0">代码示例：</div><div class="t m0 x5 h10 y31bd ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">os</span></span></div><div class="t m0 x5 hf y31be ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws159">sz <span class="fc6 ls33">=</span><span class="ws13a">os<span class="fc6 ls34">.</span>get_terminal_size()</span></span></div><div class="t m0 x5 hf y2bb0 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">sz</span></div><div class="t m0 x5 hf y31bf ff8 fs5 fc8 sc0 ls0 ws4">os.terminal_size(columns=80, lines=24)</div><div class="t m0 x5 hf y1bbc ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sz<span class="fc6 ls34">.</span>columns</span></div><div class="t m0 x5 hf y31c0 ff8 fs5 fc8 sc0 ls0">80</div><div class="t m0 x5 hf y31c1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">sz<span class="fc6 ls34">.</span>lines</span></div><div class="t m0 x5 hf y31c2 ff8 fs5 fc8 sc0 ls0">24</div><div class="t m0 x5 hf y796 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y31c3 ff2 fs2 fc4 sc0 ls0 ws212">15.5.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y317 ff1 fs3 fc0 sc0 ls19 ws1204">有太多方式来得知终端大小了，从读取环境变量到执行底层的 <span class="ff6 ls0 ws229">ioctl() <span class="ff1 wsa0">函数等等。</span></span></div><div class="t m0 x5 h9 y28fa ff1 fs3 fc0 sc0 ls0">不过，为什么要去研究这些复杂的办法而不是仅仅调用一个简单的函数呢？</div><div class="t m0 x5 hd y248a ff2 fs4 fc4 sc0 ls0 ws211">15.6<span class="_ _e"> </span>13.6 <span class="ff1">执行外部命令并获取它的输出</span></div><div class="t m0 x5 he y31c4 ff2 fs2 fc4 sc0 ls0 ws212">15.6.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y31c5 ff1 fs3 fc0 sc0 ls0 wsc">你想执行一个外部命令并以 <span class="ff4 ws1062">Python </span>字符串的形式获取执行结果。</div><div class="t m0 x5 he y31c6 ff2 fs2 fc4 sc0 ls0 ws212">15.6.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y31c7 ff1 fs3 fc0 sc0 ls0 wsc">使用 <span class="ff6 ws1f3">subprocess.check<span class="_ _7"> </span>output() </span>函数。例如：</div><div class="t m0 x5 h10 y204f ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">subprocess</span></div><div class="t m0 x5 hf y31c8 ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>check_output([<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">netstat<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">-a<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x0 h9 y31c9 ff1 fs3 fc0 sc0 ls3a ws153">这段代码执行一个指定的命令并将执行结果以一个字节字符串的形式返回。如果你</div><div class="t m0 x5 h9 ye69 ff1 fs3 fc0 sc0 ls0">需要文本形式返回，加一个解码步骤即可。例如：</div><div class="t m0 x5 hf y31ca ff8 fs5 fc0 sc0 ls0 ws16d">out_text <span class="fc6 ls32">=</span><span class="ws13a">out_bytes<span class="fc6">.</span>decode(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">utf-8<span class="ff9 ws13b">&apos;</span></span>)</span></div><div class="t m0 x0 h9 y31cb ff1 fs3 fc0 sc0 ls3a ws153">如果被执行的命令以非零码返回，就会抛出异常。下面的例子捕获到错误并获取返</div><div class="t m0 x5 h9 y31cc ff1 fs3 fc0 sc0 ls0">回码：</div><div class="t m0 x5 hf y31cd ff7 fs5 fca sc0 ls0 ws156">try<span class="ff8 fc0">:</span></div><div class="t m0 x15 hf y31ce ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">subprocess<span class="fc6 ls34">.</span>check_output([<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">cmd<span class="ff9 ws13b">&apos;</span></span><span class="ls34">,<span class="ff9 fc9">&apos;</span></span><span class="fc9">arg1<span class="ff9 ls34">&apos;</span></span>,<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">arg2<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x5 hf y31cf ff7 fs5 fca sc0 ls0 ws146">except <span class="ff8 fc0 ws13a">subprocess<span class="fc6 ls34">.</span><span class="ws9bb">CalledProcessError </span></span><span class="ws157">as <span class="ff8 fc0">e:</span></span></div><div class="t m0 x15 hf y31d0 ff8 fs5 fc0 sc0 ls0 ws16e">out_bytes <span class="fc6 ls33">=</span><span class="ws13a">e<span class="fc6 ls34">.</span><span class="ws1205">output <span class="ffa fcd ws4"># Output generated before error</span></span></span></div><div class="t m0 x15 hf y31d1 ff8 fs5 fc0 sc0 ls0 ws1206">code <span class="fc6 ls33">=</span><span class="ws13a">e<span class="fc6 ls34">.</span><span class="ws1207">returncode <span class="ffa fcd ws13b"># Return code</span></span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.6.<span class="_ _36"> </span>13.6 <span class="ff1 ws6e7">执行外部命令并获取它的输出 </span>498</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
