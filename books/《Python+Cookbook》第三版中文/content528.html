<div id="pf210" class="pf w0 h0" data-page-no="210"><div class="pc pc210 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg210.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x0 h9 y2a ff1 fs3 fc0 sc0 ls0 ws38">不过，你可以通过给 <span class="ff6 ws472">patch() </span>提供第二个参数来将值替换成任何你想要的：</div><div class="t m0 x5 hf y1ca7 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">x</span></div><div class="t m0 x5 hf y1ca8 ff8 fs5 fc8 sc0 ls0">42</div><div class="t m0 x5 hf y1ca9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 fc0 ws13a">patch(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">__main__.x<span class="ff9 ls34">&apos;</span></span><span class="ls32">,<span class="ff9 fc9 ls34">&apos;</span></span><span class="fc9">patched_value<span class="ff9 ls34">&apos;</span></span>):</span></span></div><div class="t m0 x5 hf y1caa ff7 fs5 fc5 sc0 ls0 ws1a2">... <span class="fca ws156">print<span class="ff8 fc0">(x)</span></span></div><div class="t m0 x5 h10 y1cab ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y1cac ff8 fs5 fc8 sc0 ls0">patched_value</div><div class="t m0 x5 hf y1cad ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0">x</span></div><div class="t m0 x5 hf y3346 ff8 fs5 fc8 sc0 ls0">42</div><div class="t m0 x5 hf y1b0c ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3347 ff1 fs3 fc0 sc0 ls14 ws339">被用来作为替换值的 <span class="ff6 ls0 ws33a">MagicMock </span><span class="ws174">实例能够模拟可调用对象和实例<span class="_ _1"></span>。他们记录对象</span></div><div class="t m0 x5 h9 y3348 ff1 fs3 fc0 sc0 ls0">的使用信息并允许你执行断言检查，例如：</div><div class="t m0 x5 hf y3349 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">from <span class="fcc wsb44">unittest.mock </span><span class="ws146">import <span class="ff8 fc0">MagicMock</span></span></span></div><div class="t m0 x5 hf y334a ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">m<span class="fc6 ls33">=</span><span class="ls0 ws8a2">MagicMock(return_value </span><span class="fc6">=<span class="fc7 ls0 ws13a">10<span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y334b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">m(<span class="fc7 ls34">1</span><span class="ls33">,</span><span class="fc7">2</span><span class="ws4">, debug<span class="fc6 ls34">=</span></span><span class="fca">True</span>)</span></div><div class="t m0 x5 hf y334c ff8 fs5 fc8 sc0 ls0">10</div><div class="t m0 x5 hf y334d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">assert_called_with(</span></span><span class="fc7">1</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls0 ws4">, debug</span><span class="fc6">=<span class="fca ls0 ws13a">True<span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y334e ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">assert_called_with(</span></span><span class="fc7">1</span><span class="ls32">,</span><span class="fc7">2</span><span class="ls0">)</span></span></div><div class="t m0 x5 hf y334f ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x19 hf y3350 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws13b">, line <span class="fc7 ws13a">1</span><span class="ws4">, in &lt;module&gt;</span></span></div><div class="t m0 x19 hf y3351 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fca ws13a">&quot;.../unittest/mock.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">726</span><span class="ws4">, in assert_called_with</span></span></div><div class="t m0 x15 hf y3352 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">AssertionError<span class="fc0">(msg)</span></span></div><div class="t m0 x5 hf y3353 ff8 fs5 fc2 sc0 ls0 ws13a">AssertionError<span class="fc0 ws4">: Expected call: mock(1, 2)</span></div><div class="t m0 x5 hf yc16 ff8 fs5 fc8 sc0 ls0 ws4">Actual call: mock(1, 2, debug=True)</div><div class="t m0 x5 hf y3354 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hf y3355 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">upper</span><span class="ls34">.</span><span class="fc0 ws150">return_value </span><span class="ls33">=</span><span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">HELLO<span class="ff9">&apos;</span></span></span></span></div><div class="t m0 x5 hf y3356 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">upper(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">hello<span class="ff9 ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y3357 ff9 fs5 fc8 sc0 ls34">&apos;<span class="ff8 ls0 ws13a">HELLO<span class="ff9">&apos;</span></span></div><div class="t m0 x5 hf y2641 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">assert <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">upper</span><span class="ls34">.</span><span class="fc0">called</span></span></span></span></div><div class="t m0 x5 hf y3358 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">split</span><span class="ls34">.</span><span class="fc0 ws150">return_value </span><span class="ls33">=</span><span class="fc0">[</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">hello<span class="ff9 ws13b">&apos;</span></span></span><span class="ls33">,</span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">world</span>&apos;</span><span class="ls0">]</span></span></div><div class="t m0 x5 hf y3359 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">split(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">hello world</span><span class="ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y335a ff8 fs5 fc8 sc0 ls34">[<span class="ff9 ls0 ws13b">&apos;</span><span class="ls0 ws13a">hello</span><span class="ff9">&apos;</span><span class="ls32">,</span><span class="ff9">&apos;</span><span class="ls0 ws13a">world<span class="ff9 ws13b">&apos;</span>]</span></div><div class="t m0 x5 hf y335b ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">split</span><span class="ls34">.</span><span class="fc0">assert_called_with(<span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">hello world</span><span class="ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y335c ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 hf y335d ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ws13a">m[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">blah<span class="ff9 ls34">&apos;</span></span>]</span></div><div class="t m0 x5 hf y335e ff8 fs5 fc8 sc0 ls0 ws4">&lt;MagicMock name=<span class="ff9 ws13b">&apos;</span><span class="ws13a">mock.__getitem__()<span class="ff9 ls33">&apos;</span>id=<span class="ff9 ls34">&apos;</span>4314412048<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y335f ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">__getitem__</span><span class="ls34">.</span><span class="fc0">called</span></span></span></div><div class="t m0 x5 hf y3360 ff8 fs5 fc8 sc0 ls0">True</div><div class="t m0 x5 hf y3361 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">m<span class="fc6 ls0 ws13a">.<span class="fc0">__getitem__</span><span class="ls34">.</span><span class="fc0">assert_called_with(</span></span><span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">blah<span class="ff9 ws13b">&apos;</span><span class="fc0">)</span></span></span></span></div><div class="t m0 x5 hf y2926 ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x0 h9 y3362 ff1 fs3 fc0 sc0 ls0 wsa0">一般来讲，这些操作会<span class="_ _6"></span>在一个单元测试中完成。例<span class="_ _6"></span>如，假设你已经有了像下<span class="_ _6"></span>面这样</div><div class="t m0 x5 h9 y3363 ff1 fs3 fc0 sc0 ls0">的函数：</div><div class="t m0 x5 h11 y3364 ffa fs5 fcd sc0 ls0 ws4"># example.py</div><div class="t m0 x5 hf y3365 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws2dd">urllib.request </span><span class="ws146">import <span class="ff8 fc0">urlopen</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">16.2.<span class="_ _36"> </span>14.2 <span class="ff1 ws98a">在单元测试中给对象打补丁 </span>519</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
