<div id="pf123" class="pf w0 h0" data-page-no="123"><div class="pc pc123 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg123.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">close<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y1ac ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Already closed</span>&apos;</span><span class="fc0">)</span></span></div><div class="t m0 x5 hf y1af ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">OpenConnectionState<span class="ff8 fc0">(ConnectionState):</span></span></div><div class="t m0 x15 h10 y1b0 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y355 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">read<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf y410 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">reading</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x15 h10 yba ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf y8c6 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">write<span class="fc0 ws4">(conn, data):</span></span></div><div class="t m0 x16 hf ybed ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ls34">(<span class="ff9 fc9">&apos;<span class="ff8 ls0 ws13a">writing</span>&apos;</span><span class="ls0">)</span></span></div><div class="t m0 x15 h10 ybef ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf ybf0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">open<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf yd7d ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Already open</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></div><div class="t m0 x15 h10 ybf2 ff7 fs5 fc12 sc0 ls0">@staticmethod</div><div class="t m0 x15 hf ybf3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">close<span class="fc0">(conn):</span></span></div><div class="t m0 x16 hf ybf4 ff8 fs5 fc0 sc0 ls0 ws13a">conn<span class="fc6">.</span>new_state(ClosedConnectionState)</div><div class="t m0 x0 h9 y1ee7 ff1 fs3 fc0 sc0 ls0">下面是使用演示：</div><div class="t m0 x5 hf y1ee8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls32">c<span class="fc6 ls33">=</span><span class="ls0">Connection()</span></span></div><div class="t m0 x5 hf y1ee9 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">_state</span></span></span></div><div class="t m0 x5 hf y1eea ff8 fs5 fc8 sc0 ls0 ws145">&lt;class <span class="ff9 ls34">&apos;</span><span class="ws13a">__main__.ClosedConnectionState<span class="ff9 ws13b">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y1eeb ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y1eec ff8 fs5 fce sc0 ls0 ws4">Traceback (most recent call last):</div><div class="t m0 x15 hf y1eed ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;&lt;stdin&gt;&quot;</span><span class="ws145">, line <span class="fc7 ls34">1</span><span class="ls32">,</span><span class="ff7 fca ws160">in </span><span class="fc6 ws13a">&lt;<span class="fc0">module</span>&gt;</span></span></div><div class="t m0 x15 hf y1eee ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;example.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">10</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>read</span></div><div class="t m0 x16 hf y1eef ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0">_state<span class="fc6 ls34">.</span>read(</span>self<span class="fc0">)</span></span></div><div class="t m0 x15 hf y1ef0 ff8 fs5 fc0 sc0 ls0 ws13c">File <span class="fc9 ws13a">&quot;example.py&quot;</span><span class="ws145">, line <span class="fc7 ws13a">43</span><span class="ls32">,</span><span class="ff7 fca ws157">in </span>read</span></div><div class="t m0 x16 hf y6c7 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Not open</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></div><div class="t m0 x5 hf y176 ff8 fs5 fc2 sc0 ls0 ws13a">RuntimeError<span class="fc0 ws13b">: Not open</span></div><div class="t m0 x5 hf y1ef1 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">open()</span></span></span></div><div class="t m0 x5 hf y1ef2 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">_state</span></span></span></div><div class="t m0 x5 hf y1ef3 ff8 fs5 fc8 sc0 ls0 ws145">&lt;class <span class="ff9 ls34">&apos;</span><span class="ws13a">__main__.OpenConnectionState<span class="ff9 ls34">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y1ef4 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">read()</span></span></span></div><div class="t m0 x5 hf y1ef5 ff8 fs5 fc8 sc0 ls0">reading</div><div class="t m0 x5 hf y1ef6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">write(<span class="ff9 fc9 ws13b">&apos;</span><span class="fc9">hello<span class="ff9 ls34">&apos;</span></span>)</span></span></span></div><div class="t m0 x5 hf y1ef7 ff8 fs5 fc8 sc0 ls0">writing</div><div class="t m0 x5 hf y11a6 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">close()</span></span></span></div><div class="t m0 x5 hf y1ef8 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="ff8 fc0 ls34">c<span class="fc6 ls0 ws13a">.<span class="fc0">_state</span></span></span></div><div class="t m0 x5 hf y1ef9 ff8 fs5 fc8 sc0 ls0 ws145">&lt;class <span class="ff9 ls34">&apos;</span><span class="ws13a">__main__.ClosedConnectionState<span class="ff9 ws13b">&apos;</span>&gt;</span></div><div class="t m0 x5 hf y1efa ff8 fs5 fc8 sc0 ls0">&gt;&gt;&gt;</div><div class="t m0 x5 he y1802 ff2 fs2 fc4 sc0 ls0 wsadf">10.19.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y6e ff1 fs3 fc0 sc0 ls3a ws153">如果代码中出现太多的条件判断语句的话，代码就会变得难以维护和阅读。这里的</div><div class="t m0 x5 h9 y674 ff1 fs3 fc0 sc0 ls0">解决方案是将每个状态抽取出来定义成一个类。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.19.<span class="_ _5"> </span>8.19 <span class="ff1 wsb03">实现状态对象或者状态机 </span>282</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
