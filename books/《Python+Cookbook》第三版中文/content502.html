<div id="pf1f6" class="pf w0 h0" data-page-no="1f6"><div class="pc pc1f6 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg1f6.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 he y137 ff2 fs2 fc4 sc0 ls0 ws212">15.1.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y236 ff6 fs3 fc0 sc0 ls0 ws11e3">fileinput.input() <span class="ff1 ls36 ws11e4">创建并返回一个 </span><span class="ws522">FileInput <span class="ff1 ls36 ws14a">类的实例<span class="_ _c"></span>。该实例除了拥有一些</span></span></div><div class="t m0 x5 h9 y237 ff1 fs3 fc0 sc0 ls1e ws111">有用的帮助方法外<span class="_ _1"></span>，它还可被当做一个上下文管理器使用。因此<span class="_ _c"></span>，<span class="_ _6"></span>整合起来<span class="_ _1"></span>，如果我</div><div class="t m0 x5 h9 y238 ff1 fs3 fc0 sc0 ls13 wse5">们要写一个打印多个文件输出的脚本<span class="_ _1"></span>，那么我们需要在输出中包含文件名和行号，如<span class="_ _c"></span></div><div class="t m0 x5 h9 yea6 ff1 fs3 fc0 sc0 ls0">下所示：</div><div class="t m0 x5 h10 y3162 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws146">import <span class="fcc">fileinput</span></span></div><div class="t m0 x5 hf y3163 ff7 fs5 fc5 sc0 ls0 ws139">&gt;&gt;&gt; <span class="fca ws15a">with <span class="ff8 fc0 ws13a">fileinput<span class="fc6 ls34">.</span>input(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">/etc/passwd<span class="ff9 ls34">&apos;</span></span><span class="ls32">)</span></span><span class="ws157">as <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y3164 ff7 fs5 fc5 sc0 ls0 ws1a2">&gt;&gt;&gt; <span class="fca ws139">for <span class="ff8 fc0 ws161">line </span><span class="ws160">in <span class="ff8 fc0">f:</span></span></span></div><div class="t m0 x5 hf y278c ff7 fs5 fc5 sc0 ls0 ws1a3">... <span class="fca ws156">print<span class="ff8 fc0 ws13a">(f<span class="fc6 ls34">.</span><span class="ws13b">filename(), f<span class="fc6 ls34">.</span>lineno(), line, end</span><span class="fc6">=<span class="ff9 fc9 ls34">&apos;&apos;</span></span>)</span></span></div><div class="t m0 x5 h10 y3165 ff7 fs5 fc5 sc0 ls0">...</div><div class="t m0 x5 hf y3166 ff8 fs5 fc8 sc0 ls0 ws4">/etc/passwd 1 ##</div><div class="t m0 x5 hf y3167 ff8 fs5 fc8 sc0 ls0 ws4">/etc/passwd 2 # User Database</div><div class="t m0 x5 hf y3168 ff8 fs5 fc8 sc0 ls0 ws4">/etc/passwd 3 #</div><div class="t m0 x5 hf y3169 ff8 fs5 fc8 sc0 ls0 ws4">&lt;other output omitted&gt;</div><div class="t m0 x0 h9 y600 ff1 fs3 fc0 sc0 ls3a ws153">通过将它作为一个上下文管理器使用，可以确保它不再使用时文件能自动关闭，而</div><div class="t m0 x5 h9 y316a ff1 fs3 fc0 sc0 ls17 ws11e5">且我们在之类还演示了 <span class="ff6 ls0 ws11e6">FileInput </span><span class="wsf6">的一些有用的帮助方法来获取输出中的一些其他信<span class="_ _1"></span></span></div><div class="t m0 x5 h9 y1932 ff1 fs3 fc0 sc0 ls0">息。</div><div class="t m0 x5 hd y316b ff2 fs4 fc4 sc0 ls0 ws211">15.2<span class="_ _e"> </span>13.2 <span class="ff1">终止程序并给出错误信息</span></div><div class="t m0 x5 he y316c ff2 fs2 fc4 sc0 ls0 ws212">15.2.1 <span class="ff1">问题</span></div><div class="t m0 x0 h9 y316d ff1 fs3 fc0 sc0 ls0">你想向标准错误打印一条消息并返回某个非零状态码来终止程序运行</div><div class="t m0 x5 he y316e ff2 fs2 fc4 sc0 ls0 ws212">15.2.2 <span class="ff1">解决方案</span></div><div class="t m0 x0 h9 y316f ff1 fs3 fc0 sc0 ls0 ws11e7">你有一<span class="_ _6"></span>个程序<span class="_ _6"></span>像下<span class="_ _6"></span>面这样<span class="_ _6"></span>终止，抛<span class="_ _6"></span>出一个 <span class="ff6 wsbca">SystemExit </span><span class="wsa0">异<span class="_ _6"></span>常，使用<span class="_ _6"></span>错误消<span class="_ _6"></span>息作为<span class="_ _6"></span>参</span></div><div class="t m0 x5 h9 y947 ff1 fs3 fc0 sc0 ls0">数。例如：</div><div class="t m0 x5 hf y3170 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">SystemExit<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">It failed!<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x0 h7 y3171 ff1 fs3 fc0 sc0 ls0 wsc">它会将消息在 <span class="ff6 ws17c">sys.stderr </span><span class="ws14">中打印，然后程序以状态码 <span class="ff4 ls39">1</span>退出。</span></div><div class="t m0 x5 he y2a9e ff2 fs2 fc4 sc0 ls0 ws212">15.2.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 yc5e ff1 fs3 fc0 sc0 ls0 wsa0">本节虽然很短小，但是<span class="_ _6"></span>它能解决在写脚本时的一<span class="_ _6"></span>个常见问题。也就是说，当<span class="_ _6"></span>你想要</div><div class="t m0 x5 h9 y3172 ff1 fs3 fc0 sc0 ls0">终止某个程序时，你可能会像下面这样写：</div><div class="t m0 x5 h10 y5d7 ff7 fs5 fca sc0 ls0 ws146">import <span class="fcc">sys</span></div><div class="t m0 x5 hf y5d8 ff8 fs5 fc0 sc0 ls0 ws13a">sys<span class="fc6 ls34">.</span>stderr<span class="fc6 ls34">.</span>write(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">It failed!<span class="ff7 ws156">\n<span class="ff9 ls34">&apos;</span></span></span>)</div><div class="t m0 x5 hf y5d9 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">SystemExit<span class="fc0">(<span class="fc7 ls34">1</span>)</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">15.2.<span class="_ _36"> </span>13.2 <span class="ff1 ws512">终止程序并给出错误信息 </span>493</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
