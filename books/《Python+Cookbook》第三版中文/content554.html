<div id="pf22a" class="pf w0 h0" data-page-no="22a"><div class="pc pc22a w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg22a.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x5 hf y1ab ff8 fs5 fc0 sc0 ls0 ws4">int divide(int a, int b, int *remainder) {</div><div class="t m0 x15 hf y1ac ff8 fs5 fc0 sc0 ls0 ws4">int quot = a / b;</div><div class="t m0 x15 hf y1ad ff8 fs5 fc0 sc0 ls0 ws4">*remainder = a % b;</div><div class="t m0 x15 hf y1ae ff8 fs5 fc0 sc0 ls0 ws13b">return quot;</div><div class="t m0 x5 hf y1af ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf y355 ff8 fs5 fc0 sc0 ls0 ws4">/* Average values in an array */</div><div class="t m0 x5 hf y410 ff8 fs5 fc0 sc0 ls0 ws4">double avg(double *a, int n) {</div><div class="t m0 x15 hf y411 ff8 fs5 fc0 sc0 ls0 ws13b">int i;</div><div class="t m0 x15 hf yba ff8 fs5 fc0 sc0 ls0 ws4">double total = 0.0;</div><div class="t m0 x15 hf y8c6 ff8 fs5 fc0 sc0 ls0 ws4">for (i = 0; i &lt; n; i++) {</div><div class="t m0 x16 hf ybed ff8 fs5 fc0 sc0 ls0 ws13b">total += a[i];</div><div class="t m0 x15 hf ybee ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x15 hf ybef ff8 fs5 fc0 sc0 ls0 ws4">return total / n;</div><div class="t m0 x5 hf ybf0 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x5 hf ybf1 ff8 fs5 fc0 sc0 ls0 ws4">/* A C data structure */</div><div class="t m0 x5 hf ybf2 ff8 fs5 fc0 sc0 ls0 ws4">typedef struct Point {</div><div class="t m0 x15 hf ybf3 ff8 fs5 fc0 sc0 ls0 ws13b">double x,y;</div><div class="t m0 x5 hf ybf4 ff8 fs5 fc0 sc0 ls0 ws4">} Point;</div><div class="t m0 x5 hf ybf6 ff8 fs5 fc0 sc0 ls0 ws4">/* Function involving a C data structure */</div><div class="t m0 x5 hf ybf7 ff8 fs5 fc0 sc0 ls0 ws4">double distance(Point *p1, Point *p2) {</div><div class="t m0 x15 hf ybf8 ff8 fs5 fc0 sc0 ls0 ws4">return hypot(p1-&gt;x - p2-&gt;x, p1-&gt;y - p2-&gt;y);</div><div class="t m0 x5 hf ybf9 ff8 fs5 fc0 sc0 ls0">}</div><div class="t m0 x0 h7 y35c0 ff1 fs3 fc0 sc0 ls0 ws134d">这<span class="_ _6"></span>段<span class="_ _6"></span>代<span class="_ _6"></span>码包<span class="_ _6"></span>含<span class="_ _6"></span>了<span class="_ _6"></span>多<span class="_ _6"></span>种<span class="_ _6"></span>不<span class="_ _6"></span>同<span class="_ _6"></span>的 <span class="ff4 ls225">C</span><span class="ws134e">语<span class="_ _6"></span>言<span class="_ _6"></span>编<span class="_ _6"></span>程<span class="_ _6"></span>特<span class="_ _6"></span>性。<span class="_ _6"></span>首<span class="_ _6"></span>先，<span class="_ _6"></span>这<span class="_ _6"></span>里<span class="_ _6"></span>有<span class="_ _6"></span>很<span class="_ _6"></span>多函<span class="_ _6"></span>数<span class="_ _6"></span>比<span class="_ _6"></span>如 <span class="ff6">gcd()</span></span></div><div class="t m0 x5 h7 y35c1 ff1 fs3 fc0 sc0 ls241">和<span class="ff6 ls0 ws5f7">is mandel()<span class="_ _18"> </span></span><span class="ls242">。<span class="ff6 ls0 ws134f">divide() </span><span class="ls1c5 ws1350">函数是一个返回多个值的 <span class="ff4 ls243">C</span><span class="ws1351">函数例子<span class="_ _c"></span>，其中有一个是<span class="_ _c"></span></span></span></span></div><div class="t m0 x5 h7 y35c2 ff1 fs3 fc0 sc0 ls0 ws1352">通<span class="_ _0"></span>过<span class="_ _0"></span>指<span class="_ _0"></span>针<span class="_ _12"></span>参<span class="_ _0"></span>数<span class="_ _0"></span>的<span class="_ _0"></span>方<span class="_ _0"></span>式。 <span class="ff6 ws1353">avg() </span><span class="ws1354">函<span class="_ _12"></span>数<span class="_ _0"></span>通<span class="_ _0"></span>过<span class="_ _0"></span>一<span class="_ _0"></span>个 <span class="ff4 ls244">C</span><span class="wsa0">数<span class="_ _0"></span>组<span class="_ _12"></span>执<span class="_ _0"></span>行<span class="_ _0"></span>数<span class="_ _0"></span>据<span class="_ _0"></span>聚<span class="_ _12"></span>集<span class="_ _0"></span>操<span class="_ _0"></span>作。<span class="_ _0"></span><span class="ff6 ws1355">Point </span>和</span></span></div><div class="t m0 x5 h7 y2213 ff6 fs3 fc0 sc0 ls0 ws17c">distance() <span class="ff1 wsc">函数涉及到了 <span class="ff4 ls8">C</span>结构体。</span></div><div class="t m0 x0 h7 y35c3 ff1 fs3 fc0 sc0 lsa8 ws3de">对于接下来的所有小节，先假定上面的代码已经被写入了一个<span class="_ _1"></span>名叫“<span class="ff4 ls0 wsa5">sample.c<span class="ff1 wsa0">”的</span></span></div><div class="t m0 x5 h7 y27e4 ff1 fs3 fc0 sc0 ls0 wsa0">文件中，然后它们的定义被写入一个名叫“<span class="ff4 wsa5">sample.h</span>”的头文件中，并且被编译为一个</div><div class="t m0 x5 h7 y35c4 ff1 fs3 fc0 sc0 ls0 wsa0">库<span class="_ _6"></span>叫<span class="_ _6"></span>“<span class="ff4 wsa5">libsample</span><span class="ws1356">”<span class="_ _31"></span>，<span class="_ _6"></span>能<span class="_ _6"></span>被<span class="_ _6"></span>链<span class="_ _6"></span>接<span class="_ _6"></span>到<span class="_ _6"></span>其<span class="_ _6"></span>他 <span class="ff4 ls225">C</span><span class="wsa0">语言<span class="_ _6"></span>代<span class="_ _6"></span>码<span class="_ _6"></span>中。<span class="_ _6"></span>编<span class="_ _6"></span>译<span class="_ _6"></span>和<span class="_ _6"></span>链<span class="_ _6"></span>接<span class="_ _6"></span>的<span class="_ _6"></span>细<span class="_ _6"></span>节<span class="_ _6"></span>依<span class="_ _6"></span>据<span class="_ _6"></span>系<span class="_ _6"></span>统<span class="_ _6"></span>的<span class="_ _6"></span>不</span></span></div><div class="t m0 x5 h7 y24f2 ff1 fs3 fc0 sc0 lse ws1357">同而不同，但是这个不是我们关注的。如果你要处理 <span class="ff4 ls20">C</span><span class="wsd8">代码<span class="_ _1"></span>，我们假定这些基础的东</span></div><div class="t m0 x5 h9 y35c5 ff1 fs3 fc0 sc0 ls0">西你都掌握了。</div><div class="t m0 x0 h7 y35c6 ff4 fs3 fc0 sc0 ls0 wsa5">Con<span class="_ _1"></span>ten<span class="_ _1"></span>ts:</div><div class="t m0 x5 hd y35c7 ff2 fs4 fc4 sc0 ls0 ws211">17.1<span class="_ _e"> </span>15.1 <span class="ff1 ws165">使用 </span><span class="ws1358">ct<span class="_ _c"></span>yp<span class="_ _0"></span>es <span class="ff1 ws165">访问 </span><span class="ls23d">C</span><span class="ff1">代码</span></span></div><div class="t m0 x5 he y35c8 ff2 fs2 fc4 sc0 ls0 ws212">17.1.1 <span class="ff1">问题</span></div><div class="t m0 x0 h7 y489 ff1 fs3 fc0 sc0 ls0 ws2d5">你有一<span class="_ _6"></span>些 <span class="ff4 ls245">C</span><span class="ls18 ws849">函数已经被编译到共享库或 </span><span class="ff4 ws1359">DLL </span><span class="ls18 ws135a">中。你希望可以使用纯 </span><span class="ff4 wsf8">Python </span><span class="wsa0">代码</span></div><div class="t m0 x5 h7 y35c9 ff1 fs3 fc0 sc0 ls0 ws38">调用这些函数，而不用编写额外的 <span class="ff4 ls8">C</span>代码或使用第三方扩展工具。</div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 ws21d">17.1.<span class="_ _36"> </span>15.1 <span class="ff1 ws16b">使用 </span><span class="ws135b">ctypes <span class="ff1 ws16b">访问 </span><span class="ls246">C</span><span class="ff1 ws135c">代码 </span>545</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
