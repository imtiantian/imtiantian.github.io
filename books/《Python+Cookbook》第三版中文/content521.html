<div id="pf209" class="pf w0 h0" data-page-no="209"><div class="pc pc209 w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg209.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">stop<span class="fc0">(<span class="fca">self</span>):</span></span></div><div class="t m0 x16 hf y1ac ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws145">_start </span></span>is <span class="ff8 ws13a">None<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1ad ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">RuntimeError<span class="fc0 ls34">(</span><span class="ff9 fc9 ws13b">&apos;<span class="ff8 ws4">Not started</span><span class="ls34">&apos;</span></span><span class="fc0">)</span></span></div><div class="t m0 x16 hf y1ae ff8 fs5 fc0 sc0 ls0 ws158">end <span class="fc6 ls32">=</span><span class="fca ws13a">self<span class="fc6 ls34">.</span></span>_func()</div><div class="t m0 x16 hf y1af ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">elapsed </span><span class="ws23d">+= <span class="fc0 ws158">end </span><span class="ls33">-</span></span></span>self<span class="fc6">.<span class="fc0">_start</span></span></div><div class="t m0 x16 hf y1b0 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws19f">_start </span><span class="ls32">=</span></span>None</div><div class="t m0 x15 hf y410 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">reset<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf y411 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0 ws155">elapsed </span><span class="ls33">=</span><span class="fc7">0.0</span></span></div><div class="t m0 x15 h10 y8c6 ff7 fs5 fc12 sc0 ls0">@property</div><div class="t m0 x15 hf ybed ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">running<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf ybee ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">self<span class="fc6 ls34">.</span><span class="fc0 ws145">_start </span></span><span class="ws157">is not <span class="ff8">None</span></span></div><div class="t m0 x15 hf ybf0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__enter__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0">):</span></span></span></div><div class="t m0 x16 hf yd7d ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">start()</span></span></div><div class="t m0 x16 hf ybf1 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8">self</span></div><div class="t m0 x15 hf ybf3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__exit__<span class="fc0">(<span class="fca">self</span><span class="ls33">,</span><span class="fc6">*</span>args):</span></span></div><div class="t m0 x16 hf ybf4 ff8 fs5 fca sc0 ls0 ws13a">self<span class="fc6">.<span class="fc0">stop()</span></span></div><div class="t m0 x0 h9 y32d2 ff1 fs3 fc0 sc0 ls0 wsa0">这<span class="_ _12"></span>个<span class="_ _12"></span>类<span class="_ _24"></span>定<span class="_ _12"></span>义<span class="_ _12"></span>了<span class="_ _12"></span>一<span class="_ _24"></span>个<span class="_ _12"></span>可<span class="_ _12"></span>以<span class="_ _24"></span>被<span class="_ _12"></span>用<span class="_ _12"></span>户<span class="_ _24"></span>根<span class="_ _12"></span>据<span class="_ _12"></span>需<span class="_ _12"></span>要<span class="_ _24"></span>启<span class="_ _12"></span>动、<span class="_ _12"></span>停<span class="_ _24"></span>止<span class="_ _12"></span>和<span class="_ _12"></span>重<span class="_ _24"></span>置<span class="_ _12"></span>的<span class="_ _12"></span>计<span class="_ _12"></span>时<span class="_ _24"></span>器。<span class="_ _12"></span>它<span class="_ _12"></span>会<span class="_ _24"></span>在</div><div class="t m0 x5 h9 y2d35 ff6 fs3 fc0 sc0 ls0 ws23a">elapsed <span class="ff1">属性中记录整个消耗时间。下面是一个例子来演示怎样使用它：</span></div><div class="t m0 x5 hf y32d3 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">countdown<span class="fc0">(n):</span></span></div><div class="t m0 x15 hf y32d4 ff7 fs5 fca sc0 ls0 ws16a">while <span class="ff8 fc0 ls33">n<span class="fc6 ls32">&gt;<span class="fc7 ls34">0</span></span><span class="ls0">:</span></span></div><div class="t m0 x16 hf y32d5 ff8 fs5 fc0 sc0 ls32">n<span class="fc6 ls0 ws23d">-= <span class="fc7">1</span></span></div><div class="t m0 x5 h11 y32d6 ffa fs5 fcd sc0 ls0 ws4"># Use 1: Explicit start/stop</div><div class="t m0 x5 hf y32d7 ff8 fs5 fc0 sc0 ls32">t<span class="fc6 ls33">=</span><span class="ls0">Timer()</span></div><div class="t m0 x5 hf y27fd ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">start()</span></span></div><div class="t m0 x5 hf y2fa3 ff8 fs5 fc0 sc0 ls0 ws13a">countdown(<span class="fc7">1000000</span>)</div><div class="t m0 x5 hf y32d8 ff8 fs5 fc0 sc0 ls34">t<span class="fc6 ls0 ws13a">.<span class="fc0">stop()</span></span></div><div class="t m0 x5 hf y32d9 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(t<span class="fc6 ls34">.</span>elapsed)</span></div><div class="t m0 x5 h11 y32da ffa fs5 fcd sc0 ls0 ws4"># Use 2: As a context manager</div><div class="t m0 x5 hf y32db ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0">t:</span></div><div class="t m0 x15 hf y32dc ff8 fs5 fc0 sc0 ls0 ws13a">countdown(<span class="fc7">1000000</span>)</div><div class="t m0 x5 hf y32dd ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(t<span class="fc6 ls34">.</span>elapsed)</span></div><div class="t m0 x5 hf y32de ff7 fs5 fca sc0 ls0 ws15a">with <span class="ff8 fc0 ws1f4">Timer() </span><span class="ws160">as <span class="ff8 fc0">t2:</span></span></div><div class="t m0 x15 hf y2807 ff8 fs5 fc0 sc0 ls0 ws13a">countdown(<span class="fc7">1000000</span>)</div><div class="t m0 x5 hf y2808 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(t2<span class="fc6 ls34">.</span>elapsed)</span></div><div class="t m0 x5 he y1d23 ff2 fs2 fc4 sc0 ls0 wsadf">15.13.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y32df ff1 fs3 fc0 sc0 ls63 ws21f">本节提供了一个简单而实用的类来实现时间记录以及耗时计算<span class="_ _c"></span>。同时也是对使用<span class="_ _1"></span></div><div class="t m0 x5 h7 y32e0 ff4 fs3 fc0 sc0 ls0 wscac">with <span class="ff1">语句以及上下文管理器协议的一个很好的演示。</span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsd97">15.13.<span class="_ _36"> </span>13.13 <span class="ff1 ws125d">实现一个计时器 </span>512</div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
