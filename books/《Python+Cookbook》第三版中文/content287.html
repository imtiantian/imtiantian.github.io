<div id="pf11f" class="pf w0 h0" data-page-no="11f"><div class="pc pc11f w0 h0"><img class="bi x13 y5 w2 ha" alt="" src="bg11f.png"/><div class="t m0 xd h9 y75 ff1 fs3 fc0 sc0 lsb">《<span class="ff2 ls0 wsce">Python Co<span class="_ _6"></span>okb<span class="_ _6"></span>o<span class="_ _6"></span>ok</span><span class="ls0 wsa0">》第三版<span class="ff2 wsce">, Release 2.0.0</span></span></div><div class="t m0 x15 hf y1ab ff8 fs5 fc0 sc0 ls0 ws16e">__slots__ <span class="fc6 ls33">=</span>()</div><div class="t m0 x15 hf y1ad ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key, value):</span></span></span></div><div class="t m0 x16 hf y1ae ff7 fs5 fca sc0 ls0 ws157">if <span class="ff8 fc0 ws158">key </span>in <span class="ff8 ws13a">self<span class="fc0">:</span></span></div><div class="t m0 x17 hf y1af ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">KeyError<span class="fc0 ls34">(</span>str<span class="fc0 ws15f">(key) <span class="fc6 ls33">+<span class="ff9 fc9 ls32">&apos;</span></span><span class="fc9 ws4">already set<span class="ff9 ls34">&apos;</span></span>)</span></span></div><div class="t m0 x16 hf y1b0 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__setitem__(key, value)</span></span></span></div><div class="t m0 x5 hf y411 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">StringKeysMappingMixin<span class="ff8 fc0">:</span></span></div><div class="t m0 x15 h15 yba ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 h11 y8c6 ffa fs5 fc9 sc0 ls0 ws4">Restrict keys to strings only</div><div class="t m0 x15 h15 ybed ffb fs5 fc9 sc0 ls0">&apos;&apos;&apos;</div><div class="t m0 x15 hf ybee ff8 fs5 fc0 sc0 ls0 ws16e">__slots__ <span class="fc6 ls33">=</span>()</div><div class="t m0 x15 hf ybf0 ff7 fs5 fca sc0 ls0 ws139">def <span class="ff8 fcb ws13a">__setitem__<span class="fc0 ls34">(</span><span class="fca">self<span class="fc0 ws4">, key, value):</span></span></span></div><div class="t m0 x16 hf yd7d ff7 fs5 fca sc0 ls0 ws157">if not <span class="ff8 ws13a">isinstance<span class="fc0 ws458">(key, </span>str<span class="fc0">):</span></span></div><div class="t m0 x17 hf ybf1 ff7 fs5 fca sc0 ls0 ws16a">raise <span class="ff8 ws13a">TypeError<span class="fc0">(<span class="ff9 fc9 ls34">&apos;</span><span class="fc9 ws4">keys must be strings<span class="ff9 ws13b">&apos;</span></span>)</span></span></div><div class="t m0 x16 hf ybf2 ff7 fs5 fca sc0 ls0 ws146">return <span class="ff8 ws13a">super<span class="fc0">()<span class="fc6 ls34">.</span><span class="ws13b">__setitem__(key, value)</span></span></span></div><div class="t m0 x0 h9 y1e92 ff1 fs3 fc0 sc0 ls3a ws153">这些类单独使用起来没有任何意义，事实上如果你去实例化任何一个类，除了产生</div><div class="t m0 x5 h9 y17f3 ff1 fs3 fc0 sc0 ls0">异常外没任何作用。它们是用来通过多继承来和其他映射对象混入使用的。例如：</div><div class="t m0 x5 hf y1e93 ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">LoggedDict<span class="ff8 fc0 ws71d">(LoggedMappingMixin, <span class="fca ws13a">dict</span>):</span></span></div><div class="t m0 x15 h10 y1e94 ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y1e95 ff8 fs5 fc0 sc0 ls32">d<span class="fc6 ls33">=</span><span class="ls0">LoggedDict()</span></div><div class="t m0 x5 hf y1e96 ff8 fs5 fc0 sc0 ls0 ws13a">d[<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span>&apos;</span><span class="ls32">]<span class="fc6 ls33">=</span></span><span class="fc7">23</span></div><div class="t m0 x5 hf y1e97 ff7 fs5 fca sc0 ls0 ws156">print<span class="ff8 fc0 ws13a">(d[<span class="ff9 fc9 ls34">&apos;</span><span class="fc9">x<span class="ff9 ls34">&apos;</span></span>])</span></div><div class="t m0 x5 hf y1e98 ff7 fs5 fca sc0 ls0 ws139">del <span class="ff8 fc0 ws13a">d[<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span>&apos;</span>]</span></div><div class="t m0 x5 hf y1e99 ff7 fs5 fca sc0 ls0 ws15a">from <span class="fcc ws168">collections </span><span class="ws146">import <span class="ff8 fc0">defaultdict</span></span></div><div class="t m0 x5 hf y1e9a ff7 fs5 fca sc0 ls0 ws16a">class <span class="fcc ws156">SetOnceDefaultDict<span class="ff8 fc0 ws4">(SetOnceMappingMixin, defaultdict):</span></span></div><div class="t m0 x15 h10 y1e9b ff7 fs5 fca sc0 ls0">pass</div><div class="t m0 x5 hf y1e9c ff8 fs5 fc0 sc0 ls32">d<span class="fc6 ls33">=</span><span class="ls0 ws13a">SetOnceDefaultDict(<span class="fca">list</span>)</span></div><div class="t m0 x5 hf y1e9d ff8 fs5 fc0 sc0 ls0 ws13a">d[<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span>&apos;</span>]<span class="fc6 ls34">.</span>append(<span class="fc7 ls34">2</span>)</div><div class="t m0 x5 hf y1e9e ff8 fs5 fc0 sc0 ls0 ws13a">d[<span class="ff9 fc9 ls34">&apos;<span class="ff8">x</span>&apos;</span>]<span class="fc6 ls34">.</span>append(<span class="fc7 ls34">3</span>)</div><div class="t m0 x5 h11 y1e9f ffa fs5 fcd sc0 ls0 ws4"># d[<span class="ffb ls34">&apos;</span><span class="ws13a">x<span class="ffb ls34">&apos;</span></span>] = 23<span class="_ _29"> </span># KeyError: <span class="ffb ws13b">&apos;</span>x already set<span class="ffb">&apos;</span></div><div class="t m0 x0 h7 y1ea0 ff1 fs3 fc0 sc0 ls16d wsb3e">这个例子中<span class="_ _d"></span>，可以看到混入类跟其他已存在的类 <span class="ff4 ls1b">(</span><span class="ls0 wsb3f">比<span class="_ _0"></span>如 <span class="ff4 wsa5">dict</span><span class="ls185">、</span><span class="ff4 wsb40">defaultdict </span><span class="ls186">和</span><span class="ff4">Or-</span></span></div><div class="t m0 x5 h7 y1ea1 ff4 fs3 fc0 sc0 ls0 ws17b">deredDict) <span class="ff1">结合起来使用，一个接一个。结合后就能发挥正常功效了。</span></div><div class="t m0 x5 he y1ea2 ff2 fs2 fc4 sc0 ls0 wsadf">10.18.3 <span class="ff1">讨论</span></div><div class="t m0 x0 h9 y1ea3 ff1 fs3 fc0 sc0 ls63 ws21f">混入类在标准库中很多地方都出现过<span class="_ _c"></span>，通常都是用来像上面那样扩展某些类的功<span class="_ _1"></span></div><div class="t m0 x5 h9 y1ea4 ff1 fs3 fc0 sc0 ls1e ws111">能<span class="_ _1"></span>。它们也是多继承的一个主要用途。比如<span class="_ _c"></span>，当你编写网络代码时<span class="_ _6"></span>候<span class="_ _1"></span>，你会经常使用</div><div class="t m0 x5 h9 y1ea5 ff6 fs3 fc0 sc0 ls0 wsb41">socketserver <span class="ff1 ws1a7">模块中的 </span><span class="wsb42">ThreadingMixIn <span class="ff1 wsa0">来给其他网络相关类增加多线程支持。<span class="_ _1"></span>例如，</span></span></div><div class="t m0 x5 h9 y29 ff2 fs3 fc0 sc0 ls0 wsae0">10.18.<span class="_ _5"> </span>8.18 <span class="ff1 ws16b">利用 </span><span class="wsb3c">Mixins <span class="ff1 wsb3d">扩展类功能 </span>278</span></div></div><div class="pi" data-data='{"ctm":[1.500000,0.000000,0.000000,1.500000,0.000000,0.000000]}'></div></div>
